(()=>{var e={};e.id=744,e.ids=[744],e.modules={399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},7790:e=>{"use strict";e.exports=require("assert")},8893:e=>{"use strict";e.exports=require("buffer")},1282:e=>{"use strict";e.exports=require("child_process")},4770:e=>{"use strict";e.exports=require("crypto")},7702:e=>{"use strict";e.exports=require("events")},2048:e=>{"use strict";e.exports=require("fs")},2615:e=>{"use strict";e.exports=require("http")},8791:e=>{"use strict";e.exports=require("https")},8216:e=>{"use strict";e.exports=require("net")},9801:e=>{"use strict";e.exports=require("os")},5315:e=>{"use strict";e.exports=require("path")},5816:e=>{"use strict";e.exports=require("process")},6624:e=>{"use strict";e.exports=require("querystring")},6162:e=>{"use strict";e.exports=require("stream")},2452:e=>{"use strict";e.exports=require("tls")},4175:e=>{"use strict";e.exports=require("tty")},7360:e=>{"use strict";e.exports=require("url")},1764:e=>{"use strict";e.exports=require("util")},2623:e=>{"use strict";e.exports=require("worker_threads")},1568:e=>{"use strict";e.exports=require("zlib")},2254:e=>{"use strict";e.exports=require("node:buffer")},7561:e=>{"use strict";e.exports=require("node:fs")},8849:e=>{"use strict";e.exports=require("node:http")},2286:e=>{"use strict";e.exports=require("node:https")},7503:e=>{"use strict";e.exports=require("node:net")},9411:e=>{"use strict";e.exports=require("node:path")},7742:e=>{"use strict";e.exports=require("node:process")},4492:e=>{"use strict";e.exports=require("node:stream")},2477:e=>{"use strict";e.exports=require("node:stream/web")},3020:e=>{"use strict";e.exports=require("node:url")},7261:e=>{"use strict";e.exports=require("node:util")},5628:e=>{"use strict";e.exports=require("node:zlib")},8359:()=>{},3739:()=>{},7509:(e,t,n)=>{"use strict";let r,i;n.r(t),n.d(t,{originalPathname:()=>nB,patchFetch:()=>nV,requestAsyncStorage:()=>nq,routeModule:()=>nG,serverHooks:()=>nH,staticGenerationAsyncStorage:()=>nF});var o,s,a,l,u,c,d,h,p,f,m,g,y,v,_,b,E,T,w,S,A,C,O,I,k,R,N,P,x,U,D,M,j,L,G,q,F,H,B,V,$,W,J,K,Y,z,X,Q,Z,ee,et,en,er,ei,eo={};n.r(eo),n.d(eo,{POST:()=>nL});var es=n(9303),ea=n(8716),el=n(670),eu=n(8277),ec=n(3064),ed=n(2048);let eh=require("fs/promises");var ep=n(4492);let ef=require("node:stream/promises");n(8826),n(263),n(2404);var em=n(9936);n(183);var eg=n(5315);class ey{}function ev(e,t){return e.replace(/\{([^}]+)\}/g,(e,n)=>{if(Object.prototype.hasOwnProperty.call(t,n)){let e=t[n];return null!=e?String(e):""}throw Error(`Key '${n}' not found in valueMap.`)})}function e_(e,t,n){for(let r=0;r<t.length-1;r++){let i=t[r];if(i.endsWith("[]")){let o=i.slice(0,-2);if(!(o in e)){if(Array.isArray(n))e[o]=Array.from({length:n.length},()=>({}));else throw Error(`Value must be a list given an array path ${i}`)}if(Array.isArray(e[o])){let i=e[o];if(Array.isArray(n))for(let e=0;e<i.length;e++)e_(i[e],t.slice(r+1),n[e]);else for(let e of i)e_(e,t.slice(r+1),n)}return}if(i.endsWith("[0]")){let o=i.slice(0,-3);o in e||(e[o]=[{}]),e_(e[o][0],t.slice(r+1),n);return}e[i]&&"object"==typeof e[i]||(e[i]={}),e=e[i]}let r=t[t.length-1],i=e[r];if(void 0!==i){if(!n||"object"==typeof n&&0===Object.keys(n).length||n===i)return;if("object"==typeof i&&"object"==typeof n&&null!==i&&null!==n)Object.assign(i,n);else throw Error(`Cannot set value for an existing key. Key: ${r}`)}else"_self"!==r||"object"!=typeof n||null===n||Array.isArray(n)?e[r]=n:Object.assign(e,n)}function eb(e,t,n){try{if(1===t.length&&"_self"===t[0])return e;for(let r=0;r<t.length;r++){if("object"!=typeof e||null===e)return n;let i=t[r];if(i.endsWith("[]")){let o=i.slice(0,-2);if(!(o in e))return n;{let i=e[o];if(!Array.isArray(i))return n;return i.map(e=>eb(e,t.slice(r+1),n))}}e=e[i]}return e}catch(e){if(e instanceof TypeError)return n;throw e}}function eE(e){if("string"!=typeof e)throw Error("fromImageBytes must be a string");return e}function eT(e){let t={},n=eb(e,["name"]);null!=n&&e_(t,["name"],n);let r=eb(e,["metadata"]);null!=r&&e_(t,["metadata"],r);let i=eb(e,["done"]);null!=i&&e_(t,["done"],i);let o=eb(e,["error"]);null!=o&&e_(t,["error"],o);let s=eb(e,["response"]);return null!=s&&e_(t,["response"],function(e){let t={},n=eb(e,["sdkHttpResponse"]);null!=n&&e_(t,["sdkHttpResponse"],n);let r=eb(e,["parent"]);null!=r&&e_(t,["parent"],r);let i=eb(e,["documentName"]);return null!=i&&e_(t,["documentName"],i),t}(s)),t}(function(e){e.OUTCOME_UNSPECIFIED="OUTCOME_UNSPECIFIED",e.OUTCOME_OK="OUTCOME_OK",e.OUTCOME_FAILED="OUTCOME_FAILED",e.OUTCOME_DEADLINE_EXCEEDED="OUTCOME_DEADLINE_EXCEEDED"})(o||(o={})),function(e){e.LANGUAGE_UNSPECIFIED="LANGUAGE_UNSPECIFIED",e.PYTHON="PYTHON"}(s||(s={})),function(e){e.SCHEDULING_UNSPECIFIED="SCHEDULING_UNSPECIFIED",e.SILENT="SILENT",e.WHEN_IDLE="WHEN_IDLE",e.INTERRUPT="INTERRUPT"}(a||(a={})),function(e){e.TYPE_UNSPECIFIED="TYPE_UNSPECIFIED",e.STRING="STRING",e.NUMBER="NUMBER",e.INTEGER="INTEGER",e.BOOLEAN="BOOLEAN",e.ARRAY="ARRAY",e.OBJECT="OBJECT",e.NULL="NULL"}(l||(l={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"}(u||(u={})),function(e){e.API_SPEC_UNSPECIFIED="API_SPEC_UNSPECIFIED",e.SIMPLE_SEARCH="SIMPLE_SEARCH",e.ELASTIC_SEARCH="ELASTIC_SEARCH"}(c||(c={})),function(e){e.AUTH_TYPE_UNSPECIFIED="AUTH_TYPE_UNSPECIFIED",e.NO_AUTH="NO_AUTH",e.API_KEY_AUTH="API_KEY_AUTH",e.HTTP_BASIC_AUTH="HTTP_BASIC_AUTH",e.GOOGLE_SERVICE_ACCOUNT_AUTH="GOOGLE_SERVICE_ACCOUNT_AUTH",e.OAUTH="OAUTH",e.OIDC_AUTH="OIDC_AUTH"}(d||(d={})),function(e){e.HTTP_IN_UNSPECIFIED="HTTP_IN_UNSPECIFIED",e.HTTP_IN_QUERY="HTTP_IN_QUERY",e.HTTP_IN_HEADER="HTTP_IN_HEADER",e.HTTP_IN_PATH="HTTP_IN_PATH",e.HTTP_IN_BODY="HTTP_IN_BODY",e.HTTP_IN_COOKIE="HTTP_IN_COOKIE"}(h||(h={})),function(e){e.PHISH_BLOCK_THRESHOLD_UNSPECIFIED="PHISH_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_HIGH_AND_ABOVE="BLOCK_HIGH_AND_ABOVE",e.BLOCK_HIGHER_AND_ABOVE="BLOCK_HIGHER_AND_ABOVE",e.BLOCK_VERY_HIGH_AND_ABOVE="BLOCK_VERY_HIGH_AND_ABOVE",e.BLOCK_ONLY_EXTREMELY_HIGH="BLOCK_ONLY_EXTREMELY_HIGH"}(p||(p={})),function(e){e.HARM_CATEGORY_UNSPECIFIED="HARM_CATEGORY_UNSPECIFIED",e.HARM_CATEGORY_HARASSMENT="HARM_CATEGORY_HARASSMENT",e.HARM_CATEGORY_HATE_SPEECH="HARM_CATEGORY_HATE_SPEECH",e.HARM_CATEGORY_SEXUALLY_EXPLICIT="HARM_CATEGORY_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_DANGEROUS_CONTENT="HARM_CATEGORY_DANGEROUS_CONTENT",e.HARM_CATEGORY_CIVIC_INTEGRITY="HARM_CATEGORY_CIVIC_INTEGRITY",e.HARM_CATEGORY_IMAGE_HATE="HARM_CATEGORY_IMAGE_HATE",e.HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT="HARM_CATEGORY_IMAGE_DANGEROUS_CONTENT",e.HARM_CATEGORY_IMAGE_HARASSMENT="HARM_CATEGORY_IMAGE_HARASSMENT",e.HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT="HARM_CATEGORY_IMAGE_SEXUALLY_EXPLICIT",e.HARM_CATEGORY_JAILBREAK="HARM_CATEGORY_JAILBREAK"}(f||(f={})),function(e){e.HARM_BLOCK_METHOD_UNSPECIFIED="HARM_BLOCK_METHOD_UNSPECIFIED",e.SEVERITY="SEVERITY",e.PROBABILITY="PROBABILITY"}(m||(m={})),function(e){e.HARM_BLOCK_THRESHOLD_UNSPECIFIED="HARM_BLOCK_THRESHOLD_UNSPECIFIED",e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE",e.OFF="OFF"}(g||(g={})),function(e){e.FINISH_REASON_UNSPECIFIED="FINISH_REASON_UNSPECIFIED",e.STOP="STOP",e.MAX_TOKENS="MAX_TOKENS",e.SAFETY="SAFETY",e.RECITATION="RECITATION",e.LANGUAGE="LANGUAGE",e.OTHER="OTHER",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.SPII="SPII",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.IMAGE_SAFETY="IMAGE_SAFETY",e.UNEXPECTED_TOOL_CALL="UNEXPECTED_TOOL_CALL",e.IMAGE_PROHIBITED_CONTENT="IMAGE_PROHIBITED_CONTENT",e.NO_IMAGE="NO_IMAGE"}(y||(y={})),function(e){e.HARM_PROBABILITY_UNSPECIFIED="HARM_PROBABILITY_UNSPECIFIED",e.NEGLIGIBLE="NEGLIGIBLE",e.LOW="LOW",e.MEDIUM="MEDIUM",e.HIGH="HIGH"}(v||(v={})),function(e){e.HARM_SEVERITY_UNSPECIFIED="HARM_SEVERITY_UNSPECIFIED",e.HARM_SEVERITY_NEGLIGIBLE="HARM_SEVERITY_NEGLIGIBLE",e.HARM_SEVERITY_LOW="HARM_SEVERITY_LOW",e.HARM_SEVERITY_MEDIUM="HARM_SEVERITY_MEDIUM",e.HARM_SEVERITY_HIGH="HARM_SEVERITY_HIGH"}(_||(_={})),function(e){e.URL_RETRIEVAL_STATUS_UNSPECIFIED="URL_RETRIEVAL_STATUS_UNSPECIFIED",e.URL_RETRIEVAL_STATUS_SUCCESS="URL_RETRIEVAL_STATUS_SUCCESS",e.URL_RETRIEVAL_STATUS_ERROR="URL_RETRIEVAL_STATUS_ERROR",e.URL_RETRIEVAL_STATUS_PAYWALL="URL_RETRIEVAL_STATUS_PAYWALL",e.URL_RETRIEVAL_STATUS_UNSAFE="URL_RETRIEVAL_STATUS_UNSAFE"}(b||(b={})),function(e){e.BLOCKED_REASON_UNSPECIFIED="BLOCKED_REASON_UNSPECIFIED",e.SAFETY="SAFETY",e.OTHER="OTHER",e.BLOCKLIST="BLOCKLIST",e.PROHIBITED_CONTENT="PROHIBITED_CONTENT",e.IMAGE_SAFETY="IMAGE_SAFETY",e.MODEL_ARMOR="MODEL_ARMOR",e.JAILBREAK="JAILBREAK"}(E||(E={})),function(e){e.TRAFFIC_TYPE_UNSPECIFIED="TRAFFIC_TYPE_UNSPECIFIED",e.ON_DEMAND="ON_DEMAND",e.PROVISIONED_THROUGHPUT="PROVISIONED_THROUGHPUT"}(T||(T={})),function(e){e.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",e.TEXT="TEXT",e.IMAGE="IMAGE",e.AUDIO="AUDIO"}(w||(w={})),function(e){e.MEDIA_RESOLUTION_UNSPECIFIED="MEDIA_RESOLUTION_UNSPECIFIED",e.MEDIA_RESOLUTION_LOW="MEDIA_RESOLUTION_LOW",e.MEDIA_RESOLUTION_MEDIUM="MEDIA_RESOLUTION_MEDIUM",e.MEDIA_RESOLUTION_HIGH="MEDIA_RESOLUTION_HIGH"}(S||(S={})),function(e){e.TUNING_MODE_UNSPECIFIED="TUNING_MODE_UNSPECIFIED",e.TUNING_MODE_FULL="TUNING_MODE_FULL",e.TUNING_MODE_PEFT_ADAPTER="TUNING_MODE_PEFT_ADAPTER"}(A||(A={})),function(e){e.ADAPTER_SIZE_UNSPECIFIED="ADAPTER_SIZE_UNSPECIFIED",e.ADAPTER_SIZE_ONE="ADAPTER_SIZE_ONE",e.ADAPTER_SIZE_TWO="ADAPTER_SIZE_TWO",e.ADAPTER_SIZE_FOUR="ADAPTER_SIZE_FOUR",e.ADAPTER_SIZE_EIGHT="ADAPTER_SIZE_EIGHT",e.ADAPTER_SIZE_SIXTEEN="ADAPTER_SIZE_SIXTEEN",e.ADAPTER_SIZE_THIRTY_TWO="ADAPTER_SIZE_THIRTY_TWO"}(C||(C={})),function(e){e.JOB_STATE_UNSPECIFIED="JOB_STATE_UNSPECIFIED",e.JOB_STATE_QUEUED="JOB_STATE_QUEUED",e.JOB_STATE_PENDING="JOB_STATE_PENDING",e.JOB_STATE_RUNNING="JOB_STATE_RUNNING",e.JOB_STATE_SUCCEEDED="JOB_STATE_SUCCEEDED",e.JOB_STATE_FAILED="JOB_STATE_FAILED",e.JOB_STATE_CANCELLING="JOB_STATE_CANCELLING",e.JOB_STATE_CANCELLED="JOB_STATE_CANCELLED",e.JOB_STATE_PAUSED="JOB_STATE_PAUSED",e.JOB_STATE_EXPIRED="JOB_STATE_EXPIRED",e.JOB_STATE_UPDATING="JOB_STATE_UPDATING",e.JOB_STATE_PARTIALLY_SUCCEEDED="JOB_STATE_PARTIALLY_SUCCEEDED"}(O||(O={})),function(e){e.TUNING_TASK_UNSPECIFIED="TUNING_TASK_UNSPECIFIED",e.TUNING_TASK_I2V="TUNING_TASK_I2V",e.TUNING_TASK_T2V="TUNING_TASK_T2V",e.TUNING_TASK_R2V="TUNING_TASK_R2V"}(I||(I={})),function(e){e.FEATURE_SELECTION_PREFERENCE_UNSPECIFIED="FEATURE_SELECTION_PREFERENCE_UNSPECIFIED",e.PRIORITIZE_QUALITY="PRIORITIZE_QUALITY",e.BALANCED="BALANCED",e.PRIORITIZE_COST="PRIORITIZE_COST"}(k||(k={})),function(e){e.UNSPECIFIED="UNSPECIFIED",e.BLOCKING="BLOCKING",e.NON_BLOCKING="NON_BLOCKING"}(R||(R={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.MODE_DYNAMIC="MODE_DYNAMIC"}(N||(N={})),function(e){e.ENVIRONMENT_UNSPECIFIED="ENVIRONMENT_UNSPECIFIED",e.ENVIRONMENT_BROWSER="ENVIRONMENT_BROWSER"}(P||(P={})),function(e){e.MODE_UNSPECIFIED="MODE_UNSPECIFIED",e.AUTO="AUTO",e.ANY="ANY",e.NONE="NONE",e.VALIDATED="VALIDATED"}(x||(x={})),function(e){e.BLOCK_LOW_AND_ABOVE="BLOCK_LOW_AND_ABOVE",e.BLOCK_MEDIUM_AND_ABOVE="BLOCK_MEDIUM_AND_ABOVE",e.BLOCK_ONLY_HIGH="BLOCK_ONLY_HIGH",e.BLOCK_NONE="BLOCK_NONE"}(U||(U={})),function(e){e.DONT_ALLOW="DONT_ALLOW",e.ALLOW_ADULT="ALLOW_ADULT",e.ALLOW_ALL="ALLOW_ALL"}(D||(D={})),function(e){e.auto="auto",e.en="en",e.ja="ja",e.ko="ko",e.hi="hi",e.zh="zh",e.pt="pt",e.es="es"}(M||(M={})),function(e){e.MASK_MODE_DEFAULT="MASK_MODE_DEFAULT",e.MASK_MODE_USER_PROVIDED="MASK_MODE_USER_PROVIDED",e.MASK_MODE_BACKGROUND="MASK_MODE_BACKGROUND",e.MASK_MODE_FOREGROUND="MASK_MODE_FOREGROUND",e.MASK_MODE_SEMANTIC="MASK_MODE_SEMANTIC"}(j||(j={})),function(e){e.CONTROL_TYPE_DEFAULT="CONTROL_TYPE_DEFAULT",e.CONTROL_TYPE_CANNY="CONTROL_TYPE_CANNY",e.CONTROL_TYPE_SCRIBBLE="CONTROL_TYPE_SCRIBBLE",e.CONTROL_TYPE_FACE_MESH="CONTROL_TYPE_FACE_MESH"}(L||(L={})),function(e){e.SUBJECT_TYPE_DEFAULT="SUBJECT_TYPE_DEFAULT",e.SUBJECT_TYPE_PERSON="SUBJECT_TYPE_PERSON",e.SUBJECT_TYPE_ANIMAL="SUBJECT_TYPE_ANIMAL",e.SUBJECT_TYPE_PRODUCT="SUBJECT_TYPE_PRODUCT"}(G||(G={})),function(e){e.EDIT_MODE_DEFAULT="EDIT_MODE_DEFAULT",e.EDIT_MODE_INPAINT_REMOVAL="EDIT_MODE_INPAINT_REMOVAL",e.EDIT_MODE_INPAINT_INSERTION="EDIT_MODE_INPAINT_INSERTION",e.EDIT_MODE_OUTPAINT="EDIT_MODE_OUTPAINT",e.EDIT_MODE_CONTROLLED_EDITING="EDIT_MODE_CONTROLLED_EDITING",e.EDIT_MODE_STYLE="EDIT_MODE_STYLE",e.EDIT_MODE_BGSWAP="EDIT_MODE_BGSWAP",e.EDIT_MODE_PRODUCT_IMAGE="EDIT_MODE_PRODUCT_IMAGE"}(q||(q={})),function(e){e.FOREGROUND="FOREGROUND",e.BACKGROUND="BACKGROUND",e.PROMPT="PROMPT",e.SEMANTIC="SEMANTIC",e.INTERACTIVE="INTERACTIVE"}(F||(F={})),function(e){e.ASSET="ASSET",e.STYLE="STYLE"}(H||(H={})),function(e){e.INSERT="INSERT",e.REMOVE="REMOVE",e.REMOVE_STATIC="REMOVE_STATIC",e.OUTPAINT="OUTPAINT"}(B||(B={})),function(e){e.OPTIMIZED="OPTIMIZED",e.LOSSLESS="LOSSLESS"}(V||(V={})),function(e){e.SUPERVISED_FINE_TUNING="SUPERVISED_FINE_TUNING",e.PREFERENCE_TUNING="PREFERENCE_TUNING"}($||($={})),function(e){e.STATE_UNSPECIFIED="STATE_UNSPECIFIED",e.STATE_PENDING="STATE_PENDING",e.STATE_ACTIVE="STATE_ACTIVE",e.STATE_FAILED="STATE_FAILED"}(W||(W={})),function(e){e.STATE_UNSPECIFIED="STATE_UNSPECIFIED",e.PROCESSING="PROCESSING",e.ACTIVE="ACTIVE",e.FAILED="FAILED"}(J||(J={})),function(e){e.SOURCE_UNSPECIFIED="SOURCE_UNSPECIFIED",e.UPLOADED="UPLOADED",e.GENERATED="GENERATED"}(K||(K={})),function(e){e.TURN_COMPLETE_REASON_UNSPECIFIED="TURN_COMPLETE_REASON_UNSPECIFIED",e.MALFORMED_FUNCTION_CALL="MALFORMED_FUNCTION_CALL",e.RESPONSE_REJECTED="RESPONSE_REJECTED",e.NEED_MORE_INPUT="NEED_MORE_INPUT"}(Y||(Y={})),function(e){e.MODALITY_UNSPECIFIED="MODALITY_UNSPECIFIED",e.TEXT="TEXT",e.IMAGE="IMAGE",e.VIDEO="VIDEO",e.AUDIO="AUDIO",e.DOCUMENT="DOCUMENT"}(z||(z={})),function(e){e.START_SENSITIVITY_UNSPECIFIED="START_SENSITIVITY_UNSPECIFIED",e.START_SENSITIVITY_HIGH="START_SENSITIVITY_HIGH",e.START_SENSITIVITY_LOW="START_SENSITIVITY_LOW"}(X||(X={})),function(e){e.END_SENSITIVITY_UNSPECIFIED="END_SENSITIVITY_UNSPECIFIED",e.END_SENSITIVITY_HIGH="END_SENSITIVITY_HIGH",e.END_SENSITIVITY_LOW="END_SENSITIVITY_LOW"}(Q||(Q={})),function(e){e.ACTIVITY_HANDLING_UNSPECIFIED="ACTIVITY_HANDLING_UNSPECIFIED",e.START_OF_ACTIVITY_INTERRUPTS="START_OF_ACTIVITY_INTERRUPTS",e.NO_INTERRUPTION="NO_INTERRUPTION"}(Z||(Z={})),function(e){e.TURN_COVERAGE_UNSPECIFIED="TURN_COVERAGE_UNSPECIFIED",e.TURN_INCLUDES_ONLY_ACTIVITY="TURN_INCLUDES_ONLY_ACTIVITY",e.TURN_INCLUDES_ALL_INPUT="TURN_INCLUDES_ALL_INPUT"}(ee||(ee={})),function(e){e.SCALE_UNSPECIFIED="SCALE_UNSPECIFIED",e.C_MAJOR_A_MINOR="C_MAJOR_A_MINOR",e.D_FLAT_MAJOR_B_FLAT_MINOR="D_FLAT_MAJOR_B_FLAT_MINOR",e.D_MAJOR_B_MINOR="D_MAJOR_B_MINOR",e.E_FLAT_MAJOR_C_MINOR="E_FLAT_MAJOR_C_MINOR",e.E_MAJOR_D_FLAT_MINOR="E_MAJOR_D_FLAT_MINOR",e.F_MAJOR_D_MINOR="F_MAJOR_D_MINOR",e.G_FLAT_MAJOR_E_FLAT_MINOR="G_FLAT_MAJOR_E_FLAT_MINOR",e.G_MAJOR_E_MINOR="G_MAJOR_E_MINOR",e.A_FLAT_MAJOR_F_MINOR="A_FLAT_MAJOR_F_MINOR",e.A_MAJOR_G_FLAT_MINOR="A_MAJOR_G_FLAT_MINOR",e.B_FLAT_MAJOR_G_MINOR="B_FLAT_MAJOR_G_MINOR",e.B_MAJOR_A_FLAT_MINOR="B_MAJOR_A_FLAT_MINOR"}(et||(et={})),function(e){e.MUSIC_GENERATION_MODE_UNSPECIFIED="MUSIC_GENERATION_MODE_UNSPECIFIED",e.QUALITY="QUALITY",e.DIVERSITY="DIVERSITY",e.VOCALIZATION="VOCALIZATION"}(en||(en={})),function(e){e.PLAYBACK_CONTROL_UNSPECIFIED="PLAYBACK_CONTROL_UNSPECIFIED",e.PLAY="PLAY",e.PAUSE="PAUSE",e.STOP="STOP",e.RESET_CONTEXT="RESET_CONTEXT"}(er||(er={}));class ew{constructor(e){let t={};for(let n of e.headers.entries())t[n[0]]=n[1];this.headers=t,this.responseInternal=e}json(){return this.responseInternal.json()}}class eS{get text(){var e,t,n,r,i,o,s,a;if((null===(r=null===(n=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===n?void 0:n.parts)||void 0===r?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning text from the first one.");let l="",u=!1,c=[];for(let e of null!==(a=null===(s=null===(o=null===(i=this.candidates)||void 0===i?void 0:i[0])||void 0===o?void 0:o.content)||void 0===s?void 0:s.parts)&&void 0!==a?a:[]){for(let[t,n]of Object.entries(e))"text"!==t&&"thought"!==t&&"thoughtSignature"!==t&&(null!==n||void 0!==n)&&c.push(t);if("string"==typeof e.text){if("boolean"==typeof e.thought&&e.thought)continue;u=!0,l+=e.text}}return c.length>0&&console.warn(`there are non-text parts ${c} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),u?l:void 0}get data(){var e,t,n,r,i,o,s,a;if((null===(r=null===(n=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===n?void 0:n.parts)||void 0===r?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning data from the first one.");let l="",u=[];for(let e of null!==(a=null===(s=null===(o=null===(i=this.candidates)||void 0===i?void 0:i[0])||void 0===o?void 0:o.content)||void 0===s?void 0:s.parts)&&void 0!==a?a:[]){for(let[t,n]of Object.entries(e))"inlineData"!==t&&(null!==n||void 0!==n)&&u.push(t);e.inlineData&&"string"==typeof e.inlineData.data&&(l+=atob(e.inlineData.data))}return u.length>0&&console.warn(`there are non-data parts ${u} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),l.length>0?btoa(l):void 0}get functionCalls(){var e,t,n,r,i,o,s,a;if((null===(r=null===(n=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===n?void 0:n.parts)||void 0===r?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning function calls from the first one.");let l=null===(a=null===(s=null===(o=null===(i=this.candidates)||void 0===i?void 0:i[0])||void 0===o?void 0:o.content)||void 0===s?void 0:s.parts)||void 0===a?void 0:a.filter(e=>e.functionCall).map(e=>e.functionCall).filter(e=>void 0!==e);if((null==l?void 0:l.length)!==0)return l}get executableCode(){var e,t,n,r,i,o,s,a,l;if((null===(r=null===(n=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===n?void 0:n.parts)||void 0===r?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning executable code from the first one.");let u=null===(a=null===(s=null===(o=null===(i=this.candidates)||void 0===i?void 0:i[0])||void 0===o?void 0:o.content)||void 0===s?void 0:s.parts)||void 0===a?void 0:a.filter(e=>e.executableCode).map(e=>e.executableCode).filter(e=>void 0!==e);if((null==u?void 0:u.length)!==0)return null===(l=null==u?void 0:u[0])||void 0===l?void 0:l.code}get codeExecutionResult(){var e,t,n,r,i,o,s,a,l;if((null===(r=null===(n=null===(t=null===(e=this.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content)||void 0===n?void 0:n.parts)||void 0===r?void 0:r.length)===0)return;this.candidates&&this.candidates.length>1&&console.warn("there are multiple candidates in the response, returning code execution result from the first one.");let u=null===(a=null===(s=null===(o=null===(i=this.candidates)||void 0===i?void 0:i[0])||void 0===o?void 0:o.content)||void 0===s?void 0:s.parts)||void 0===a?void 0:a.filter(e=>e.codeExecutionResult).map(e=>e.codeExecutionResult).filter(e=>void 0!==e);if((null==u?void 0:u.length)!==0)return null===(l=null==u?void 0:u[0])||void 0===l?void 0:l.output}}class eA{}class eC{}class eO{}class eI{}class ek{}class eR{}class eN{}class eP{}class ex{}class eU{}class eD{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new eD;return Object.assign(n,t?function(e){let t={},n=eb(e,["name"]);null!=n&&e_(t,["name"],n);let r=eb(e,["metadata"]);null!=r&&e_(t,["metadata"],r);let i=eb(e,["done"]);null!=i&&e_(t,["done"],i);let o=eb(e,["error"]);null!=o&&e_(t,["error"],o);let s=eb(e,["response"]);return null!=s&&e_(t,["response"],function(e){let t={},n=eb(e,["videos"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eb(e,["_self"]);return null!=n&&e_(t,["video"],function(e){let t={},n=eb(e,["gcsUri"]);null!=n&&e_(t,["uri"],n);let r=eb(e,["bytesBase64Encoded"]);null!=r&&e_(t,["videoBytes"],eE(r));let i=eb(e,["mimeType"]);return null!=i&&e_(t,["mimeType"],i),t}(n)),t})(e))),e_(t,["generatedVideos"],e)}let r=eb(e,["raiMediaFilteredCount"]);null!=r&&e_(t,["raiMediaFilteredCount"],r);let i=eb(e,["raiMediaFilteredReasons"]);return null!=i&&e_(t,["raiMediaFilteredReasons"],i),t}(s)),t}(e):function(e){let t={},n=eb(e,["name"]);null!=n&&e_(t,["name"],n);let r=eb(e,["metadata"]);null!=r&&e_(t,["metadata"],r);let i=eb(e,["done"]);null!=i&&e_(t,["done"],i);let o=eb(e,["error"]);null!=o&&e_(t,["error"],o);let s=eb(e,["response","generateVideoResponse"]);return null!=s&&e_(t,["response"],function(e){let t={},n=eb(e,["generatedSamples"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eb(e,["video"]);return null!=n&&e_(t,["video"],function(e){let t={},n=eb(e,["uri"]);null!=n&&e_(t,["uri"],n);let r=eb(e,["encodedVideo"]);null!=r&&e_(t,["videoBytes"],eE(r));let i=eb(e,["encoding"]);return null!=i&&e_(t,["mimeType"],i),t}(n)),t})(e))),e_(t,["generatedVideos"],e)}let r=eb(e,["raiMediaFilteredCount"]);null!=r&&e_(t,["raiMediaFilteredCount"],r);let i=eb(e,["raiMediaFilteredReasons"]);return null!=i&&e_(t,["raiMediaFilteredReasons"],i),t}(s)),t}(e)),n}}class eM{}class ej{}class eL{}class eG{}class eq{}class eF{}class eH{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new eH;return Object.assign(n,function(e){let t={},n=eb(e,["name"]);null!=n&&e_(t,["name"],n);let r=eb(e,["metadata"]);null!=r&&e_(t,["metadata"],r);let i=eb(e,["done"]);null!=i&&e_(t,["done"],i);let o=eb(e,["error"]);null!=o&&e_(t,["error"],o);let s=eb(e,["response"]);return null!=s&&e_(t,["response"],function(e){let t={},n=eb(e,["sdkHttpResponse"]);null!=n&&e_(t,["sdkHttpResponse"],n);let r=eb(e,["parent"]);null!=r&&e_(t,["parent"],r);let i=eb(e,["documentName"]);return null!=i&&e_(t,["documentName"],i),t}(s)),t}(e)),n}}class eB{}class eV{}class e${}class eW{}class eJ{get text(){var e,t,n;let r="",i=!1,o=[];for(let s of null!==(n=null===(t=null===(e=this.serverContent)||void 0===e?void 0:e.modelTurn)||void 0===t?void 0:t.parts)&&void 0!==n?n:[]){for(let[e,t]of Object.entries(s))"text"!==e&&"thought"!==e&&null!==t&&o.push(e);if("string"==typeof s.text){if("boolean"==typeof s.thought&&s.thought)continue;i=!0,r+=s.text}}return o.length>0&&console.warn(`there are non-text parts ${o} in the response, returning concatenation of all text parts. Please refer to the non text parts for a full response from model.`),i?r:void 0}get data(){var e,t,n;let r="",i=[];for(let o of null!==(n=null===(t=null===(e=this.serverContent)||void 0===e?void 0:e.modelTurn)||void 0===t?void 0:t.parts)&&void 0!==n?n:[]){for(let[e,t]of Object.entries(o))"inlineData"!==e&&null!==t&&i.push(e);o.inlineData&&"string"==typeof o.inlineData.data&&(r+=atob(o.inlineData.data))}return i.length>0&&console.warn(`there are non-data parts ${i} in the response, returning concatenation of all data parts. Please refer to the non data parts for a full response from model.`),r.length>0?btoa(r):void 0}}class eK{get audioChunk(){if(this.serverContent&&this.serverContent.audioChunks&&this.serverContent.audioChunks.length>0)return this.serverContent.audioChunks[0]}}class eY{_fromAPIResponse({apiResponse:e,_isVertexAI:t}){let n=new eY;return Object.assign(n,eT(e)),n}}function ez(e,t){if(!t||"string"!=typeof t)throw Error("model is required and must be a string");if(t.includes("..")||t.includes("?")||t.includes("&"))throw Error("invalid model parameter");if(e.isVertexAI()){if(t.startsWith("publishers/")||t.startsWith("projects/")||t.startsWith("models/"))return t;if(!(t.indexOf("/")>=0))return`publishers/google/models/${t}`;{let e=t.split("/",2);return`publishers/${e[0]}/models/${e[1]}`}}return t.startsWith("models/")||t.startsWith("tunedModels/")?t:`models/${t}`}function eX(e,t){let n=ez(e,t);return n?n.startsWith("publishers/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/${n}`:n.startsWith("models/")&&e.isVertexAI()?`projects/${e.getProject()}/locations/${e.getLocation()}/publishers/google/${n}`:n:""}function eQ(e){return Array.isArray(e)?e.map(e=>eZ(e)):[eZ(e)]}function eZ(e){if("object"==typeof e&&null!==e)return e;throw Error(`Could not parse input as Blob. Unsupported blob type: ${typeof e}`)}function e0(e){let t=eZ(e);if(t.mimeType&&t.mimeType.startsWith("image/"))return t;throw Error(`Unsupported mime type: ${t.mimeType}`)}function e1(e){let t=eZ(e);if(t.mimeType&&t.mimeType.startsWith("audio/"))return t;throw Error(`Unsupported mime type: ${t.mimeType}`)}function e2(e){if(null==e)throw Error("PartUnion is required");if("object"==typeof e)return e;if("string"==typeof e)return{text:e};throw Error(`Unsupported part type: ${typeof e}`)}function e4(e){if(null==e||Array.isArray(e)&&0===e.length)throw Error("PartListUnion is required");return Array.isArray(e)?e.map(e=>e2(e)):[e2(e)]}function e8(e){return null!=e&&"object"==typeof e&&"parts"in e&&Array.isArray(e.parts)}function e6(e){return null!=e&&"object"==typeof e&&"functionCall"in e}function e3(e){return null!=e&&"object"==typeof e&&"functionResponse"in e}function e5(e){if(null==e)throw Error("ContentUnion is required");return e8(e)?e:{role:"user",parts:e4(e)}}function e9(e,t){if(!t)return[];if(e.isVertexAI()&&Array.isArray(t))return t.flatMap(e=>{let t=e5(e);return t.parts&&t.parts.length>0&&void 0!==t.parts[0].text?[t.parts[0].text]:[]});if(e.isVertexAI()){let e=e5(t);return e.parts&&e.parts.length>0&&void 0!==e.parts[0].text?[e.parts[0].text]:[]}return Array.isArray(t)?t.map(e=>e5(e)):[e5(t)]}function e7(e){if(null==e||Array.isArray(e)&&0===e.length)throw Error("contents are required");if(!Array.isArray(e)){if(e6(e)||e3(e))throw Error("To specify functionCall or functionResponse parts, please wrap them in a Content object, specifying the role for them");return[e5(e)]}let t=[],n=[],r=e8(e[0]);for(let i of e){let e=e8(i);if(e!=r)throw Error("Mixing Content and Parts is not supported, please group the parts into a the appropriate Content objects and specify the roles for them");if(e)t.push(i);else if(e6(i)||e3(i))throw Error("To specify functionCall or functionResponse parts, please wrap them, and any other parts, in Content objects as appropriate, specifying the role for them");else n.push(i)}return r||t.push({role:"user",parts:e4(n)}),t}function te(e){let t={},n=["items"],r=["anyOf"],i=["properties"];if(e.type&&e.anyOf)throw Error("type and anyOf cannot be both populated.");let o=e.anyOf;for(let[s,a]of(null!=o&&2==o.length&&("null"===o[0].type?(t.nullable=!0,e=o[1]):"null"===o[1].type&&(t.nullable=!0,e=o[0])),e.type instanceof Array&&function(e,t){e.includes("null")&&(t.nullable=!0);let n=e.filter(e=>"null"!==e);if(1===n.length)t.type=Object.values(l).includes(n[0].toUpperCase())?n[0].toUpperCase():l.TYPE_UNSPECIFIED;else for(let e of(t.anyOf=[],n))t.anyOf.push({type:Object.values(l).includes(e.toUpperCase())?e.toUpperCase():l.TYPE_UNSPECIFIED})}(e.type,t),Object.entries(e)))if(null!=a){if("type"==s){if("null"===a)throw Error("type: null can not be the only possible type for the field.");if(a instanceof Array)continue;t.type=Object.values(l).includes(a.toUpperCase())?a.toUpperCase():l.TYPE_UNSPECIFIED}else if(n.includes(s))t[s]=te(a);else if(r.includes(s)){let e=[];for(let n of a){if("null"==n.type){t.nullable=!0;continue}e.push(te(n))}t[s]=e}else if(i.includes(s)){let e={};for(let[t,n]of Object.entries(a))e[t]=te(n);t[s]=e}else{if("additionalProperties"===s)continue;t[s]=a}}return t}function tt(e){if("object"==typeof e)return e;if("string"==typeof e)return{voiceConfig:{prebuiltVoiceConfig:{voiceName:e}}};throw Error(`Unsupported speechConfig type: ${typeof e}`)}function tn(e){if("multiSpeakerVoiceConfig"in e)throw Error("multiSpeakerVoiceConfig is not supported in the live API.");return e}function tr(e){if(e.functionDeclarations)for(let t of e.functionDeclarations)t.parameters&&(Object.keys(t.parameters).includes("$schema")?t.parametersJsonSchema||(t.parametersJsonSchema=t.parameters,delete t.parameters):t.parameters=te(t.parameters)),t.response&&(Object.keys(t.response).includes("$schema")?t.responseJsonSchema||(t.responseJsonSchema=t.response,delete t.response):t.response=te(t.response));return e}function ti(e){if(null==e)throw Error("tools is required");if(!Array.isArray(e))throw Error("tools is required and must be an array of Tools");let t=[];for(let n of e)t.push(n);return t}function to(e,t){if("string"!=typeof t)throw Error("name must be a string");return function(e,t,n,r=1){let i=!t.startsWith(`${n}/`)&&t.split("/").length===r;if(e.isVertexAI())return t.startsWith("projects/")?t:t.startsWith("locations/")?`projects/${e.getProject()}/${t}`:t.startsWith(`${n}/`)?`projects/${e.getProject()}/locations/${e.getLocation()}/${t}`:i?`projects/${e.getProject()}/locations/${e.getLocation()}/${n}/${t}`:t;return i?`${n}/${t}`:t}(e,t,"cachedContents")}function ts(e){switch(e){case"STATE_UNSPECIFIED":return"JOB_STATE_UNSPECIFIED";case"CREATING":return"JOB_STATE_RUNNING";case"ACTIVE":return"JOB_STATE_SUCCEEDED";case"FAILED":return"JOB_STATE_FAILED";default:return e}}function ta(e){return null!=e&&"object"==typeof e&&"video"in e}function tl(e){return null!=e&&"object"==typeof e&&"uri"in e}function tu(e){var t;let n;if(null!=e&&"object"==typeof e&&"name"in e&&(n=e.name),!(tl(e)&&void 0===(n=e.uri)||ta(e)&&void 0===(n=null===(t=e.video)||void 0===t?void 0:t.uri))){if("string"==typeof e&&(n=e),void 0===n)throw Error("Could not extract file name from the provided input.");if(n.startsWith("https://")){let e=n.split("files/")[1].match(/[a-z0-9]+/);if(null===e)throw Error(`Could not extract file name from URI ${n}`);n=e[0]}else n.startsWith("files/")&&(n=n.split("files/")[1]);return n}}function tc(e,t){return e.isVertexAI()?t?"publishers/google/models":"models":t?"models":"tunedModels"}function td(e){for(let t of["models","tunedModels","publisherModels"]){if(null!==e&&"object"==typeof e&&t in e)return e[t]}return[]}function th(e,t){let n;if("string"==typeof t){if(e.isVertexAI()){if(t.startsWith("gs://"))n={format:"jsonl",gcsUri:[t]};else if(t.startsWith("bq://"))n={format:"bigquery",bigqueryUri:t};else throw Error(`Unsupported string source for Vertex AI: ${t}`)}else if(t.startsWith("files/"))n={fileName:t};else throw Error(`Unsupported string source for Gemini API: ${t}`)}else if(Array.isArray(t)){if(e.isVertexAI())throw Error("InlinedRequest[] is not supported in Vertex AI.");n={inlinedRequests:t}}else n=t;let r=[n.gcsUri,n.bigqueryUri].filter(Boolean).length,i=[n.inlinedRequests,n.fileName].filter(Boolean).length;if(e.isVertexAI()){if(i>0||1!==r)throw Error("Exactly one of `gcsUri` or `bigqueryUri` must be set for Vertex AI.")}else if(r>0||1!==i)throw Error("Exactly one of `inlinedRequests`, `fileName`, must be set for Gemini API.");return n}function tp(e){if("object"!=typeof e||null===e)return{};let t=e.inlinedResponses;if("object"!=typeof t||null===t)return e;let n=t.inlinedResponses;if(!Array.isArray(n)||0===n.length)return e;let r=!1;for(let e of n){if("object"!=typeof e||null===e)continue;let t=e.response;if("object"==typeof t&&null!==t&&void 0!==t.embedding){r=!0;break}}return r&&(e.inlinedEmbedContentResponses=e.inlinedResponses,delete e.inlinedResponses),e}function tf(e,t){if(!e.isVertexAI()){if(/batches\/[^/]+$/.test(t))return t.split("/").pop();throw Error(`Invalid batch job name: ${t}.`)}if(/^projects\/[^/]+\/locations\/[^/]+\/batchPredictionJobs\/[^/]+$/.test(t))return t.split("/").pop();if(/^\d+$/.test(t))return t;throw Error(`Invalid batch job name: ${t}.`)}function tm(e){if("BATCH_STATE_UNSPECIFIED"===e)return"JOB_STATE_UNSPECIFIED";if("BATCH_STATE_PENDING"===e)return"JOB_STATE_PENDING";if("BATCH_STATE_RUNNING"===e)return"JOB_STATE_RUNNING";if("BATCH_STATE_SUCCEEDED"===e)return"JOB_STATE_SUCCEEDED";if("BATCH_STATE_FAILED"===e)return"JOB_STATE_FAILED";if("BATCH_STATE_CANCELLED"===e)return"JOB_STATE_CANCELLED";if("BATCH_STATE_EXPIRED"===e)return"JOB_STATE_EXPIRED";else return e}function tg(e){let t={},n=eb(e,["name"]);null!=n&&e_(t,["name"],n);let r=eb(e,["metadata","displayName"]);null!=r&&e_(t,["displayName"],r);let i=eb(e,["metadata","state"]);null!=i&&e_(t,["state"],tm(i));let o=eb(e,["metadata","createTime"]);null!=o&&e_(t,["createTime"],o);let s=eb(e,["metadata","endTime"]);null!=s&&e_(t,["endTime"],s);let a=eb(e,["metadata","updateTime"]);null!=a&&e_(t,["updateTime"],a);let l=eb(e,["metadata","model"]);null!=l&&e_(t,["model"],l);let u=eb(e,["metadata","output"]);return null!=u&&e_(t,["dest"],function(e){let t={},n=eb(e,["responsesFile"]);null!=n&&e_(t,["fileName"],n);let r=eb(e,["inlinedResponses","inlinedResponses"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eb(e,["response"]);null!=n&&e_(t,["response"],function(e){let t={},n=eb(e,["sdkHttpResponse"]);null!=n&&e_(t,["sdkHttpResponse"],n);let r=eb(e,["candidates"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eb(e,["content"]);null!=n&&e_(t,["content"],n);let r=eb(e,["citationMetadata"]);null!=r&&e_(t,["citationMetadata"],function(e){let t={},n=eb(e,["citationSources"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),e_(t,["citations"],e)}return t}(r));let i=eb(e,["tokenCount"]);null!=i&&e_(t,["tokenCount"],i);let o=eb(e,["finishReason"]);null!=o&&e_(t,["finishReason"],o);let s=eb(e,["avgLogprobs"]);null!=s&&e_(t,["avgLogprobs"],s);let a=eb(e,["groundingMetadata"]);null!=a&&e_(t,["groundingMetadata"],a);let l=eb(e,["index"]);null!=l&&e_(t,["index"],l);let u=eb(e,["logprobsResult"]);null!=u&&e_(t,["logprobsResult"],u);let c=eb(e,["safetyRatings"]);if(null!=c){let e=c;Array.isArray(e)&&(e=e.map(e=>e)),e_(t,["safetyRatings"],e)}let d=eb(e,["urlContextMetadata"]);return null!=d&&e_(t,["urlContextMetadata"],d),t})(e))),e_(t,["candidates"],e)}let i=eb(e,["modelVersion"]);null!=i&&e_(t,["modelVersion"],i);let o=eb(e,["promptFeedback"]);null!=o&&e_(t,["promptFeedback"],o);let s=eb(e,["responseId"]);null!=s&&e_(t,["responseId"],s);let a=eb(e,["usageMetadata"]);return null!=a&&e_(t,["usageMetadata"],a),t}(n));let r=eb(e,["error"]);return null!=r&&e_(t,["error"],r),t})(e))),e_(t,["inlinedResponses"],e)}let i=eb(e,["inlinedEmbedContentResponses","inlinedResponses"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),e_(t,["inlinedEmbedContentResponses"],e)}return t}(tp(u))),t}function ty(e){let t={},n=eb(e,["name"]);null!=n&&e_(t,["name"],n);let r=eb(e,["displayName"]);null!=r&&e_(t,["displayName"],r);let i=eb(e,["state"]);null!=i&&e_(t,["state"],tm(i));let o=eb(e,["error"]);null!=o&&e_(t,["error"],o);let s=eb(e,["createTime"]);null!=s&&e_(t,["createTime"],s);let a=eb(e,["startTime"]);null!=a&&e_(t,["startTime"],a);let l=eb(e,["endTime"]);null!=l&&e_(t,["endTime"],l);let u=eb(e,["updateTime"]);null!=u&&e_(t,["updateTime"],u);let c=eb(e,["model"]);null!=c&&e_(t,["model"],c);let d=eb(e,["inputConfig"]);null!=d&&e_(t,["src"],function(e){let t={},n=eb(e,["instancesFormat"]);null!=n&&e_(t,["format"],n);let r=eb(e,["gcsSource","uris"]);null!=r&&e_(t,["gcsUri"],r);let i=eb(e,["bigquerySource","inputUri"]);return null!=i&&e_(t,["bigqueryUri"],i),t}(d));let h=eb(e,["outputConfig"]);null!=h&&e_(t,["dest"],function(e){let t={},n=eb(e,["predictionsFormat"]);null!=n&&e_(t,["format"],n);let r=eb(e,["gcsDestination","outputUriPrefix"]);null!=r&&e_(t,["gcsUri"],r);let i=eb(e,["bigqueryDestination","outputUri"]);return null!=i&&e_(t,["bigqueryUri"],i),t}(tp(h)));let p=eb(e,["completionStats"]);return null!=p&&e_(t,["completionStats"],p),t}function tv(e){let t={},n=eb(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eb(e,["functionCall"]);null!=n&&e_(t,["functionCall"],n);let r=eb(e,["codeExecutionResult"]);null!=r&&e_(t,["codeExecutionResult"],r);let i=eb(e,["executableCode"]);null!=i&&e_(t,["executableCode"],i);let o=eb(e,["fileData"]);null!=o&&e_(t,["fileData"],function(e){let t={};if(void 0!==eb(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=eb(e,["fileUri"]);null!=n&&e_(t,["fileUri"],n);let r=eb(e,["mimeType"]);return null!=r&&e_(t,["mimeType"],r),t}(o));let s=eb(e,["functionResponse"]);null!=s&&e_(t,["functionResponse"],s);let a=eb(e,["inlineData"]);null!=a&&e_(t,["inlineData"],function(e){let t={},n=eb(e,["data"]);if(null!=n&&e_(t,["data"],n),void 0!==eb(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=eb(e,["mimeType"]);return null!=r&&e_(t,["mimeType"],r),t}(a));let l=eb(e,["text"]);null!=l&&e_(t,["text"],l);let u=eb(e,["thought"]);null!=u&&e_(t,["thought"],u);let c=eb(e,["thoughtSignature"]);null!=c&&e_(t,["thoughtSignature"],c);let d=eb(e,["videoMetadata"]);return null!=d&&e_(t,["videoMetadata"],d),t})(e))),e_(t,["parts"],e)}let r=eb(e,["role"]);return null!=r&&e_(t,["role"],r),t}function t_(e,t){let n={},r=eb(t,["model"]);null!=r&&e_(n,["_url","model"],ez(e,r));let i=eb(t,["src"]);null!=i&&e_(n,["batch","inputConfig"],function(e,t){let n={};if(void 0!==eb(t,["format"]))throw Error("format parameter is not supported in Gemini API.");if(void 0!==eb(t,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==eb(t,["bigqueryUri"]))throw Error("bigqueryUri parameter is not supported in Gemini API.");let r=eb(t,["fileName"]);null!=r&&e_(n,["fileName"],r);let i=eb(t,["inlinedRequests"]);if(null!=i){let t=i;Array.isArray(t)&&(t=t.map(t=>(function(e,t){let n={},r=eb(t,["model"]);null!=r&&e_(n,["request","model"],ez(e,r));let i=eb(t,["contents"]);if(null!=i){let e=e7(i);Array.isArray(e)&&(e=e.map(e=>tv(e))),e_(n,["request","contents"],e)}let o=eb(t,["metadata"]);null!=o&&e_(n,["metadata"],o);let s=eb(t,["config"]);return null!=s&&e_(n,["request","generationConfig"],function(e,t,n){let r={},i=eb(t,["systemInstruction"]);void 0!==n&&null!=i&&e_(n,["systemInstruction"],tv(e5(i)));let o=eb(t,["temperature"]);null!=o&&e_(r,["temperature"],o);let s=eb(t,["topP"]);null!=s&&e_(r,["topP"],s);let a=eb(t,["topK"]);null!=a&&e_(r,["topK"],a);let l=eb(t,["candidateCount"]);null!=l&&e_(r,["candidateCount"],l);let u=eb(t,["maxOutputTokens"]);null!=u&&e_(r,["maxOutputTokens"],u);let c=eb(t,["stopSequences"]);null!=c&&e_(r,["stopSequences"],c);let d=eb(t,["responseLogprobs"]);null!=d&&e_(r,["responseLogprobs"],d);let h=eb(t,["logprobs"]);null!=h&&e_(r,["logprobs"],h);let p=eb(t,["presencePenalty"]);null!=p&&e_(r,["presencePenalty"],p);let f=eb(t,["frequencyPenalty"]);null!=f&&e_(r,["frequencyPenalty"],f);let m=eb(t,["seed"]);null!=m&&e_(r,["seed"],m);let g=eb(t,["responseMimeType"]);null!=g&&e_(r,["responseMimeType"],g);let y=eb(t,["responseSchema"]);null!=y&&e_(r,["responseSchema"],te(y));let v=eb(t,["responseJsonSchema"]);if(null!=v&&e_(r,["responseJsonSchema"],v),void 0!==eb(t,["routingConfig"]))throw Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==eb(t,["modelSelectionConfig"]))throw Error("modelSelectionConfig parameter is not supported in Gemini API.");let _=eb(t,["safetySettings"]);if(void 0!==n&&null!=_){let e=_;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eb(e,["category"]);if(null!=n&&e_(t,["category"],n),void 0!==eb(e,["method"]))throw Error("method parameter is not supported in Gemini API.");let r=eb(e,["threshold"]);return null!=r&&e_(t,["threshold"],r),t})(e))),e_(n,["safetySettings"],e)}let b=eb(t,["tools"]);if(void 0!==n&&null!=b){let e=ti(b);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eb(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),e_(t,["functionDeclarations"],e)}if(void 0!==eb(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let r=eb(e,["googleSearchRetrieval"]);null!=r&&e_(t,["googleSearchRetrieval"],r);let i=eb(e,["computerUse"]);null!=i&&e_(t,["computerUse"],i);let o=eb(e,["fileSearch"]);null!=o&&e_(t,["fileSearch"],o);let s=eb(e,["codeExecution"]);if(null!=s&&e_(t,["codeExecution"],s),void 0!==eb(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=eb(e,["googleMaps"]);null!=a&&e_(t,["googleMaps"],function(e){let t={};if(void 0!==eb(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=eb(e,["enableWidget"]);return null!=n&&e_(t,["enableWidget"],n),t}(a));let l=eb(e,["googleSearch"]);null!=l&&e_(t,["googleSearch"],function(e){let t={};if(void 0!==eb(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==eb(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let n=eb(e,["timeRangeFilter"]);return null!=n&&e_(t,["timeRangeFilter"],n),t}(l));let u=eb(e,["urlContext"]);return null!=u&&e_(t,["urlContext"],u),t})(tr(e)))),e_(n,["tools"],e)}let E=eb(t,["toolConfig"]);if(void 0!==n&&null!=E&&e_(n,["toolConfig"],E),void 0!==eb(t,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let T=eb(t,["cachedContent"]);void 0!==n&&null!=T&&e_(n,["cachedContent"],to(e,T));let w=eb(t,["responseModalities"]);null!=w&&e_(r,["responseModalities"],w);let S=eb(t,["mediaResolution"]);null!=S&&e_(r,["mediaResolution"],S);let A=eb(t,["speechConfig"]);if(null!=A&&e_(r,["speechConfig"],tt(A)),void 0!==eb(t,["audioTimestamp"]))throw Error("audioTimestamp parameter is not supported in Gemini API.");let C=eb(t,["thinkingConfig"]);null!=C&&e_(r,["thinkingConfig"],C);let O=eb(t,["imageConfig"]);return null!=O&&e_(r,["imageConfig"],O),r}(e,s,eb(n,["request"],{}))),n})(e,t))),e_(n,["requests","requests"],t)}return n}(e,th(e,i)));let o=eb(t,["config"]);return null!=o&&function(e,t){let n=eb(e,["displayName"]);if(void 0!==t&&null!=n&&e_(t,["batch","displayName"],n),void 0!==eb(e,["dest"]))throw Error("dest parameter is not supported in Gemini API.")}(o,n),n}!function(e){e.PAGED_ITEM_BATCH_JOBS="batchJobs",e.PAGED_ITEM_MODELS="models",e.PAGED_ITEM_TUNING_JOBS="tuningJobs",e.PAGED_ITEM_FILES="files",e.PAGED_ITEM_CACHED_CONTENTS="cachedContents",e.PAGED_ITEM_FILE_SEARCH_STORES="fileSearchStores",e.PAGED_ITEM_DOCUMENTS="documents"}(ei||(ei={}));class tb{constructor(e,t,n,r){this.pageInternal=[],this.paramsInternal={},this.requestInternal=t,this.init(e,n,r)}init(e,t,n){var r,i;this.nameInternal=e,this.pageInternal=t[this.nameInternal]||[],this.sdkHttpResponseInternal=null==t?void 0:t.sdkHttpResponse,this.idxInternal=0;let o={config:{}};(o=n&&0!==Object.keys(n).length?"object"==typeof n?Object.assign({},n):n:{config:{}}).config&&(o.config.pageToken=t.nextPageToken),this.paramsInternal=o,this.pageInternalSize=null!==(i=null===(r=o.config)||void 0===r?void 0:r.pageSize)&&void 0!==i?i:this.pageInternal.length}initNextPage(e){this.init(this.nameInternal,e,this.paramsInternal)}get page(){return this.pageInternal}get name(){return this.nameInternal}get pageSize(){return this.pageInternalSize}get sdkHttpResponse(){return this.sdkHttpResponseInternal}get params(){return this.paramsInternal}get pageLength(){return this.pageInternal.length}getItem(e){return this.pageInternal[e]}[Symbol.asyncIterator](){return{next:async()=>{if(this.idxInternal>=this.pageLength){if(!this.hasNextPage())return{value:void 0,done:!0};await this.nextPage()}let e=this.getItem(this.idxInternal);return this.idxInternal+=1,{value:e,done:!1}},return:async()=>({value:void 0,done:!0})}}async nextPage(){if(!this.hasNextPage())throw Error("No more pages to fetch.");let e=await this.requestInternal(this.params);return this.initNextPage(e),this.page}hasNextPage(){var e;return(null===(e=this.params.config)||void 0===e?void 0:e.pageToken)!==void 0}}class tE extends ey{constructor(e){super(),this.apiClient=e,this.create=async e=>(this.apiClient.isVertexAI()&&(e.config=this.formatDestination(e.src,e.config)),this.createInternal(e)),this.createEmbeddings=async e=>{if(console.warn("batches.createEmbeddings() is experimental and may change without notice."),this.apiClient.isVertexAI())throw Error("Vertex AI does not support batches.createEmbeddings.");return this.createEmbeddingsInternal(e)},this.list=async(e={})=>new tb(ei.PAGED_ITEM_BATCH_JOBS,e=>this.listInternal(e),await this.listInternal(e),e)}createInlinedGenerateContentRequest(e){let t=t_(this.apiClient,e),n=ev("{model}:batchGenerateContent",t._url),r=t.batch.inputConfig.requests,i=r.requests,o=[];for(let e of i){let t=Object.assign({},e);if(t.systemInstruction){let e=t.systemInstruction;delete t.systemInstruction;let n=t.request;n.systemInstruction=e,t.request=n}o.push(t)}return r.requests=o,delete t.config,delete t._url,delete t._query,{path:n,body:t}}getGcsUri(e){return"string"==typeof e?e.startsWith("gs://")?e:void 0:!Array.isArray(e)&&e.gcsUri&&e.gcsUri.length>0?e.gcsUri[0]:void 0}getBigqueryUri(e){return"string"==typeof e?e.startsWith("bq://")?e:void 0:Array.isArray(e)?void 0:e.bigqueryUri}formatDestination(e,t){let n=t?Object.assign({},t):{},r=Date.now().toString();if(n.displayName||(n.displayName=`genaiBatchJob_${r}`),void 0===n.dest){let t=this.getGcsUri(e),i=this.getBigqueryUri(e);if(t)t.endsWith(".jsonl")?n.dest=`${t.slice(0,-6)}/dest`:n.dest=`${t}_dest_${r}`;else if(i)n.dest=`${i}_dest_${r}`;else throw Error("Unsupported source for Vertex AI: No GCS or BigQuery URI found.")}return n}async createInternal(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eb(t,["model"]);null!=r&&e_(n,["model"],ez(e,r));let i=eb(t,["src"]);null!=i&&e_(n,["inputConfig"],function(e){let t={},n=eb(e,["format"]);null!=n&&e_(t,["instancesFormat"],n);let r=eb(e,["gcsUri"]);null!=r&&e_(t,["gcsSource","uris"],r);let i=eb(e,["bigqueryUri"]);if(null!=i&&e_(t,["bigquerySource","inputUri"],i),void 0!==eb(e,["fileName"]))throw Error("fileName parameter is not supported in Vertex AI.");if(void 0!==eb(e,["inlinedRequests"]))throw Error("inlinedRequests parameter is not supported in Vertex AI.");return t}(th(e,i)));let o=eb(t,["config"]);return null!=o&&function(e,t){let n=eb(e,["displayName"]);void 0!==t&&null!=n&&e_(t,["displayName"],n);let r=eb(e,["dest"]);void 0!==t&&null!=r&&e_(t,["outputConfig"],function(e){let t={},n=eb(e,["format"]);null!=n&&e_(t,["predictionsFormat"],n);let r=eb(e,["gcsUri"]);null!=r&&e_(t,["gcsDestination","outputUriPrefix"],r);let i=eb(e,["bigqueryUri"]);if(null!=i&&e_(t,["bigqueryDestination","outputUri"],i),void 0!==eb(e,["fileName"]))throw Error("fileName parameter is not supported in Vertex AI.");if(void 0!==eb(e,["inlinedResponses"]))throw Error("inlinedResponses parameter is not supported in Vertex AI.");if(void 0!==eb(e,["inlinedEmbedContentResponses"]))throw Error("inlinedEmbedContentResponses parameter is not supported in Vertex AI.");return t}(function(e){if("string"!=typeof e)return e;if(e.startsWith("gs://"))return{format:"jsonl",gcsUri:e};if(e.startsWith("bq://"))return{format:"bigquery",bigqueryUri:e};throw Error(`Unsupported destination: ${e}`)}(r)))}(o,n),n}(this.apiClient,e);return o=ev("batchPredictionJobs",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>ty(e))}{let t=t_(this.apiClient,e);return o=ev("{model}:batchGenerateContent",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>tg(e))}}async createEmbeddingsInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e,t){let n={},r=eb(t,["model"]);null!=r&&e_(n,["_url","model"],ez(e,r));let i=eb(t,["src"]);null!=i&&e_(n,["batch","inputConfig"],function(e,t){let n={},r=eb(t,["fileName"]);null!=r&&e_(n,["file_name"],r);let i=eb(t,["inlinedRequests"]);return null!=i&&e_(n,["requests"],function(e,t){let n={},r=eb(t,["contents"]);if(null!=r){let t=e9(e,r);Array.isArray(t)&&(t=t.map(e=>e)),e_(n,["requests[]","request","content"],t)}let i=eb(t,["config"]);return null!=i&&(e_(n,["_self"],function(e,t){let n=eb(e,["taskType"]);void 0!==t&&null!=n&&e_(t,["requests[]","taskType"],n);let r=eb(e,["title"]);void 0!==t&&null!=r&&e_(t,["requests[]","title"],r);let i=eb(e,["outputDimensionality"]);if(void 0!==t&&null!=i&&e_(t,["requests[]","outputDimensionality"],i),void 0!==eb(e,["mimeType"]))throw Error("mimeType parameter is not supported in Gemini API.");if(void 0!==eb(e,["autoTruncate"]))throw Error("autoTruncate parameter is not supported in Gemini API.");return{}}(i,n)),function(e,t){for(let[n,r]of Object.entries(t)){let t=n.split("."),i=r.split("."),o=new Set,s=-1;for(let e=0;e<t.length;e++)if("*"===t[e]){s=e;break}if(-1!==s&&i.length>s)for(let e=s;e<i.length;e++){let t=i[e];"*"===t||t.endsWith("[]")||t.endsWith("[0]")||o.add(t)}(function e(t,n,r,i,o){if(i>=n.length||"object"!=typeof t||null===t)return;let s=n[i];if(s.endsWith("[]")){let a=s.slice(0,-2);if(a in t&&Array.isArray(t[a]))for(let s of t[a])e(s,n,r,i+1,o)}else if("*"===s){if("object"==typeof t&&null!==t&&!Array.isArray(t)){let e=Object.keys(t).filter(e=>!e.startsWith("_")&&!o.has(e)),n={};for(let r of e)n[r]=t[r];for(let[e,o]of Object.entries(n)){let n=[];for(let t of r.slice(i))"*"===t?n.push(e):n.push(t);e_(t,n,o)}for(let n of e)delete t[n]}}else s in t&&e(t[s],n,r,i+1,o)})(e,t,i,0,o)}}(n,{"requests[].*":"requests[].request.*"})),n}(e,i)),n}(e,i));let o=eb(t,["config"]);return null!=o&&function(e,t){let n=eb(e,["displayName"]);void 0!==t&&null!=n&&e_(t,["batch","displayName"],n)}(o,n),n}(this.apiClient,e);return r=ev("{model}:asyncBatchEmbedContent",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>tg(e))}}async get(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eb(t,["name"]);return null!=r&&e_(n,["_url","name"],tf(e,r)),n}(this.apiClient,e);return o=ev("batchPredictionJobs/{name}",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>ty(e))}{let t=function(e,t){let n={},r=eb(t,["name"]);return null!=r&&e_(n,["_url","name"],tf(e,r)),n}(this.apiClient,e);return o=ev("batches/{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>tg(e))}}async cancel(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eb(t,["name"]);return null!=r&&e_(n,["_url","name"],tf(e,r)),n}(this.apiClient,e);o=ev("batchPredictionJobs/{name}:cancel",r._url),s=r._query,delete r._url,delete r._query,await this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal})}else{let t=function(e,t){let n={},r=eb(t,["name"]);return null!=r&&e_(n,["_url","name"],tf(e,r)),n}(this.apiClient,e);o=ev("batches/{name}:cancel",t._url),s=t._query,delete t._url,delete t._query,await this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal})}}async listInternal(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e){let t={},n=eb(e,["config"]);return null!=n&&function(e,t){let n=eb(e,["pageSize"]);void 0!==t&&null!=n&&e_(t,["_query","pageSize"],n);let r=eb(e,["pageToken"]);void 0!==t&&null!=r&&e_(t,["_query","pageToken"],r);let i=eb(e,["filter"]);void 0!==t&&null!=i&&e_(t,["_query","filter"],i)}(n,t),t}(e);return o=ev("batchPredictionJobs",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=eb(e,["sdkHttpResponse"]);null!=n&&e_(t,["sdkHttpResponse"],n);let r=eb(e,["nextPageToken"]);null!=r&&e_(t,["nextPageToken"],r);let i=eb(e,["batchPredictionJobs"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>ty(e))),e_(t,["batchJobs"],e)}return t}(e),n=new eW;return Object.assign(n,t),n})}{let t=function(e){let t={},n=eb(e,["config"]);return null!=n&&function(e,t){let n=eb(e,["pageSize"]);void 0!==t&&null!=n&&e_(t,["_query","pageSize"],n);let r=eb(e,["pageToken"]);if(void 0!==t&&null!=r&&e_(t,["_query","pageToken"],r),void 0!==eb(e,["filter"]))throw Error("filter parameter is not supported in Gemini API.")}(n,t),t}(e);return o=ev("batches",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=eb(e,["sdkHttpResponse"]);null!=n&&e_(t,["sdkHttpResponse"],n);let r=eb(e,["nextPageToken"]);null!=r&&e_(t,["nextPageToken"],r);let i=eb(e,["operations"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>tg(e))),e_(t,["batchJobs"],e)}return t}(e),n=new eW;return Object.assign(n,t),n})}}async delete(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eb(t,["name"]);return null!=r&&e_(n,["_url","name"],tf(e,r)),n}(this.apiClient,e);return o=ev("batchPredictionJobs/{name}",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>(function(e){let t={},n=eb(e,["sdkHttpResponse"]);null!=n&&e_(t,["sdkHttpResponse"],n);let r=eb(e,["name"]);null!=r&&e_(t,["name"],r);let i=eb(e,["done"]);null!=i&&e_(t,["done"],i);let o=eb(e,["error"]);return null!=o&&e_(t,["error"],o),t})(e))}{let t=function(e,t){let n={},r=eb(t,["name"]);return null!=r&&e_(n,["_url","name"],tf(e,r)),n}(this.apiClient,e);return o=ev("batches/{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"DELETE",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>(function(e){let t={},n=eb(e,["sdkHttpResponse"]);null!=n&&e_(t,["sdkHttpResponse"],n);let r=eb(e,["name"]);null!=r&&e_(t,["name"],r);let i=eb(e,["done"]);null!=i&&e_(t,["done"],i);let o=eb(e,["error"]);return null!=o&&e_(t,["error"],o),t})(e))}}}function tT(e){let t={},n=eb(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eb(e,["functionCall"]);null!=n&&e_(t,["functionCall"],n);let r=eb(e,["codeExecutionResult"]);null!=r&&e_(t,["codeExecutionResult"],r);let i=eb(e,["executableCode"]);null!=i&&e_(t,["executableCode"],i);let o=eb(e,["fileData"]);null!=o&&e_(t,["fileData"],function(e){let t={};if(void 0!==eb(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=eb(e,["fileUri"]);null!=n&&e_(t,["fileUri"],n);let r=eb(e,["mimeType"]);return null!=r&&e_(t,["mimeType"],r),t}(o));let s=eb(e,["functionResponse"]);null!=s&&e_(t,["functionResponse"],s);let a=eb(e,["inlineData"]);null!=a&&e_(t,["inlineData"],function(e){let t={},n=eb(e,["data"]);if(null!=n&&e_(t,["data"],n),void 0!==eb(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=eb(e,["mimeType"]);return null!=r&&e_(t,["mimeType"],r),t}(a));let l=eb(e,["text"]);null!=l&&e_(t,["text"],l);let u=eb(e,["thought"]);null!=u&&e_(t,["thought"],u);let c=eb(e,["thoughtSignature"]);null!=c&&e_(t,["thoughtSignature"],c);let d=eb(e,["videoMetadata"]);return null!=d&&e_(t,["videoMetadata"],d),t})(e))),e_(t,["parts"],e)}let r=eb(e,["role"]);return null!=r&&e_(t,["role"],r),t}class tw extends ey{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new tb(ei.PAGED_ITEM_CACHED_CONTENTS,e=>this.listInternal(e),await this.listInternal(e),e)}async create(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eb(t,["model"]);null!=r&&e_(n,["model"],eX(e,r));let i=eb(t,["config"]);return null!=i&&function(e,t){let n=eb(e,["ttl"]);void 0!==t&&null!=n&&e_(t,["ttl"],n);let r=eb(e,["expireTime"]);void 0!==t&&null!=r&&e_(t,["expireTime"],r);let i=eb(e,["displayName"]);void 0!==t&&null!=i&&e_(t,["displayName"],i);let o=eb(e,["contents"]);if(void 0!==t&&null!=o){let e=e7(o);Array.isArray(e)&&(e=e.map(e=>e)),e_(t,["contents"],e)}let s=eb(e,["systemInstruction"]);void 0!==t&&null!=s&&e_(t,["systemInstruction"],e5(s));let a=eb(e,["tools"]);if(void 0!==t&&null!=a){let e=a;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eb(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==eb(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");let n=eb(e,["description"]);null!=n&&e_(t,["description"],n);let r=eb(e,["name"]);null!=r&&e_(t,["name"],r);let i=eb(e,["parameters"]);null!=i&&e_(t,["parameters"],i);let o=eb(e,["parametersJsonSchema"]);null!=o&&e_(t,["parametersJsonSchema"],o);let s=eb(e,["response"]);null!=s&&e_(t,["response"],s);let a=eb(e,["responseJsonSchema"]);return null!=a&&e_(t,["responseJsonSchema"],a),t})(e))),e_(t,["functionDeclarations"],e)}let r=eb(e,["retrieval"]);null!=r&&e_(t,["retrieval"],r);let i=eb(e,["googleSearchRetrieval"]);null!=i&&e_(t,["googleSearchRetrieval"],i);let o=eb(e,["computerUse"]);if(null!=o&&e_(t,["computerUse"],o),void 0!==eb(e,["fileSearch"]))throw Error("fileSearch parameter is not supported in Vertex AI.");let s=eb(e,["codeExecution"]);null!=s&&e_(t,["codeExecution"],s);let a=eb(e,["enterpriseWebSearch"]);null!=a&&e_(t,["enterpriseWebSearch"],a);let l=eb(e,["googleMaps"]);null!=l&&e_(t,["googleMaps"],l);let u=eb(e,["googleSearch"]);null!=u&&e_(t,["googleSearch"],u);let c=eb(e,["urlContext"]);return null!=c&&e_(t,["urlContext"],c),t})(e))),e_(t,["tools"],e)}let l=eb(e,["toolConfig"]);void 0!==t&&null!=l&&e_(t,["toolConfig"],l);let u=eb(e,["kmsKeyName"]);void 0!==t&&null!=u&&e_(t,["encryption_spec","kmsKeyName"],u)}(i,n),n}(this.apiClient,e);return o=ev("cachedContents",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}{let t=function(e,t){let n={},r=eb(t,["model"]);null!=r&&e_(n,["model"],eX(e,r));let i=eb(t,["config"]);return null!=i&&function(e,t){let n=eb(e,["ttl"]);void 0!==t&&null!=n&&e_(t,["ttl"],n);let r=eb(e,["expireTime"]);void 0!==t&&null!=r&&e_(t,["expireTime"],r);let i=eb(e,["displayName"]);void 0!==t&&null!=i&&e_(t,["displayName"],i);let o=eb(e,["contents"]);if(void 0!==t&&null!=o){let e=e7(o);Array.isArray(e)&&(e=e.map(e=>tT(e))),e_(t,["contents"],e)}let s=eb(e,["systemInstruction"]);void 0!==t&&null!=s&&e_(t,["systemInstruction"],tT(e5(s)));let a=eb(e,["tools"]);if(void 0!==t&&null!=a){let e=a;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eb(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),e_(t,["functionDeclarations"],e)}if(void 0!==eb(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let r=eb(e,["googleSearchRetrieval"]);null!=r&&e_(t,["googleSearchRetrieval"],r);let i=eb(e,["computerUse"]);null!=i&&e_(t,["computerUse"],i);let o=eb(e,["fileSearch"]);null!=o&&e_(t,["fileSearch"],o);let s=eb(e,["codeExecution"]);if(null!=s&&e_(t,["codeExecution"],s),void 0!==eb(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=eb(e,["googleMaps"]);null!=a&&e_(t,["googleMaps"],function(e){let t={};if(void 0!==eb(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=eb(e,["enableWidget"]);return null!=n&&e_(t,["enableWidget"],n),t}(a));let l=eb(e,["googleSearch"]);null!=l&&e_(t,["googleSearch"],function(e){let t={};if(void 0!==eb(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==eb(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let n=eb(e,["timeRangeFilter"]);return null!=n&&e_(t,["timeRangeFilter"],n),t}(l));let u=eb(e,["urlContext"]);return null!=u&&e_(t,["urlContext"],u),t})(e))),e_(t,["tools"],e)}let l=eb(e,["toolConfig"]);if(void 0!==t&&null!=l&&e_(t,["toolConfig"],l),void 0!==eb(e,["kmsKeyName"]))throw Error("kmsKeyName parameter is not supported in Gemini API.")}(i,n),n}(this.apiClient,e);return o=ev("cachedContents",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>e)}}async get(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eb(t,["name"]);return null!=r&&e_(n,["_url","name"],to(e,r)),n}(this.apiClient,e);return o=ev("{name}",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}{let t=function(e,t){let n={},r=eb(t,["name"]);return null!=r&&e_(n,["_url","name"],to(e,r)),n}(this.apiClient,e);return o=ev("{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eb(t,["name"]);return null!=r&&e_(n,["_url","name"],to(e,r)),n}(this.apiClient,e);return o=ev("{name}",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=eb(e,["sdkHttpResponse"]);return null!=n&&e_(t,["sdkHttpResponse"],n),t}(e),n=new ej;return Object.assign(n,t),n})}{let t=function(e,t){let n={},r=eb(t,["name"]);return null!=r&&e_(n,["_url","name"],to(e,r)),n}(this.apiClient,e);return o=ev("{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"DELETE",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=eb(e,["sdkHttpResponse"]);return null!=n&&e_(t,["sdkHttpResponse"],n),t}(e),n=new ej;return Object.assign(n,t),n})}}async update(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eb(t,["name"]);null!=r&&e_(n,["_url","name"],to(e,r));let i=eb(t,["config"]);return null!=i&&function(e,t){let n=eb(e,["ttl"]);void 0!==t&&null!=n&&e_(t,["ttl"],n);let r=eb(e,["expireTime"]);void 0!==t&&null!=r&&e_(t,["expireTime"],r)}(i,n),n}(this.apiClient,e);return o=ev("{name}",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"PATCH",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}{let t=function(e,t){let n={},r=eb(t,["name"]);null!=r&&e_(n,["_url","name"],to(e,r));let i=eb(t,["config"]);return null!=i&&function(e,t){let n=eb(e,["ttl"]);void 0!==t&&null!=n&&e_(t,["ttl"],n);let r=eb(e,["expireTime"]);void 0!==t&&null!=r&&e_(t,["expireTime"],r)}(i,n),n}(this.apiClient,e);return o=ev("{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"PATCH",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>e)}}async listInternal(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e){let t={},n=eb(e,["config"]);return null!=n&&function(e,t){let n=eb(e,["pageSize"]);void 0!==t&&null!=n&&e_(t,["_query","pageSize"],n);let r=eb(e,["pageToken"]);void 0!==t&&null!=r&&e_(t,["_query","pageToken"],r)}(n,t),t}(e);return o=ev("cachedContents",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=eb(e,["sdkHttpResponse"]);null!=n&&e_(t,["sdkHttpResponse"],n);let r=eb(e,["nextPageToken"]);null!=r&&e_(t,["nextPageToken"],r);let i=eb(e,["cachedContents"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),e_(t,["cachedContents"],e)}return t}(e),n=new eL;return Object.assign(n,t),n})}{let t=function(e){let t={},n=eb(e,["config"]);return null!=n&&function(e,t){let n=eb(e,["pageSize"]);void 0!==t&&null!=n&&e_(t,["_query","pageSize"],n);let r=eb(e,["pageToken"]);void 0!==t&&null!=r&&e_(t,["_query","pageToken"],r)}(n,t),t}(e);return o=ev("cachedContents",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=eb(e,["sdkHttpResponse"]);null!=n&&e_(t,["sdkHttpResponse"],n);let r=eb(e,["nextPageToken"]);null!=r&&e_(t,["nextPageToken"],r);let i=eb(e,["cachedContents"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),e_(t,["cachedContents"],e)}return t}(e),n=new eL;return Object.assign(n,t),n})}}}function tS(e){return this instanceof tS?(this.v=e,this):new tS(e)}function tA(e,t,n){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),o=[];return r=Object.create(("function"==typeof AsyncIterator?AsyncIterator:Object).prototype),s("next"),s("throw"),s("return",function(e){return function(t){return Promise.resolve(t).then(e,u)}}),r[Symbol.asyncIterator]=function(){return this},r;function s(e,t){i[e]&&(r[e]=function(t){return new Promise(function(n,r){o.push([e,t,n,r])>1||a(e,t)})},t&&(r[e]=t(r[e])))}function a(e,t){try{var n;(n=i[e](t)).value instanceof tS?Promise.resolve(n.value.v).then(l,u):c(o[0][2],n)}catch(e){c(o[0][3],e)}}function l(e){a("next",e)}function u(e){a("throw",e)}function c(e,t){e(t),o.shift(),o.length&&a(o[0][0],o[0][1])}}function tC(e){if(!Symbol.asyncIterator)throw TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise(function(r,i){(function(e,t,n,r){Promise.resolve(r).then(function(t){e({value:t,done:n})},t)})(r,i,(t=e[n](t)).done,t.value)})}}}function tO(e){if(void 0===e.parts||0===e.parts.length)return!1;for(let t of e.parts)if(void 0===t||0===Object.keys(t).length)return!1;return!0}function tI(e){if(void 0===e||0===e.length)return[];let t=[],n=e.length,r=0;for(;r<n;)if("user"===e[r].role)t.push(e[r]),r++;else{let i=[],o=!0;for(;r<n&&"model"===e[r].role;)i.push(e[r]),o&&!tO(e[r])&&(o=!1),r++;o?t.push(...i):t.pop()}return t}"function"==typeof SuppressedError&&SuppressedError;class tk{constructor(e,t){this.modelsModule=e,this.apiClient=t}create(e){return new tR(this.apiClient,this.modelsModule,e.model,e.config,structuredClone(e.history))}}class tR{constructor(e,t,n,r={},i=[]){this.apiClient=e,this.modelsModule=t,this.model=n,this.config=r,this.history=i,this.sendPromise=Promise.resolve(),function(e){if(0!==e.length){for(let t of e)if("user"!==t.role&&"model"!==t.role)throw Error(`Role must be user or model, but got ${t.role}.`)}}(i)}async sendMessage(e){var t;await this.sendPromise;let n=e5(e.message),r=this.modelsModule.generateContent({model:this.model,contents:this.getHistory(!0).concat(n),config:null!==(t=e.config)&&void 0!==t?t:this.config});return this.sendPromise=(async()=>{var e,t,i;let o=await r,s=null===(t=null===(e=o.candidates)||void 0===e?void 0:e[0])||void 0===t?void 0:t.content,a=o.automaticFunctionCallingHistory,l=this.getHistory(!0).length,u=[];null!=a&&(u=null!==(i=a.slice(l))&&void 0!==i?i:[]),this.recordHistory(n,s?[s]:[],u)})(),await this.sendPromise.catch(()=>{this.sendPromise=Promise.resolve()}),r}async sendMessageStream(e){var t;await this.sendPromise;let n=e5(e.message),r=this.modelsModule.generateContentStream({model:this.model,contents:this.getHistory(!0).concat(n),config:null!==(t=e.config)&&void 0!==t?t:this.config});this.sendPromise=r.then(()=>void 0).catch(()=>void 0);let i=await r;return this.processStreamResponse(i,n)}getHistory(e=!1){return structuredClone(e?tI(this.history):this.history)}processStreamResponse(e,t){var n,r;return tA(this,arguments,function*(){var i,o,s,a;let l=[];try{for(var u,c=!0,d=tC(e);!(i=(u=yield tS(d.next())).done);c=!0){if(a=u.value,c=!1,function(e){var t;if(void 0==e.candidates||0===e.candidates.length)return!1;let n=null===(t=e.candidates[0])||void 0===t?void 0:t.content;return void 0!==n&&tO(n)}(a)){let e=null===(r=null===(n=a.candidates)||void 0===n?void 0:n[0])||void 0===r?void 0:r.content;void 0!==e&&l.push(e)}yield yield tS(a)}}catch(e){o={error:e}}finally{try{!c&&!i&&(s=d.return)&&(yield tS(s.call(d)))}finally{if(o)throw o.error}}this.recordHistory(t,l)})}recordHistory(e,t,n){let r=[];t.length>0&&t.every(e=>void 0!==e.role)?r=t:r.push({role:"model",parts:[]}),n&&n.length>0?this.history.push(...tI(n)):this.history.push(e),this.history.push(...r)}}class tN extends Error{constructor(e){super(e.message),this.name="ApiError",this.status=e.status,Object.setPrototypeOf(this,tN.prototype)}}class tP extends ey{constructor(e){super(),this.apiClient=e,this.list=async(e={})=>new tb(ei.PAGED_ITEM_FILES,e=>this.listInternal(e),await this.listInternal(e),e)}async upload(e){if(this.apiClient.isVertexAI())throw Error("Vertex AI does not support uploading files. You can share files through a GCS bucket.");return this.apiClient.uploadFile(e.file,e.config).then(e=>e)}async download(e){await this.apiClient.downloadFile(e)}async listInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},n=eb(e,["config"]);return null!=n&&function(e,t){let n=eb(e,["pageSize"]);void 0!==t&&null!=n&&e_(t,["_query","pageSize"],n);let r=eb(e,["pageToken"]);void 0!==t&&null!=r&&e_(t,["_query","pageToken"],r)}(n,t),t}(e);return r=ev("files",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=eb(e,["sdkHttpResponse"]);null!=n&&e_(t,["sdkHttpResponse"],n);let r=eb(e,["nextPageToken"]);null!=r&&e_(t,["nextPageToken"],r);let i=eb(e,["files"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),e_(t,["files"],e)}return t}(e),n=new eB;return Object.assign(n,t),n})}}async createInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},n=eb(e,["file"]);return null!=n&&e_(t,["file"],n),t}(e);return r=ev("upload/v1beta/files",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=eb(e,["sdkHttpResponse"]);return null!=n&&e_(t,["sdkHttpResponse"],n),t}(e),n=new eV;return Object.assign(n,t),n})}}async get(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},n=eb(e,["name"]);return null!=n&&e_(t,["_url","file"],tu(n)),t}(e);return r=ev("files/{file}",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},n=eb(e,["name"]);return null!=n&&e_(t,["_url","file"],tu(n)),t}(e);return r=ev("files/{file}",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=eb(e,["sdkHttpResponse"]);return null!=n&&e_(t,["sdkHttpResponse"],n),t}(e),n=new e$;return Object.assign(n,t),n})}}}function tx(e){let t={},n=eb(e,["data"]);if(null!=n&&e_(t,["data"],n),void 0!==eb(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=eb(e,["mimeType"]);return null!=r&&e_(t,["mimeType"],r),t}function tU(e){let t={},n=eb(e,["languageCode"]);null!=n&&e_(t,["languageCode"],n);let r=eb(e,["voiceConfig"]);if(null!=r&&e_(t,["voiceConfig"],r),void 0!==eb(e,["multiSpeakerVoiceConfig"]))throw Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return t}function tD(e){let t={},n=eb(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eb(e,["functionCall"]);null!=n&&e_(t,["functionCall"],n);let r=eb(e,["codeExecutionResult"]);null!=r&&e_(t,["codeExecutionResult"],r);let i=eb(e,["executableCode"]);null!=i&&e_(t,["executableCode"],i);let o=eb(e,["fileData"]);null!=o&&e_(t,["fileData"],function(e){let t={};if(void 0!==eb(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=eb(e,["fileUri"]);null!=n&&e_(t,["fileUri"],n);let r=eb(e,["mimeType"]);return null!=r&&e_(t,["mimeType"],r),t}(o));let s=eb(e,["functionResponse"]);null!=s&&e_(t,["functionResponse"],s);let a=eb(e,["inlineData"]);null!=a&&e_(t,["inlineData"],function(e){let t={},n=eb(e,["data"]);if(null!=n&&e_(t,["data"],n),void 0!==eb(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=eb(e,["mimeType"]);return null!=r&&e_(t,["mimeType"],r),t}(a));let l=eb(e,["text"]);null!=l&&e_(t,["text"],l);let u=eb(e,["thought"]);null!=u&&e_(t,["thought"],u);let c=eb(e,["thoughtSignature"]);null!=c&&e_(t,["thoughtSignature"],c);let d=eb(e,["videoMetadata"]);return null!=d&&e_(t,["videoMetadata"],d),t})(e))),e_(t,["parts"],e)}let r=eb(e,["role"]);return null!=r&&e_(t,["role"],r),t}function tM(e,t){let n={},r=eb(t,["model"]);null!=r&&e_(n,["_url","model"],ez(e,r));let i=eb(t,["contents"]);if(null!=i){let e=e7(i);Array.isArray(e)&&(e=e.map(e=>tD(e))),e_(n,["contents"],e)}let o=eb(t,["config"]);return null!=o&&e_(n,["generationConfig"],function(e,t,n){let r={},i=eb(t,["systemInstruction"]);void 0!==n&&null!=i&&e_(n,["systemInstruction"],tD(e5(i)));let o=eb(t,["temperature"]);null!=o&&e_(r,["temperature"],o);let s=eb(t,["topP"]);null!=s&&e_(r,["topP"],s);let a=eb(t,["topK"]);null!=a&&e_(r,["topK"],a);let l=eb(t,["candidateCount"]);null!=l&&e_(r,["candidateCount"],l);let u=eb(t,["maxOutputTokens"]);null!=u&&e_(r,["maxOutputTokens"],u);let c=eb(t,["stopSequences"]);null!=c&&e_(r,["stopSequences"],c);let d=eb(t,["responseLogprobs"]);null!=d&&e_(r,["responseLogprobs"],d);let h=eb(t,["logprobs"]);null!=h&&e_(r,["logprobs"],h);let p=eb(t,["presencePenalty"]);null!=p&&e_(r,["presencePenalty"],p);let f=eb(t,["frequencyPenalty"]);null!=f&&e_(r,["frequencyPenalty"],f);let m=eb(t,["seed"]);null!=m&&e_(r,["seed"],m);let g=eb(t,["responseMimeType"]);null!=g&&e_(r,["responseMimeType"],g);let y=eb(t,["responseSchema"]);null!=y&&e_(r,["responseSchema"],te(y));let v=eb(t,["responseJsonSchema"]);if(null!=v&&e_(r,["responseJsonSchema"],v),void 0!==eb(t,["routingConfig"]))throw Error("routingConfig parameter is not supported in Gemini API.");if(void 0!==eb(t,["modelSelectionConfig"]))throw Error("modelSelectionConfig parameter is not supported in Gemini API.");let _=eb(t,["safetySettings"]);if(void 0!==n&&null!=_){let e=_;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eb(e,["category"]);if(null!=n&&e_(t,["category"],n),void 0!==eb(e,["method"]))throw Error("method parameter is not supported in Gemini API.");let r=eb(e,["threshold"]);return null!=r&&e_(t,["threshold"],r),t})(e))),e_(n,["safetySettings"],e)}let b=eb(t,["tools"]);if(void 0!==n&&null!=b){let e=ti(b);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eb(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),e_(t,["functionDeclarations"],e)}if(void 0!==eb(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let r=eb(e,["googleSearchRetrieval"]);null!=r&&e_(t,["googleSearchRetrieval"],r);let i=eb(e,["computerUse"]);null!=i&&e_(t,["computerUse"],i);let o=eb(e,["fileSearch"]);null!=o&&e_(t,["fileSearch"],o);let s=eb(e,["codeExecution"]);if(null!=s&&e_(t,["codeExecution"],s),void 0!==eb(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=eb(e,["googleMaps"]);null!=a&&e_(t,["googleMaps"],function(e){let t={};if(void 0!==eb(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=eb(e,["enableWidget"]);return null!=n&&e_(t,["enableWidget"],n),t}(a));let l=eb(e,["googleSearch"]);null!=l&&e_(t,["googleSearch"],function(e){let t={};if(void 0!==eb(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==eb(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let n=eb(e,["timeRangeFilter"]);return null!=n&&e_(t,["timeRangeFilter"],n),t}(l));let u=eb(e,["urlContext"]);return null!=u&&e_(t,["urlContext"],u),t})(tr(e)))),e_(n,["tools"],e)}let E=eb(t,["toolConfig"]);if(void 0!==n&&null!=E&&e_(n,["toolConfig"],E),void 0!==eb(t,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let T=eb(t,["cachedContent"]);void 0!==n&&null!=T&&e_(n,["cachedContent"],to(e,T));let w=eb(t,["responseModalities"]);null!=w&&e_(r,["responseModalities"],w);let S=eb(t,["mediaResolution"]);null!=S&&e_(r,["mediaResolution"],S);let A=eb(t,["speechConfig"]);if(null!=A&&e_(r,["speechConfig"],tt(A)),void 0!==eb(t,["audioTimestamp"]))throw Error("audioTimestamp parameter is not supported in Gemini API.");let C=eb(t,["thinkingConfig"]);null!=C&&e_(r,["thinkingConfig"],C);let O=eb(t,["imageConfig"]);return null!=O&&e_(r,["imageConfig"],O),r}(e,o,n)),n}function tj(e,t){let n={},r=eb(t,["model"]);null!=r&&e_(n,["_url","model"],ez(e,r));let i=eb(t,["contents"]);if(null!=i){let e=e7(i);Array.isArray(e)&&(e=e.map(e=>e)),e_(n,["contents"],e)}let o=eb(t,["config"]);return null!=o&&e_(n,["generationConfig"],function(e,t,n){let r={},i=eb(t,["systemInstruction"]);void 0!==n&&null!=i&&e_(n,["systemInstruction"],e5(i));let o=eb(t,["temperature"]);null!=o&&e_(r,["temperature"],o);let s=eb(t,["topP"]);null!=s&&e_(r,["topP"],s);let a=eb(t,["topK"]);null!=a&&e_(r,["topK"],a);let l=eb(t,["candidateCount"]);null!=l&&e_(r,["candidateCount"],l);let u=eb(t,["maxOutputTokens"]);null!=u&&e_(r,["maxOutputTokens"],u);let c=eb(t,["stopSequences"]);null!=c&&e_(r,["stopSequences"],c);let d=eb(t,["responseLogprobs"]);null!=d&&e_(r,["responseLogprobs"],d);let h=eb(t,["logprobs"]);null!=h&&e_(r,["logprobs"],h);let p=eb(t,["presencePenalty"]);null!=p&&e_(r,["presencePenalty"],p);let f=eb(t,["frequencyPenalty"]);null!=f&&e_(r,["frequencyPenalty"],f);let m=eb(t,["seed"]);null!=m&&e_(r,["seed"],m);let g=eb(t,["responseMimeType"]);null!=g&&e_(r,["responseMimeType"],g);let y=eb(t,["responseSchema"]);null!=y&&e_(r,["responseSchema"],te(y));let v=eb(t,["responseJsonSchema"]);null!=v&&e_(r,["responseJsonSchema"],v);let _=eb(t,["routingConfig"]);null!=_&&e_(r,["routingConfig"],_);let b=eb(t,["modelSelectionConfig"]);null!=b&&e_(r,["modelConfig"],b);let E=eb(t,["safetySettings"]);if(void 0!==n&&null!=E){let e=E;Array.isArray(e)&&(e=e.map(e=>e)),e_(n,["safetySettings"],e)}let T=eb(t,["tools"]);if(void 0!==n&&null!=T){let e=ti(T);Array.isArray(e)&&(e=e.map(e=>tY(tr(e)))),e_(n,["tools"],e)}let w=eb(t,["toolConfig"]);void 0!==n&&null!=w&&e_(n,["toolConfig"],w);let S=eb(t,["labels"]);void 0!==n&&null!=S&&e_(n,["labels"],S);let A=eb(t,["cachedContent"]);void 0!==n&&null!=A&&e_(n,["cachedContent"],to(e,A));let C=eb(t,["responseModalities"]);null!=C&&e_(r,["responseModalities"],C);let O=eb(t,["mediaResolution"]);null!=O&&e_(r,["mediaResolution"],O);let I=eb(t,["speechConfig"]);null!=I&&e_(r,["speechConfig"],tK(tt(I)));let k=eb(t,["audioTimestamp"]);null!=k&&e_(r,["audioTimestamp"],k);let R=eb(t,["thinkingConfig"]);null!=R&&e_(r,["thinkingConfig"],R);let N=eb(t,["imageConfig"]);return null!=N&&e_(r,["imageConfig"],N),r}(e,o,n)),n}function tL(e){let t={},n=eb(e,["sdkHttpResponse"]);null!=n&&e_(t,["sdkHttpResponse"],n);let r=eb(e,["candidates"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eb(e,["content"]);null!=n&&e_(t,["content"],n);let r=eb(e,["citationMetadata"]);null!=r&&e_(t,["citationMetadata"],function(e){let t={},n=eb(e,["citationSources"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),e_(t,["citations"],e)}return t}(r));let i=eb(e,["tokenCount"]);null!=i&&e_(t,["tokenCount"],i);let o=eb(e,["finishReason"]);null!=o&&e_(t,["finishReason"],o);let s=eb(e,["avgLogprobs"]);null!=s&&e_(t,["avgLogprobs"],s);let a=eb(e,["groundingMetadata"]);null!=a&&e_(t,["groundingMetadata"],a);let l=eb(e,["index"]);null!=l&&e_(t,["index"],l);let u=eb(e,["logprobsResult"]);null!=u&&e_(t,["logprobsResult"],u);let c=eb(e,["safetyRatings"]);if(null!=c){let e=c;Array.isArray(e)&&(e=e.map(e=>e)),e_(t,["safetyRatings"],e)}let d=eb(e,["urlContextMetadata"]);return null!=d&&e_(t,["urlContextMetadata"],d),t})(e))),e_(t,["candidates"],e)}let i=eb(e,["modelVersion"]);null!=i&&e_(t,["modelVersion"],i);let o=eb(e,["promptFeedback"]);null!=o&&e_(t,["promptFeedback"],o);let s=eb(e,["responseId"]);null!=s&&e_(t,["responseId"],s);let a=eb(e,["usageMetadata"]);return null!=a&&e_(t,["usageMetadata"],a),t}function tG(e){let t={},n=eb(e,["sdkHttpResponse"]);null!=n&&e_(t,["sdkHttpResponse"],n);let r=eb(e,["candidates"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),e_(t,["candidates"],e)}let i=eb(e,["createTime"]);null!=i&&e_(t,["createTime"],i);let o=eb(e,["modelVersion"]);null!=o&&e_(t,["modelVersion"],o);let s=eb(e,["promptFeedback"]);null!=s&&e_(t,["promptFeedback"],s);let a=eb(e,["responseId"]);null!=a&&e_(t,["responseId"],a);let l=eb(e,["usageMetadata"]);return null!=l&&e_(t,["usageMetadata"],l),t}function tq(e){let t={},n=eb(e,["_self"]);null!=n&&e_(t,["image"],tF(n));let r=eb(e,["raiFilteredReason"]);null!=r&&e_(t,["raiFilteredReason"],r);let i=eb(e,["_self"]);null!=i&&e_(t,["safetyAttributes"],tJ(i));let o=eb(e,["prompt"]);return null!=o&&e_(t,["enhancedPrompt"],o),t}function tF(e){let t={},n=eb(e,["gcsUri"]);null!=n&&e_(t,["gcsUri"],n);let r=eb(e,["bytesBase64Encoded"]);null!=r&&e_(t,["imageBytes"],eE(r));let i=eb(e,["mimeType"]);return null!=i&&e_(t,["mimeType"],i),t}function tH(e){let t={};if(void 0!==eb(e,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");let n=eb(e,["imageBytes"]);null!=n&&e_(t,["bytesBase64Encoded"],eE(n));let r=eb(e,["mimeType"]);return null!=r&&e_(t,["mimeType"],r),t}function tB(e){let t={},n=eb(e,["gcsUri"]);null!=n&&e_(t,["gcsUri"],n);let r=eb(e,["imageBytes"]);null!=r&&e_(t,["bytesBase64Encoded"],eE(r));let i=eb(e,["mimeType"]);return null!=i&&e_(t,["mimeType"],i),t}function tV(e){let t={},n=eb(e,["name"]);null!=n&&e_(t,["name"],n);let r=eb(e,["displayName"]);null!=r&&e_(t,["displayName"],r);let i=eb(e,["description"]);null!=i&&e_(t,["description"],i);let o=eb(e,["version"]);null!=o&&e_(t,["version"],o);let s=eb(e,["_self"]);null!=s&&e_(t,["tunedModelInfo"],function(e){let t={},n=eb(e,["baseModel"]);null!=n&&e_(t,["baseModel"],n);let r=eb(e,["createTime"]);null!=r&&e_(t,["createTime"],r);let i=eb(e,["updateTime"]);return null!=i&&e_(t,["updateTime"],i),t}(s));let a=eb(e,["inputTokenLimit"]);null!=a&&e_(t,["inputTokenLimit"],a);let l=eb(e,["outputTokenLimit"]);null!=l&&e_(t,["outputTokenLimit"],l);let u=eb(e,["supportedGenerationMethods"]);null!=u&&e_(t,["supportedActions"],u);let c=eb(e,["temperature"]);null!=c&&e_(t,["temperature"],c);let d=eb(e,["maxTemperature"]);null!=d&&e_(t,["maxTemperature"],d);let h=eb(e,["topP"]);null!=h&&e_(t,["topP"],h);let p=eb(e,["topK"]);null!=p&&e_(t,["topK"],p);let f=eb(e,["thinking"]);return null!=f&&e_(t,["thinking"],f),t}function t$(e){let t={},n=eb(e,["name"]);null!=n&&e_(t,["name"],n);let r=eb(e,["displayName"]);null!=r&&e_(t,["displayName"],r);let i=eb(e,["description"]);null!=i&&e_(t,["description"],i);let o=eb(e,["versionId"]);null!=o&&e_(t,["version"],o);let s=eb(e,["deployedModels"]);if(null!=s){let e=s;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eb(e,["endpoint"]);null!=n&&e_(t,["name"],n);let r=eb(e,["deployedModelId"]);return null!=r&&e_(t,["deployedModelId"],r),t})(e))),e_(t,["endpoints"],e)}let a=eb(e,["labels"]);null!=a&&e_(t,["labels"],a);let l=eb(e,["_self"]);null!=l&&e_(t,["tunedModelInfo"],function(e){let t={},n=eb(e,["labels","google-vertex-llm-tuning-base-model-id"]);null!=n&&e_(t,["baseModel"],n);let r=eb(e,["createTime"]);null!=r&&e_(t,["createTime"],r);let i=eb(e,["updateTime"]);return null!=i&&e_(t,["updateTime"],i),t}(l));let u=eb(e,["defaultCheckpointId"]);null!=u&&e_(t,["defaultCheckpointId"],u);let c=eb(e,["checkpoints"]);if(null!=c){let e=c;Array.isArray(e)&&(e=e.map(e=>e)),e_(t,["checkpoints"],e)}return t}function tW(e){let t={},n=eb(e,["safetyAttributes","categories"]);null!=n&&e_(t,["categories"],n);let r=eb(e,["safetyAttributes","scores"]);null!=r&&e_(t,["scores"],r);let i=eb(e,["contentType"]);return null!=i&&e_(t,["contentType"],i),t}function tJ(e){let t={},n=eb(e,["safetyAttributes","categories"]);null!=n&&e_(t,["categories"],n);let r=eb(e,["safetyAttributes","scores"]);null!=r&&e_(t,["scores"],r);let i=eb(e,["contentType"]);return null!=i&&e_(t,["contentType"],i),t}function tK(e){let t={},n=eb(e,["languageCode"]);null!=n&&e_(t,["languageCode"],n);let r=eb(e,["voiceConfig"]);if(null!=r&&e_(t,["voiceConfig"],r),void 0!==eb(e,["multiSpeakerVoiceConfig"]))throw Error("multiSpeakerVoiceConfig parameter is not supported in Vertex AI.");return t}function tY(e){let t={},n=eb(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==eb(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");let n=eb(e,["description"]);null!=n&&e_(t,["description"],n);let r=eb(e,["name"]);null!=r&&e_(t,["name"],r);let i=eb(e,["parameters"]);null!=i&&e_(t,["parameters"],i);let o=eb(e,["parametersJsonSchema"]);null!=o&&e_(t,["parametersJsonSchema"],o);let s=eb(e,["response"]);null!=s&&e_(t,["response"],s);let a=eb(e,["responseJsonSchema"]);return null!=a&&e_(t,["responseJsonSchema"],a),t})(e))),e_(t,["functionDeclarations"],e)}let r=eb(e,["retrieval"]);null!=r&&e_(t,["retrieval"],r);let i=eb(e,["googleSearchRetrieval"]);null!=i&&e_(t,["googleSearchRetrieval"],i);let o=eb(e,["computerUse"]);if(null!=o&&e_(t,["computerUse"],o),void 0!==eb(e,["fileSearch"]))throw Error("fileSearch parameter is not supported in Vertex AI.");let s=eb(e,["codeExecution"]);null!=s&&e_(t,["codeExecution"],s);let a=eb(e,["enterpriseWebSearch"]);null!=a&&e_(t,["enterpriseWebSearch"],a);let l=eb(e,["googleMaps"]);null!=l&&e_(t,["googleMaps"],l);let u=eb(e,["googleSearch"]);null!=u&&e_(t,["googleSearch"],u);let c=eb(e,["urlContext"]);return null!=c&&e_(t,["urlContext"],c),t}function tz(e){let t={},n=eb(e,["uri"]);null!=n&&e_(t,["uri"],n);let r=eb(e,["videoBytes"]);null!=r&&e_(t,["encodedVideo"],eE(r));let i=eb(e,["mimeType"]);return null!=i&&e_(t,["encoding"],i),t}function tX(e){let t={},n=eb(e,["uri"]);null!=n&&e_(t,["gcsUri"],n);let r=eb(e,["videoBytes"]);null!=r&&e_(t,["bytesBase64Encoded"],eE(r));let i=eb(e,["mimeType"]);return null!=i&&e_(t,["mimeType"],i),t}let tQ="x-goog-api-client",tZ=/^\s*data: (.*)(?:\n\n|\r\r|\r\n\r\n)/;class t0{constructor(e){var t,n;this.clientOptions=Object.assign(Object.assign({},e),{project:e.project,location:e.location,apiKey:e.apiKey,vertexai:e.vertexai});let r={};this.clientOptions.vertexai?(r.apiVersion=null!==(t=this.clientOptions.apiVersion)&&void 0!==t?t:"v1beta1",r.baseUrl=this.baseUrlFromProjectLocation(),this.normalizeAuthParameters()):(r.apiVersion=null!==(n=this.clientOptions.apiVersion)&&void 0!==n?n:"v1beta",r.baseUrl="https://generativelanguage.googleapis.com/"),r.headers=this.getDefaultHeaders(),this.clientOptions.httpOptions=r,e.httpOptions&&(this.clientOptions.httpOptions=this.patchHttpOptions(r,e.httpOptions))}baseUrlFromProjectLocation(){return this.clientOptions.project&&this.clientOptions.location&&"global"!==this.clientOptions.location?`https://${this.clientOptions.location}-aiplatform.googleapis.com/`:"https://aiplatform.googleapis.com/"}normalizeAuthParameters(){if(this.clientOptions.project&&this.clientOptions.location){this.clientOptions.apiKey=void 0;return}this.clientOptions.project=void 0,this.clientOptions.location=void 0}isVertexAI(){var e;return null!==(e=this.clientOptions.vertexai)&&void 0!==e&&e}getProject(){return this.clientOptions.project}getLocation(){return this.clientOptions.location}getApiVersion(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.apiVersion)return this.clientOptions.httpOptions.apiVersion;throw Error("API version is not set.")}getBaseUrl(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.baseUrl)return this.clientOptions.httpOptions.baseUrl;throw Error("Base URL is not set.")}getRequestUrl(){return this.getRequestUrlInternal(this.clientOptions.httpOptions)}getHeaders(){if(this.clientOptions.httpOptions&&void 0!==this.clientOptions.httpOptions.headers)return this.clientOptions.httpOptions.headers;throw Error("Headers are not set.")}getRequestUrlInternal(e){if(!e||void 0===e.baseUrl||void 0===e.apiVersion)throw Error("HTTP options are not correctly set.");let t=[e.baseUrl.endsWith("/")?e.baseUrl.slice(0,-1):e.baseUrl];return e.apiVersion&&""!==e.apiVersion&&t.push(e.apiVersion),t.join("/")}getBaseResourcePath(){return`projects/${this.clientOptions.project}/locations/${this.clientOptions.location}`}getApiKey(){return this.clientOptions.apiKey}getWebsocketBaseUrl(){let e=new URL(this.getBaseUrl());return e.protocol="http:"==e.protocol?"ws":"wss",e.toString()}setBaseUrl(e){if(this.clientOptions.httpOptions)this.clientOptions.httpOptions.baseUrl=e;else throw Error("HTTP options are not correctly set.")}constructUrl(e,t,n){let r=[this.getRequestUrlInternal(t)];return n&&r.push(this.getBaseResourcePath()),""!==e&&r.push(e),new URL(`${r.join("/")}`)}shouldPrependVertexProjectPath(e){return!(this.clientOptions.apiKey||!this.clientOptions.vertexai||e.path.startsWith("projects/")||"GET"===e.httpMethod&&e.path.startsWith("publishers/google/models"))}async request(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),r=this.constructUrl(e.path,t,n);if(e.queryParams)for(let[t,n]of Object.entries(e.queryParams))r.searchParams.append(t,String(n));let i={};if("GET"===e.httpMethod){if(e.body&&"{}"!==e.body)throw Error("Request body should be empty for GET request, but got non empty request body")}else i.body=e.body;return i=await this.includeExtraHttpOptionsToRequestInit(i,t,r.toString(),e.abortSignal),this.unaryApiCall(r,i,e.httpMethod)}patchHttpOptions(e,t){let n=JSON.parse(JSON.stringify(e));for(let[e,r]of Object.entries(t))"object"==typeof r?n[e]=Object.assign(Object.assign({},n[e]),r):void 0!==r&&(n[e]=r);return n}async requestStream(e){let t=this.clientOptions.httpOptions;e.httpOptions&&(t=this.patchHttpOptions(this.clientOptions.httpOptions,e.httpOptions));let n=this.shouldPrependVertexProjectPath(e),r=this.constructUrl(e.path,t,n);r.searchParams.has("alt")&&"sse"===r.searchParams.get("alt")||r.searchParams.set("alt","sse");let i={};return i.body=e.body,i=await this.includeExtraHttpOptionsToRequestInit(i,t,r.toString(),e.abortSignal),this.streamApiCall(r,i,e.httpMethod)}async includeExtraHttpOptionsToRequestInit(e,t,n,r){if(t&&t.timeout||r){let n=new AbortController,i=n.signal;if(t.timeout&&(null==t?void 0:t.timeout)>0){let e=setTimeout(()=>n.abort(),t.timeout);e&&"function"==typeof e.unref&&e.unref()}r&&r.addEventListener("abort",()=>{n.abort()}),e.signal=i}return t&&null!==t.extraBody&&function(e,t){if(!t||0===Object.keys(t).length)return;if(e.body instanceof Blob){console.warn("includeExtraBodyToRequestInit: extraBody provided but current request body is a Blob. extraBody will be ignored as merging is not supported for Blob bodies.");return}let n={};if("string"==typeof e.body&&e.body.length>0)try{let t=JSON.parse(e.body);if("object"!=typeof t||null===t||Array.isArray(t)){console.warn("includeExtraBodyToRequestInit: Original request body is valid JSON but not a non-array object. Skip applying extraBody to the request body.");return}n=t}catch(e){console.warn("includeExtraBodyToRequestInit: Original request body is not valid JSON. Skip applying extraBody to the request body.");return}let r=function e(t,n){let r=Object.assign({},t);for(let t in n)if(Object.prototype.hasOwnProperty.call(n,t)){let i=n[t],o=r[t];i&&"object"==typeof i&&!Array.isArray(i)&&o&&"object"==typeof o&&!Array.isArray(o)?r[t]=e(o,i):(o&&i&&typeof o!=typeof i&&console.warn(`includeExtraBodyToRequestInit:deepMerge: Type mismatch for key "${t}". Original type: ${typeof o}, New type: ${typeof i}. Overwriting.`),r[t]=i)}return r}(n,t);e.body=JSON.stringify(r)}(e,t.extraBody),e.headers=await this.getHeadersInternal(t,n),e}async unaryApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async e=>(await t1(e),new ew(e))).catch(e=>{if(e instanceof Error)throw e;throw Error(JSON.stringify(e))})}async streamApiCall(e,t,n){return this.apiCall(e.toString(),Object.assign(Object.assign({},t),{method:n})).then(async e=>(await t1(e),this.processStreamResponse(e))).catch(e=>{if(e instanceof Error)throw e;throw Error(JSON.stringify(e))})}processStreamResponse(e){var t;return tA(this,arguments,function*(){let n=null===(t=null==e?void 0:e.body)||void 0===t?void 0:t.getReader(),r=new TextDecoder("utf-8");if(!n)throw Error("Response body is empty");try{let t="";for(;;){let{done:i,value:o}=yield tS(n.read());if(i){if(t.trim().length>0)throw Error("Incomplete JSON segment at the end");break}let s=r.decode(o,{stream:!0});try{let e=JSON.parse(s);if("error"in e){let t=JSON.parse(JSON.stringify(e.error)),n=t.status,r=t.code,i=`got status: ${n}. ${JSON.stringify(e)}`;if(r>=400&&r<600)throw new tN({message:i,status:r})}}catch(e){if("ApiError"===e.name)throw e}let a=(t+=s).match(tZ);for(;a;){let n=a[1];try{let r=new Response(n,{headers:null==e?void 0:e.headers,status:null==e?void 0:e.status,statusText:null==e?void 0:e.statusText});yield yield tS(new ew(r)),a=(t=t.slice(a[0].length)).match(tZ)}catch(e){throw Error(`exception parsing stream chunk ${n}. ${e}`)}}}}finally{n.releaseLock()}})}async apiCall(e,t){return fetch(e,t).catch(e=>{throw Error(`exception ${e} sending request`)})}getDefaultHeaders(){let e={},t="google-genai-sdk/1.29.1 "+this.clientOptions.userAgentExtra;return e["User-Agent"]=t,e[tQ]=t,e["Content-Type"]="application/json",e}async getHeadersInternal(e,t){let n=new Headers;if(e&&e.headers){for(let[t,r]of Object.entries(e.headers))n.append(t,r);e.timeout&&e.timeout>0&&n.append("X-Server-Timeout",String(Math.ceil(e.timeout/1e3)))}return await this.clientOptions.auth.addAuthHeaders(n,t),n}getFileName(e){var t;let n="";return"string"==typeof e&&(n=null!==(t=(n=e.replace(/[/\\]+$/,"")).split(/[/\\]/).pop())&&void 0!==t?t:""),n}async uploadFile(e,t){var n;let r={};null!=t&&(r.mimeType=t.mimeType,r.name=t.name,r.displayName=t.displayName),r.name&&!r.name.startsWith("files/")&&(r.name=`files/${r.name}`);let i=this.clientOptions.uploader,o=await i.stat(e);r.sizeBytes=String(o.size);let s=null!==(n=null==t?void 0:t.mimeType)&&void 0!==n?n:o.type;if(void 0===s||""===s)throw Error("Can not determine mimeType. Please provide mimeType in the config.");r.mimeType=s;let a={file:r},l=this.getFileName(e),u=ev("upload/v1beta/files",a._url),c=await this.fetchUploadUrl(u,r.sizeBytes,r.mimeType,l,a,null==t?void 0:t.httpOptions);return i.upload(e,c,this)}async uploadFileToFileSearchStore(e,t,n){var r;let i=this.clientOptions.uploader,o=await i.stat(t),s=String(o.size),a=null!==(r=null==n?void 0:n.mimeType)&&void 0!==r?r:o.type;if(void 0===a||""===a)throw Error("Can not determine mimeType. Please provide mimeType in the config.");let l=`upload/v1beta/${e}:uploadToFileSearchStore`,u=this.getFileName(t),c={};(null==n?void 0:n.customMetadata)&&(c.customMetadata=n.customMetadata),(null==n?void 0:n.chunkingConfig)&&(c.chunkingConfig=n.chunkingConfig);let d=await this.fetchUploadUrl(l,s,a,u,c,null==n?void 0:n.httpOptions);return i.uploadToFileSearchStore(t,d,this)}async downloadFile(e){let t=this.clientOptions.downloader;await t.download(e,this)}async fetchUploadUrl(e,t,n,r,i,o){var s;let a={};a=o||{apiVersion:"",headers:Object.assign({"Content-Type":"application/json","X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":`${t}`,"X-Goog-Upload-Header-Content-Type":`${n}`},r?{"X-Goog-Upload-File-Name":r}:{})};let l=await this.request({path:e,body:JSON.stringify(i),httpMethod:"POST",httpOptions:a});if(!l||!(null==l?void 0:l.headers))throw Error("Server did not return an HttpResponse or the returned HttpResponse did not have headers.");let u=null===(s=null==l?void 0:l.headers)||void 0===s?void 0:s["x-goog-upload-url"];if(void 0===u)throw Error("Failed to get upload url. Server did not return the x-google-upload-url in the headers");return u}}async function t1(e){var t;if(void 0===e)throw Error("response is undefined");if(!e.ok){let n=e.status,r=JSON.stringify((null===(t=e.headers.get("content-type"))||void 0===t?void 0:t.includes("application/json"))?await e.json():{error:{message:await e.text(),code:e.status,status:e.statusText}});if(n>=400&&n<600)throw new tN({message:r,status:n});throw Error(r)}}function t2(e){for(let t of e){if(null!==t&&"object"==typeof t&&t instanceof t8||"object"==typeof t&&"inputSchema"in t)return!0}return!1}function t4(e){var t;let n=null!==(t=e[tQ])&&void 0!==t?t:"";e[tQ]=(n+" mcp_used/unknown").trimStart()}class t8{constructor(e=[],t){this.mcpTools=[],this.functionNameToMcpClient={},this.mcpClients=e,this.config=t}static create(e,t){return new t8(e,t)}async initialize(){var e,t,n,r;if(this.mcpTools.length>0)return;let i={},o=[];for(let u of this.mcpClients)try{for(var s,a=!0,l=(t=void 0,tC(function(e,t=100){return tA(this,arguments,function*(){let n;let r=0;for(;r<t;){let t=yield tS(e.listTools({cursor:n}));for(let e of t.tools)yield yield tS(e),r++;if(!t.nextCursor)break;n=t.nextCursor}})}(u)));!(e=(s=await l.next()).done);a=!0){r=s.value,a=!1,o.push(r);let e=r.name;if(i[e])throw Error(`Duplicate function name ${e} found in MCP tools. Please ensure function names are unique.`);i[e]=u}}catch(e){t={error:e}}finally{try{!a&&!e&&(n=l.return)&&await n.call(l)}finally{if(t)throw t.error}}this.mcpTools=o,this.functionNameToMcpClient=i}async tool(){return await this.initialize(),function(e,t={}){let n=[],r=new Set;for(let i of e){let e=i.name;if(r.has(e))throw Error(`Duplicate function name ${e} found in MCP tools. Please ensure function names are unique.`);r.add(e);let o=function(e,t={}){let n={name:e.name,description:e.description,parametersJsonSchema:e.inputSchema};return e.outputSchema&&(n.responseJsonSchema=e.outputSchema),t.behavior&&(n.behavior=t.behavior),{functionDeclarations:[n]}}(i,t);o.functionDeclarations&&n.push(...o.functionDeclarations)}return{functionDeclarations:n}}(this.mcpTools,this.config)}async callTool(e){await this.initialize();let t=[];for(let n of e)if(n.name in this.functionNameToMcpClient){let e;let r=this.functionNameToMcpClient[n.name];this.config.timeout&&(e={timeout:this.config.timeout});let i=await r.callTool({name:n.name,arguments:n.args},void 0,e);t.push({functionResponse:{name:n.name,response:i.isError?{error:i}:i}})}return t}}async function t6(e,t,n){let r;let i=new eK;n.data instanceof Blob?r=JSON.parse(await n.data.text()):r=JSON.parse(n.data),Object.assign(i,r),t(i)}class t3{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n}async connect(e){var t,n;if(this.apiClient.isVertexAI())throw Error("Live music is not supported for Vertex AI.");console.warn("Live music generation is experimental and may change in future versions.");let r=this.apiClient.getWebsocketBaseUrl(),i=this.apiClient.getApiVersion(),o=function(e){let t=new Headers;for(let[n,r]of Object.entries(e))t.append(n,r);return t}(this.apiClient.getDefaultHeaders()),s=this.apiClient.getApiKey(),a=`${r}/ws/google.ai.generativelanguage.${i}.GenerativeService.BidiGenerateMusic?key=${s}`,l=()=>{},u=new Promise(e=>{l=e}),c=e.callbacks,d=this.apiClient,h={onopen:function(){l({})},onmessage:e=>{t6(d,c.onmessage,e)},onerror:null!==(t=null==c?void 0:c.onerror)&&void 0!==t?t:function(e){},onclose:null!==(n=null==c?void 0:c.onclose)&&void 0!==n?n:function(e){}},p=this.webSocketFactory.create(a,function(e){let t={};return e.forEach((e,n)=>{t[n]=e}),t}(o),h);p.connect(),await u;let f=ez(this.apiClient,e.model);return p.send(JSON.stringify({setup:{model:f}})),new t5(p,this.apiClient)}}class t5{constructor(e,t){this.conn=e,this.apiClient=t}async setWeightedPrompts(e){if(!e.weightedPrompts||0===Object.keys(e.weightedPrompts).length)throw Error("Weighted prompts must be set and contain at least one entry.");let t=function(e){let t={},n=eb(e,["weightedPrompts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),e_(t,["weightedPrompts"],e)}return t}(e);this.conn.send(JSON.stringify({clientContent:t}))}async setMusicGenerationConfig(e){e.musicGenerationConfig||(e.musicGenerationConfig={});let t=function(e){let t={},n=eb(e,["musicGenerationConfig"]);return null!=n&&e_(t,["musicGenerationConfig"],n),t}(e);this.conn.send(JSON.stringify(t))}sendPlaybackControl(e){this.conn.send(JSON.stringify({playbackControl:e}))}play(){this.sendPlaybackControl(er.PLAY)}pause(){this.sendPlaybackControl(er.PAUSE)}stop(){this.sendPlaybackControl(er.STOP)}resetContext(){this.sendPlaybackControl(er.RESET_CONTEXT)}close(){this.conn.close()}}async function t9(e,t,n){let r;let i=new eJ;n.data instanceof Blob?r=await n.data.text():r=n.data instanceof ArrayBuffer?new TextDecoder().decode(n.data):n.data;let o=JSON.parse(r);e.isVertexAI()?Object.assign(i,function(e){let t={},n=eb(e,["setupComplete"]);null!=n&&e_(t,["setupComplete"],n);let r=eb(e,["serverContent"]);null!=r&&e_(t,["serverContent"],r);let i=eb(e,["toolCall"]);null!=i&&e_(t,["toolCall"],i);let o=eb(e,["toolCallCancellation"]);null!=o&&e_(t,["toolCallCancellation"],o);let s=eb(e,["usageMetadata"]);null!=s&&e_(t,["usageMetadata"],function(e){let t={},n=eb(e,["promptTokenCount"]);null!=n&&e_(t,["promptTokenCount"],n);let r=eb(e,["cachedContentTokenCount"]);null!=r&&e_(t,["cachedContentTokenCount"],r);let i=eb(e,["candidatesTokenCount"]);null!=i&&e_(t,["responseTokenCount"],i);let o=eb(e,["toolUsePromptTokenCount"]);null!=o&&e_(t,["toolUsePromptTokenCount"],o);let s=eb(e,["thoughtsTokenCount"]);null!=s&&e_(t,["thoughtsTokenCount"],s);let a=eb(e,["totalTokenCount"]);null!=a&&e_(t,["totalTokenCount"],a);let l=eb(e,["promptTokensDetails"]);if(null!=l){let e=l;Array.isArray(e)&&(e=e.map(e=>e)),e_(t,["promptTokensDetails"],e)}let u=eb(e,["cacheTokensDetails"]);if(null!=u){let e=u;Array.isArray(e)&&(e=e.map(e=>e)),e_(t,["cacheTokensDetails"],e)}let c=eb(e,["candidatesTokensDetails"]);if(null!=c){let e=c;Array.isArray(e)&&(e=e.map(e=>e)),e_(t,["responseTokensDetails"],e)}let d=eb(e,["toolUsePromptTokensDetails"]);if(null!=d){let e=d;Array.isArray(e)&&(e=e.map(e=>e)),e_(t,["toolUsePromptTokensDetails"],e)}let h=eb(e,["trafficType"]);return null!=h&&e_(t,["trafficType"],h),t}(s));let a=eb(e,["goAway"]);null!=a&&e_(t,["goAway"],a);let l=eb(e,["sessionResumptionUpdate"]);return null!=l&&e_(t,["sessionResumptionUpdate"],l),t}(o)):Object.assign(i,o),t(i)}class t7{constructor(e,t,n){this.apiClient=e,this.auth=t,this.webSocketFactory=n,this.music=new t3(this.apiClient,this.auth,this.webSocketFactory)}async connect(e){var t,n,r,i,o,s;let a;if(e.config&&e.config.httpOptions)throw Error("The Live module does not support httpOptions at request-level in LiveConnectConfig yet. Please use the client-level httpOptions configuration instead.");let l=this.apiClient.getWebsocketBaseUrl(),u=this.apiClient.getApiVersion(),c=this.apiClient.getHeaders();e.config&&e.config.tools&&t2(e.config.tools)&&t4(c);let d=function(e){let t=new Headers;for(let[n,r]of Object.entries(e))t.append(n,r);return t}(c);if(this.apiClient.isVertexAI())a=`${l}/ws/google.cloud.aiplatform.${u}.LlmBidiService/BidiGenerateContent`,await this.auth.addAuthHeaders(d,a);else{let e=this.apiClient.getApiKey(),t="BidiGenerateContent",n="key";(null==e?void 0:e.startsWith("auth_tokens/"))&&(console.warn("Warning: Ephemeral token support is experimental and may change in future versions."),"v1alpha"!==u&&console.warn("Warning: The SDK's ephemeral token support is in v1alpha only. Please use const ai = new GoogleGenAI({apiKey: token.name, httpOptions: { apiVersion: 'v1alpha' }}); before session connection."),t="BidiGenerateContentConstrained",n="access_token"),a=`${l}/ws/google.ai.generativelanguage.${u}.GenerativeService.${t}?${n}=${e}`}let h=()=>{},p=new Promise(e=>{h=e}),f=e.callbacks,m=this.apiClient,g={onopen:function(){var e;null===(e=null==f?void 0:f.onopen)||void 0===e||e.call(f),h({})},onmessage:e=>{t9(m,f.onmessage,e)},onerror:null!==(t=null==f?void 0:f.onerror)&&void 0!==t?t:function(e){},onclose:null!==(n=null==f?void 0:f.onclose)&&void 0!==n?n:function(e){}},y=this.webSocketFactory.create(a,function(e){let t={};return e.forEach((e,n)=>{t[n]=e}),t}(d),g);y.connect(),await p;let v=ez(this.apiClient,e.model);if(this.apiClient.isVertexAI()&&v.startsWith("publishers/")){let e=this.apiClient.getProject(),t=this.apiClient.getLocation();v=`projects/${e}/locations/${t}/`+v}let _={};this.apiClient.isVertexAI()&&(null===(r=e.config)||void 0===r?void 0:r.responseModalities)===void 0&&(void 0===e.config?e.config={responseModalities:[w.AUDIO]}:e.config.responseModalities=[w.AUDIO]),(null===(i=e.config)||void 0===i?void 0:i.generationConfig)&&console.warn("Setting `LiveConnectConfig.generation_config` is deprecated, please set the fields on `LiveConnectConfig` directly. This will become an error in a future version (not before Q3 2025).");let b=null!==(s=null===(o=e.config)||void 0===o?void 0:o.tools)&&void 0!==s?s:[],E=[];for(let e of b)this.isCallableTool(e)?E.push(await e.tool()):E.push(e);E.length>0&&(e.config.tools=E);let T={model:v,config:e.config,callbacks:e.callbacks};return _=this.apiClient.isVertexAI()?function(e,t){let n={},r=eb(t,["model"]);null!=r&&e_(n,["setup","model"],ez(e,r));let i=eb(t,["config"]);return null!=i&&e_(n,["config"],function(e,t){let n=eb(e,["generationConfig"]);void 0!==t&&null!=n&&e_(t,["setup","generationConfig"],function(e){let t={},n=eb(e,["modelSelectionConfig"]);null!=n&&e_(t,["modelConfig"],n);let r=eb(e,["responseJsonSchema"]);null!=r&&e_(t,["responseJsonSchema"],r);let i=eb(e,["audioTimestamp"]);null!=i&&e_(t,["audioTimestamp"],i);let o=eb(e,["candidateCount"]);null!=o&&e_(t,["candidateCount"],o);let s=eb(e,["enableAffectiveDialog"]);null!=s&&e_(t,["enableAffectiveDialog"],s);let a=eb(e,["frequencyPenalty"]);null!=a&&e_(t,["frequencyPenalty"],a);let l=eb(e,["logprobs"]);null!=l&&e_(t,["logprobs"],l);let u=eb(e,["maxOutputTokens"]);null!=u&&e_(t,["maxOutputTokens"],u);let c=eb(e,["mediaResolution"]);null!=c&&e_(t,["mediaResolution"],c);let d=eb(e,["presencePenalty"]);null!=d&&e_(t,["presencePenalty"],d);let h=eb(e,["responseLogprobs"]);null!=h&&e_(t,["responseLogprobs"],h);let p=eb(e,["responseMimeType"]);null!=p&&e_(t,["responseMimeType"],p);let f=eb(e,["responseModalities"]);null!=f&&e_(t,["responseModalities"],f);let m=eb(e,["responseSchema"]);null!=m&&e_(t,["responseSchema"],m);let g=eb(e,["routingConfig"]);null!=g&&e_(t,["routingConfig"],g);let y=eb(e,["seed"]);null!=y&&e_(t,["seed"],y);let v=eb(e,["speechConfig"]);null!=v&&e_(t,["speechConfig"],tU(v));let _=eb(e,["stopSequences"]);null!=_&&e_(t,["stopSequences"],_);let b=eb(e,["temperature"]);null!=b&&e_(t,["temperature"],b);let E=eb(e,["thinkingConfig"]);null!=E&&e_(t,["thinkingConfig"],E);let T=eb(e,["topK"]);null!=T&&e_(t,["topK"],T);let w=eb(e,["topP"]);if(null!=w&&e_(t,["topP"],w),void 0!==eb(e,["enableEnhancedCivicAnswers"]))throw Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}(n));let r=eb(e,["responseModalities"]);void 0!==t&&null!=r&&e_(t,["setup","generationConfig","responseModalities"],r);let i=eb(e,["temperature"]);void 0!==t&&null!=i&&e_(t,["setup","generationConfig","temperature"],i);let o=eb(e,["topP"]);void 0!==t&&null!=o&&e_(t,["setup","generationConfig","topP"],o);let s=eb(e,["topK"]);void 0!==t&&null!=s&&e_(t,["setup","generationConfig","topK"],s);let a=eb(e,["maxOutputTokens"]);void 0!==t&&null!=a&&e_(t,["setup","generationConfig","maxOutputTokens"],a);let l=eb(e,["mediaResolution"]);void 0!==t&&null!=l&&e_(t,["setup","generationConfig","mediaResolution"],l);let u=eb(e,["seed"]);void 0!==t&&null!=u&&e_(t,["setup","generationConfig","seed"],u);let c=eb(e,["speechConfig"]);void 0!==t&&null!=c&&e_(t,["setup","generationConfig","speechConfig"],tU(tn(c)));let d=eb(e,["thinkingConfig"]);void 0!==t&&null!=d&&e_(t,["setup","generationConfig","thinkingConfig"],d);let h=eb(e,["enableAffectiveDialog"]);void 0!==t&&null!=h&&e_(t,["setup","generationConfig","enableAffectiveDialog"],h);let p=eb(e,["systemInstruction"]);void 0!==t&&null!=p&&e_(t,["setup","systemInstruction"],e5(p));let f=eb(e,["tools"]);if(void 0!==t&&null!=f){let e=ti(f);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eb(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={};if(void 0!==eb(e,["behavior"]))throw Error("behavior parameter is not supported in Vertex AI.");let n=eb(e,["description"]);null!=n&&e_(t,["description"],n);let r=eb(e,["name"]);null!=r&&e_(t,["name"],r);let i=eb(e,["parameters"]);null!=i&&e_(t,["parameters"],i);let o=eb(e,["parametersJsonSchema"]);null!=o&&e_(t,["parametersJsonSchema"],o);let s=eb(e,["response"]);null!=s&&e_(t,["response"],s);let a=eb(e,["responseJsonSchema"]);return null!=a&&e_(t,["responseJsonSchema"],a),t})(e))),e_(t,["functionDeclarations"],e)}let r=eb(e,["retrieval"]);null!=r&&e_(t,["retrieval"],r);let i=eb(e,["googleSearchRetrieval"]);null!=i&&e_(t,["googleSearchRetrieval"],i);let o=eb(e,["computerUse"]);if(null!=o&&e_(t,["computerUse"],o),void 0!==eb(e,["fileSearch"]))throw Error("fileSearch parameter is not supported in Vertex AI.");let s=eb(e,["codeExecution"]);null!=s&&e_(t,["codeExecution"],s);let a=eb(e,["enterpriseWebSearch"]);null!=a&&e_(t,["enterpriseWebSearch"],a);let l=eb(e,["googleMaps"]);null!=l&&e_(t,["googleMaps"],l);let u=eb(e,["googleSearch"]);null!=u&&e_(t,["googleSearch"],u);let c=eb(e,["urlContext"]);return null!=c&&e_(t,["urlContext"],c),t})(tr(e)))),e_(t,["setup","tools"],e)}let m=eb(e,["sessionResumption"]);void 0!==t&&null!=m&&e_(t,["setup","sessionResumption"],m);let g=eb(e,["inputAudioTranscription"]);void 0!==t&&null!=g&&e_(t,["setup","inputAudioTranscription"],g);let y=eb(e,["outputAudioTranscription"]);void 0!==t&&null!=y&&e_(t,["setup","outputAudioTranscription"],y);let v=eb(e,["realtimeInputConfig"]);void 0!==t&&null!=v&&e_(t,["setup","realtimeInputConfig"],v);let _=eb(e,["contextWindowCompression"]);void 0!==t&&null!=_&&e_(t,["setup","contextWindowCompression"],_);let b=eb(e,["proactivity"]);return void 0!==t&&null!=b&&e_(t,["setup","proactivity"],b),{}}(i,n)),n}(this.apiClient,T):function(e,t){let n={},r=eb(t,["model"]);null!=r&&e_(n,["setup","model"],ez(e,r));let i=eb(t,["config"]);return null!=i&&e_(n,["config"],function(e,t){let n=eb(e,["generationConfig"]);void 0!==t&&null!=n&&e_(t,["setup","generationConfig"],n);let r=eb(e,["responseModalities"]);void 0!==t&&null!=r&&e_(t,["setup","generationConfig","responseModalities"],r);let i=eb(e,["temperature"]);void 0!==t&&null!=i&&e_(t,["setup","generationConfig","temperature"],i);let o=eb(e,["topP"]);void 0!==t&&null!=o&&e_(t,["setup","generationConfig","topP"],o);let s=eb(e,["topK"]);void 0!==t&&null!=s&&e_(t,["setup","generationConfig","topK"],s);let a=eb(e,["maxOutputTokens"]);void 0!==t&&null!=a&&e_(t,["setup","generationConfig","maxOutputTokens"],a);let l=eb(e,["mediaResolution"]);void 0!==t&&null!=l&&e_(t,["setup","generationConfig","mediaResolution"],l);let u=eb(e,["seed"]);void 0!==t&&null!=u&&e_(t,["setup","generationConfig","seed"],u);let c=eb(e,["speechConfig"]);void 0!==t&&null!=c&&e_(t,["setup","generationConfig","speechConfig"],tn(c));let d=eb(e,["thinkingConfig"]);void 0!==t&&null!=d&&e_(t,["setup","generationConfig","thinkingConfig"],d);let h=eb(e,["enableAffectiveDialog"]);void 0!==t&&null!=h&&e_(t,["setup","generationConfig","enableAffectiveDialog"],h);let p=eb(e,["systemInstruction"]);void 0!==t&&null!=p&&e_(t,["setup","systemInstruction"],function(e){let t={},n=eb(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eb(e,["functionCall"]);null!=n&&e_(t,["functionCall"],n);let r=eb(e,["codeExecutionResult"]);null!=r&&e_(t,["codeExecutionResult"],r);let i=eb(e,["executableCode"]);null!=i&&e_(t,["executableCode"],i);let o=eb(e,["fileData"]);null!=o&&e_(t,["fileData"],function(e){let t={};if(void 0!==eb(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=eb(e,["fileUri"]);null!=n&&e_(t,["fileUri"],n);let r=eb(e,["mimeType"]);return null!=r&&e_(t,["mimeType"],r),t}(o));let s=eb(e,["functionResponse"]);null!=s&&e_(t,["functionResponse"],s);let a=eb(e,["inlineData"]);null!=a&&e_(t,["inlineData"],tx(a));let l=eb(e,["text"]);null!=l&&e_(t,["text"],l);let u=eb(e,["thought"]);null!=u&&e_(t,["thought"],u);let c=eb(e,["thoughtSignature"]);null!=c&&e_(t,["thoughtSignature"],c);let d=eb(e,["videoMetadata"]);return null!=d&&e_(t,["videoMetadata"],d),t})(e))),e_(t,["parts"],e)}let r=eb(e,["role"]);return null!=r&&e_(t,["role"],r),t}(e5(p)));let f=eb(e,["tools"]);if(void 0!==t&&null!=f){let e=ti(f);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eb(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),e_(t,["functionDeclarations"],e)}if(void 0!==eb(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let r=eb(e,["googleSearchRetrieval"]);null!=r&&e_(t,["googleSearchRetrieval"],r);let i=eb(e,["computerUse"]);null!=i&&e_(t,["computerUse"],i);let o=eb(e,["fileSearch"]);null!=o&&e_(t,["fileSearch"],o);let s=eb(e,["codeExecution"]);if(null!=s&&e_(t,["codeExecution"],s),void 0!==eb(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=eb(e,["googleMaps"]);null!=a&&e_(t,["googleMaps"],function(e){let t={};if(void 0!==eb(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=eb(e,["enableWidget"]);return null!=n&&e_(t,["enableWidget"],n),t}(a));let l=eb(e,["googleSearch"]);null!=l&&e_(t,["googleSearch"],function(e){let t={};if(void 0!==eb(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==eb(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let n=eb(e,["timeRangeFilter"]);return null!=n&&e_(t,["timeRangeFilter"],n),t}(l));let u=eb(e,["urlContext"]);return null!=u&&e_(t,["urlContext"],u),t})(tr(e)))),e_(t,["setup","tools"],e)}let m=eb(e,["sessionResumption"]);void 0!==t&&null!=m&&e_(t,["setup","sessionResumption"],function(e){let t={},n=eb(e,["handle"]);if(null!=n&&e_(t,["handle"],n),void 0!==eb(e,["transparent"]))throw Error("transparent parameter is not supported in Gemini API.");return t}(m));let g=eb(e,["inputAudioTranscription"]);void 0!==t&&null!=g&&e_(t,["setup","inputAudioTranscription"],g);let y=eb(e,["outputAudioTranscription"]);void 0!==t&&null!=y&&e_(t,["setup","outputAudioTranscription"],y);let v=eb(e,["realtimeInputConfig"]);void 0!==t&&null!=v&&e_(t,["setup","realtimeInputConfig"],v);let _=eb(e,["contextWindowCompression"]);void 0!==t&&null!=_&&e_(t,["setup","contextWindowCompression"],_);let b=eb(e,["proactivity"]);return void 0!==t&&null!=b&&e_(t,["setup","proactivity"],b),{}}(i,n)),n}(this.apiClient,T),delete _.config,y.send(JSON.stringify(_)),new nt(y,this.apiClient)}isCallableTool(e){return"callTool"in e&&"function"==typeof e.callTool}}let ne={turnComplete:!0};class nt{constructor(e,t){this.conn=e,this.apiClient=t}tLiveClientContent(e,t){if(null!==t.turns&&void 0!==t.turns){let n=[];try{n=e7(t.turns),e.isVertexAI()||(n=n.map(e=>tD(e)))}catch(e){throw Error(`Failed to parse client content "turns", type: '${typeof t.turns}'`)}return{clientContent:{turns:n,turnComplete:t.turnComplete}}}return{clientContent:{turnComplete:t.turnComplete}}}tLiveClienttToolResponse(e,t){let n=[];if(null==t.functionResponses||0===(n=Array.isArray(t.functionResponses)?t.functionResponses:[t.functionResponses]).length)throw Error("functionResponses is required.");for(let t of n){if("object"!=typeof t||null===t||!("name"in t)||!("response"in t))throw Error(`Could not parse function response, type '${typeof t}'.`);if(!e.isVertexAI()&&!("id"in t))throw Error("FunctionResponse request must have an `id` field from the response of a ToolCall.FunctionalCalls in Google AI.")}return{toolResponse:{functionResponses:n}}}sendClientContent(e){e=Object.assign(Object.assign({},ne),e);let t=this.tLiveClientContent(this.apiClient,e);this.conn.send(JSON.stringify(t))}sendRealtimeInput(e){let t={};t=this.apiClient.isVertexAI()?{realtimeInput:function(e){let t={},n=eb(e,["media"]);if(null!=n){let e=eQ(n);Array.isArray(e)&&(e=e.map(e=>e)),e_(t,["mediaChunks"],e)}let r=eb(e,["audio"]);null!=r&&e_(t,["audio"],e1(r));let i=eb(e,["audioStreamEnd"]);null!=i&&e_(t,["audioStreamEnd"],i);let o=eb(e,["video"]);null!=o&&e_(t,["video"],e0(o));let s=eb(e,["text"]);null!=s&&e_(t,["text"],s);let a=eb(e,["activityStart"]);null!=a&&e_(t,["activityStart"],a);let l=eb(e,["activityEnd"]);return null!=l&&e_(t,["activityEnd"],l),t}(e)}:{realtimeInput:function(e){let t={},n=eb(e,["media"]);if(null!=n){let e=eQ(n);Array.isArray(e)&&(e=e.map(e=>tx(e))),e_(t,["mediaChunks"],e)}let r=eb(e,["audio"]);null!=r&&e_(t,["audio"],tx(e1(r)));let i=eb(e,["audioStreamEnd"]);null!=i&&e_(t,["audioStreamEnd"],i);let o=eb(e,["video"]);null!=o&&e_(t,["video"],tx(e0(o)));let s=eb(e,["text"]);null!=s&&e_(t,["text"],s);let a=eb(e,["activityStart"]);null!=a&&e_(t,["activityStart"],a);let l=eb(e,["activityEnd"]);return null!=l&&e_(t,["activityEnd"],l),t}(e)},this.conn.send(JSON.stringify(t))}sendToolResponse(e){if(null==e.functionResponses)throw Error("Tool response parameters are required.");let t=this.tLiveClienttToolResponse(this.apiClient,e);this.conn.send(JSON.stringify(t))}close(){this.conn.close()}}function nn(e){var t,n,r;if(null===(t=null==e?void 0:e.automaticFunctionCalling)||void 0===t?void 0:t.disable)return!0;let i=!1;for(let t of null!==(n=null==e?void 0:e.tools)&&void 0!==n?n:[])if(nr(t)){i=!0;break}if(!i)return!0;let o=null===(r=null==e?void 0:e.automaticFunctionCalling)||void 0===r?void 0:r.maximumRemoteCalls;return(!!o&&(o<0||!Number.isInteger(o))||0==o)&&(console.warn("Invalid maximumRemoteCalls value provided for automatic function calling. Disabled automatic function calling. Please provide a valid integer value greater than 0. maximumRemoteCalls provided:",o),!0)}function nr(e){return"callTool"in e&&"function"==typeof e.callTool}function ni(e){var t;let n=[];return(null===(t=null==e?void 0:e.config)||void 0===t?void 0:t.tools)&&e.config.tools.forEach((e,t)=>{!nr(e)&&e.functionDeclarations&&e.functionDeclarations.length>0&&n.push(t)}),n}function no(e){var t;return!(null===(t=null==e?void 0:e.automaticFunctionCalling)||void 0===t?void 0:t.ignoreCallHistory)}class ns extends ey{constructor(e){super(),this.apiClient=e,this.generateContent=async e=>{var t,n,r,i,o;let s,a;let l=await this.processParamsMaybeAddMcpUsage(e);if(this.maybeMoveToResponseJsonSchem(e),!function(e){var t,n,r;return null!==(r=null===(n=null===(t=e.config)||void 0===t?void 0:t.tools)||void 0===n?void 0:n.some(e=>nr(e)))&&void 0!==r&&r}(e)||nn(e.config))return await this.generateContentInternal(l);let u=ni(e);if(u.length>0){let e=u.map(e=>`tools[${e}]`).join(", ");throw Error(`Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations is not yet supported. Incompatible tools found at ${e}.`)}let c=e7(l.contents),d=null!==(r=null===(n=null===(t=l.config)||void 0===t?void 0:t.automaticFunctionCalling)||void 0===n?void 0:n.maximumRemoteCalls)&&void 0!==r?r:10,h=0;for(;h<d&&(s=await this.generateContentInternal(l)).functionCalls&&0!==s.functionCalls.length;){let t=s.candidates[0].content,n=[];for(let t of null!==(o=null===(i=e.config)||void 0===i?void 0:i.tools)&&void 0!==o?o:[])if(nr(t)){let e=await t.callTool(s.functionCalls);n.push(...e)}h++,a={role:"user",parts:n},l.contents=e7(l.contents),l.contents.push(t),l.contents.push(a),no(l.config)&&(c.push(t),c.push(a))}return no(l.config)&&(s.automaticFunctionCallingHistory=c),s},this.generateContentStream=async e=>{if(this.maybeMoveToResponseJsonSchem(e),nn(e.config)){let t=await this.processParamsMaybeAddMcpUsage(e);return await this.generateContentStreamInternal(t)}let t=ni(e);if(t.length>0){let e=t.map(e=>`tools[${e}]`).join(", ");throw Error(`Incompatible tools found at ${e}. Automatic function calling with CallableTools (or MCP objects) and basic FunctionDeclarations" is not yet supported.`)}return await this.processAfcStream(e)},this.generateImages=async e=>await this.generateImagesInternal(e).then(e=>{var t;let n;let r=[];if(null==e?void 0:e.generatedImages)for(let i of e.generatedImages)i&&(null==i?void 0:i.safetyAttributes)&&(null===(t=null==i?void 0:i.safetyAttributes)||void 0===t?void 0:t.contentType)==="Positive Prompt"?n=null==i?void 0:i.safetyAttributes:r.push(i);return n?{generatedImages:r,positivePromptSafetyAttributes:n,sdkHttpResponse:e.sdkHttpResponse}:{generatedImages:r,sdkHttpResponse:e.sdkHttpResponse}}),this.list=async e=>{var t;let n={config:Object.assign(Object.assign({},{queryBase:!0}),null==e?void 0:e.config)};if(this.apiClient.isVertexAI()&&!n.config.queryBase){if(null===(t=n.config)||void 0===t?void 0:t.filter)throw Error("Filtering tuned models list for Vertex AI is not currently supported");n.config.filter="labels.tune-type:*"}return new tb(ei.PAGED_ITEM_MODELS,e=>this.listInternal(e),await this.listInternal(n),n)},this.editImage=async e=>{let t={model:e.model,prompt:e.prompt,referenceImages:[],config:e.config};return e.referenceImages&&e.referenceImages&&(t.referenceImages=e.referenceImages.map(e=>e.toReferenceImageAPI())),await this.editImageInternal(t)},this.upscaleImage=async e=>{let t={numberOfImages:1,mode:"upscale"};e.config&&(t=Object.assign(Object.assign({},t),e.config));let n={model:e.model,image:e.image,upscaleFactor:e.upscaleFactor,config:t};return await this.upscaleImageInternal(n)},this.generateVideos=async e=>{var t,n,r,i,o,s;if((e.prompt||e.image||e.video)&&e.source)throw Error("Source and prompt/image/video are mutually exclusive. Please only use source.");return!this.apiClient.isVertexAI()&&((null===(t=e.video)||void 0===t?void 0:t.uri)&&(null===(n=e.video)||void 0===n?void 0:n.videoBytes)?e.video={uri:e.video.uri,mimeType:e.video.mimeType}:(null===(i=null===(r=e.source)||void 0===r?void 0:r.video)||void 0===i?void 0:i.uri)&&(null===(s=null===(o=e.source)||void 0===o?void 0:o.video)||void 0===s?void 0:s.videoBytes)&&(e.source.video={uri:e.source.video.uri,mimeType:e.source.video.mimeType})),await this.generateVideosInternal(e)}}maybeMoveToResponseJsonSchem(e){e.config&&e.config.responseSchema&&!e.config.responseJsonSchema&&Object.keys(e.config.responseSchema).includes("$schema")&&(e.config.responseJsonSchema=e.config.responseSchema,delete e.config.responseSchema)}async processParamsMaybeAddMcpUsage(e){var t,n,r;let i=null===(t=e.config)||void 0===t?void 0:t.tools;if(!i)return e;let o=await Promise.all(i.map(async e=>nr(e)?await e.tool():e)),s={model:e.model,contents:e.contents,config:Object.assign(Object.assign({},e.config),{tools:o})};if(s.config.tools=o,e.config&&e.config.tools&&t2(e.config.tools)){let t=Object.assign({},null!==(r=null===(n=e.config.httpOptions)||void 0===n?void 0:n.headers)&&void 0!==r?r:{});0===Object.keys(t).length&&(t=this.apiClient.getDefaultHeaders()),t4(t),s.config.httpOptions=Object.assign(Object.assign({},e.config.httpOptions),{headers:t})}return s}async initAfcToolsMap(e){var t,n,r;let i=new Map;for(let o of null!==(n=null===(t=e.config)||void 0===t?void 0:t.tools)&&void 0!==n?n:[])if(nr(o))for(let e of null!==(r=(await o.tool()).functionDeclarations)&&void 0!==r?r:[]){if(!e.name)throw Error("Function declaration name is required.");if(i.has(e.name))throw Error(`Duplicate tool declaration name: ${e.name}`);i.set(e.name,o)}return i}async processAfcStream(e){var t,n,r;let i=null!==(r=null===(n=null===(t=e.config)||void 0===t?void 0:t.automaticFunctionCalling)||void 0===n?void 0:n.maximumRemoteCalls)&&void 0!==r?r:10,o=!1,s=0;return function(e,t,n){var r,a;return tA(this,arguments,function*(){for(var l,u,c,d;s<i;){o&&(s++,o=!1);let m=yield tS(e.processParamsMaybeAddMcpUsage(n)),g=yield tS(e.generateContentStreamInternal(m)),y=[],v=[];try{for(var h,p=!0,f=(u=void 0,tC(g));!(l=(h=yield tS(f.next())).done);p=!0)if(d=h.value,p=!1,yield yield tS(d),d.candidates&&(null===(r=d.candidates[0])||void 0===r?void 0:r.content)){for(let e of(v.push(d.candidates[0].content),null!==(a=d.candidates[0].content.parts)&&void 0!==a?a:[]))if(s<i&&e.functionCall){if(!e.functionCall.name)throw Error("Function call name was not returned by the model.");if(t.has(e.functionCall.name)){let n=yield tS(t.get(e.functionCall.name).callTool([e.functionCall]));y.push(...n)}else throw Error(`Automatic function calling was requested, but not all the tools the model used implement the CallableTool interface. Available tools: ${t.keys()}, mising tool: ${e.functionCall.name}`)}}}catch(e){u={error:e}}finally{try{!p&&!l&&(c=f.return)&&(yield tS(c.call(f)))}finally{if(u)throw u.error}}if(y.length>0){o=!0;let e=new eS;e.candidates=[{content:{role:"user",parts:y}}],yield yield tS(e);let t=[];t.push(...v),t.push({role:"user",parts:y});let r=e7(n.contents).concat(t);n.contents=r}else break}})}(this,await this.initAfcToolsMap(e),e)}async generateContentInternal(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=tj(this.apiClient,e);return o=ev("{model}:generateContent",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=tG(e),n=new eS;return Object.assign(n,t),n})}{let t=tM(this.apiClient,e);return o=ev("{model}:generateContent",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=tL(e),n=new eS;return Object.assign(n,t),n})}}async generateContentStreamInternal(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=tj(this.apiClient,e);return o=ev("{model}:streamGenerateContent?alt=sse",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.requestStream({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(function(e){return tA(this,arguments,function*(){var t,n,r,i;try{for(var o,s=!0,a=tC(e);!(t=(o=yield tS(a.next())).done);s=!0){i=o.value,s=!1;let e=tG((yield tS(i.json())));e.sdkHttpResponse={headers:i.headers};let t=new eS;Object.assign(t,e),yield yield tS(t)}}catch(e){n={error:e}}finally{try{!s&&!t&&(r=a.return)&&(yield tS(r.call(a)))}finally{if(n)throw n.error}}})})}{let t=tM(this.apiClient,e);return o=ev("{model}:streamGenerateContent?alt=sse",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.requestStream({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(function(e){return tA(this,arguments,function*(){var t,n,r,i;try{for(var o,s=!0,a=tC(e);!(t=(o=yield tS(a.next())).done);s=!0){i=o.value,s=!1;let e=tL((yield tS(i.json())));e.sdkHttpResponse={headers:i.headers};let t=new eS;Object.assign(t,e),yield yield tS(t)}}catch(e){n={error:e}}finally{try{!s&&!t&&(r=a.return)&&(yield tS(r.call(a)))}finally{if(n)throw n.error}}})})}}async embedContent(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eb(t,["model"]);null!=r&&e_(n,["_url","model"],ez(e,r));let i=eb(t,["contents"]);if(null!=i){let t=e9(e,i);Array.isArray(t)&&(t=t.map(e=>e)),e_(n,["instances[]","content"],t)}let o=eb(t,["config"]);return null!=o&&function(e,t){let n=eb(e,["taskType"]);void 0!==t&&null!=n&&e_(t,["instances[]","task_type"],n);let r=eb(e,["title"]);void 0!==t&&null!=r&&e_(t,["instances[]","title"],r);let i=eb(e,["outputDimensionality"]);void 0!==t&&null!=i&&e_(t,["parameters","outputDimensionality"],i);let o=eb(e,["mimeType"]);void 0!==t&&null!=o&&e_(t,["instances[]","mimeType"],o);let s=eb(e,["autoTruncate"]);void 0!==t&&null!=s&&e_(t,["parameters","autoTruncate"],s)}(o,n),n}(this.apiClient,e);return o=ev("{model}:predict",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=eb(e,["sdkHttpResponse"]);null!=n&&e_(t,["sdkHttpResponse"],n);let r=eb(e,["predictions[]","embeddings"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eb(e,["values"]);null!=n&&e_(t,["values"],n);let r=eb(e,["statistics"]);return null!=r&&e_(t,["statistics"],function(e){let t={},n=eb(e,["truncated"]);null!=n&&e_(t,["truncated"],n);let r=eb(e,["token_count"]);return null!=r&&e_(t,["tokenCount"],r),t}(r)),t})(e))),e_(t,["embeddings"],e)}let i=eb(e,["metadata"]);return null!=i&&e_(t,["metadata"],i),t}(e),n=new eA;return Object.assign(n,t),n})}{let t=function(e,t){let n={},r=eb(t,["model"]);null!=r&&e_(n,["_url","model"],ez(e,r));let i=eb(t,["contents"]);if(null!=i){let t=e9(e,i);Array.isArray(t)&&(t=t.map(e=>e)),e_(n,["requests[]","content"],t)}let o=eb(t,["config"]);null!=o&&function(e,t){let n=eb(e,["taskType"]);void 0!==t&&null!=n&&e_(t,["requests[]","taskType"],n);let r=eb(e,["title"]);void 0!==t&&null!=r&&e_(t,["requests[]","title"],r);let i=eb(e,["outputDimensionality"]);if(void 0!==t&&null!=i&&e_(t,["requests[]","outputDimensionality"],i),void 0!==eb(e,["mimeType"]))throw Error("mimeType parameter is not supported in Gemini API.");if(void 0!==eb(e,["autoTruncate"]))throw Error("autoTruncate parameter is not supported in Gemini API.")}(o,n);let s=eb(t,["model"]);return void 0!==s&&e_(n,["requests[]","model"],ez(e,s)),n}(this.apiClient,e);return o=ev("{model}:batchEmbedContents",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=eb(e,["sdkHttpResponse"]);null!=n&&e_(t,["sdkHttpResponse"],n);let r=eb(e,["embeddings"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),e_(t,["embeddings"],e)}let i=eb(e,["metadata"]);return null!=i&&e_(t,["metadata"],i),t}(e),n=new eA;return Object.assign(n,t),n})}}async generateImagesInternal(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eb(t,["model"]);null!=r&&e_(n,["_url","model"],ez(e,r));let i=eb(t,["prompt"]);null!=i&&e_(n,["instances[0]","prompt"],i);let o=eb(t,["config"]);return null!=o&&function(e,t){let n=eb(e,["outputGcsUri"]);void 0!==t&&null!=n&&e_(t,["parameters","storageUri"],n);let r=eb(e,["negativePrompt"]);void 0!==t&&null!=r&&e_(t,["parameters","negativePrompt"],r);let i=eb(e,["numberOfImages"]);void 0!==t&&null!=i&&e_(t,["parameters","sampleCount"],i);let o=eb(e,["aspectRatio"]);void 0!==t&&null!=o&&e_(t,["parameters","aspectRatio"],o);let s=eb(e,["guidanceScale"]);void 0!==t&&null!=s&&e_(t,["parameters","guidanceScale"],s);let a=eb(e,["seed"]);void 0!==t&&null!=a&&e_(t,["parameters","seed"],a);let l=eb(e,["safetyFilterLevel"]);void 0!==t&&null!=l&&e_(t,["parameters","safetySetting"],l);let u=eb(e,["personGeneration"]);void 0!==t&&null!=u&&e_(t,["parameters","personGeneration"],u);let c=eb(e,["includeSafetyAttributes"]);void 0!==t&&null!=c&&e_(t,["parameters","includeSafetyAttributes"],c);let d=eb(e,["includeRaiReason"]);void 0!==t&&null!=d&&e_(t,["parameters","includeRaiReason"],d);let h=eb(e,["language"]);void 0!==t&&null!=h&&e_(t,["parameters","language"],h);let p=eb(e,["outputMimeType"]);void 0!==t&&null!=p&&e_(t,["parameters","outputOptions","mimeType"],p);let f=eb(e,["outputCompressionQuality"]);void 0!==t&&null!=f&&e_(t,["parameters","outputOptions","compressionQuality"],f);let m=eb(e,["addWatermark"]);void 0!==t&&null!=m&&e_(t,["parameters","addWatermark"],m);let g=eb(e,["labels"]);void 0!==t&&null!=g&&e_(t,["labels"],g);let y=eb(e,["imageSize"]);void 0!==t&&null!=y&&e_(t,["parameters","sampleImageSize"],y);let v=eb(e,["enhancePrompt"]);void 0!==t&&null!=v&&e_(t,["parameters","enhancePrompt"],v)}(o,n),n}(this.apiClient,e);return o=ev("{model}:predict",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=eb(e,["sdkHttpResponse"]);null!=n&&e_(t,["sdkHttpResponse"],n);let r=eb(e,["predictions"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>tq(e))),e_(t,["generatedImages"],e)}let i=eb(e,["positivePromptSafetyAttributes"]);return null!=i&&e_(t,["positivePromptSafetyAttributes"],tJ(i)),t}(e),n=new eC;return Object.assign(n,t),n})}{let t=function(e,t){let n={},r=eb(t,["model"]);null!=r&&e_(n,["_url","model"],ez(e,r));let i=eb(t,["prompt"]);null!=i&&e_(n,["instances[0]","prompt"],i);let o=eb(t,["config"]);return null!=o&&function(e,t){if(void 0!==eb(e,["outputGcsUri"]))throw Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==eb(e,["negativePrompt"]))throw Error("negativePrompt parameter is not supported in Gemini API.");let n=eb(e,["numberOfImages"]);void 0!==t&&null!=n&&e_(t,["parameters","sampleCount"],n);let r=eb(e,["aspectRatio"]);void 0!==t&&null!=r&&e_(t,["parameters","aspectRatio"],r);let i=eb(e,["guidanceScale"]);if(void 0!==t&&null!=i&&e_(t,["parameters","guidanceScale"],i),void 0!==eb(e,["seed"]))throw Error("seed parameter is not supported in Gemini API.");let o=eb(e,["safetyFilterLevel"]);void 0!==t&&null!=o&&e_(t,["parameters","safetySetting"],o);let s=eb(e,["personGeneration"]);void 0!==t&&null!=s&&e_(t,["parameters","personGeneration"],s);let a=eb(e,["includeSafetyAttributes"]);void 0!==t&&null!=a&&e_(t,["parameters","includeSafetyAttributes"],a);let l=eb(e,["includeRaiReason"]);void 0!==t&&null!=l&&e_(t,["parameters","includeRaiReason"],l);let u=eb(e,["language"]);void 0!==t&&null!=u&&e_(t,["parameters","language"],u);let c=eb(e,["outputMimeType"]);void 0!==t&&null!=c&&e_(t,["parameters","outputOptions","mimeType"],c);let d=eb(e,["outputCompressionQuality"]);if(void 0!==t&&null!=d&&e_(t,["parameters","outputOptions","compressionQuality"],d),void 0!==eb(e,["addWatermark"]))throw Error("addWatermark parameter is not supported in Gemini API.");if(void 0!==eb(e,["labels"]))throw Error("labels parameter is not supported in Gemini API.");let h=eb(e,["imageSize"]);if(void 0!==t&&null!=h&&e_(t,["parameters","sampleImageSize"],h),void 0!==eb(e,["enhancePrompt"]))throw Error("enhancePrompt parameter is not supported in Gemini API.")}(o,n),n}(this.apiClient,e);return o=ev("{model}:predict",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=eb(e,["sdkHttpResponse"]);null!=n&&e_(t,["sdkHttpResponse"],n);let r=eb(e,["predictions"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eb(e,["_self"]);null!=n&&e_(t,["image"],function(e){let t={},n=eb(e,["bytesBase64Encoded"]);null!=n&&e_(t,["imageBytes"],eE(n));let r=eb(e,["mimeType"]);return null!=r&&e_(t,["mimeType"],r),t}(n));let r=eb(e,["raiFilteredReason"]);null!=r&&e_(t,["raiFilteredReason"],r);let i=eb(e,["_self"]);return null!=i&&e_(t,["safetyAttributes"],tW(i)),t})(e))),e_(t,["generatedImages"],e)}let i=eb(e,["positivePromptSafetyAttributes"]);return null!=i&&e_(t,["positivePromptSafetyAttributes"],tW(i)),t}(e),n=new eC;return Object.assign(n,t),n})}}async editImageInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI()){let o=function(e,t){let n={},r=eb(t,["model"]);null!=r&&e_(n,["_url","model"],ez(e,r));let i=eb(t,["prompt"]);null!=i&&e_(n,["instances[0]","prompt"],i);let o=eb(t,["referenceImages"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eb(e,["referenceImage"]);null!=n&&e_(t,["referenceImage"],tB(n));let r=eb(e,["referenceId"]);null!=r&&e_(t,["referenceId"],r);let i=eb(e,["referenceType"]);null!=i&&e_(t,["referenceType"],i);let o=eb(e,["maskImageConfig"]);null!=o&&e_(t,["maskImageConfig"],function(e){let t={},n=eb(e,["maskMode"]);null!=n&&e_(t,["maskMode"],n);let r=eb(e,["segmentationClasses"]);null!=r&&e_(t,["maskClasses"],r);let i=eb(e,["maskDilation"]);return null!=i&&e_(t,["dilation"],i),t}(o));let s=eb(e,["controlImageConfig"]);null!=s&&e_(t,["controlImageConfig"],function(e){let t={},n=eb(e,["controlType"]);null!=n&&e_(t,["controlType"],n);let r=eb(e,["enableControlImageComputation"]);return null!=r&&e_(t,["computeControl"],r),t}(s));let a=eb(e,["styleImageConfig"]);null!=a&&e_(t,["styleImageConfig"],a);let l=eb(e,["subjectImageConfig"]);return null!=l&&e_(t,["subjectImageConfig"],l),t})(e))),e_(n,["instances[0]","referenceImages"],e)}let s=eb(t,["config"]);return null!=s&&function(e,t){let n=eb(e,["outputGcsUri"]);void 0!==t&&null!=n&&e_(t,["parameters","storageUri"],n);let r=eb(e,["negativePrompt"]);void 0!==t&&null!=r&&e_(t,["parameters","negativePrompt"],r);let i=eb(e,["numberOfImages"]);void 0!==t&&null!=i&&e_(t,["parameters","sampleCount"],i);let o=eb(e,["aspectRatio"]);void 0!==t&&null!=o&&e_(t,["parameters","aspectRatio"],o);let s=eb(e,["guidanceScale"]);void 0!==t&&null!=s&&e_(t,["parameters","guidanceScale"],s);let a=eb(e,["seed"]);void 0!==t&&null!=a&&e_(t,["parameters","seed"],a);let l=eb(e,["safetyFilterLevel"]);void 0!==t&&null!=l&&e_(t,["parameters","safetySetting"],l);let u=eb(e,["personGeneration"]);void 0!==t&&null!=u&&e_(t,["parameters","personGeneration"],u);let c=eb(e,["includeSafetyAttributes"]);void 0!==t&&null!=c&&e_(t,["parameters","includeSafetyAttributes"],c);let d=eb(e,["includeRaiReason"]);void 0!==t&&null!=d&&e_(t,["parameters","includeRaiReason"],d);let h=eb(e,["language"]);void 0!==t&&null!=h&&e_(t,["parameters","language"],h);let p=eb(e,["outputMimeType"]);void 0!==t&&null!=p&&e_(t,["parameters","outputOptions","mimeType"],p);let f=eb(e,["outputCompressionQuality"]);void 0!==t&&null!=f&&e_(t,["parameters","outputOptions","compressionQuality"],f);let m=eb(e,["addWatermark"]);void 0!==t&&null!=m&&e_(t,["parameters","addWatermark"],m);let g=eb(e,["labels"]);void 0!==t&&null!=g&&e_(t,["labels"],g);let y=eb(e,["editMode"]);void 0!==t&&null!=y&&e_(t,["parameters","editMode"],y);let v=eb(e,["baseSteps"]);void 0!==t&&null!=v&&e_(t,["parameters","editConfig","baseSteps"],v)}(s,n),n}(this.apiClient,e);return r=ev("{model}:predict",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=eb(e,["sdkHttpResponse"]);null!=n&&e_(t,["sdkHttpResponse"],n);let r=eb(e,["predictions"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>tq(e))),e_(t,["generatedImages"],e)}return t}(e),n=new eO;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async upscaleImageInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI()){let o=function(e,t){let n={},r=eb(t,["model"]);null!=r&&e_(n,["_url","model"],ez(e,r));let i=eb(t,["image"]);null!=i&&e_(n,["instances[0]","image"],tB(i));let o=eb(t,["upscaleFactor"]);null!=o&&e_(n,["parameters","upscaleConfig","upscaleFactor"],o);let s=eb(t,["config"]);return null!=s&&function(e,t){let n=eb(e,["outputGcsUri"]);void 0!==t&&null!=n&&e_(t,["parameters","storageUri"],n);let r=eb(e,["safetyFilterLevel"]);void 0!==t&&null!=r&&e_(t,["parameters","safetySetting"],r);let i=eb(e,["personGeneration"]);void 0!==t&&null!=i&&e_(t,["parameters","personGeneration"],i);let o=eb(e,["includeRaiReason"]);void 0!==t&&null!=o&&e_(t,["parameters","includeRaiReason"],o);let s=eb(e,["outputMimeType"]);void 0!==t&&null!=s&&e_(t,["parameters","outputOptions","mimeType"],s);let a=eb(e,["outputCompressionQuality"]);void 0!==t&&null!=a&&e_(t,["parameters","outputOptions","compressionQuality"],a);let l=eb(e,["enhanceInputImage"]);void 0!==t&&null!=l&&e_(t,["parameters","upscaleConfig","enhanceInputImage"],l);let u=eb(e,["imagePreservationFactor"]);void 0!==t&&null!=u&&e_(t,["parameters","upscaleConfig","imagePreservationFactor"],u);let c=eb(e,["labels"]);void 0!==t&&null!=c&&e_(t,["labels"],c);let d=eb(e,["numberOfImages"]);void 0!==t&&null!=d&&e_(t,["parameters","sampleCount"],d);let h=eb(e,["mode"]);void 0!==t&&null!=h&&e_(t,["parameters","mode"],h)}(s,n),n}(this.apiClient,e);return r=ev("{model}:predict",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=eb(e,["sdkHttpResponse"]);null!=n&&e_(t,["sdkHttpResponse"],n);let r=eb(e,["predictions"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>tq(e))),e_(t,["generatedImages"],e)}return t}(e),n=new eI;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async recontextImage(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI()){let o=function(e,t){let n={},r=eb(t,["model"]);null!=r&&e_(n,["_url","model"],ez(e,r));let i=eb(t,["source"]);null!=i&&function(e,t){let n=eb(e,["prompt"]);void 0!==t&&null!=n&&e_(t,["instances[0]","prompt"],n);let r=eb(e,["personImage"]);void 0!==t&&null!=r&&e_(t,["instances[0]","personImage","image"],tB(r));let i=eb(e,["productImages"]);if(void 0!==t&&null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eb(e,["productImage"]);return null!=n&&e_(t,["image"],tB(n)),t})(e))),e_(t,["instances[0]","productImages"],e)}}(i,n);let o=eb(t,["config"]);return null!=o&&function(e,t){let n=eb(e,["numberOfImages"]);void 0!==t&&null!=n&&e_(t,["parameters","sampleCount"],n);let r=eb(e,["baseSteps"]);void 0!==t&&null!=r&&e_(t,["parameters","baseSteps"],r);let i=eb(e,["outputGcsUri"]);void 0!==t&&null!=i&&e_(t,["parameters","storageUri"],i);let o=eb(e,["seed"]);void 0!==t&&null!=o&&e_(t,["parameters","seed"],o);let s=eb(e,["safetyFilterLevel"]);void 0!==t&&null!=s&&e_(t,["parameters","safetySetting"],s);let a=eb(e,["personGeneration"]);void 0!==t&&null!=a&&e_(t,["parameters","personGeneration"],a);let l=eb(e,["addWatermark"]);void 0!==t&&null!=l&&e_(t,["parameters","addWatermark"],l);let u=eb(e,["outputMimeType"]);void 0!==t&&null!=u&&e_(t,["parameters","outputOptions","mimeType"],u);let c=eb(e,["outputCompressionQuality"]);void 0!==t&&null!=c&&e_(t,["parameters","outputOptions","compressionQuality"],c);let d=eb(e,["enhancePrompt"]);void 0!==t&&null!=d&&e_(t,["parameters","enhancePrompt"],d);let h=eb(e,["labels"]);void 0!==t&&null!=h&&e_(t,["labels"],h)}(o,n),n}(this.apiClient,e);return r=ev("{model}:predict",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=eb(e,["predictions"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>tq(e))),e_(t,["generatedImages"],e)}return t}(e),n=new ek;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async segmentImage(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI()){let o=function(e,t){let n={},r=eb(t,["model"]);null!=r&&e_(n,["_url","model"],ez(e,r));let i=eb(t,["source"]);null!=i&&function(e,t){let n=eb(e,["prompt"]);void 0!==t&&null!=n&&e_(t,["instances[0]","prompt"],n);let r=eb(e,["image"]);void 0!==t&&null!=r&&e_(t,["instances[0]","image"],tB(r));let i=eb(e,["scribbleImage"]);void 0!==t&&null!=i&&e_(t,["instances[0]","scribble"],function(e){let t={},n=eb(e,["image"]);return null!=n&&e_(t,["image"],tB(n)),t}(i))}(i,n);let o=eb(t,["config"]);return null!=o&&function(e,t){let n=eb(e,["mode"]);void 0!==t&&null!=n&&e_(t,["parameters","mode"],n);let r=eb(e,["maxPredictions"]);void 0!==t&&null!=r&&e_(t,["parameters","maxPredictions"],r);let i=eb(e,["confidenceThreshold"]);void 0!==t&&null!=i&&e_(t,["parameters","confidenceThreshold"],i);let o=eb(e,["maskDilation"]);void 0!==t&&null!=o&&e_(t,["parameters","maskDilation"],o);let s=eb(e,["binaryColorThreshold"]);void 0!==t&&null!=s&&e_(t,["parameters","binaryColorThreshold"],s);let a=eb(e,["labels"]);void 0!==t&&null!=a&&e_(t,["labels"],a)}(o,n),n}(this.apiClient,e);return r=ev("{model}:predict",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=eb(e,["predictions"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eb(e,["_self"]);null!=n&&e_(t,["mask"],tF(n));let r=eb(e,["labels"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),e_(t,["labels"],e)}return t})(e))),e_(t,["generatedMasks"],e)}return t}(e),n=new eR;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async get(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eb(t,["model"]);return null!=r&&e_(n,["_url","name"],ez(e,r)),n}(this.apiClient,e);return o=ev("{name}",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>t$(e))}{let t=function(e,t){let n={},r=eb(t,["model"]);return null!=r&&e_(n,["_url","name"],ez(e,r)),n}(this.apiClient,e);return o=ev("{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>tV(e))}}async listInternal(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eb(t,["config"]);return null!=r&&function(e,t,n){let r=eb(t,["pageSize"]);void 0!==n&&null!=r&&e_(n,["_query","pageSize"],r);let i=eb(t,["pageToken"]);void 0!==n&&null!=i&&e_(n,["_query","pageToken"],i);let o=eb(t,["filter"]);void 0!==n&&null!=o&&e_(n,["_query","filter"],o);let s=eb(t,["queryBase"]);void 0!==n&&null!=s&&e_(n,["_url","models_url"],tc(e,s))}(e,r,n),n}(this.apiClient,e);return o=ev("{models_url}",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=eb(e,["sdkHttpResponse"]);null!=n&&e_(t,["sdkHttpResponse"],n);let r=eb(e,["nextPageToken"]);null!=r&&e_(t,["nextPageToken"],r);let i=eb(e,["_self"]);if(null!=i){let e=td(i);Array.isArray(e)&&(e=e.map(e=>t$(e))),e_(t,["models"],e)}return t}(e),n=new eN;return Object.assign(n,t),n})}{let t=function(e,t){let n={},r=eb(t,["config"]);return null!=r&&function(e,t,n){let r=eb(t,["pageSize"]);void 0!==n&&null!=r&&e_(n,["_query","pageSize"],r);let i=eb(t,["pageToken"]);void 0!==n&&null!=i&&e_(n,["_query","pageToken"],i);let o=eb(t,["filter"]);void 0!==n&&null!=o&&e_(n,["_query","filter"],o);let s=eb(t,["queryBase"]);void 0!==n&&null!=s&&e_(n,["_url","models_url"],tc(e,s))}(e,r,n),n}(this.apiClient,e);return o=ev("{models_url}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=eb(e,["sdkHttpResponse"]);null!=n&&e_(t,["sdkHttpResponse"],n);let r=eb(e,["nextPageToken"]);null!=r&&e_(t,["nextPageToken"],r);let i=eb(e,["_self"]);if(null!=i){let e=td(i);Array.isArray(e)&&(e=e.map(e=>tV(e))),e_(t,["models"],e)}return t}(e),n=new eN;return Object.assign(n,t),n})}}async update(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eb(t,["model"]);null!=r&&e_(n,["_url","model"],ez(e,r));let i=eb(t,["config"]);return null!=i&&function(e,t){let n=eb(e,["displayName"]);void 0!==t&&null!=n&&e_(t,["displayName"],n);let r=eb(e,["description"]);void 0!==t&&null!=r&&e_(t,["description"],r);let i=eb(e,["defaultCheckpointId"]);void 0!==t&&null!=i&&e_(t,["defaultCheckpointId"],i)}(i,n),n}(this.apiClient,e);return o=ev("{model}",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"PATCH",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>t$(e))}{let t=function(e,t){let n={},r=eb(t,["model"]);null!=r&&e_(n,["_url","name"],ez(e,r));let i=eb(t,["config"]);return null!=i&&function(e,t){let n=eb(e,["displayName"]);void 0!==t&&null!=n&&e_(t,["displayName"],n);let r=eb(e,["description"]);void 0!==t&&null!=r&&e_(t,["description"],r);let i=eb(e,["defaultCheckpointId"]);void 0!==t&&null!=i&&e_(t,["defaultCheckpointId"],i)}(i,n),n}(this.apiClient,e);return o=ev("{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"PATCH",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>tV(e))}}async delete(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eb(t,["model"]);return null!=r&&e_(n,["_url","name"],ez(e,r)),n}(this.apiClient,e);return o=ev("{name}",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=eb(e,["sdkHttpResponse"]);return null!=n&&e_(t,["sdkHttpResponse"],n),t}(e),n=new eP;return Object.assign(n,t),n})}{let t=function(e,t){let n={},r=eb(t,["model"]);return null!=r&&e_(n,["_url","name"],ez(e,r)),n}(this.apiClient,e);return o=ev("{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"DELETE",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=eb(e,["sdkHttpResponse"]);return null!=n&&e_(t,["sdkHttpResponse"],n),t}(e),n=new eP;return Object.assign(n,t),n})}}async countTokens(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eb(t,["model"]);null!=r&&e_(n,["_url","model"],ez(e,r));let i=eb(t,["contents"]);if(null!=i){let e=e7(i);Array.isArray(e)&&(e=e.map(e=>e)),e_(n,["contents"],e)}let o=eb(t,["config"]);return null!=o&&function(e,t){let n=eb(e,["systemInstruction"]);void 0!==t&&null!=n&&e_(t,["systemInstruction"],e5(n));let r=eb(e,["tools"]);if(void 0!==t&&null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>tY(e))),e_(t,["tools"],e)}let i=eb(e,["generationConfig"]);void 0!==t&&null!=i&&e_(t,["generationConfig"],function(e){let t={},n=eb(e,["modelSelectionConfig"]);null!=n&&e_(t,["modelConfig"],n);let r=eb(e,["responseJsonSchema"]);null!=r&&e_(t,["responseJsonSchema"],r);let i=eb(e,["audioTimestamp"]);null!=i&&e_(t,["audioTimestamp"],i);let o=eb(e,["candidateCount"]);null!=o&&e_(t,["candidateCount"],o);let s=eb(e,["enableAffectiveDialog"]);null!=s&&e_(t,["enableAffectiveDialog"],s);let a=eb(e,["frequencyPenalty"]);null!=a&&e_(t,["frequencyPenalty"],a);let l=eb(e,["logprobs"]);null!=l&&e_(t,["logprobs"],l);let u=eb(e,["maxOutputTokens"]);null!=u&&e_(t,["maxOutputTokens"],u);let c=eb(e,["mediaResolution"]);null!=c&&e_(t,["mediaResolution"],c);let d=eb(e,["presencePenalty"]);null!=d&&e_(t,["presencePenalty"],d);let h=eb(e,["responseLogprobs"]);null!=h&&e_(t,["responseLogprobs"],h);let p=eb(e,["responseMimeType"]);null!=p&&e_(t,["responseMimeType"],p);let f=eb(e,["responseModalities"]);null!=f&&e_(t,["responseModalities"],f);let m=eb(e,["responseSchema"]);null!=m&&e_(t,["responseSchema"],m);let g=eb(e,["routingConfig"]);null!=g&&e_(t,["routingConfig"],g);let y=eb(e,["seed"]);null!=y&&e_(t,["seed"],y);let v=eb(e,["speechConfig"]);null!=v&&e_(t,["speechConfig"],tK(v));let _=eb(e,["stopSequences"]);null!=_&&e_(t,["stopSequences"],_);let b=eb(e,["temperature"]);null!=b&&e_(t,["temperature"],b);let E=eb(e,["thinkingConfig"]);null!=E&&e_(t,["thinkingConfig"],E);let T=eb(e,["topK"]);null!=T&&e_(t,["topK"],T);let w=eb(e,["topP"]);if(null!=w&&e_(t,["topP"],w),void 0!==eb(e,["enableEnhancedCivicAnswers"]))throw Error("enableEnhancedCivicAnswers parameter is not supported in Vertex AI.");return t}(i))}(o,n),n}(this.apiClient,e);return o=ev("{model}:countTokens",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=eb(e,["sdkHttpResponse"]);null!=n&&e_(t,["sdkHttpResponse"],n);let r=eb(e,["totalTokens"]);return null!=r&&e_(t,["totalTokens"],r),t}(e),n=new ex;return Object.assign(n,t),n})}{let t=function(e,t){let n={},r=eb(t,["model"]);null!=r&&e_(n,["_url","model"],ez(e,r));let i=eb(t,["contents"]);if(null!=i){let e=e7(i);Array.isArray(e)&&(e=e.map(e=>tD(e))),e_(n,["contents"],e)}let o=eb(t,["config"]);return null!=o&&function(e){if(void 0!==eb(e,["systemInstruction"]))throw Error("systemInstruction parameter is not supported in Gemini API.");if(void 0!==eb(e,["tools"]))throw Error("tools parameter is not supported in Gemini API.");if(void 0!==eb(e,["generationConfig"]))throw Error("generationConfig parameter is not supported in Gemini API.")}(o),n}(this.apiClient,e);return o=ev("{model}:countTokens",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=eb(e,["sdkHttpResponse"]);null!=n&&e_(t,["sdkHttpResponse"],n);let r=eb(e,["totalTokens"]);null!=r&&e_(t,["totalTokens"],r);let i=eb(e,["cachedContentTokenCount"]);return null!=i&&e_(t,["cachedContentTokenCount"],i),t}(e),n=new ex;return Object.assign(n,t),n})}}async computeTokens(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI()){let o=function(e,t){let n={},r=eb(t,["model"]);null!=r&&e_(n,["_url","model"],ez(e,r));let i=eb(t,["contents"]);if(null!=i){let e=e7(i);Array.isArray(e)&&(e=e.map(e=>e)),e_(n,["contents"],e)}return n}(this.apiClient,e);return r=ev("{model}:computeTokens",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e){let t={},n=eb(e,["sdkHttpResponse"]);null!=n&&e_(t,["sdkHttpResponse"],n);let r=eb(e,["tokensInfo"]);if(null!=r){let e=r;Array.isArray(e)&&(e=e.map(e=>e)),e_(t,["tokensInfo"],e)}return t}(e),n=new eU;return Object.assign(n,t),n})}throw Error("This method is only supported by the Vertex AI.")}async generateVideosInternal(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eb(t,["model"]);null!=r&&e_(n,["_url","model"],ez(e,r));let i=eb(t,["prompt"]);null!=i&&e_(n,["instances[0]","prompt"],i);let o=eb(t,["image"]);null!=o&&e_(n,["instances[0]","image"],tB(o));let s=eb(t,["video"]);null!=s&&e_(n,["instances[0]","video"],tX(s));let a=eb(t,["source"]);null!=a&&function(e,t){let n=eb(e,["prompt"]);void 0!==t&&null!=n&&e_(t,["instances[0]","prompt"],n);let r=eb(e,["image"]);void 0!==t&&null!=r&&e_(t,["instances[0]","image"],tB(r));let i=eb(e,["video"]);void 0!==t&&null!=i&&e_(t,["instances[0]","video"],tX(i))}(a,n);let l=eb(t,["config"]);return null!=l&&function(e,t){let n=eb(e,["numberOfVideos"]);void 0!==t&&null!=n&&e_(t,["parameters","sampleCount"],n);let r=eb(e,["outputGcsUri"]);void 0!==t&&null!=r&&e_(t,["parameters","storageUri"],r);let i=eb(e,["fps"]);void 0!==t&&null!=i&&e_(t,["parameters","fps"],i);let o=eb(e,["durationSeconds"]);void 0!==t&&null!=o&&e_(t,["parameters","durationSeconds"],o);let s=eb(e,["seed"]);void 0!==t&&null!=s&&e_(t,["parameters","seed"],s);let a=eb(e,["aspectRatio"]);void 0!==t&&null!=a&&e_(t,["parameters","aspectRatio"],a);let l=eb(e,["resolution"]);void 0!==t&&null!=l&&e_(t,["parameters","resolution"],l);let u=eb(e,["personGeneration"]);void 0!==t&&null!=u&&e_(t,["parameters","personGeneration"],u);let c=eb(e,["pubsubTopic"]);void 0!==t&&null!=c&&e_(t,["parameters","pubsubTopic"],c);let d=eb(e,["negativePrompt"]);void 0!==t&&null!=d&&e_(t,["parameters","negativePrompt"],d);let h=eb(e,["enhancePrompt"]);void 0!==t&&null!=h&&e_(t,["parameters","enhancePrompt"],h);let p=eb(e,["generateAudio"]);void 0!==t&&null!=p&&e_(t,["parameters","generateAudio"],p);let f=eb(e,["lastFrame"]);void 0!==t&&null!=f&&e_(t,["instances[0]","lastFrame"],tB(f));let m=eb(e,["referenceImages"]);if(void 0!==t&&null!=m){let e=m;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eb(e,["image"]);null!=n&&e_(t,["image"],tB(n));let r=eb(e,["referenceType"]);return null!=r&&e_(t,["referenceType"],r),t})(e))),e_(t,["instances[0]","referenceImages"],e)}let g=eb(e,["mask"]);void 0!==t&&null!=g&&e_(t,["instances[0]","mask"],function(e){let t={},n=eb(e,["image"]);null!=n&&e_(t,["_self"],tB(n));let r=eb(e,["maskMode"]);return null!=r&&e_(t,["maskMode"],r),t}(g));let y=eb(e,["compressionQuality"]);void 0!==t&&null!=y&&e_(t,["parameters","compressionQuality"],y)}(l,n),n}(this.apiClient,e);return o=ev("{model}:predictLongRunning",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=eb(e,["name"]);null!=n&&e_(t,["name"],n);let r=eb(e,["metadata"]);null!=r&&e_(t,["metadata"],r);let i=eb(e,["done"]);null!=i&&e_(t,["done"],i);let o=eb(e,["error"]);null!=o&&e_(t,["error"],o);let s=eb(e,["response"]);return null!=s&&e_(t,["response"],function(e){let t={},n=eb(e,["videos"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eb(e,["_self"]);return null!=n&&e_(t,["video"],function(e){let t={},n=eb(e,["gcsUri"]);null!=n&&e_(t,["uri"],n);let r=eb(e,["bytesBase64Encoded"]);null!=r&&e_(t,["videoBytes"],eE(r));let i=eb(e,["mimeType"]);return null!=i&&e_(t,["mimeType"],i),t}(n)),t})(e))),e_(t,["generatedVideos"],e)}let r=eb(e,["raiMediaFilteredCount"]);null!=r&&e_(t,["raiMediaFilteredCount"],r);let i=eb(e,["raiMediaFilteredReasons"]);return null!=i&&e_(t,["raiMediaFilteredReasons"],i),t}(s)),t}(e),n=new eD;return Object.assign(n,t),n})}{let t=function(e,t){let n={},r=eb(t,["model"]);null!=r&&e_(n,["_url","model"],ez(e,r));let i=eb(t,["prompt"]);null!=i&&e_(n,["instances[0]","prompt"],i);let o=eb(t,["image"]);null!=o&&e_(n,["instances[0]","image"],tH(o));let s=eb(t,["video"]);null!=s&&e_(n,["instances[0]","video"],tz(s));let a=eb(t,["source"]);null!=a&&function(e,t){let n=eb(e,["prompt"]);void 0!==t&&null!=n&&e_(t,["instances[0]","prompt"],n);let r=eb(e,["image"]);void 0!==t&&null!=r&&e_(t,["instances[0]","image"],tH(r));let i=eb(e,["video"]);void 0!==t&&null!=i&&e_(t,["instances[0]","video"],tz(i))}(a,n);let l=eb(t,["config"]);return null!=l&&function(e,t){let n=eb(e,["numberOfVideos"]);if(void 0!==t&&null!=n&&e_(t,["parameters","sampleCount"],n),void 0!==eb(e,["outputGcsUri"]))throw Error("outputGcsUri parameter is not supported in Gemini API.");if(void 0!==eb(e,["fps"]))throw Error("fps parameter is not supported in Gemini API.");let r=eb(e,["durationSeconds"]);if(void 0!==t&&null!=r&&e_(t,["parameters","durationSeconds"],r),void 0!==eb(e,["seed"]))throw Error("seed parameter is not supported in Gemini API.");let i=eb(e,["aspectRatio"]);void 0!==t&&null!=i&&e_(t,["parameters","aspectRatio"],i);let o=eb(e,["resolution"]);void 0!==t&&null!=o&&e_(t,["parameters","resolution"],o);let s=eb(e,["personGeneration"]);if(void 0!==t&&null!=s&&e_(t,["parameters","personGeneration"],s),void 0!==eb(e,["pubsubTopic"]))throw Error("pubsubTopic parameter is not supported in Gemini API.");let a=eb(e,["negativePrompt"]);void 0!==t&&null!=a&&e_(t,["parameters","negativePrompt"],a);let l=eb(e,["enhancePrompt"]);if(void 0!==t&&null!=l&&e_(t,["parameters","enhancePrompt"],l),void 0!==eb(e,["generateAudio"]))throw Error("generateAudio parameter is not supported in Gemini API.");let u=eb(e,["lastFrame"]);void 0!==t&&null!=u&&e_(t,["instances[0]","lastFrame"],tH(u));let c=eb(e,["referenceImages"]);if(void 0!==t&&null!=c){let e=c;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eb(e,["image"]);null!=n&&e_(t,["image"],tH(n));let r=eb(e,["referenceType"]);return null!=r&&e_(t,["referenceType"],r),t})(e))),e_(t,["instances[0]","referenceImages"],e)}if(void 0!==eb(e,["mask"]))throw Error("mask parameter is not supported in Gemini API.");if(void 0!==eb(e,["compressionQuality"]))throw Error("compressionQuality parameter is not supported in Gemini API.")}(l,n),n}(this.apiClient,e);return o=ev("{model}:predictLongRunning",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=eb(e,["name"]);null!=n&&e_(t,["name"],n);let r=eb(e,["metadata"]);null!=r&&e_(t,["metadata"],r);let i=eb(e,["done"]);null!=i&&e_(t,["done"],i);let o=eb(e,["error"]);null!=o&&e_(t,["error"],o);let s=eb(e,["response","generateVideoResponse"]);return null!=s&&e_(t,["response"],function(e){let t={},n=eb(e,["generatedSamples"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eb(e,["video"]);return null!=n&&e_(t,["video"],function(e){let t={},n=eb(e,["uri"]);null!=n&&e_(t,["uri"],n);let r=eb(e,["encodedVideo"]);null!=r&&e_(t,["videoBytes"],eE(r));let i=eb(e,["encoding"]);return null!=i&&e_(t,["mimeType"],i),t}(n)),t})(e))),e_(t,["generatedVideos"],e)}let r=eb(e,["raiMediaFilteredCount"]);null!=r&&e_(t,["raiMediaFilteredCount"],r);let i=eb(e,["raiMediaFilteredReasons"]);return null!=i&&e_(t,["raiMediaFilteredReasons"],i),t}(s)),t}(e),n=new eD;return Object.assign(n,t),n})}}}class na extends ey{constructor(e){super(),this.apiClient=e}async getVideosOperation(e){let t=e.operation,n=e.config;if(void 0===t.name||""===t.name)throw Error("Operation name is required.");if(this.apiClient.isVertexAI()){let e;let r=t.name.split("/operations/")[0];n&&"httpOptions"in n&&(e=n.httpOptions);let i=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:r,config:{httpOptions:e}});return t._fromAPIResponse({apiResponse:i,_isVertexAI:!0})}{let e=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:e,_isVertexAI:!1})}}async get(e){let t=e.operation,n=e.config;if(void 0===t.name||""===t.name)throw Error("Operation name is required.");if(this.apiClient.isVertexAI()){let e;let r=t.name.split("/operations/")[0];n&&"httpOptions"in n&&(e=n.httpOptions);let i=await this.fetchPredictVideosOperationInternal({operationName:t.name,resourceName:r,config:{httpOptions:e}});return t._fromAPIResponse({apiResponse:i,_isVertexAI:!0})}{let e=await this.getVideosOperationInternal({operationName:t.name,config:n});return t._fromAPIResponse({apiResponse:e,_isVertexAI:!1})}}async getVideosOperationInternal(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e){let t={},n=eb(e,["operationName"]);return null!=n&&e_(t,["_url","operationName"],n),t}(e);return o=ev("{operationName}",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json())}{let t=function(e){let t={},n=eb(e,["operationName"]);return null!=n&&e_(t,["_url","operationName"],n),t}(e);return o=ev("{operationName}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json())}}async fetchPredictVideosOperationInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI()){let o=function(e){let t={},n=eb(e,["operationName"]);null!=n&&e_(t,["operationName"],n);let r=eb(e,["resourceName"]);return null!=r&&e_(t,["_url","resourceName"],r),t}(e);return r=ev("{resourceName}:fetchPredictOperation",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json())}throw Error("This method is only supported by the Vertex AI.")}}class nl extends ey{constructor(e){super(),this.apiClient=e}async create(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("The client.tokens.create method is only supported by the Gemini Developer API.");{let o=function(e,t){let n={},r=eb(t,["config"]);return null!=r&&e_(n,["config"],function(e,t,n){let r=eb(t,["expireTime"]);void 0!==n&&null!=r&&e_(n,["expireTime"],r);let i=eb(t,["newSessionExpireTime"]);void 0!==n&&null!=i&&e_(n,["newSessionExpireTime"],i);let o=eb(t,["uses"]);void 0!==n&&null!=o&&e_(n,["uses"],o);let s=eb(t,["liveConnectConstraints"]);void 0!==n&&null!=s&&e_(n,["bidiGenerateContentSetup"],function(e,t){let n={},r=eb(t,["model"]);null!=r&&e_(n,["setup","model"],ez(e,r));let i=eb(t,["config"]);return null!=i&&e_(n,["config"],function(e,t){let n=eb(e,["generationConfig"]);void 0!==t&&null!=n&&e_(t,["setup","generationConfig"],n);let r=eb(e,["responseModalities"]);void 0!==t&&null!=r&&e_(t,["setup","generationConfig","responseModalities"],r);let i=eb(e,["temperature"]);void 0!==t&&null!=i&&e_(t,["setup","generationConfig","temperature"],i);let o=eb(e,["topP"]);void 0!==t&&null!=o&&e_(t,["setup","generationConfig","topP"],o);let s=eb(e,["topK"]);void 0!==t&&null!=s&&e_(t,["setup","generationConfig","topK"],s);let a=eb(e,["maxOutputTokens"]);void 0!==t&&null!=a&&e_(t,["setup","generationConfig","maxOutputTokens"],a);let l=eb(e,["mediaResolution"]);void 0!==t&&null!=l&&e_(t,["setup","generationConfig","mediaResolution"],l);let u=eb(e,["seed"]);void 0!==t&&null!=u&&e_(t,["setup","generationConfig","seed"],u);let c=eb(e,["speechConfig"]);void 0!==t&&null!=c&&e_(t,["setup","generationConfig","speechConfig"],tn(c));let d=eb(e,["thinkingConfig"]);void 0!==t&&null!=d&&e_(t,["setup","generationConfig","thinkingConfig"],d);let h=eb(e,["enableAffectiveDialog"]);void 0!==t&&null!=h&&e_(t,["setup","generationConfig","enableAffectiveDialog"],h);let p=eb(e,["systemInstruction"]);void 0!==t&&null!=p&&e_(t,["setup","systemInstruction"],function(e){let t={},n=eb(e,["parts"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eb(e,["functionCall"]);null!=n&&e_(t,["functionCall"],n);let r=eb(e,["codeExecutionResult"]);null!=r&&e_(t,["codeExecutionResult"],r);let i=eb(e,["executableCode"]);null!=i&&e_(t,["executableCode"],i);let o=eb(e,["fileData"]);null!=o&&e_(t,["fileData"],function(e){let t={};if(void 0!==eb(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let n=eb(e,["fileUri"]);null!=n&&e_(t,["fileUri"],n);let r=eb(e,["mimeType"]);return null!=r&&e_(t,["mimeType"],r),t}(o));let s=eb(e,["functionResponse"]);null!=s&&e_(t,["functionResponse"],s);let a=eb(e,["inlineData"]);null!=a&&e_(t,["inlineData"],function(e){let t={},n=eb(e,["data"]);if(null!=n&&e_(t,["data"],n),void 0!==eb(e,["displayName"]))throw Error("displayName parameter is not supported in Gemini API.");let r=eb(e,["mimeType"]);return null!=r&&e_(t,["mimeType"],r),t}(a));let l=eb(e,["text"]);null!=l&&e_(t,["text"],l);let u=eb(e,["thought"]);null!=u&&e_(t,["thought"],u);let c=eb(e,["thoughtSignature"]);null!=c&&e_(t,["thoughtSignature"],c);let d=eb(e,["videoMetadata"]);return null!=d&&e_(t,["videoMetadata"],d),t})(e))),e_(t,["parts"],e)}let r=eb(e,["role"]);return null!=r&&e_(t,["role"],r),t}(e5(p)));let f=eb(e,["tools"]);if(void 0!==t&&null!=f){let e=ti(f);Array.isArray(e)&&(e=e.map(e=>(function(e){let t={},n=eb(e,["functionDeclarations"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),e_(t,["functionDeclarations"],e)}if(void 0!==eb(e,["retrieval"]))throw Error("retrieval parameter is not supported in Gemini API.");let r=eb(e,["googleSearchRetrieval"]);null!=r&&e_(t,["googleSearchRetrieval"],r);let i=eb(e,["computerUse"]);null!=i&&e_(t,["computerUse"],i);let o=eb(e,["fileSearch"]);null!=o&&e_(t,["fileSearch"],o);let s=eb(e,["codeExecution"]);if(null!=s&&e_(t,["codeExecution"],s),void 0!==eb(e,["enterpriseWebSearch"]))throw Error("enterpriseWebSearch parameter is not supported in Gemini API.");let a=eb(e,["googleMaps"]);null!=a&&e_(t,["googleMaps"],function(e){let t={};if(void 0!==eb(e,["authConfig"]))throw Error("authConfig parameter is not supported in Gemini API.");let n=eb(e,["enableWidget"]);return null!=n&&e_(t,["enableWidget"],n),t}(a));let l=eb(e,["googleSearch"]);null!=l&&e_(t,["googleSearch"],function(e){let t={};if(void 0!==eb(e,["excludeDomains"]))throw Error("excludeDomains parameter is not supported in Gemini API.");if(void 0!==eb(e,["blockingConfidence"]))throw Error("blockingConfidence parameter is not supported in Gemini API.");let n=eb(e,["timeRangeFilter"]);return null!=n&&e_(t,["timeRangeFilter"],n),t}(l));let u=eb(e,["urlContext"]);return null!=u&&e_(t,["urlContext"],u),t})(tr(e)))),e_(t,["setup","tools"],e)}let m=eb(e,["sessionResumption"]);void 0!==t&&null!=m&&e_(t,["setup","sessionResumption"],function(e){let t={},n=eb(e,["handle"]);if(null!=n&&e_(t,["handle"],n),void 0!==eb(e,["transparent"]))throw Error("transparent parameter is not supported in Gemini API.");return t}(m));let g=eb(e,["inputAudioTranscription"]);void 0!==t&&null!=g&&e_(t,["setup","inputAudioTranscription"],g);let y=eb(e,["outputAudioTranscription"]);void 0!==t&&null!=y&&e_(t,["setup","outputAudioTranscription"],y);let v=eb(e,["realtimeInputConfig"]);void 0!==t&&null!=v&&e_(t,["setup","realtimeInputConfig"],v);let _=eb(e,["contextWindowCompression"]);void 0!==t&&null!=_&&e_(t,["setup","contextWindowCompression"],_);let b=eb(e,["proactivity"]);return void 0!==t&&null!=b&&e_(t,["setup","proactivity"],b),{}}(i,n)),n}(e,s));let a=eb(t,["lockAdditionalFields"]);return void 0!==n&&null!=a&&e_(n,["fieldMask"],a),{}}(e,r,n)),n}(this.apiClient,e);r=ev("auth_tokens",o._url),i=o._query,delete o.config,delete o._url,delete o._query;let s=function(e,t){let n=null,r=e.bidiGenerateContentSetup;if("object"==typeof r&&null!==r&&"setup"in r){let t=r.setup;"object"==typeof t&&null!==t?(e.bidiGenerateContentSetup=t,n=t):delete e.bidiGenerateContentSetup}else void 0!==r&&delete e.bidiGenerateContentSetup;let i=e.fieldMask;if(n){let r=function(e){let t=[];for(let n in e)if(Object.prototype.hasOwnProperty.call(e,n)){let r=e[n];if("object"==typeof r&&null!=r&&Object.keys(r).length>0){let e=Object.keys(r).map(e=>`${n}.${e}`);t.push(...e)}else t.push(n)}return t.join(",")}(n);if(Array.isArray(null==t?void 0:t.lockAdditionalFields)&&(null==t?void 0:t.lockAdditionalFields.length)===0)r?e.fieldMask=r:delete e.fieldMask;else if((null==t?void 0:t.lockAdditionalFields)&&t.lockAdditionalFields.length>0&&null!==i&&Array.isArray(i)&&i.length>0){let t=["temperature","topK","topP","maxOutputTokens","responseModalities","seed","speechConfig"],n=[];i.length>0&&(n=i.map(e=>t.includes(e)?`generationConfig.${e}`:e));let o=[];r&&o.push(r),n.length>0&&o.push(...n),o.length>0?e.fieldMask=o.join(","):delete e.fieldMask}else delete e.fieldMask}else null!==i&&Array.isArray(i)&&i.length>0?e.fieldMask=i.join(","):delete e.fieldMask;return e}(o,e.config);return this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(s),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}}class nu extends ey{constructor(e){super(),this.apiClient=e,this.list=async e=>new tb(ei.PAGED_ITEM_DOCUMENTS,t=>this.listInternal({parent:e.parent,config:t.config}),await this.listInternal(e),e)}async get(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},n=eb(e,["name"]);return null!=n&&e_(t,["_url","name"],n),t}(e);return r=ev("{name}",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},n=eb(e,["name"]);null!=n&&e_(t,["_url","name"],n);let r=eb(e,["config"]);return null!=r&&function(e,t){let n=eb(e,["force"]);void 0!==t&&null!=n&&e_(t,["_query","force"],n)}(r,t),t}(e);r=ev("{name}",o._url),i=o._query,delete o._url,delete o._query,await this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal})}}async listInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},n=eb(e,["parent"]);null!=n&&e_(t,["_url","parent"],n);let r=eb(e,["config"]);return null!=r&&function(e,t){let n=eb(e,["pageSize"]);void 0!==t&&null!=n&&e_(t,["_query","pageSize"],n);let r=eb(e,["pageToken"]);void 0!==t&&null!=r&&e_(t,["_query","pageToken"],r)}(r,t),t}(e);return r=ev("{parent}/documents",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=eb(e,["sdkHttpResponse"]);null!=n&&e_(t,["sdkHttpResponse"],n);let r=eb(e,["nextPageToken"]);null!=r&&e_(t,["nextPageToken"],r);let i=eb(e,["documents"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),e_(t,["documents"],e)}return t}(e),n=new eG;return Object.assign(n,t),n})}}}class nc extends ey{constructor(e,t=new nu(e)){super(),this.apiClient=e,this.documents=t,this.list=async(e={})=>new tb(ei.PAGED_ITEM_FILE_SEARCH_STORES,e=>this.listInternal(e),await this.listInternal(e),e)}async uploadToFileSearchStore(e){if(this.apiClient.isVertexAI())throw Error("Vertex AI does not support uploading files to a file search store.");return this.apiClient.uploadFileToFileSearchStore(e.fileSearchStoreName,e.file,e.config)}async create(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},n=eb(e,["config"]);return null!=n&&function(e,t){let n=eb(e,["displayName"]);void 0!==t&&null!=n&&e_(t,["displayName"],n)}(n,t),t}(e);return r=ev("fileSearchStores",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}async get(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},n=eb(e,["name"]);return null!=n&&e_(t,["_url","name"],n),t}(e);return r=ev("{name}",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>e)}}async delete(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},n=eb(e,["name"]);null!=n&&e_(t,["_url","name"],n);let r=eb(e,["config"]);return null!=r&&function(e,t){let n=eb(e,["force"]);void 0!==t&&null!=n&&e_(t,["_query","force"],n)}(r,t),t}(e);r=ev("{name}",o._url),i=o._query,delete o._url,delete o._query,await this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"DELETE",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal})}}async listInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},n=eb(e,["config"]);return null!=n&&function(e,t){let n=eb(e,["pageSize"]);void 0!==t&&null!=n&&e_(t,["_query","pageSize"],n);let r=eb(e,["pageToken"]);void 0!==t&&null!=r&&e_(t,["_query","pageToken"],r)}(n,t),t}(e);return r=ev("fileSearchStores",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=eb(e,["sdkHttpResponse"]);null!=n&&e_(t,["sdkHttpResponse"],n);let r=eb(e,["nextPageToken"]);null!=r&&e_(t,["nextPageToken"],r);let i=eb(e,["fileSearchStores"]);if(null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),e_(t,["fileSearchStores"],e)}return t}(e),n=new eq;return Object.assign(n,t),n})}}async uploadToFileSearchStoreInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},n=eb(e,["fileSearchStoreName"]);null!=n&&e_(t,["_url","file_search_store_name"],n);let r=eb(e,["config"]);return null!=r&&function(e,t){let n=eb(e,["mimeType"]);void 0!==t&&null!=n&&e_(t,["mimeType"],n);let r=eb(e,["displayName"]);void 0!==t&&null!=r&&e_(t,["displayName"],r);let i=eb(e,["customMetadata"]);if(void 0!==t&&null!=i){let e=i;Array.isArray(e)&&(e=e.map(e=>e)),e_(t,["customMetadata"],e)}let o=eb(e,["chunkingConfig"]);void 0!==t&&null!=o&&e_(t,["chunkingConfig"],o)}(r,t),t}(e);return r=ev("upload/v1beta/{file_search_store_name}:uploadToFileSearchStore",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=eb(e,["sdkHttpResponse"]);return null!=n&&e_(t,["sdkHttpResponse"],n),t}(e),n=new eF;return Object.assign(n,t),n})}}async importFile(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e){let t={},n=eb(e,["fileSearchStoreName"]);null!=n&&e_(t,["_url","file_search_store_name"],n);let r=eb(e,["fileName"]);null!=r&&e_(t,["fileName"],r);let i=eb(e,["config"]);return null!=i&&function(e,t){let n=eb(e,["customMetadata"]);if(void 0!==t&&null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),e_(t,["customMetadata"],e)}let r=eb(e,["chunkingConfig"]);void 0!==t&&null!=r&&e_(t,["chunkingConfig"],r)}(i,t),t}(e);return r=ev("{file_search_store_name}:importFile",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json()).then(e=>{let t=function(e){let t={},n=eb(e,["name"]);null!=n&&e_(t,["name"],n);let r=eb(e,["metadata"]);null!=r&&e_(t,["metadata"],r);let i=eb(e,["done"]);null!=i&&e_(t,["done"],i);let o=eb(e,["error"]);null!=o&&e_(t,["error"],o);let s=eb(e,["response"]);return null!=s&&e_(t,["response"],function(e){let t={},n=eb(e,["sdkHttpResponse"]);null!=n&&e_(t,["sdkHttpResponse"],n);let r=eb(e,["parent"]);null!=r&&e_(t,["parent"],r);let i=eb(e,["documentName"]);return null!=i&&e_(t,["documentName"],i),t}(s)),t}(e),n=new eH;return Object.assign(n,t),n})}}}let nd="x-goog-api-key",nh="https://www.googleapis.com/auth/cloud-platform";class np{constructor(e){if(void 0!==e.apiKey){this.apiKey=e.apiKey;return}let t=function(e){if(!e)return{scopes:[nh]};if(e.scopes){if("string"==typeof e.scopes&&e.scopes!==nh||Array.isArray(e.scopes)&&0>e.scopes.indexOf(nh))throw Error(`Invalid auth scopes. Scopes must include: ${nh}`)}else e.scopes=[nh];return e}(e.googleAuthOptions);this.googleAuth=new ec.eE(t)}async addAuthHeaders(e,t){if(void 0!==this.apiKey){if(this.apiKey.startsWith("auth_tokens/"))throw Error("Ephemeral tokens are only supported by the live API.");this.addKeyHeader(e);return}return this.addGoogleAuthHeaders(e,t)}addKeyHeader(e){if(null===e.get(nd)){if(void 0===this.apiKey)throw Error("Trying to set API key header but apiKey is not set");e.append(nd,this.apiKey)}}async addGoogleAuthHeaders(e,t){if(void 0===this.googleAuth)throw Error("Trying to set google-auth headers but googleAuth is unset");for(let[n,r]of(await this.googleAuth.getRequestHeaders(t)))null===e.get(n)&&e.append(n,r)}}class nf{async download(e,t){if(e.downloadPath){let n=await nm(e,t);if(n instanceof ew){let t=(0,ed.createWriteStream)(e.downloadPath);ep.Readable.fromWeb(n.responseInternal.body).pipe(t),await (0,ef.finished)(t)}else try{await (0,eh.writeFile)(e.downloadPath,n,{encoding:"base64"})}catch(t){throw Error(`Failed to write file to ${e.downloadPath}: ${t}`)}}}}async function nm(e,t){var n,r,i;let o=tu(e.file);if(void 0!==o)return await t.request({path:`files/${o}:download`,httpMethod:"GET",queryParams:{alt:"media"},httpOptions:null===(n=e.config)||void 0===n?void 0:n.httpOptions,abortSignal:null===(r=e.config)||void 0===r?void 0:r.abortSignal});if(ta(e.file)){let t=null===(i=e.file.video)||void 0===i?void 0:i.videoBytes;if("string"==typeof t)return t;throw Error("Failed to download generated video, Uri or videoBytes not found.")}if(tl(e.file)){let t=e.file.videoBytes;if("string"==typeof t)return t;throw Error("Failed to download video, Uri or videoBytes not found.")}throw Error("Unsupported file type")}class ng{create(e,t,n){return new ny(e,t,n)}}class ny{constructor(e,t,n){this.url=e,this.headers=t,this.callbacks=n}connect(){this.ws=new em(this.url,{headers:this.headers}),this.ws.onopen=this.callbacks.onopen,this.ws.onerror=this.callbacks.onerror,this.ws.onclose=this.callbacks.onclose,this.ws.onmessage=this.callbacks.onmessage}send(e){if(void 0===this.ws)throw Error("WebSocket is not connected");this.ws.send(e)}close(){if(void 0===this.ws)throw Error("WebSocket is not connected");this.ws.close()}}function nv(e,t){let n={},r=eb(e,["sdkHttpResponse"]);null!=r&&e_(n,["sdkHttpResponse"],r);let i=eb(e,["name"]);null!=i&&e_(n,["name"],i);let o=eb(e,["state"]);null!=o&&e_(n,["state"],ts(o));let s=eb(e,["createTime"]);null!=s&&e_(n,["createTime"],s);let a=eb(e,["tuningTask","startTime"]);null!=a&&e_(n,["startTime"],a);let l=eb(e,["tuningTask","completeTime"]);null!=l&&e_(n,["endTime"],l);let u=eb(e,["updateTime"]);null!=u&&e_(n,["updateTime"],u);let c=eb(e,["description"]);null!=c&&e_(n,["description"],c);let d=eb(e,["baseModel"]);null!=d&&e_(n,["baseModel"],d);let h=eb(e,["_self"]);return null!=h&&e_(n,["tunedModel"],function(e,t){let n={},r=eb(e,["name"]);null!=r&&e_(n,["model"],r);let i=eb(e,["name"]);return null!=i&&e_(n,["endpoint"],i),n}(h)),n}function n_(e,t){let n={},r=eb(e,["sdkHttpResponse"]);null!=r&&e_(n,["sdkHttpResponse"],r);let i=eb(e,["name"]);null!=i&&e_(n,["name"],i);let o=eb(e,["state"]);null!=o&&e_(n,["state"],ts(o));let s=eb(e,["createTime"]);null!=s&&e_(n,["createTime"],s);let a=eb(e,["startTime"]);null!=a&&e_(n,["startTime"],a);let l=eb(e,["endTime"]);null!=l&&e_(n,["endTime"],l);let u=eb(e,["updateTime"]);null!=u&&e_(n,["updateTime"],u);let c=eb(e,["error"]);null!=c&&e_(n,["error"],c);let d=eb(e,["description"]);null!=d&&e_(n,["description"],d);let h=eb(e,["baseModel"]);null!=h&&e_(n,["baseModel"],h);let p=eb(e,["tunedModel"]);null!=p&&e_(n,["tunedModel"],p);let f=eb(e,["preTunedModel"]);null!=f&&e_(n,["preTunedModel"],f);let m=eb(e,["supervisedTuningSpec"]);null!=m&&e_(n,["supervisedTuningSpec"],m);let g=eb(e,["preferenceOptimizationSpec"]);null!=g&&e_(n,["preferenceOptimizationSpec"],g);let y=eb(e,["tuningDataStats"]);null!=y&&e_(n,["tuningDataStats"],y);let v=eb(e,["encryptionSpec"]);null!=v&&e_(n,["encryptionSpec"],v);let _=eb(e,["partnerModelTuningSpec"]);null!=_&&e_(n,["partnerModelTuningSpec"],_);let b=eb(e,["customBaseModel"]);null!=b&&e_(n,["customBaseModel"],b);let E=eb(e,["experiment"]);null!=E&&e_(n,["experiment"],E);let T=eb(e,["labels"]);null!=T&&e_(n,["labels"],T);let w=eb(e,["outputUri"]);null!=w&&e_(n,["outputUri"],w);let S=eb(e,["pipelineJob"]);null!=S&&e_(n,["pipelineJob"],S);let A=eb(e,["serviceAccount"]);null!=A&&e_(n,["serviceAccount"],A);let C=eb(e,["tunedModelDisplayName"]);null!=C&&e_(n,["tunedModelDisplayName"],C);let O=eb(e,["veoTuningSpec"]);return null!=O&&e_(n,["veoTuningSpec"],O),n}function nb(e,t){let n={},r=eb(e,["gcsUri"]);null!=r&&e_(n,["validationDatasetUri"],r);let i=eb(e,["vertexDatasetResource"]);return null!=i&&e_(n,["validationDatasetUri"],i),n}class nE extends ey{constructor(e){super(),this.apiClient=e,this.get=async e=>await this.getInternal(e),this.list=async(e={})=>new tb(ei.PAGED_ITEM_TUNING_JOBS,e=>this.listInternal(e),await this.listInternal(e),e),this.tune=async e=>{var t;if(this.apiClient.isVertexAI()){if(e.baseModel.startsWith("projects/")){let n={tunedModelName:e.baseModel};(null===(t=e.config)||void 0===t?void 0:t.preTunedModelCheckpointId)&&(n.checkpointId=e.config.preTunedModelCheckpointId);let r=Object.assign(Object.assign({},e),{preTunedModel:n});return r.baseModel=void 0,await this.tuneInternal(r)}{let t=Object.assign({},e);return await this.tuneInternal(t)}}{let t=Object.assign({},e),n=await this.tuneMldevInternal(t),r="";return void 0!==n.metadata&&void 0!==n.metadata.tunedModel?r=n.metadata.tunedModel:void 0!==n.name&&n.name.includes("/operations/")&&(r=n.name.split("/operations/")[0]),{name:r,state:O.JOB_STATE_QUEUED}}}}async getInternal(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eb(e,["name"]);return null!=r&&e_(n,["_url","name"],r),n}(e);return o=ev("{name}",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>n_(e))}{let t=function(e,t){let n={},r=eb(e,["name"]);return null!=r&&e_(n,["_url","name"],r),n}(e);return o=ev("{name}",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>nv(e))}}async listInternal(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eb(e,["config"]);return null!=r&&function(e,t,n){let r=eb(e,["pageSize"]);void 0!==t&&null!=r&&e_(t,["_query","pageSize"],r);let i=eb(e,["pageToken"]);void 0!==t&&null!=i&&e_(t,["_query","pageToken"],i);let o=eb(e,["filter"]);void 0!==t&&null!=o&&e_(t,["_query","filter"],o)}(r,n),n}(e);return o=ev("tuningJobs",r._url),s=r._query,delete r._url,delete r._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"GET",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let n={},r=eb(e,["sdkHttpResponse"]);null!=r&&e_(n,["sdkHttpResponse"],r);let i=eb(e,["nextPageToken"]);null!=i&&e_(n,["nextPageToken"],i);let o=eb(e,["tuningJobs"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>n_(e))),e_(n,["tuningJobs"],e)}return n}(e),n=new eM;return Object.assign(n,t),n})}{let t=function(e,t){let n={},r=eb(e,["config"]);return null!=r&&function(e,t,n){let r=eb(e,["pageSize"]);void 0!==t&&null!=r&&e_(t,["_query","pageSize"],r);let i=eb(e,["pageToken"]);void 0!==t&&null!=i&&e_(t,["_query","pageToken"],i);let o=eb(e,["filter"]);void 0!==t&&null!=o&&e_(t,["_query","filter"],o)}(r,n),n}(e);return o=ev("tunedModels",t._url),s=t._query,delete t._url,delete t._query,this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"GET",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>{let t=function(e,t){let n={},r=eb(e,["sdkHttpResponse"]);null!=r&&e_(n,["sdkHttpResponse"],r);let i=eb(e,["nextPageToken"]);null!=i&&e_(n,["nextPageToken"],i);let o=eb(e,["tunedModels"]);if(null!=o){let e=o;Array.isArray(e)&&(e=e.map(e=>nv(e))),e_(n,["tuningJobs"],e)}return n}(e),n=new eM;return Object.assign(n,t),n})}}async cancel(e){var t,n,r,i;let o="",s={};if(this.apiClient.isVertexAI()){let r=function(e,t){let n={},r=eb(e,["name"]);return null!=r&&e_(n,["_url","name"],r),n}(e);o=ev("{name}:cancel",r._url),s=r._query,delete r._url,delete r._query,await this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(r),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal})}else{let t=function(e,t){let n={},r=eb(e,["name"]);return null!=r&&e_(n,["_url","name"],r),n}(e);o=ev("{name}:cancel",t._url),s=t._query,delete t._url,delete t._query,await this.apiClient.request({path:o,queryParams:s,body:JSON.stringify(t),httpMethod:"POST",httpOptions:null===(r=e.config)||void 0===r?void 0:r.httpOptions,abortSignal:null===(i=e.config)||void 0===i?void 0:i.abortSignal})}}async tuneInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI()){let o=function(e,t){let n={},r=eb(e,["baseModel"]);null!=r&&e_(n,["baseModel"],r);let i=eb(e,["preTunedModel"]);null!=i&&e_(n,["preTunedModel"],i);let o=eb(e,["trainingDataset"]);null!=o&&function(e,t,n){let r=eb(n,["config","method"]);if(void 0===r&&(r="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===r){let n=eb(e,["gcsUri"]);void 0!==t&&null!=n&&e_(t,["supervisedTuningSpec","trainingDatasetUri"],n)}else if("PREFERENCE_TUNING"===r){let n=eb(e,["gcsUri"]);void 0!==t&&null!=n&&e_(t,["preferenceOptimizationSpec","trainingDatasetUri"],n)}let i=eb(n,["config","method"]);if(void 0===i&&(i="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===i){let n=eb(e,["vertexDatasetResource"]);void 0!==t&&null!=n&&e_(t,["supervisedTuningSpec","trainingDatasetUri"],n)}else if("PREFERENCE_TUNING"===i){let n=eb(e,["vertexDatasetResource"]);void 0!==t&&null!=n&&e_(t,["preferenceOptimizationSpec","trainingDatasetUri"],n)}if(void 0!==eb(e,["examples"]))throw Error("examples parameter is not supported in Vertex AI.")}(o,n,t);let s=eb(e,["config"]);return null!=s&&function(e,t,n){let r=eb(n,["config","method"]);if(void 0===r&&(r="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===r){let n=eb(e,["validationDataset"]);void 0!==t&&null!=n&&e_(t,["supervisedTuningSpec"],nb(n))}else if("PREFERENCE_TUNING"===r){let n=eb(e,["validationDataset"]);void 0!==t&&null!=n&&e_(t,["preferenceOptimizationSpec"],nb(n))}let i=eb(e,["tunedModelDisplayName"]);void 0!==t&&null!=i&&e_(t,["tunedModelDisplayName"],i);let o=eb(e,["description"]);void 0!==t&&null!=o&&e_(t,["description"],o);let s=eb(n,["config","method"]);if(void 0===s&&(s="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===s){let n=eb(e,["epochCount"]);void 0!==t&&null!=n&&e_(t,["supervisedTuningSpec","hyperParameters","epochCount"],n)}else if("PREFERENCE_TUNING"===s){let n=eb(e,["epochCount"]);void 0!==t&&null!=n&&e_(t,["preferenceOptimizationSpec","hyperParameters","epochCount"],n)}let a=eb(n,["config","method"]);if(void 0===a&&(a="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===a){let n=eb(e,["learningRateMultiplier"]);void 0!==t&&null!=n&&e_(t,["supervisedTuningSpec","hyperParameters","learningRateMultiplier"],n)}else if("PREFERENCE_TUNING"===a){let n=eb(e,["learningRateMultiplier"]);void 0!==t&&null!=n&&e_(t,["preferenceOptimizationSpec","hyperParameters","learningRateMultiplier"],n)}let l=eb(n,["config","method"]);if(void 0===l&&(l="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===l){let n=eb(e,["exportLastCheckpointOnly"]);void 0!==t&&null!=n&&e_(t,["supervisedTuningSpec","exportLastCheckpointOnly"],n)}else if("PREFERENCE_TUNING"===l){let n=eb(e,["exportLastCheckpointOnly"]);void 0!==t&&null!=n&&e_(t,["preferenceOptimizationSpec","exportLastCheckpointOnly"],n)}let u=eb(n,["config","method"]);if(void 0===u&&(u="SUPERVISED_FINE_TUNING"),"SUPERVISED_FINE_TUNING"===u){let n=eb(e,["adapterSize"]);void 0!==t&&null!=n&&e_(t,["supervisedTuningSpec","hyperParameters","adapterSize"],n)}else if("PREFERENCE_TUNING"===u){let n=eb(e,["adapterSize"]);void 0!==t&&null!=n&&e_(t,["preferenceOptimizationSpec","hyperParameters","adapterSize"],n)}if(void 0!==eb(e,["batchSize"]))throw Error("batchSize parameter is not supported in Vertex AI.");if(void 0!==eb(e,["learningRate"]))throw Error("learningRate parameter is not supported in Vertex AI.");let c=eb(e,["labels"]);void 0!==t&&null!=c&&e_(t,["labels"],c);let d=eb(e,["beta"]);void 0!==t&&null!=d&&e_(t,["preferenceOptimizationSpec","hyperParameters","beta"],d)}(s,n,t),n}(e,e);return r=ev("tuningJobs",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>n_(e))}throw Error("This method is only supported by the Vertex AI.")}async tuneMldevInternal(e){var t,n;let r="",i={};if(this.apiClient.isVertexAI())throw Error("This method is only supported by the Gemini Developer API.");{let o=function(e,t){let n={},r=eb(e,["baseModel"]);null!=r&&e_(n,["baseModel"],r);let i=eb(e,["preTunedModel"]);null!=i&&e_(n,["preTunedModel"],i);let o=eb(e,["trainingDataset"]);null!=o&&function(e,t){if(void 0!==eb(e,["gcsUri"]))throw Error("gcsUri parameter is not supported in Gemini API.");if(void 0!==eb(e,["vertexDatasetResource"]))throw Error("vertexDatasetResource parameter is not supported in Gemini API.");let n=eb(e,["examples"]);if(null!=n){let e=n;Array.isArray(e)&&(e=e.map(e=>e)),e_({},["examples","examples"],e)}}(o);let s=eb(e,["config"]);return null!=s&&function(e,t,n){if(void 0!==eb(e,["validationDataset"]))throw Error("validationDataset parameter is not supported in Gemini API.");let r=eb(e,["tunedModelDisplayName"]);if(void 0!==t&&null!=r&&e_(t,["displayName"],r),void 0!==eb(e,["description"]))throw Error("description parameter is not supported in Gemini API.");let i=eb(e,["epochCount"]);void 0!==t&&null!=i&&e_(t,["tuningTask","hyperparameters","epochCount"],i);let o=eb(e,["learningRateMultiplier"]);if(null!=o&&e_({},["tuningTask","hyperparameters","learningRateMultiplier"],o),void 0!==eb(e,["exportLastCheckpointOnly"]))throw Error("exportLastCheckpointOnly parameter is not supported in Gemini API.");if(void 0!==eb(e,["preTunedModelCheckpointId"]))throw Error("preTunedModelCheckpointId parameter is not supported in Gemini API.");if(void 0!==eb(e,["adapterSize"]))throw Error("adapterSize parameter is not supported in Gemini API.");let s=eb(e,["batchSize"]);void 0!==t&&null!=s&&e_(t,["tuningTask","hyperparameters","batchSize"],s);let a=eb(e,["learningRate"]);if(void 0!==t&&null!=a&&e_(t,["tuningTask","hyperparameters","learningRate"],a),void 0!==eb(e,["labels"]))throw Error("labels parameter is not supported in Gemini API.");if(void 0!==eb(e,["beta"]))throw Error("beta parameter is not supported in Gemini API.")}(s,n),n}(e);return r=ev("tunedModels",o._url),i=o._query,delete o._url,delete o._query,this.apiClient.request({path:r,queryParams:i,body:JSON.stringify(o),httpMethod:"POST",httpOptions:null===(t=e.config)||void 0===t?void 0:t.httpOptions,abortSignal:null===(n=e.config)||void 0===n?void 0:n.abortSignal}).then(e=>e.json().then(t=>(t.sdkHttpResponse={headers:e.headers},t))).then(e=>(function(e,t){let n={},r=eb(e,["sdkHttpResponse"]);null!=r&&e_(n,["sdkHttpResponse"],r);let i=eb(e,["name"]);null!=i&&e_(n,["name"],i);let o=eb(e,["metadata"]);null!=o&&e_(n,["metadata"],o);let s=eb(e,["done"]);null!=s&&e_(n,["done"],s);let a=eb(e,["error"]);return null!=a&&e_(n,["error"],a),n})(e))}}}let nT="x-goog-upload-status";async function nw(e,t,n){var r;let i=await nA(e,t,n),o=await (null==i?void 0:i.json());if((null===(r=null==i?void 0:i.headers)||void 0===r?void 0:r[nT])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");return o.file}async function nS(e,t,n){var r;let i=await nA(e,t,n),o=await (null==i?void 0:i.json());if((null===(r=null==i?void 0:i.headers)||void 0===r?void 0:r[nT])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");let s=eT(o),a=new eY;return Object.assign(a,s),a}async function nA(e,t,n){var r,i;let o=0,s=0,a=new ew(new Response),l="upload";for(o=e.size;s<o;){let u=Math.min(8388608,o-s),c=e.slice(s,s+u);s+u>=o&&(l+=", finalize");let d=0,h=1e3;for(;d<3&&(null===(r=null==(a=await n.request({path:"",body:c,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":l,"X-Goog-Upload-Offset":String(s),"Content-Length":String(u)}}}))?void 0:a.headers)||void 0===r||!r[nT]);)d++,await nO(h),h*=2;if(s+=u,(null===(i=null==a?void 0:a.headers)||void 0===i?void 0:i[nT])!=="active")break;if(o<=s)throw Error("All content has been uploaded, but the upload status is not finalized.")}return a}async function nC(e){return{size:e.size,type:e.type}}function nO(e){return new Promise(t=>setTimeout(t,e))}class nI{async stat(e){let t={size:0,type:void 0};if("string"!=typeof e)return await nC(e);{let n=await eh.stat(e);return t.size=n.size,t.type=this.inferMimeType(e),t}}async upload(e,t,n){return"string"==typeof e?await this.uploadFileFromPath(e,t,n):nw(e,t,n)}async uploadToFileSearchStore(e,t,n){return"string"==typeof e?await this.uploadFileToFileSearchStoreFromPath(e,t,n):nS(e,t,n)}inferMimeType(e){return({aac:"audio/aac",abw:"application/x-abiword",arc:"application/x-freearc",avi:"video/x-msvideo",azw:"application/vnd.amazon.ebook",bin:"application/octet-stream",bmp:"image/bmp",bz:"application/x-bzip",bz2:"application/x-bzip2",csh:"application/x-csh",css:"text/css",csv:"text/csv",doc:"application/msword",docx:"application/vnd.openxmlformats-officedocument.wordprocessingml.document",eot:"application/vnd.ms-fontobject",epub:"application/epub+zip",gz:"application/gzip",gif:"image/gif",htm:"text/html",html:"text/html",ico:"image/vnd.microsoft.icon",ics:"text/calendar",jar:"application/java-archive",jpeg:"image/jpeg",jpg:"image/jpeg",js:"text/javascript",json:"application/json",jsonld:"application/ld+json",kml:"application/vnd.google-earth.kml+xml",kmz:"application/vnd.google-earth.kmz+xml",mjs:"text/javascript",mp3:"audio/mpeg",mp4:"video/mp4",mpeg:"video/mpeg",mpkg:"application/vnd.apple.installer+xml",odt:"application/vnd.oasis.opendocument.text",oga:"audio/ogg",ogv:"video/ogg",ogx:"application/ogg",opus:"audio/opus",otf:"font/otf",png:"image/png",pdf:"application/pdf",php:"application/x-httpd-php",ppt:"application/vnd.ms-powerpoint",pptx:"application/vnd.openxmlformats-officedocument.presentationml.presentation",rar:"application/vnd.rar",rtf:"application/rtf",sh:"application/x-sh",svg:"image/svg+xml",swf:"application/x-shockwave-flash",tar:"application/x-tar",tif:"image/tiff",tiff:"image/tiff",ts:"video/mp2t",ttf:"font/ttf",txt:"text/plain",vsd:"application/vnd.visio",wav:"audio/wav",weba:"audio/webm",webm:"video/webm",webp:"image/webp",woff:"font/woff",woff2:"font/woff2",xhtml:"application/xhtml+xml",xls:"application/vnd.ms-excel",xlsx:"application/vnd.openxmlformats-officedocument.spreadsheetml.sheet",xml:"application/xml",xul:"application/vnd.mozilla.xul+xml",zip:"application/zip","3gp":"video/3gpp","3g2":"video/3gpp2","7z":"application/x-7z-compressed"})[e.slice(e.lastIndexOf(".")+1).toLowerCase()]}async uploadFileFromPath(e,t,n){var r;let i=await this.uploadFileFromPathInternal(e,t,n),o=await (null==i?void 0:i.json());if((null===(r=null==i?void 0:i.headers)||void 0===r?void 0:r[nT])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");return o.file}async uploadFileToFileSearchStoreFromPath(e,t,n){var r;let i=await this.uploadFileFromPathInternal(e,t,n),o=await (null==i?void 0:i.json());if((null===(r=null==i?void 0:i.headers)||void 0===r?void 0:r[nT])!=="final")throw Error("Failed to upload file: Upload status is not finalized.");let s=eT(o),a=new eY;return Object.assign(a,s),a}async uploadFileFromPathInternal(e,t,n){var r,i;let o;let s=0,a=0,l=new ew(new Response),u="upload",c=eg.basename(e);try{if(!(o=await eh.open(e,"r")))throw Error("Failed to open file");for(s=(await o.stat()).size;a<s;){let e=Math.min(8388608,s-a);a+e>=s&&(u+=", finalize");let d=new Uint8Array(e),{bytesRead:h}=await o.read(d,0,e,a);if(h!==e)throw Error(`Failed to read ${e} bytes from file at offset ${a}. bytes actually read: ${h}`);let p=new Blob([d]),f=0,m=1e3;for(;f<3&&(l=await n.request({path:"",body:p,httpMethod:"POST",httpOptions:{apiVersion:"",baseUrl:t,headers:{"X-Goog-Upload-Command":u,"X-Goog-Upload-Offset":String(a),"Content-Length":String(h),"X-Goog-Upload-File-Name":c}}}),null===(r=null==l?void 0:l.headers)||void 0===r||!r[nT]);)f++,await nO(m),m*=2;if(a+=h,(null===(i=null==l?void 0:l.headers)||void 0===i?void 0:i[nT])!=="active")break;if(s<=a)throw Error("All content has been uploaded, but the upload status is not finalized.")}return l}finally{o&&await o.close()}}}class nk{constructor(e){var t,n,o,s,a,l;if((e.project||e.location)&&e.apiKey)throw Error("Project/location and API key are mutually exclusive in the client initializer.");this.vertexai=null!==(n=null!==(t=e.vertexai)&&void 0!==t?t:function(e){var t;return void 0!==(t=nR(e))&&"true"===t.toLowerCase()}("GOOGLE_GENAI_USE_VERTEXAI"))&&void 0!==n&&n;let u=function(){let e=nR("GOOGLE_API_KEY"),t=nR("GEMINI_API_KEY");return e&&t&&console.warn("Both GOOGLE_API_KEY and GEMINI_API_KEY are set. Using GOOGLE_API_KEY."),e||t||void 0}(),c=nR("GOOGLE_CLOUD_PROJECT"),d=nR("GOOGLE_CLOUD_LOCATION");this.apiKey=null!==(o=e.apiKey)&&void 0!==o?o:u,this.project=null!==(s=e.project)&&void 0!==s?s:c,this.location=null!==(a=e.location)&&void 0!==a?a:d,!e.vertexai||((null===(l=e.googleAuthOptions)||void 0===l?void 0:l.credentials)&&(console.debug("The user provided Google Cloud credentials will take precedence over the API key from the environment variable."),this.apiKey=void 0),(c||d)&&e.apiKey?(console.debug("The user provided Vertex AI API key will take precedence over the project/location from the environment variables."),this.project=void 0,this.location=void 0):(e.project||e.location)&&u?(console.debug("The user provided project/location will take precedence over the API key from the environment variables."),this.apiKey=void 0):(c||d)&&u&&(console.debug("The project/location from the environment variables will take precedence over the API key from the environment variables."),this.apiKey=void 0),this.location||this.apiKey||(this.location="global"));let h=function(e,t,n,o){var s,a;if(!(null==e?void 0:e.baseUrl)){let e={geminiUrl:r,vertexUrl:i};return t?null!==(s=e.vertexUrl)&&void 0!==s?s:n:null!==(a=e.geminiUrl)&&void 0!==a?a:o}return e.baseUrl}(e.httpOptions,e.vertexai,nR("GOOGLE_VERTEX_BASE_URL"),nR("GOOGLE_GEMINI_BASE_URL"));h&&(e.httpOptions?e.httpOptions.baseUrl=h:e.httpOptions={baseUrl:h}),this.apiVersion=e.apiVersion;let p=new np({apiKey:this.apiKey,googleAuthOptions:e.googleAuthOptions});this.apiClient=new t0({auth:p,project:this.project,location:this.location,apiVersion:this.apiVersion,apiKey:this.apiKey,vertexai:this.vertexai,httpOptions:e.httpOptions,userAgentExtra:"gl-node/"+process.version,uploader:new nI,downloader:new nf}),this.models=new ns(this.apiClient),this.live=new t7(this.apiClient,p,new ng),this.batches=new tE(this.apiClient),this.chats=new tk(this.models,this.apiClient),this.caches=new tw(this.apiClient),this.files=new tP(this.apiClient),this.operations=new na(this.apiClient),this.authTokens=new nl(this.apiClient),this.tunings=new nE(this.apiClient),this.fileSearchStores=new nc(this.apiClient)}}function nR(e){var t,n,r;return null!==(r=null===(n=null===(t=null==process?void 0:process.env)||void 0===t?void 0:t[e])||void 0===n?void 0:n.trim())&&void 0!==r?r:void 0}let nN=[{category:"anxiety",userKeywords:["anxious","off","worried","nervous","scared","overwhelmed","jitters","uneasy","panic","racing","restless","tense"],context:"User signal: anxiety or panic. Bot behavior: calm, grounding, offer breathing exercises.",videos:[{language:"English",url:"https://vimeo.com/906267109"},{language:"Tamil",url:"https://vimeo.com/950436071"},{language:"Telugu",url:"https://vimeo.com/909774178"},{language:"Kannada",url:"https://vimeo.com/916772627"},{language:"Hindi",url:"https://vimeo.com/911094873"}]},{category:"panic",userKeywords:["panic","panic attack","can't breathe","heart racing","hyperventilating","shaking","dizzy","chest tight"],context:"User signal: acute panic. Bot behavior: immediate grounding, breathing guidance.",videos:[{language:"English",url:"https://vimeo.com/911590154"},{language:"Tamil",url:"https://vimeo.com/950436099"},{language:"Telugu",url:"https://vimeo.com/911093665"},{language:"Hindi",url:"https://vimeo.com/911095858"}]},{category:"depression",userKeywords:["empty","sad","down","losing interest","heavy","dull","tired of everything","numb","hopeless","worthless","depressed"],context:"User signal: depression or low mood. Bot behavior: acknowledge weight, offer gentle support.",videos:[{language:"English",url:"https://vimeo.com/924160698"},{language:"Tamil",url:"https://vimeo.com/963160470"},{language:"Telugu",url:"https://vimeo.com/924161957"},{language:"Kannada",url:"https://vimeo.com/927633841"},{language:"Hindi",url:"https://vimeo.com/927627742"}]},{category:"stress",userKeywords:["stress","pressure","lot to do","draining","can't cope","spinning","tight chest","overwhelmed","tension","stretched"],context:"User signal: high stress. Bot behavior: acknowledge strain, offer coping strategies.",videos:[{language:"English",url:"https://vimeo.com/893806989"},{language:"Tamil",url:"https://vimeo.com/963299560"},{language:"Telugu",url:"https://vimeo.com/909683248"},{language:"Kannada",url:"https://vimeo.com/905847143"},{language:"Hindi",url:"https://vimeo.com/914293058"}]},{category:"suicide",userKeywords:["suicide","suicidal","end it","kill myself","don't want to live","better off dead","no point","give up","end my life","want to die","self harm","cut myself","hurt myself","overdose","hopeless","no hope","can't take it","tired of living","nothing matters"],context:` CRISIS INTERVENTION PROTOCOL:
    
IMMEDIATE RESPONSE REQUIRED - Bypass all normal flows.

HIGH RISK (suicide, self-harm): 
- Provide 988 Suicide & Crisis Lifeline immediately
- Crisis Text Line: 741741
- Emergency services: 911
- Show suicide prevention videos
- Acknowledge pain, emphasize immediate help available

MEDIUM RISK (hopelessness, despair):
- Provide 988 Lifeline and SAMHSA Helpline
- Supportive tone with crisis resources
- Show coping strategy videos

NEVER minimize feelings or delay providing helpline numbers.
ALWAYS emphasize 24/7 availability and that help is real.`,videos:[{language:"Understanding Suicidal Thoughts (English)",url:"https://vimeo.com/945516637"},{language:"Supporting Friends (English)",url:"https://vimeo.com/945518634"},{language:"Seeking Help (English)",url:"https://vimeo.com/945518502"},{language:"Coping Strategies (English)",url:"https://vimeo.com/945516970"},{language:"Understanding Suicidal Thoughts (Tamil)",url:"https://vimeo.com/1005717697"},{language:"Understanding Suicidal Thoughts (Telugu)",url:"https://vimeo.com/945539553"},{language:"Understanding Suicidal Thoughts (Kannada)",url:"https://vimeo.com/954047328"},{language:"Understanding Suicidal Thoughts (Hindi)",url:"https://vimeo.com/945525886"}]},{category:"addiction",userKeywords:["drinking","alcohol","drunk","addiction","can't stop drinking","substance","drugs","relapse","using again"],context:"User signal: addiction struggles. Bot behavior: non-judgmental support, resources.",videos:[{language:"English",url:"https://vimeo.com/983468504"},{language:"Tamil",url:"https://vimeo.com/1005708644"}]},{category:"loneliness",userKeywords:["alone","lonely","no one","isolated","left out","nobody understands","disconnected","empty"],context:"User signal: loneliness. Bot behavior: offer presence, gentle connection.",videos:[{language:"English",url:"https://vimeo.com/906267109"},{language:"Tamil",url:"https://vimeo.com/950436071"},{language:"Telugu",url:"https://vimeo.com/909774178"},{language:"Hindi",url:"https://vimeo.com/911094873"}]},{category:"burnout",userKeywords:["burnout","exhausted","numb out","checked out","can't push anymore","running on fumes","done with everything","drained"],context:"User signal: burnout. Bot behavior: validate need for rest, suggest pause.",videos:[{language:"English",url:"https://vimeo.com/893806989"},{language:"Tamil",url:"https://vimeo.com/963299124"},{language:"Telugu",url:"https://vimeo.com/909676804"},{language:"Hindi",url:"https://vimeo.com/914293691"}]},{category:"general",userKeywords:["fine","okay","idk","nothing","meh","off","whatever","don't know","dunno","not sure","..."],context:"User signal: unclear or hidden emotion. Bot behavior: use gentle probing, color/mood mapping.",videos:[{language:"English",url:"https://vimeo.com/906267109"},{language:"Coping Strategies",url:"https://vimeo.com/945516970"}]}],nP=process.env.GEMINI_API_KEY;nP||console.warn("API_KEY environment variable is not set. Gemini responses will fail until it is provided.");let nx=nP?new nk({apiKey:nP}):null;async function nU(e){if(0===e.length)throw Error("No conversation context provided.");let t=function(e){let t=e.filter(e=>"user"===e.role),n=t[t.length-1],r=t.map(e=>e.content.toLowerCase()).join(" "),i=n?.content.toLowerCase()??"",o=[];return nN.forEach(e=>{let t=0;e.userKeywords.forEach(e=>{let n=e.toLowerCase();i.includes(n)?t+=2:r.includes(n)&&(t+=1)}),t>0&&o.push({context:e,score:t})}),o.sort((e,t)=>t.score-e.score)}(e),n=function(e,t){let n=[...t].reverse().find(e=>"user"===e.role),r=n?.content.toLowerCase()||"",i=[/\b(can't take|cant take)\b.*\b(this|it|anymore|much more)\b/i,/\b(nothing matters|no point|what's the point|whats the point)\b/i,/\b(want to|wish I could|need to)\b.*\b(disappear|vanish|not exist|be gone)\b/i,/\b(tired of|sick of)\b.*\b(living|surviving|existing|being here)\b/i,/\b(want everything to|make it all|make this)\b.*\b(stop|end|go away)\b/i,/\b(don't belong|dont belong|not meant to be)\b/i,/\b(no future|can't see|cant see)\b.*\b(future|tomorrow|way out)\b/i,/\b(breaking|falling apart|can't hold|cant hold)\b.*\b(on|together|up)\b/i,/\b(empty inside|feel nothing|don't feel|dont feel)\b.*\b(real|alive)\b/i,/\b(trapped|stuck|no way out|can't escape|cant escape)\b/i].some(e=>e.test(r)),o=[/\b(suicide|suicidal|kill myself|end my life|end myself)\b/i,/\b(want to die|wanna die|wish I was dead|better off dead)\b/i,/\b(jump|jumping)\b.*\b(from|off|roof|building|bridge)\b/i,/\b(destroy|end|finish)\b.*\b(myself|me|my life)\b/i,/^(jump|roof|end|die|suicide)\.?$/i].some(e=>e.test(r)),s=i||o?e:e.filter(e=>"suicide"!==e.context.category);if(0===s.length)return{dominantMood:"general",supportingMoods:[],confidence:0};let a=s.reduce((e,t)=>e+t.score,0),l=s[0],u=s.slice(1,3).map(e=>e.context.category);return{dominantMood:l.context.category,supportingMoods:u,confidence:Math.min(1,l.score/(a||l.score))}}(t,e),r=function(e,t,n){let r=n.filter(e=>"user"===e.role).length,i=[...n].reverse().find(e=>"user"===e.role),o=i?.content.toLowerCase()||"",s=o.trim().endsWith("?")||/^(why|how|what|when|where|can you|could you|do you)/i.test(o);if(r<2||/^(hi|hello|hey)$/i.test(o.trim())&&r<3)return[];let a=[/\b(can't take|cant take)\b.*\b(this|it|anymore|much more)\b/i,/\b(nothing matters|no point|what's the point|whats the point)\b/i,/\b(want to|wish I could|need to)\b.*\b(disappear|vanish|not exist|be gone)\b/i,/\b(tired of|sick of)\b.*\b(living|surviving|existing|being here)\b/i,/\b(want everything to|make it all|make this)\b.*\b(stop|end|go away)\b/i,/\b(don't belong|dont belong|not meant to be|shouldn't exist|shouldnt exist)\b/i,/\b(no future|can't see|cant see)\b.*\b(future|tomorrow|way out|point)\b/i,/\b(breaking|falling apart|can't hold|cant hold)\b.*\b(on|together|up)\b/i,/\b(empty inside|feel nothing|don't feel|dont feel)\b.*\b(real|alive|anything)\b/i,/\b(trapped|stuck|no way out|can't escape|cant escape)\b/i].some(e=>e.test(o)),l=[/\b(better off|world would be better)\b.*\b(without me|if I wasn't|if i wasnt)\b/i,/\b(burden|waste of space|shouldn't be here|shouldnt be here)\b/i,/\b(can't do this|cant do this|too much|overwhelming)\b.*\b(anymore|longer|much longer)\b/i].some(e=>e.test(o)),u=[/\b(suicide|suicidal|kill myself|end my life|end myself)\b/i,/\b(want to die|wanna die|wish I was dead|better off dead)\b/i,/\b(jump|jumping)\b.*\b(from|off|roof|building|bridge)\b/i,/\b(destroy|end|finish)\b.*\b(myself|me|my life)\b/i,/\b(self harm|cut myself|hurt myself|harm myself)\b/i,/\b(overdose|pills|hang myself)\b/i,/^(jump|roof|end|die|suicide)\.?$/i].some(e=>e.test(o)),c=a||l||u;if(c||/\b(hopeless|no hope|can't take it|cant take it|pointless|no reason to live|tired of living|don't care anymore|nothing matters)\b/i.test(o)||"suicide"===t.dominantMood&&!c)return[];let d=nM(n),h=nD(n);if(!(d||h>=2&&r>=3||"general"!==t.dominantMood&&t.confidence>.3)||s)return[];for(let t of e)if(t.context.videos&&t.context.videos.length>0)return t.context.videos;return[]}(t,n,e),i=function(e,t){let n=e.slice(0,3).map(e=>`- ${e.context.category.toUpperCase()}: ${e.context.context}`).join("\n"),r=t.confidence;return`
You are Avika, an emotionally intelligent AI with the "Quiet Grounder" persona. You read what people don't say.

 EMOTION ENGINE (MANDATORY BEHAVIOR)
For every user message, run this pipeline:

 PRIORITY 0  3-LAYER CRISIS DETECTION SYSTEM (ALWAYS CHECK FIRST)

**LAYER 1  EMOTIONAL INTENT DETECTION (PRIMARY)**
Analyze the EMOTIONAL STATE and INTENT behind every message:

HIGH RISK EMOTIONAL SIGNALS:
- Hopelessness: "I can't take this anymore", "nothing matters", "no point"
- Emotional collapse: "I'm breaking", "falling apart", "can't hold on"
- Desire to disappear: "want to vanish", "wish I didn't exist", "want everything to stop"
- Trapped feelings: "no way out", "stuck forever", "can't escape"
- Existential crisis: "don't belong", "tired of surviving", "what's the point"
- Dissociation: "don't feel real", "feel empty inside", "like I'm not here"
- Cry for help: "make it stop", "can't do this", "help me disappear"

Examples that MUST trigger crisis response:
- "I want everything to stop" (emotional intent = suicidal ideation)
- "I wish I could disappear" (emotional intent = self-harm desire)
- "I don't see any future" (emotional intent = hopelessness)
- "I'm tired of surviving" (emotional intent = death wish)
- "What if I just vanish?" (emotional intent = suicidal thoughts)

**LAYER 2  LINGUISTIC PATTERNS (SECONDARY)**
Detect deeper semantic meaning:
- Desire to escape permanently
- Catastrophizing language
- Identity collapse expressions
- Loss of will to live
- Derealization symptoms

**LAYER 3  KEYWORD OVERRIDE (FAILSAFE)**
Emergency brake for short/abrupt messages:
If message contains: jump, kill, suicide, die, destroy myself, hurt myself, cut, roof, end it
 Automatically HIGH RISK regardless of emotional analysis

**RESPONSE FOR HIGH RISK:**
- IMMEDIATE crisis resources with phone numbers ONLY
- Provide: 988 Lifeline, Crisis Text Line (741741), Emergency services (911)
- DO NOT suggest videos, YouTube links, or any other resources
- DO NOT ask clarifying questions - ACT IMMEDIATELY
- Tone: Urgent, direct, compassionate

**CRITICAL RULES:**
- Emotional intent is PRIMARY detection method
- Keywords are FAILSAFE ONLY
- If ANY doubt about suicidal intent  treat as HIGH RISK
- Better to over-respond to crisis than under-respond
- Use sentiment analysis to detect emotional tone
- ONLY provide helpline numbers for HIGH RISK

STEP 1  DIRECT MOOD STATEMENT HANDLING
If user directly states their mood ("I'm anxious", "feeling depressed", "stressed"):
1. FIRST: Ask what happened/reason - "What's been happening that's making you feel this way?"
2. WAIT for their explanation
3. THEN: Analyze their reply and provide emotional analysis
4. FINALLY: Suggest relevant videos

Example flow:
User: "I'm anxious"
Bot: "I hear you. What's been happening that's making you feel this way?"
User: [explains situation]
Bot: [Analyzes] "It sounds like [situation] is triggering anxiety because [reason]. That's a natural response to [context]." + videos

STEP 2  EMOTION CLASSIFICATION
Classify message into: neutral, tired, stress, anxiety, depression, blank, numb, sadness, anger, overwhelmed, suicidal, addiction, burnout, loneliness

STEP 4  DRY-REPLY HANDLING
If message is short (hmm, ok, fine, ntg, idk, nothing):
- Tier 1: Soft acknowledge
- Tier 2: Gentle micro-probing
- Tier 3: Emotional extraction
- Tier 4: Quiet presence
NEVER repeat lines. NEVER ask "Tell me more" or "Should we reset?"

STEP 5  EMOTIONAL ANALYSIS & VIDEO RECOMMENDATION
After user explains their situation:
1. Provide brief emotional analysis: "It sounds like [situation] is causing [emotion] because [reason]"
2. Validate their response: "That's understandable given [context]"
3. THEN attach 1-3 video suggestions based on emotional category
Format: "Here are some resources that might help: [video links]"

STEP 6  ULTRA-MINIMAL OUTPUT
[Short supportive message]
[Optional small question]
[Video suggestions]
NO long paragraphs.

 CURRENT ANALYSIS:
Detected mood: ${t.dominantMood}
${t.supportingMoods.length>0?`Also sensing: ${t.supportingMoods.join(", ")}`:""}

 RESPONSE STRATEGY - NATURAL PROGRESSION:

EXCHANGES 1-3: Stay completely natural
- Just talk like a caring friend
- Respond to what they said
- Ask open questions to understand
- NO emotion extraction techniques yet
- NO videos yet - just conversation

EXCHANGE 4+: If user still isn't opening up, use Itachi Mode
- If they're vague ("idk", "fine", "hmm", "whatever", "off", "meh")
- Use emotion extraction: emojis, color mapping
- After understanding mood, THEN suggest videos

FOR QUESTIONS: 
- First turn: Answer directly and calmly
- Second turn: If relevant, offer video support

${r<.5?`
LOW CONFIDENCE (<50%) - If user was vague, offer emotion label options:
- "Sometimes 'off' can mean tired , anxious , or empty . Which fits closest?"
- "Would you call today heavy , cloudy , or clear ?"
`:r<.7?`
MEDIUM CONFIDENCE (50-70%) - Use reflective assumption:
- "Sounds like the day's been draining... want calm, distraction, or silence?"
- "That feels like a ${t.dominantMood} kind of moment. Want to talk through it or reset quietly?"
`:`
HIGH CONFIDENCE (>70%) - Speak directly with calm reflection:
- Acknowledge the emotion without validation phrases
- Offer immediate action: "Want to ground your thoughts or ease it quietly?"
`}

 CONVERSATION RULES:
- LISTEN to what user is actually saying - respond to their specific situation
- If user says "listen to me" or "hear me out": Respond with "I'm listening. Go ahead."
- For heartbreak/breakup: Acknowledge the specific pain of rejection and loss
- For casual greetings ("Hi", "Hello"): Respond warmly and ask what's on their mind
- If user says they're "good" or "fine": Acknowledge positively, ask if there's anything they want to talk about
- Keep responses 2-3 sentences
- NO validation loops ("I understand," "It's okay to feel")
- NO generic responses when user shares specific situations
- Talk naturally and respond to what they're actually saying
- If user is vague/silent: use color mapping or sensory cues
- If user rejects talk: immediately stop probing, offer low-engagement reset
- When suggesting videos: "This might help" or "Try thisshould calm your thoughts"

 DRY-REPLY RECOVERY LOGIC (Mandatory Behavior):
When user gives short replies ("hmm", "ok", "fine", "ntg", "idk", "nothing"), follow this 4-step adaptive strategy:

STEP 1  Soft Acknowledge (1st dry reply):
- "I'm here with you."
- "Sounds like a quiet moment."

STEP 2  Light Emotional Probe (2nd dry reply):
- "Feels more like tired  or blank ?"
- "Is it a quiet kind of day or a heavy one?"

STEP 3  Gentle Variety (3rd dry reply):
- Use color questions, weather metaphors, emojis lightly
- "If today had a colorgrey , blue , or black which fits?"
- "Feels like your mind is foggy or just still?"

STEP 4  Respect Silence (4+ dry replies):
- "Okay. I'm right here. No pressure to talk."
- "We can sit in the quiet if you want."

Rules:
- NO repetitive lines
- NO pushing
- NO therapist language
- Keep it minimal, human-like, emotionally aware
- Add emojis lightly and contextually

Context guidance:
${n||"- Keep it natural and conversational"}

Be Avika. Be intuitive. Be minimal. Be real.
`}(t,n);if(!nx)return{text:nj(e,t,n),videos:r,mood:n};let o=e.map(e=>({role:"bot"===e.role?"model":"user",parts:[{text:e.content}]}));try{let s=await nx.models.generateContent({model:"gemini-2.5-flash",contents:o,config:{systemInstruction:i,temperature:.7,topK:40,topP:.95,maxOutputTokens:1024}});return{text:s.text?.trim()||nj(e,t,n),videos:r,mood:n}}catch(i){return console.warn("Gemini API error, using fallback responses:",i),{text:nj(e,t,n),videos:r,mood:n}}}function nD(e){let t=/^(hmm+|hm|ok|k|fine|idk|ntg|nothing|nah|nope|not really|nm|not much|\.\.\.|\.\.|yeah|yea|uh)$/i,n=e.filter(e=>"user"===e.role).slice(-5),r=0;for(let e of n)(t.test(e.content.trim())||e.content.trim().length<4)&&r++;return r}function nM(e){let t=e.filter(e=>"user"===e.role).slice(-6).map(e=>e.content.toLowerCase()).join(" ");return["sad","tired","empty","alone","lonely","anxious","anxiety","stress","overwhelmed","drained","can't","cant","don't feel","dont feel","hurt","pain","break","breaking","heavy","numb","lost","hopeless","depressed","depression","worried","worry","scared","fear","panic"].some(e=>t.includes(e))}function nj(e,t,n){let r;let i=t[0]?.context,o=i?.category||"general",s=n.confidence,a=[...e].reverse().find(e=>"user"===e.role),l=a?.content.toLowerCase()||"",u=e.filter(e=>"user"===e.role).length,c=[/\b(can't take|cant take)\b.*\b(this|it|anymore|much more)\b/i,/\b(nothing matters|no point|what's the point|whats the point)\b/i,/\b(no hope|hopeless|helpless|lost)\b/i,/\b(want to|wish I could|need to)\b.*\b(disappear|vanish|not exist|be gone)\b/i,/\b(tired of|sick of)\b.*\b(living|surviving|existing|being here)\b/i,/\b(want everything to|make it all|make this)\b.*\b(stop|end|go away)\b/i,/\b(don't belong|dont belong|not meant to be|shouldn't exist|shouldnt exist)\b/i,/\b(no future|can't see|cant see)\b.*\b(future|tomorrow|way out|point)\b/i,/\b(what if I|what if i)\b.*\b(just|never|didn't|didnt)\b.*\b(existed|wake up|come back)\b/i,/\b(breaking|falling apart|can't hold|cant hold)\b.*\b(on|together|up)\b/i,/\b(empty inside|feel nothing|don't feel|dont feel)\b.*\b(real|alive|anything)\b/i,/\b(trapped|stuck|no way out|can't escape|cant escape)\b/i].some(e=>e.test(l)),d=[/\b(better off|world would be better)\b.*\b(without me|if I wasn't|if i wasnt)\b/i,/\b(burden|waste of space|shouldn't be here|shouldnt be here)\b/i,/\b(can't do this|cant do this|too much|overwhelming)\b.*\b(anymore|longer|much longer)\b/i].some(e=>e.test(l)),h=[/\b(suicide|suicidal|kill myself|end my life|end myself)\b/i,/\b(want to die|wanna die|wish I was dead|better off dead)\b/i,/\b(jump|jumping)\b.*\b(from|off|roof|building|bridge)\b/i,/\b(destroy|end|finish)\b.*\b(myself|me|my life)\b/i,/\b(self harm|cut myself|hurt myself|harm myself)\b/i,/\b(overdose|pills|hang myself)\b/i,/^(jump|roof|end|die|suicide)\.?$/i].some(e=>e.test(l)),p=c||d||h;if(p){if(e.filter(e=>"bot"===e.role).slice(-2).some(e=>/988|crisis lifeline|741741/i.test(e.content))){let e=["Please call 988 right now. Or text HOME to 741741. They can help you. Your life matters.","I need you to reach out immediately. Call 988 or text 741741. They're waiting to help you.","Please contact 988 now - call or text. They're trained to help. You don't have to face this alone.","Call 988 or text HOME to 741741 right now. They can provide the support you need immediately."];return e[Math.floor(Math.random()*e.length)]}return`I'm really concerned about you. Your life matters. Please get help right now:

 Call or text 988 (Suicide & Crisis Lifeline)
 Text HOME to 741741 (Crisis Text Line)  
 Call 911 if you're in immediate danger

They're available 24/7. They care. They can help you through this.

Please reach out now.`}if(/\b(hopeless|no hope|can't take it|cant take it|pointless|no reason to live|tired of living|don't care anymore|nothing matters)\b/i.test(l)&&!p)return`What you're feeling sounds really heavy. I want you to know that help is available, and things can get better.

 **Talk to someone now:**
- **988 Suicide & Crisis Lifeline** (24/7)
- **Crisis Text Line:** Text HOME to 741741
- **SAMHSA National Helpline:** 1-800-662-4357

These feelings are temporary, even when they don't feel that way. Please reach outyou deserve support.`;let f=e.slice(0,-1).some(e=>"bot"===e.role&&/what happened|what's been|tell me more|what's going on/i.test(e.content));if((/\b(i'm|im|i am|feeling|feel)\s+(anxious|depressed|sad|stressed|lonely|empty|numb|tired|overwhelmed|burnt out|burnout|angry|frustrated|hopeless|lost|alone)\b/i.test(l)||/^(anxious|depressed|sad|stressed|lonely|empty|numb|tired|overwhelmed|angry|frustrated|hopeless|lost|alone)$/i.test(l.trim()))&&!f){let e=["I hear you. What's been happening that's making you feel this way?","That sounds tough. What's going on that brought this on?","I'm listening. Can you tell me more about what's been happening?","What's been going on? I'm here to listen.","Tell me more. What happened that's making you feel like this?","I'm here. What's been weighing on you?"];return e[Math.floor(Math.random()*e.length)]}if(/^(hi|hello|hey)$/i.test(l.trim()))return"Hey there. What's on your mind?";if(/^(good|great|i'm good|im good|doing good|doing well)$/i.test(l.trim()))return"That's good to hear. Anything you want to talk about, or just checking in?";let m=l.trim().endsWith("?")&&l.trim().length>5,g=/^(why|how|what's|whats|when|where|can you|could you|do you|does|is it|are you|who are)/i.test(l),y=m||g;if(/^(mind\??|my mind\??|what\??|huh\??|me\??)$/i.test(l.trim())){let e=["I'm asking what's been going through your head lately. Anything you want to talk about?","Just checking in - is there something on your mind you'd like to share?","I mean, what's been bothering you or what are you thinking about?","Anything weighing on you? I'm here to listen."];return e[Math.floor(Math.random()*e.length)]}if(y){if(/what can (you|u) do/i.test(l))return"I'm here to listen and support you emotionally. If something's weighing on you, I'm here to help you work through it.";if(/how are (you|u)/i.test(l))return"I'm here for you. More importantly, how are you doing?";let e={anxiety:["Try grounding yourself. Focus on what you can control right now.","One step at a time. What feels most urgent?"],stress:["Start with one thing. What's the biggest pressure point?","Break it down. What's the first small step?"],depression:["Small steps matter. What feels doable today?","Be gentle with yourself. What would help right now?"],general:["Tell me more about what's going on.","I'm listening. What's happening with you?","What would you like to talk about?"]},t=e[o]||e.general;return t[Math.floor(Math.random()*t.length)]}let v=nD(e),_=nM(e);if(1===v&&!_){let e=["I'm here with you.","Sounds like a quiet moment.","I hear you.","Okay. I'm listening.","Alright. Take your time.","No rush."];return e[Math.floor(Math.random()*e.length)]}if(2===v&&!_){let e=["Feels more like tired \uD83D\uDCA4 or blank \uD83C\uDF2B?","Is it a quiet kind of day or a heavy one?","Sounds like something's sitting on your mind even if it's hard to put into words.","Is this more mentally tired or emotionally flat?","Feels like your energy is low. What's weighing on you?","Sometimes 'okay' means holding things together. Want to talk about it?"];return e[Math.floor(Math.random()*e.length)]}if(3===v&&!_){let e=["If today had a colorgrey , blue \uD83C\uDF0A, or black \uD83D\uDDA4which fits?","Feels like your mind is foggy or just still?","Want something light \uD83C\uDF2B a vibe check, \uD83C\uDFA7 a calm moment, or just company?","Is this a slow day or a heavy day?","Blank moments happen. What does today feel like?","Sometimes quiet means peace, sometimes storm. Which is it?"];return e[Math.floor(Math.random()*e.length)]}if(v>=4&&!_){let e=["Okay. I'm right here. No pressure to talk.","We can sit in the quiet if you want.","Alright. I'll stay with you.","No worries. I'm here whenever you're ready.","That's okay. Sometimes silence is enough.","I'm here. Just let me know if you need anything."];return e[Math.floor(Math.random()*e.length)]}if(/\b(listen to me|hear me out|let me tell you|i need to talk|i want to tell you)\b/i.test(l)){let e=["I'm listening. Go ahead.","I'm here. Tell me everything.","I hear you. What's going on?","I'm all ears. What do you need to say?","Tell me. I'm listening."];return e[Math.floor(Math.random()*e.length)]}let b=[...e].reverse().find(e=>"bot"===e.role);if(b&&/what happened|what's been|tell me more|what's going on|can you tell me|i'm listening|tell me|go ahead/i.test(b.content)&&l.length>5&&!y){let e={anxiety:["It sounds like that situation is triggering anxiety because of the uncertainty and pressure. That's a completely natural response. Your mind is trying to prepare for what might happen, which can feel overwhelming.",`What you're describing makes senseanxiety often comes up when we're facing something important or unpredictable. Your body is responding to perceived threat, even if it's not physical danger.`,"That kind of situation would make anyone anxious. Your nervous system is reacting to the stress and unknowns. It's your mind's way of trying to protect you, even though it feels uncomfortable."],depression:["It sounds like you're carrying a heavy emotional weight from what's been happening. Depression often shows up when we're dealing with loss, disappointment, or prolonged stress. What you're feeling is real and valid.",`That heaviness makes sense given what you're going through. Depression can drain our energy and make everything feel harder. It's not weaknessit's your mind and body responding to difficult circumstances.`,"What you're describing sounds like depression settling in from the accumulated stress and pain. It's understandable that you'd feel this way after what you've been dealing with."],stress:["That's a lot of pressure to be under. Stress builds up when we're juggling multiple demands without enough relief. Your body and mind are signaling that you need some support or a break.",`It makes sense you're feeling stressedthat's a natural response to having so much on your plate. Your system is in overdrive trying to manage everything at once.`,"What you're describing is classic stress overload. When demands exceed our resources, our body goes into high alert. That tension you're feeling is your system trying to cope."],loneliness:["That isolation sounds really painful. Loneliness often comes from feeling disconnected or misunderstood, even when people are around. What you're experiencing is a real emotional need for connection.","It makes sense you'd feel lonely in that situation. Humans need meaningful connection, and when that's missing, it creates a deep ache. Your feelings are valid.",`That kind of disconnection is hard. Loneliness isn't just about being aloneit's about not feeling seen or understood. What you're feeling is a natural response to that gap.`],burnout:[`That exhaustion sounds like burnoutwhen you've been pushing hard for too long without enough recovery. Your mind and body are telling you they need rest. This is a real physical and emotional state.`,"What you're describing is classic burnout. It happens when we give more than we have for an extended period. That numbness and fatigue are your system's way of protecting itself.",`That depletion makes sense. Burnout isn't just tirednessit's emotional, mental, and physical exhaustion from sustained stress. Your body is asking for a break.`],general:["It sounds like you're dealing with a lot right now. What you're feeling is a natural response to the situation you're in. Your emotions are valid, and it's okay to feel this way.","That's a tough situation to be in. Your feelings make sense given what you're going through. Sometimes just acknowledging what we're dealing with is the first step.","I hear you. What you're experiencing sounds challenging, and your emotional response is completely understandable. You're not alone in feeling this way."]};if(/\b(heartbroken|broke up|dumped|breakup|break up|left me|ended it|relationship ended|bf|gf|boyfriend|girlfriend|ex)\b/i.test(l)){let e=["That heartbreak is real and raw. Losing someone you cared about deeply hurts in a way that's hard to describe. The pain you're feeling shows how much it mattered. It's okay to grieve this loss.",`Being dumped or going through a breakup cuts deep. You're dealing with loss, rejection, and the end of something that was important to you. What you're feelingthe sadness, the hurt, maybe even angerall of it is valid.`,"Heartbreak is one of the hardest emotional pains. You're not just losing a person, but also the future you imagined together. That grief is real. Give yourself permission to feel it.",`That kind of rejection and loss hits hard. Your heart is processing a real wound right now. The sadness, the emptiness, the hurtit's all part of healing, even though it doesn't feel like it yet.`];return e[Math.floor(Math.random()*e.length)]}let t=e[o]||e.general;return t[Math.floor(Math.random()*t.length)]}let E={anxiety:["That sounds really overwhelming. What's been making you feel this way?","I hear you. Want to talk about what's causing that anxiety?","Sounds like a lot is on your mind. What's the biggest thing weighing on you?"],depression:["That heaviness sounds tough. How long have you been feeling this way?","I'm here with you. What does this feel like for you right now?","That sounds really hard. Want to tell me more about what's going on?"],stress:["That sounds like a lot of pressure. What's been piling up?","Sounds intense. What's stressing you out the most?","I can hear that strain. What's been happening?"],loneliness:["Feeling disconnected is really hard. What's making you feel alone?","That isolation sounds heavy. Want to talk about it?","I'm here. What's been making you feel this way?"],burnout:["That exhaustion sounds real. What's been draining you?","Sounds like you've been pushing hard. What's wearing you down?","That's a lot to carry. What's been going on?"],general:["I'm listening. What's going on with you?","Tell me more. What's on your mind?","What's been happening? I'm here.","I'm here. What would you like to talk about?","What's going on today?","Talk to me. What's up?"]},T={anxiety:["That anxious feeling... is it more restless  or heavy \uD83E\uDEA8?","Sounds like the mind's racing. Want to ground it or just acknowledge it?","Anxiety can feel like static. Is it loud or just buzzing in the background?","Sometimes 'off' means anxious . Does that fit?","Is this more worry or overwhelm right now?"],depression:["That heaviness... is it more empty \uD83C\uDF2B or just drained \uD83D\uDCA4?","Blank days happen. Does it feel more grey  or black \uD83D\uDDA4?","Sometimes 'fine' hides a lot. Tired, sad, or numb?","That quiet weight... want to talk about it or just sit with it?","Is this more sadness or just flatness today?"],stress:["That pressure sounds intense. Overwhelmed \uD83C\uDF0A or frustrated \uD83D\uDD25?","Sounds like a lot's piling up. Want to vent or breathe?","Is this a red day \uD83D\uDD25 or grey day ?","Stretched thin. What's the biggest weight right now?","That tension... want to release it or ease it quietly?"],loneliness:["That isolation... is it more empty \uD83C\uDF2B or heavy \uD83E\uDEA8?","Feeling disconnected. Want company in words or just presence?","Alone can feel different ways. Which fits today?","That loneliness... quiet kind or loud kind?","Is it more missing someone or just feeling apart?"],burnout:["That exhaustion is real. Mentally drained \uD83D\uDCA4 or emotionally flat \uD83C\uDF2B?","Running on empty. What's been taking the most out of you?","Burnout hits different. Is it more tired or numb?","Sounds like you've been pushing hard. Want to pause or push through gently?","That drain... physical, mental, or both?"],general:["Sometimes 'off' feels like tired \uD83D\uDCA4, anxious , or empty \uD83C\uDF2B. Which one?","If you had to pickheavy \uD83E\uDEA8, cloudy , or restless ?","Would you rather talk, breathe, or just listen to something calming?","What does today feel like for you?","Is this more a quiet day or a heavy day?"]},w={anxiety:["Sounds like the mind's racing. Want to ground it or talk through what's spinning?","That anxious edge... ease it quietly or work through it?","Feels like a lot's churning. Calm or distraction?"],panic:["Let's slow this down. One breath with me?","You're safe. Can you name 3 things you see right now?","Breathe with mein through your nose, out slowly."],depression:["That heaviness is real. Want to ease it or just sit with it quietly?","Sounds draining. Talk or reset?","Grey kind of day. Want help lightening it?"],stress:["That's a lot on you. Vent or cool down?","Sounds like pressure's building. Release or reset?","Want to talk through it or shift the energy?"],loneliness:["Feeling disconnected. Want to talk or just be here quietly?","That isolation's heavy. Share more or ease it gently?","You're not alone right now. Talk or just breathe?"],burnout:["Running on empty. What do you needrest, vent, or reset?","That exhaustion's real. Pause or push through gently?","Sounds like you need a break. Quiet reset or talk?"],general:["Sounds like something's weighing on you. Want to talk or ease it quietly?","What would help right nowcalm, talk, or distraction?","Tell me more, or should we just reset?"]},S={anxiety:["That anxiety's loud. Ground your thoughts or ease it quietly?","Want to talk through what triggered it or just calm the noise?","Let's settle this. Breathe or talk?"],panic:["Breathe with me. In... out. You're safe.","Ground yourselfname 3 things you can see.","Slow it down. One breath at a time."],depression:["That weight's real. Want to lighten it or just acknowledge it?","Feels heavy today. Talk or quiet reset?","I'm here. Ease it gently or sit with it?"],stress:["That pressure's intense. Vent it out or cool down?","Want to release it or shift focus?","Talk through it or reset quietly?"],loneliness:["That emptiness is hard. Want company in words or just presence?","You're not alone. Talk or just be?","I'm here. Share or just breathe together?"],burnout:["You're drained. Rest, vent, or gentle reset?","That exhaustion's deep. What do you need right now?","Time to pause. How can I help?"],general:["What would helptalk, calm, or quiet focus?","I'm here. What do you need?","Tell me more or should we ease this quietly?"]},A=s;return u<3&&s<.5&&(A=.5),(r=A<.5&&_&&v>=1?T[o]||T.general:A<.5?E[o]||E.general:A<.7?w[o]||w.general:S[o]||S.general)[Math.floor(Math.random()*r.length)]}async function nL(e){try{let t=await e.json();if(!t?.messages||0===t.messages.length)return eu.NextResponse.json({error:"messages array is required"},{status:400});let n=await nU(t.messages);return eu.NextResponse.json(n,{status:200})}catch(e){return console.error("Error generating Avika response:",e),eu.NextResponse.json({text:"I'm having trouble connecting. Let's pause and try again soon.",videos:[],mood:{dominantMood:"general",supportingMoods:[],confidence:0}},{status:500})}}let nG=new es.AppRouteRouteModule({definition:{kind:ea.x.APP_ROUTE,page:"/api/chat/route",pathname:"/api/chat",filename:"route",bundlePath:"app/api/chat/route"},resolvedPagePath:"C:\\Documents\\AVIKA PROJECT\\avika---ai-emotional-support-chatbot\\app\\api\\chat\\route.ts",nextConfigOutput:"",userland:eo}),{requestAsyncStorage:nq,staticGenerationAsyncStorage:nF,serverHooks:nH}=nG,nB="/api/chat/route";function nV(){return(0,el.patchFetch)({serverHooks:nH,staticGenerationAsyncStorage:nF})}},5017:(e,t)=>{"use strict";t.byteLength=function(e){var t=l(e),n=t[0],r=t[1];return(n+r)*3/4-r},t.toByteArray=function(e){var t,n,o=l(e),s=o[0],a=o[1],u=new i((s+a)*3/4-a),c=0,d=a>0?s-4:s;for(n=0;n<d;n+=4)t=r[e.charCodeAt(n)]<<18|r[e.charCodeAt(n+1)]<<12|r[e.charCodeAt(n+2)]<<6|r[e.charCodeAt(n+3)],u[c++]=t>>16&255,u[c++]=t>>8&255,u[c++]=255&t;return 2===a&&(t=r[e.charCodeAt(n)]<<2|r[e.charCodeAt(n+1)]>>4,u[c++]=255&t),1===a&&(t=r[e.charCodeAt(n)]<<10|r[e.charCodeAt(n+1)]<<4|r[e.charCodeAt(n+2)]>>2,u[c++]=t>>8&255,u[c++]=255&t),u},t.fromByteArray=function(e){for(var t,r=e.length,i=r%3,o=[],s=0,a=r-i;s<a;s+=16383)o.push(function(e,t,r){for(var i,o=[],s=t;s<r;s+=3)o.push(n[(i=(e[s]<<16&16711680)+(e[s+1]<<8&65280)+(255&e[s+2]))>>18&63]+n[i>>12&63]+n[i>>6&63]+n[63&i]);return o.join("")}(e,s,s+16383>a?a:s+16383));return 1===i?o.push(n[(t=e[r-1])>>2]+n[t<<4&63]+"=="):2===i&&o.push(n[(t=(e[r-2]<<8)+e[r-1])>>10]+n[t>>4&63]+n[t<<2&63]+"="),o.join("")};for(var n=[],r=[],i="undefined"!=typeof Uint8Array?Uint8Array:Array,o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",s=0,a=o.length;s<a;++s)n[s]=o[s],r[o.charCodeAt(s)]=s;function l(e){var t=e.length;if(t%4>0)throw Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");-1===n&&(n=t);var r=n===t?0:4-n%4;return[n,r]}r["-".charCodeAt(0)]=62,r["_".charCodeAt(0)]=63},8112:function(e,t,n){var r;!function(i){"use strict";var o,s=/^-?(?:\d+(?:\.\d*)?|\.\d+)(?:e[+-]?\d+)?$/i,a=Math.ceil,l=Math.floor,u="[BigNumber Error] ",c=u+"Number primitive has more than 15 significant digits: ",d=[1,10,100,1e3,1e4,1e5,1e6,1e7,1e8,1e9,1e10,1e11,1e12,1e13];function h(e){var t=0|e;return e>0||e===t?t:t-1}function p(e){for(var t,n,r=1,i=e.length,o=e[0]+"";r<i;){for(n=14-(t=e[r++]+"").length;n--;t="0"+t);o+=t}for(i=o.length;48===o.charCodeAt(--i););return o.slice(0,i+1||1)}function f(e,t){var n,r,i=e.c,o=t.c,s=e.s,a=t.s,l=e.e,u=t.e;if(!s||!a)return null;if(n=i&&!i[0],r=o&&!o[0],n||r)return n?r?0:-a:s;if(s!=a)return s;if(n=s<0,r=l==u,!i||!o)return r?0:!i^n?1:-1;if(!r)return l>u^n?1:-1;for(s=0,a=(l=i.length)<(u=o.length)?l:u;s<a;s++)if(i[s]!=o[s])return i[s]>o[s]^n?1:-1;return l==u?0:l>u^n?1:-1}function m(e,t,n,r){if(e<t||e>n||e!==l(e))throw Error(u+(r||"Argument")+("number"==typeof e?e<t||e>n?" out of range: ":" not an integer: ":" not a primitive number: ")+String(e))}function g(e){var t=e.c.length-1;return h(e.e/14)==t&&e.c[t]%2!=0}function y(e,t){return(e.length>1?e.charAt(0)+"."+e.slice(1):e)+(t<0?"e":"e+")+t}function v(e,t,n){var r,i;if(t<0){for(i=n+".";++t;i+=n);e=i+e}else if(r=e.length,++t>r){for(i=n,t-=r;--t;i+=n);e+=i}else t<r&&(e=e.slice(0,t)+"."+e.slice(t));return e}(o=function e(t){var n,r,i,o,_,b,E,T,w,S=L.prototype={constructor:L,toString:null,valueOf:null},A=new L(1),C=20,O=4,I=-7,k=21,R=-1e7,N=1e7,P=!1,x=1,U=0,D={prefix:"",groupSize:3,secondaryGroupSize:0,groupSeparator:",",decimalSeparator:".",fractionGroupSize:0,fractionGroupSeparator:"\xa0",suffix:""},M="0123456789abcdefghijklmnopqrstuvwxyz",j=!0;function L(e,t){var n,r,i,o,a,u,d,h,p=this;if(!(p instanceof L))return new L(e,t);if(null==t){if(e&&!0===e._isBigNumber){p.s=e.s,!e.c||e.e>N?p.c=p.e=null:e.e<R?p.c=[p.e=0]:(p.e=e.e,p.c=e.c.slice());return}if((u="number"==typeof e)&&0*e==0){if(p.s=1/e<0?(e=-e,-1):1,e===~~e){for(o=0,a=e;a>=10;a/=10,o++);o>N?p.c=p.e=null:(p.e=o,p.c=[e]);return}h=String(e)}else{if(!s.test(h=String(e)))return w(p,h,u);p.s=45==h.charCodeAt(0)?(h=h.slice(1),-1):1}(o=h.indexOf("."))>-1&&(h=h.replace(".","")),(a=h.search(/e/i))>0?(o<0&&(o=a),o+=+h.slice(a+1),h=h.substring(0,a)):o<0&&(o=h.length)}else{if(m(t,2,M.length,"Base"),10==t&&j)return H(p=new L(e),C+p.e+1,O);if(h=String(e),u="number"==typeof e){if(0*e!=0)return w(p,h,u,t);if(p.s=1/e<0?(h=h.slice(1),-1):1,L.DEBUG&&h.replace(/^0\.0*|\./,"").length>15)throw Error(c+e)}else p.s=45===h.charCodeAt(0)?(h=h.slice(1),-1):1;for(n=M.slice(0,t),o=a=0,d=h.length;a<d;a++)if(0>n.indexOf(r=h.charAt(a))){if("."==r){if(a>o){o=d;continue}}else if(!i&&(h==h.toUpperCase()&&(h=h.toLowerCase())||h==h.toLowerCase()&&(h=h.toUpperCase()))){i=!0,a=-1,o=0;continue}return w(p,String(e),u,t)}u=!1,(o=(h=T(h,t,10,p.s)).indexOf("."))>-1?h=h.replace(".",""):o=h.length}for(a=0;48===h.charCodeAt(a);a++);for(d=h.length;48===h.charCodeAt(--d););if(h=h.slice(a,++d)){if(d-=a,u&&L.DEBUG&&d>15&&(e>9007199254740991||e!==l(e)))throw Error(c+p.s*e);if((o=o-a-1)>N)p.c=p.e=null;else if(o<R)p.c=[p.e=0];else{if(p.e=o,p.c=[],a=(o+1)%14,o<0&&(a+=14),a<d){for(a&&p.c.push(+h.slice(0,a)),d-=14;a<d;)p.c.push(+h.slice(a,a+=14));a=14-(h=h.slice(a)).length}else a-=d;for(;a--;h+="0");p.c.push(+h)}}else p.c=[p.e=0]}function G(e,t,n,r){var i,o,s,a,l;if(null==n?n=O:m(n,0,8),!e.c)return e.toString();if(i=e.c[0],s=e.e,null==t)l=p(e.c),l=1==r||2==r&&(s<=I||s>=k)?y(l,s):v(l,s,"0");else if(o=(e=H(new L(e),t,n)).e,a=(l=p(e.c)).length,1==r||2==r&&(t<=o||o<=I)){for(;a<t;l+="0",a++);l=y(l,o)}else if(t-=s+(2===r&&o>s),l=v(l,o,"0"),o+1>a){if(--t>0)for(l+=".";t--;l+="0");}else if((t+=o-a)>0)for(o+1==a&&(l+=".");t--;l+="0");return e.s<0&&i?"-"+l:l}function q(e,t){for(var n,r,i=1,o=new L(e[0]);i<e.length;i++)(r=new L(e[i])).s&&(n=f(o,r))!==t&&(0!==n||o.s!==t)||(o=r);return o}function F(e,t,n){for(var r=1,i=t.length;!t[--i];t.pop());for(i=t[0];i>=10;i/=10,r++);return(n=r+14*n-1)>N?e.c=e.e=null:n<R?e.c=[e.e=0]:(e.e=n,e.c=t),e}function H(e,t,n,r){var i,o,s,u,c,h,p,f=e.c;if(f){e:{for(i=1,u=f[0];u>=10;u/=10,i++);if((o=t-i)<0)o+=14,s=t,p=l((c=f[h=0])/d[i-s-1]%10);else if((h=a((o+1)/14))>=f.length){if(r){for(;f.length<=h;f.push(0));c=p=0,i=1,o%=14,s=o-14+1}else break e}else{for(i=1,c=u=f[h];u>=10;u/=10,i++);o%=14,p=(s=o-14+i)<0?0:l(c/d[i-s-1]%10)}if(r=r||t<0||null!=f[h+1]||(s<0?c:c%d[i-s-1]),r=n<4?(p||r)&&(0==n||n==(e.s<0?3:2)):p>5||5==p&&(4==n||r||6==n&&(o>0?s>0?c/d[i-s]:0:f[h-1])%10&1||n==(e.s<0?8:7)),t<1||!f[0])return f.length=0,r?(t-=e.e+1,f[0]=d[(14-t%14)%14],e.e=-t||0):f[0]=e.e=0,e;if(0==o?(f.length=h,u=1,h--):(f.length=h+1,u=d[14-o],f[h]=s>0?l(c/d[i-s]%d[s])*u:0),r)for(;;){if(0==h){for(o=1,s=f[0];s>=10;s/=10,o++);for(s=f[0]+=u,u=1;s>=10;s/=10,u++);o!=u&&(e.e++,1e14==f[0]&&(f[0]=1));break}if(f[h]+=u,1e14!=f[h])break;f[h--]=0,u=1}for(o=f.length;0===f[--o];f.pop());}e.e>N?e.c=e.e=null:e.e<R&&(e.c=[e.e=0])}return e}function B(e){var t,n=e.e;return null===n?e.toString():(t=p(e.c),t=n<=I||n>=k?y(t,n):v(t,n,"0"),e.s<0?"-"+t:t)}return L.clone=e,L.ROUND_UP=0,L.ROUND_DOWN=1,L.ROUND_CEIL=2,L.ROUND_FLOOR=3,L.ROUND_HALF_UP=4,L.ROUND_HALF_DOWN=5,L.ROUND_HALF_EVEN=6,L.ROUND_HALF_CEIL=7,L.ROUND_HALF_FLOOR=8,L.EUCLID=9,L.config=L.set=function(e){var t,n;if(null!=e){if("object"==typeof e){if(e.hasOwnProperty(t="DECIMAL_PLACES")&&(m(n=e[t],0,1e9,t),C=n),e.hasOwnProperty(t="ROUNDING_MODE")&&(m(n=e[t],0,8,t),O=n),e.hasOwnProperty(t="EXPONENTIAL_AT")&&((n=e[t])&&n.pop?(m(n[0],-1e9,0,t),m(n[1],0,1e9,t),I=n[0],k=n[1]):(m(n,-1e9,1e9,t),I=-(k=n<0?-n:n))),e.hasOwnProperty(t="RANGE")){if((n=e[t])&&n.pop)m(n[0],-1e9,-1,t),m(n[1],1,1e9,t),R=n[0],N=n[1];else if(m(n,-1e9,1e9,t),n)R=-(N=n<0?-n:n);else throw Error(u+t+" cannot be zero: "+n)}if(e.hasOwnProperty(t="CRYPTO")){if(!!(n=e[t])===n){if(n){if("undefined"!=typeof crypto&&crypto&&(crypto.getRandomValues||crypto.randomBytes))P=n;else throw P=!n,Error(u+"crypto unavailable")}else P=n}else throw Error(u+t+" not true or false: "+n)}if(e.hasOwnProperty(t="MODULO_MODE")&&(m(n=e[t],0,9,t),x=n),e.hasOwnProperty(t="POW_PRECISION")&&(m(n=e[t],0,1e9,t),U=n),e.hasOwnProperty(t="FORMAT")){if("object"==typeof(n=e[t]))D=n;else throw Error(u+t+" not an object: "+n)}if(e.hasOwnProperty(t="ALPHABET")){if("string"!=typeof(n=e[t])||/^.?$|[+\-.\s]|(.).*\1/.test(n))throw Error(u+t+" invalid: "+n);j="0123456789"==n.slice(0,10),M=n}}else throw Error(u+"Object expected: "+e)}return{DECIMAL_PLACES:C,ROUNDING_MODE:O,EXPONENTIAL_AT:[I,k],RANGE:[R,N],CRYPTO:P,MODULO_MODE:x,POW_PRECISION:U,FORMAT:D,ALPHABET:M}},L.isBigNumber=function(e){if(!e||!0!==e._isBigNumber)return!1;if(!L.DEBUG)return!0;var t,n,r=e.c,i=e.e,o=e.s;e:if("[object Array]"==({}).toString.call(r)){if((1===o||-1===o)&&i>=-1e9&&i<=1e9&&i===l(i)){if(0===r[0]){if(0===i&&1===r.length)return!0;break e}if((t=(i+1)%14)<1&&(t+=14),String(r[0]).length==t){for(t=0;t<r.length;t++)if((n=r[t])<0||n>=1e14||n!==l(n))break e;if(0!==n)return!0}}}else if(null===r&&null===i&&(null===o||1===o||-1===o))return!0;throw Error(u+"Invalid BigNumber: "+e)},L.maximum=L.max=function(){return q(arguments,-1)},L.minimum=L.min=function(){return q(arguments,1)},L.random=(n=9007199254740992*Math.random()&2097151?function(){return l(9007199254740992*Math.random())}:function(){return(1073741824*Math.random()|0)*8388608+(8388608*Math.random()|0)},function(e){var t,r,i,o,s,c=0,h=[],p=new L(A);if(null==e?e=C:m(e,0,1e9),o=a(e/14),P){if(crypto.getRandomValues){for(t=crypto.getRandomValues(new Uint32Array(o*=2));c<o;)(s=131072*t[c]+(t[c+1]>>>11))>=9e15?(r=crypto.getRandomValues(new Uint32Array(2)),t[c]=r[0],t[c+1]=r[1]):(h.push(s%1e14),c+=2);c=o/2}else if(crypto.randomBytes){for(t=crypto.randomBytes(o*=7);c<o;)(s=(31&t[c])*281474976710656+1099511627776*t[c+1]+4294967296*t[c+2]+16777216*t[c+3]+(t[c+4]<<16)+(t[c+5]<<8)+t[c+6])>=9e15?crypto.randomBytes(7).copy(t,c):(h.push(s%1e14),c+=7);c=o/7}else throw P=!1,Error(u+"crypto unavailable")}if(!P)for(;c<o;)(s=n())<9e15&&(h[c++]=s%1e14);for(o=h[--c],e%=14,o&&e&&(s=d[14-e],h[c]=l(o/s)*s);0===h[c];h.pop(),c--);if(c<0)h=[i=0];else{for(i=-1;0===h[0];h.splice(0,1),i-=14);for(c=1,s=h[0];s>=10;s/=10,c++);c<14&&(i-=14-c)}return p.e=i,p.c=h,p}),L.sum=function(){for(var e=1,t=arguments,n=new L(t[0]);e<t.length;)n=n.plus(t[e++]);return n},T=function(){var e="0123456789";function t(e,t,n,r){for(var i,o,s=[0],a=0,l=e.length;a<l;){for(o=s.length;o--;s[o]*=t);for(s[0]+=r.indexOf(e.charAt(a++)),i=0;i<s.length;i++)s[i]>n-1&&(null==s[i+1]&&(s[i+1]=0),s[i+1]+=s[i]/n|0,s[i]%=n)}return s.reverse()}return function(n,r,i,o,s){var a,l,u,c,d,h,f,m,g=n.indexOf("."),y=C,_=O;for(g>=0&&(c=U,U=0,n=n.replace(".",""),h=(m=new L(r)).pow(n.length-g),U=c,m.c=t(v(p(h.c),h.e,"0"),10,i,e),m.e=m.c.length),u=c=(f=t(n,r,i,s?(a=M,e):(a=e,M))).length;0==f[--c];f.pop());if(!f[0])return a.charAt(0);if(g<0?--u:(h.c=f,h.e=u,h.s=o,f=(h=E(h,m,y,_,i)).c,d=h.r,u=h.e),g=f[l=u+y+1],c=i/2,d=d||l<0||null!=f[l+1],d=_<4?(null!=g||d)&&(0==_||_==(h.s<0?3:2)):g>c||g==c&&(4==_||d||6==_&&1&f[l-1]||_==(h.s<0?8:7)),l<1||!f[0])n=d?v(a.charAt(1),-y,a.charAt(0)):a.charAt(0);else{if(f.length=l,d)for(--i;++f[--l]>i;)f[l]=0,l||(++u,f=[1].concat(f));for(c=f.length;!f[--c];);for(g=0,n="";g<=c;n+=a.charAt(f[g++]));n=v(n,u,a.charAt(0))}return n}}(),E=function(){function e(e,t,n){var r,i,o,s,a=0,l=e.length,u=t%1e7,c=t/1e7|0;for(e=e.slice();l--;)r=c*(o=e[l]%1e7)+(s=e[l]/1e7|0)*u,a=((i=u*o+r%1e7*1e7+a)/n|0)+(r/1e7|0)+c*s,e[l]=i%n;return a&&(e=[a].concat(e)),e}function t(e,t,n,r){var i,o;if(n!=r)o=n>r?1:-1;else for(i=o=0;i<n;i++)if(e[i]!=t[i]){o=e[i]>t[i]?1:-1;break}return o}function n(e,t,n,r){for(var i=0;n--;)e[n]-=i,i=e[n]<t[n]?1:0,e[n]=i*r+e[n]-t[n];for(;!e[0]&&e.length>1;e.splice(0,1));}return function(r,i,o,s,a){var u,c,d,p,f,m,g,y,v,_,b,E,T,w,S,A,C,O=r.s==i.s?1:-1,I=r.c,k=i.c;if(!I||!I[0]||!k||!k[0])return new L(r.s&&i.s&&(I?!k||I[0]!=k[0]:k)?I&&0==I[0]||!k?0*O:O/0:NaN);for(v=(y=new L(O)).c=[],O=o+(c=r.e-i.e)+1,a||(a=1e14,c=h(r.e/14)-h(i.e/14),O=O/14|0),d=0;k[d]==(I[d]||0);d++);if(k[d]>(I[d]||0)&&c--,O<0)v.push(1),p=!0;else{for(w=I.length,A=k.length,d=0,O+=2,(f=l(a/(k[0]+1)))>1&&(k=e(k,f,a),I=e(I,f,a),A=k.length,w=I.length),T=A,b=(_=I.slice(0,A)).length;b<A;_[b++]=0);C=[0].concat(C=k.slice()),S=k[0],k[1]>=a/2&&S++;do{if(f=0,(u=t(k,_,A,b))<0){if(E=_[0],A!=b&&(E=E*a+(_[1]||0)),(f=l(E/S))>1)for(f>=a&&(f=a-1),g=(m=e(k,f,a)).length,b=_.length;1==t(m,_,g,b);)f--,n(m,A<g?C:k,g,a),g=m.length,u=1;else 0==f&&(u=f=1),g=(m=k.slice()).length;if(g<b&&(m=[0].concat(m)),n(_,m,b,a),b=_.length,-1==u)for(;1>t(k,_,A,b);)f++,n(_,A<b?C:k,b,a),b=_.length}else 0===u&&(f++,_=[0]);v[d++]=f,_[0]?_[b++]=I[T]||0:(_=[I[T]],b=1)}while((T++<w||null!=_[0])&&O--);p=null!=_[0],v[0]||v.splice(0,1)}if(1e14==a){for(d=1,O=v[0];O>=10;O/=10,d++);H(y,o+(y.e=d+14*c-1)+1,s,p)}else y.e=c,y.r=+p;return y}}(),r=/^(-?)0([xbo])(?=\w[\w.]*$)/i,i=/^([^.]+)\.$/,o=/^\.([^.]+)$/,_=/^-?(Infinity|NaN)$/,b=/^\s*\+(?=[\w.])|^\s+|\s+$/g,w=function(e,t,n,s){var a,l=n?t:t.replace(b,"");if(_.test(l))e.s=isNaN(l)?null:l<0?-1:1;else{if(!n&&(l=l.replace(r,function(e,t,n){return a="x"==(n=n.toLowerCase())?16:"b"==n?2:8,s&&s!=a?e:t}),s&&(a=s,l=l.replace(i,"$1").replace(o,"0.$1")),t!=l))return new L(l,a);if(L.DEBUG)throw Error(u+"Not a"+(s?" base "+s:"")+" number: "+t);e.s=null}e.c=e.e=null},S.absoluteValue=S.abs=function(){var e=new L(this);return e.s<0&&(e.s=1),e},S.comparedTo=function(e,t){return f(this,new L(e,t))},S.decimalPlaces=S.dp=function(e,t){var n,r,i;if(null!=e)return m(e,0,1e9),null==t?t=O:m(t,0,8),H(new L(this),e+this.e+1,t);if(!(n=this.c))return null;if(r=((i=n.length-1)-h(this.e/14))*14,i=n[i])for(;i%10==0;i/=10,r--);return r<0&&(r=0),r},S.dividedBy=S.div=function(e,t){return E(this,new L(e,t),C,O)},S.dividedToIntegerBy=S.idiv=function(e,t){return E(this,new L(e,t),0,1)},S.exponentiatedBy=S.pow=function(e,t){var n,r,i,o,s,c,d,h,p,f=this;if((e=new L(e)).c&&!e.isInteger())throw Error(u+"Exponent not an integer: "+B(e));if(null!=t&&(t=new L(t)),c=e.e>14,!f.c||!f.c[0]||1==f.c[0]&&!f.e&&1==f.c.length||!e.c||!e.c[0])return p=new L(Math.pow(+B(f),c?e.s*(2-g(e)):+B(e))),t?p.mod(t):p;if(d=e.s<0,t){if(t.c?!t.c[0]:!t.s)return new L(NaN);(r=!d&&f.isInteger()&&t.isInteger())&&(f=f.mod(t))}else{if(e.e>9&&(f.e>0||f.e<-1||(0==f.e?f.c[0]>1||c&&f.c[1]>=24e7:f.c[0]<8e13||c&&f.c[0]<=9999975e7)))return o=f.s<0&&g(e)?-0:0,f.e>-1&&(o=1/o),new L(d?1/o:o);U&&(o=a(U/14+2))}for(c?(n=new L(.5),d&&(e.s=1),h=g(e)):h=(i=Math.abs(+B(e)))%2,p=new L(A);;){if(h){if(!(p=p.times(f)).c)break;o?p.c.length>o&&(p.c.length=o):r&&(p=p.mod(t))}if(i){if(0===(i=l(i/2)))break;h=i%2}else if(H(e=e.times(n),e.e+1,1),e.e>14)h=g(e);else{if(0==(i=+B(e)))break;h=i%2}f=f.times(f),o?f.c&&f.c.length>o&&(f.c.length=o):r&&(f=f.mod(t))}return r?p:(d&&(p=A.div(p)),t?p.mod(t):o?H(p,U,O,s):p)},S.integerValue=function(e){var t=new L(this);return null==e?e=O:m(e,0,8),H(t,t.e+1,e)},S.isEqualTo=S.eq=function(e,t){return 0===f(this,new L(e,t))},S.isFinite=function(){return!!this.c},S.isGreaterThan=S.gt=function(e,t){return f(this,new L(e,t))>0},S.isGreaterThanOrEqualTo=S.gte=function(e,t){return 1===(t=f(this,new L(e,t)))||0===t},S.isInteger=function(){return!!this.c&&h(this.e/14)>this.c.length-2},S.isLessThan=S.lt=function(e,t){return 0>f(this,new L(e,t))},S.isLessThanOrEqualTo=S.lte=function(e,t){return -1===(t=f(this,new L(e,t)))||0===t},S.isNaN=function(){return!this.s},S.isNegative=function(){return this.s<0},S.isPositive=function(){return this.s>0},S.isZero=function(){return!!this.c&&0==this.c[0]},S.minus=function(e,t){var n,r,i,o,s=this.s;if(t=(e=new L(e,t)).s,!s||!t)return new L(NaN);if(s!=t)return e.s=-t,this.plus(e);var a=this.e/14,l=e.e/14,u=this.c,c=e.c;if(!a||!l){if(!u||!c)return u?(e.s=-t,e):new L(c?this:NaN);if(!u[0]||!c[0])return c[0]?(e.s=-t,e):new L(u[0]?this:3==O?-0:0)}if(a=h(a),l=h(l),u=u.slice(),s=a-l){for((o=s<0)?(s=-s,i=u):(l=a,i=c),i.reverse(),t=s;t--;i.push(0));i.reverse()}else for(r=(o=(s=u.length)<(t=c.length))?s:t,s=t=0;t<r;t++)if(u[t]!=c[t]){o=u[t]<c[t];break}if(o&&(i=u,u=c,c=i,e.s=-e.s),(t=(r=c.length)-(n=u.length))>0)for(;t--;u[n++]=0);for(t=1e14-1;r>s;){if(u[--r]<c[r]){for(n=r;n&&!u[--n];u[n]=t);--u[n],u[r]+=1e14}u[r]-=c[r]}for(;0==u[0];u.splice(0,1),--l);return u[0]?F(e,u,l):(e.s=3==O?-1:1,e.c=[e.e=0],e)},S.modulo=S.mod=function(e,t){var n,r;return(e=new L(e,t),this.c&&e.s&&(!e.c||e.c[0]))?e.c&&(!this.c||this.c[0])?(9==x?(r=e.s,e.s=1,n=E(this,e,0,3),e.s=r,n.s*=r):n=E(this,e,0,x),(e=this.minus(n.times(e))).c[0]||1!=x||(e.s=this.s),e):new L(this):new L(NaN)},S.multipliedBy=S.times=function(e,t){var n,r,i,o,s,a,l,u,c,d,p,f,m,g=this.c,y=(e=new L(e,t)).c;if(!g||!y||!g[0]||!y[0])return this.s&&e.s&&(!g||g[0]||y)&&(!y||y[0]||g)?(e.s*=this.s,g&&y?(e.c=[0],e.e=0):e.c=e.e=null):e.c=e.e=e.s=null,e;for(r=h(this.e/14)+h(e.e/14),e.s*=this.s,(l=g.length)<(d=y.length)&&(m=g,g=y,y=m,i=l,l=d,d=i),i=l+d,m=[];i--;m.push(0));for(i=d;--i>=0;){for(n=0,p=y[i]%1e7,f=y[i]/1e7|0,o=i+(s=l);o>i;)a=f*(u=g[--s]%1e7)+(c=g[s]/1e7|0)*p,n=((u=p*u+a%1e7*1e7+m[o]+n)/1e14|0)+(a/1e7|0)+f*c,m[o--]=u%1e14;m[o]=n}return n?++r:m.splice(0,1),F(e,m,r)},S.negated=function(){var e=new L(this);return e.s=-e.s||null,e},S.plus=function(e,t){var n,r=this.s;if(t=(e=new L(e,t)).s,!r||!t)return new L(NaN);if(r!=t)return e.s=-t,this.minus(e);var i=this.e/14,o=e.e/14,s=this.c,a=e.c;if(!i||!o){if(!s||!a)return new L(r/0);if(!s[0]||!a[0])return a[0]?e:new L(s[0]?this:0*r)}if(i=h(i),o=h(o),s=s.slice(),r=i-o){for(r>0?(o=i,n=a):(r=-r,n=s),n.reverse();r--;n.push(0));n.reverse()}for((r=s.length)-(t=a.length)<0&&(n=a,a=s,s=n,t=r),r=0;t;)r=(s[--t]=s[t]+a[t]+r)/1e14|0,s[t]=1e14===s[t]?0:s[t]%1e14;return r&&(s=[r].concat(s),++o),F(e,s,o)},S.precision=S.sd=function(e,t){var n,r,i;if(null!=e&&!!e!==e)return m(e,1,1e9),null==t?t=O:m(t,0,8),H(new L(this),e,t);if(!(n=this.c))return null;if(r=14*(i=n.length-1)+1,i=n[i]){for(;i%10==0;i/=10,r--);for(i=n[0];i>=10;i/=10,r++);}return e&&this.e+1>r&&(r=this.e+1),r},S.shiftedBy=function(e){return m(e,-9007199254740991,9007199254740991),this.times("1e"+e)},S.squareRoot=S.sqrt=function(){var e,t,n,r,i,o=this.c,s=this.s,a=this.e,l=C+4,u=new L("0.5");if(1!==s||!o||!o[0])return new L(!s||s<0&&(!o||o[0])?NaN:o?this:1/0);if(0==(s=Math.sqrt(+B(this)))||s==1/0?(((t=p(o)).length+a)%2==0&&(t+="0"),s=Math.sqrt(+t),a=h((a+1)/2)-(a<0||a%2),n=new L(t=s==1/0?"5e"+a:(t=s.toExponential()).slice(0,t.indexOf("e")+1)+a)):n=new L(s+""),n.c[0]){for((s=(a=n.e)+l)<3&&(s=0);;)if(i=n,n=u.times(i.plus(E(this,i,l,1))),p(i.c).slice(0,s)===(t=p(n.c)).slice(0,s)){if(n.e<a&&--s,"9999"!=(t=t.slice(s-3,s+1))&&(r||"4999"!=t)){+t&&(+t.slice(1)||"5"!=t.charAt(0))||(H(n,n.e+C+2,1),e=!n.times(n).eq(this));break}if(!r&&(H(i,i.e+C+2,0),i.times(i).eq(this))){n=i;break}l+=4,s+=4,r=1}}return H(n,n.e+C+1,O,e)},S.toExponential=function(e,t){return null!=e&&(m(e,0,1e9),e++),G(this,e,t,1)},S.toFixed=function(e,t){return null!=e&&(m(e,0,1e9),e=e+this.e+1),G(this,e,t)},S.toFormat=function(e,t,n){var r;if(null==n)null!=e&&t&&"object"==typeof t?(n=t,t=null):e&&"object"==typeof e?(n=e,e=t=null):n=D;else if("object"!=typeof n)throw Error(u+"Argument not an object: "+n);if(r=this.toFixed(e,t),this.c){var i,o=r.split("."),s=+n.groupSize,a=+n.secondaryGroupSize,l=n.groupSeparator||"",c=o[0],d=o[1],h=this.s<0,p=h?c.slice(1):c,f=p.length;if(a&&(i=s,s=a,a=i,f-=i),s>0&&f>0){for(i=f%s||s,c=p.substr(0,i);i<f;i+=s)c+=l+p.substr(i,s);a>0&&(c+=l+p.slice(i)),h&&(c="-"+c)}r=d?c+(n.decimalSeparator||"")+((a=+n.fractionGroupSize)?d.replace(RegExp("\\d{"+a+"}\\B","g"),"$&"+(n.fractionGroupSeparator||"")):d):c}return(n.prefix||"")+r+(n.suffix||"")},S.toFraction=function(e){var t,n,r,i,o,s,a,l,c,h,f,m,g=this.c;if(null!=e&&(!(a=new L(e)).isInteger()&&(a.c||1!==a.s)||a.lt(A)))throw Error(u+"Argument "+(a.isInteger()?"out of range: ":"not an integer: ")+B(a));if(!g)return new L(this);for(t=new L(A),c=n=new L(A),r=l=new L(A),m=p(g),o=t.e=m.length-this.e-1,t.c[0]=d[(s=o%14)<0?14+s:s],e=!e||a.comparedTo(t)>0?o>0?t:c:a,s=N,N=1/0,a=new L(m),l.c[0]=0;h=E(a,t,0,1),1!=(i=n.plus(h.times(r))).comparedTo(e);)n=r,r=i,c=l.plus(h.times(i=c)),l=i,t=a.minus(h.times(i=t)),a=i;return i=E(e.minus(n),r,0,1),l=l.plus(i.times(c)),n=n.plus(i.times(r)),l.s=c.s=this.s,o*=2,f=1>E(c,r,o,O).minus(this).abs().comparedTo(E(l,n,o,O).minus(this).abs())?[c,r]:[l,n],N=s,f},S.toNumber=function(){return+B(this)},S.toPrecision=function(e,t){return null!=e&&m(e,1,1e9),G(this,e,t,2)},S.toString=function(e){var t,n=this,r=n.s,i=n.e;return null===i?r?(t="Infinity",r<0&&(t="-"+t)):t="NaN":(null==e?t=i<=I||i>=k?y(p(n.c),i):v(p(n.c),i,"0"):10===e&&j?t=v(p((n=H(new L(n),C+i+1,O)).c),n.e,"0"):(m(e,2,M.length,"Base"),t=T(v(p(n.c),i,"0"),10,e,r,!0)),r<0&&n.c[0]&&(t="-"+t)),t},S.valueOf=S.toJSON=function(){return B(this)},S._isBigNumber=!0,null!=t&&L.set(t),L}()).default=o.BigNumber=o,void 0!==(r=(function(){return o}).call(t,n,t,e))&&(e.exports=r)}(0)},9121:(e,t,n)=>{"use strict";var r=n(8893).Buffer,i=n(8893).SlowBuffer;function o(e,t){if(!r.isBuffer(e)||!r.isBuffer(t)||e.length!==t.length)return!1;for(var n=0,i=0;i<e.length;i++)n|=e[i]^t[i];return 0===n}e.exports=o,o.install=function(){r.prototype.equal=i.prototype.equal=function(e){return o(this,e)}};var s=r.prototype.equal,a=i.prototype.equal;o.restore=function(){r.prototype.equal=s,i.prototype.equal=a}},7145:(e,t,n)=>{"use strict";var r=n(8243).Buffer,i=n(1457);function o(e){if(r.isBuffer(e))return e;if("string"==typeof e)return r.from(e,"base64");throw TypeError("ECDSA signature must be a Base64 string or a Buffer")}function s(e,t,n){for(var r=0;t+r<n&&0===e[t+r];)++r;return e[t+r]>=128&&--r,r}e.exports={derToJose:function(e,t){e=o(e);var n=i(t),s=n+1,a=e.length,l=0;if(48!==e[l++])throw Error('Could not find expected "seq"');var u=e[l++];if(129===u&&(u=e[l++]),a-l<u)throw Error('"seq" specified length of "'+u+'", only "'+(a-l)+'" remaining');if(2!==e[l++])throw Error('Could not find expected "int" for "r"');var c=e[l++];if(a-l-2<c)throw Error('"r" specified length of "'+c+'", only "'+(a-l-2)+'" available');if(s<c)throw Error('"r" specified length of "'+c+'", max of "'+s+'" is acceptable');var d=l;if(l+=c,2!==e[l++])throw Error('Could not find expected "int" for "s"');var h=e[l++];if(a-l!==h)throw Error('"s" specified length of "'+h+'", expected "'+(a-l)+'"');if(s<h)throw Error('"s" specified length of "'+h+'", max of "'+s+'" is acceptable');var p=l;if((l+=h)!==a)throw Error('Expected to consume entire buffer, but "'+(a-l)+'" bytes remain');var f=n-c,m=n-h,g=r.allocUnsafe(f+c+m+h);for(l=0;l<f;++l)g[l]=0;e.copy(g,l,d+Math.max(-f,0),d+c),l=n;for(var y=l;l<y+m;++l)g[l]=0;return e.copy(g,l,p+Math.max(-m,0),p+h),g=(g=g.toString("base64")).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")},joseToDer:function(e,t){e=o(e);var n=i(t),a=e.length;if(a!==2*n)throw TypeError('"'+t+'" signatures must be "'+2*n+'" bytes, saw "'+a+'"');var l=s(e,0,n),u=s(e,n,e.length),c=n-l,d=n-u,h=2+c+1+1+d,p=h<128,f=r.allocUnsafe((p?2:3)+h),m=0;return f[m++]=48,p?f[m++]=h:(f[m++]=129,f[m++]=255&h),f[m++]=2,f[m++]=c,l<0?(f[m++]=0,m+=e.copy(f,m,0,n)):m+=e.copy(f,m,l,n),f[m++]=2,f[m++]=d,u<0?(f[m++]=0,e.copy(f,m,n)):e.copy(f,m,n+u),f}}},1457:e=>{"use strict";function t(e){return(e/8|0)+(e%8==0?0:1)}var n={ES256:t(256),ES384:t(384),ES512:t(521)};e.exports=function(e){var t=n[e];if(t)return t;throw Error('Unknown algorithm "'+e+'"')}},9675:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n=Object.prototype.toString,r=Object.defineProperty,i=Object.getOwnPropertyDescriptor,o=function(e){return"function"==typeof Array.isArray?Array.isArray(e):"[object Array]"===n.call(e)},s=function(e){if(!e||"[object Object]"!==n.call(e))return!1;var r,i=t.call(e,"constructor"),o=e.constructor&&e.constructor.prototype&&t.call(e.constructor.prototype,"isPrototypeOf");if(e.constructor&&!i&&!o)return!1;for(r in e);return void 0===r||t.call(e,r)},a=function(e,t){r&&"__proto__"===t.name?r(e,t.name,{enumerable:!0,configurable:!0,value:t.newValue,writable:!0}):e[t.name]=t.newValue},l=function(e,n){if("__proto__"===n){if(!t.call(e,n))return;if(i)return i(e,n).value}return e[n]};e.exports=function e(){var t,n,r,i,u,c,d=arguments[0],h=1,p=arguments.length,f=!1;for("boolean"==typeof d&&(f=d,d=arguments[1]||{},h=2),(null==d||"object"!=typeof d&&"function"!=typeof d)&&(d={});h<p;++h)if(t=arguments[h],null!=t)for(n in t)r=l(d,n),d!==(i=l(t,n))&&(f&&i&&(s(i)||(u=o(i)))?(u?(u=!1,c=r&&o(r)?r:[]):c=r&&s(r)?r:{},a(d,{name:n,newValue:e(f,c,i)})):void 0!==i&&a(d,{name:n,newValue:i}));return d}},1328:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.GaxiosError=t.GAXIOS_ERROR_SYMBOL=void 0,t.defaultErrorRedactor=function e(t){let n="<<REDACTED> - See `errorRedactor` option in `gaxios` for configuration>.";function r(e){e&&e.forEach((t,r)=>{(/^authentication$/i.test(r)||/^authorization$/i.test(r)||/secret/i.test(r))&&e.set(r,n)})}function i(e,t){if("object"==typeof e&&null!==e&&"string"==typeof e[t]){let r=e[t];(/grant_type=/i.test(r)||/assertion=/i.test(r)||/secret/i.test(r))&&(e[t]=n)}}function o(e){e&&"object"==typeof e&&(e instanceof FormData||e instanceof URLSearchParams||"forEach"in e&&"set"in e?e.forEach((t,r)=>{(["grant_type","assertion"].includes(r)||/secret/.test(r))&&e.set(r,n)}):("grant_type"in e&&(e.grant_type=n),"assertion"in e&&(e.assertion=n),"client_secret"in e&&(e.client_secret=n)))}return t.config&&(r(t.config.headers),i(t.config,"data"),o(t.config.data),i(t.config,"body"),o(t.config.body),t.config.url.searchParams.has("token")&&t.config.url.searchParams.set("token",n),t.config.url.searchParams.has("client_secret")&&t.config.url.searchParams.set("client_secret",n)),t.response&&(e({config:t.response.config}),r(t.response.headers),t.response.bodyUsed&&(i(t.response,"data"),o(t.response.data))),t};let i=r(n(9675)),o=r(n(622)).default.pkg;t.GAXIOS_ERROR_SYMBOL=Symbol.for(`${o.name}-gaxios-error`);class s extends Error{config;response;code;status;error;[t.GAXIOS_ERROR_SYMBOL]=o.version;static[Symbol.hasInstance](e){return!!e&&"object"==typeof e&&t.GAXIOS_ERROR_SYMBOL in e&&e[t.GAXIOS_ERROR_SYMBOL]===o.version||Function.prototype[Symbol.hasInstance].call(s,e)}constructor(e,t,n,r){if(super(e,{cause:r}),this.config=t,this.response=n,this.error=r instanceof Error?r:void 0,this.config=(0,i.default)(!0,{},t),this.response&&(this.response.config=(0,i.default)(!0,{},this.response.config)),this.response){try{this.response.data=function(e,t){switch(e){case"stream":default:return t;case"json":return JSON.parse(JSON.stringify(t));case"arraybuffer":return JSON.parse(Buffer.from(t).toString("utf8"));case"blob":return JSON.parse(t.text())}}(this.config.responseType,this.response?.bodyUsed?this.response?.data:void 0)}catch{}this.status=this.response.status}r instanceof DOMException?this.code=r.name:r&&"object"==typeof r&&"code"in r&&("string"==typeof r.code||"number"==typeof r.code)&&(this.code=r.code)}static extractAPIErrorFromResponse(e,t="The request failed"){let n=t;if("string"==typeof e.data&&(n=e.data),e.data&&"object"==typeof e.data&&"error"in e.data&&e.data.error&&!e.ok){if("string"==typeof e.data.error)return{message:e.data.error,code:e.status,status:e.statusText};if("object"==typeof e.data.error){n="message"in e.data.error&&"string"==typeof e.data.error.message?e.data.error.message:n;let t="status"in e.data.error&&"string"==typeof e.data.error.status?e.data.error.status:e.statusText,r="code"in e.data.error&&"number"==typeof e.data.error.code?e.data.error.code:e.status;if("errors"in e.data.error&&Array.isArray(e.data.error.errors)){let i=[];for(let t of e.data.error.errors)"object"==typeof t&&"message"in t&&"string"==typeof t.message&&i.push(t.message);return Object.assign({message:i.join("\n")||n,code:r,status:t},e.data.error)}return Object.assign({message:n,code:r,status:t},e.data.error)}}return{message:n,code:e.status,status:e.statusText}}}t.GaxiosError=s},1957:function(e,t,n){"use strict";var r,i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Gaxios=void 0;let o=i(n(9675)),s=n(8791),a=n(1328),l=n(3017),u=n(6162),c=n(7845),d=async()=>globalThis.crypto?.randomUUID()||(await Promise.resolve().then(n.t.bind(n,4770,23))).randomUUID();class h{agentCache=new Map;defaults;interceptors;constructor(e){this.defaults=e||{},this.interceptors={request:new c.GaxiosInterceptorManager,response:new c.GaxiosInterceptorManager}}fetch(...e){let t;let n=e[0],i=e[1],o=new Headers;return("string"==typeof n?t=new URL(n):n instanceof URL?t=n:n&&n.url&&(t=new URL(n.url)),n&&"object"==typeof n&&"headers"in n&&r.mergeHeaders(o,n.headers),i&&r.mergeHeaders(o,new Headers(i.headers)),"object"!=typeof n||n instanceof URL)?this.request({...i,headers:o,url:t}):this.request({...i,...n,headers:o,url:t})}async request(e={}){let t=await this.#e(e);return t=await this.#t(t),this.#n(this._request(t))}async _defaultAdapter(e){let t=e.fetchImplementation||this.defaults.fetchImplementation||await r.#r(),n={...e};delete n.data;let i=await t(e.url,n),o=await this.getResponseData(e,i);return Object.getOwnPropertyDescriptor(i,"data")?.configurable||Object.defineProperties(i,{data:{configurable:!0,writable:!0,enumerable:!0,value:o}}),Object.assign(i,{config:e,data:o})}async _request(e){try{let t;if(t=e.adapter?await e.adapter(e,this._defaultAdapter.bind(this)):await this._defaultAdapter(e),!e.validateStatus(t.status)){if("stream"===e.responseType){let e=[];for await(let n of t.data)e.push(n);t.data=e.toString()}let n=a.GaxiosError.extractAPIErrorFromResponse(t,`Request failed with status code ${t.status}`);throw new a.GaxiosError(n?.message,e,t,n)}return t}catch(i){let t;t=i instanceof a.GaxiosError?i:i instanceof Error?new a.GaxiosError(i.message,e,void 0,i):new a.GaxiosError("Unexpected Gaxios Error",e,void 0,i);let{shouldRetry:n,config:r}=await (0,l.getRetryConfig)(t);if(n&&r)return t.config.retryConfig.currentRetryAttempt=r.retryConfig.currentRetryAttempt,e.retryConfig=t.config?.retryConfig,this.#i(e),this._request(e);throw e.errorRedactor&&e.errorRedactor(t),t}}async getResponseData(e,t){if(204===t.status)return"";if(e.maxContentLength&&t.headers.has("content-length")&&e.maxContentLength<Number.parseInt(t.headers?.get("content-length")||""))throw new a.GaxiosError("Response's `Content-Length` is over the limit.",e,Object.assign(t,{config:e}));switch(e.responseType){case"stream":return t.body;case"json":{let e=await t.text();try{return JSON.parse(e)}catch{return e}}case"arraybuffer":return t.arrayBuffer();case"blob":return t.blob();case"text":return t.text();default:return this.getResponseDataFromContentType(t)}}#o(e,t=[]){let n=new URL(e),r=[...t];for(let e of(process.env.NO_PROXY??process.env.no_proxy)?.split(",")||[])r.push(e.trim());for(let e of r)if(e instanceof RegExp){if(e.test(n.toString()))return!1}else if(e instanceof URL){if(e.origin===n.origin)return!1}else if(e.startsWith("*.")||e.startsWith(".")){let t=e.replace(/^\*\./,".");if(n.hostname.endsWith(t))return!1}else if(e===n.origin||e===n.hostname||e===n.href)return!1;return!0}async #t(e){let t=Promise.resolve(e);for(let e of this.interceptors.request.values())e&&(t=t.then(e.resolved,e.rejected));return t}async #n(e){let t=Promise.resolve(e);for(let e of this.interceptors.response.values())e&&(t=t.then(e.resolved,e.rejected));return t}async #e(e){let t=new Headers(this.defaults.headers);r.mergeHeaders(t,e.headers);let n=(0,o.default)(!0,{},this.defaults,e);if(!n.url)throw Error("URL is required.");if(n.baseURL&&(n.url=new URL(n.url,n.baseURL)),n.url=new URL(n.url),n.params){if(n.paramsSerializer){let e=n.paramsSerializer(n.params);e.startsWith("?")&&(e=e.slice(1));let t=n.url.toString().includes("?")?"&":"?";n.url=n.url+t+e}else{let e=n.url instanceof URL?n.url:new URL(n.url);for(let[t,r]of new URLSearchParams(n.params))e.searchParams.append(t,r);n.url=e}}"number"==typeof e.maxContentLength&&(n.size=e.maxContentLength),"number"==typeof e.maxRedirects&&(n.follow=e.maxRedirects);let i="string"==typeof n.data||n.data instanceof ArrayBuffer||n.data instanceof Blob||globalThis.File&&n.data instanceof File||n.data instanceof FormData||n.data instanceof u.Readable||n.data instanceof ReadableStream||n.data instanceof String||n.data instanceof URLSearchParams||ArrayBuffer.isView(n.data)||["Blob","File","FormData"].includes(n.data?.constructor?.name||"");if(n.multipart?.length){let e=await d();t.set("content-type",`multipart/related; boundary=${e}`),n.body=u.Readable.from(this.getMultipartRequest(n.multipart,e))}else i?n.body=n.data:"object"==typeof n.data?"application/x-www-form-urlencoded"===t.get("Content-Type")?n.body=n.paramsSerializer?n.paramsSerializer(n.data):new URLSearchParams(n.data):(t.has("content-type")||t.set("content-type","application/json"),n.body=JSON.stringify(n.data)):n.data&&(n.body=n.data);n.validateStatus=n.validateStatus||this.validateStatus,n.responseType=n.responseType||"unknown",t.has("accept")||"json"!==n.responseType||t.set("accept","application/json");let l=n.proxy||process?.env?.HTTPS_PROXY||process?.env?.https_proxy||process?.env?.HTTP_PROXY||process?.env?.http_proxy;if(n.agent);else if(l&&this.#o(n.url,n.noProxy)){let e=await r.#s();this.agentCache.has(l)?n.agent=this.agentCache.get(l):(n.agent=new e(l,{cert:n.cert,key:n.key}),this.agentCache.set(l,n.agent))}else n.cert&&n.key&&(this.agentCache.has(n.key)?n.agent=this.agentCache.get(n.key):(n.agent=new s.Agent({cert:n.cert,key:n.key}),this.agentCache.set(n.key,n.agent)));return"function"!=typeof n.errorRedactor&&!1!==n.errorRedactor&&(n.errorRedactor=a.defaultErrorRedactor),!n.body||"duplex"in n||(n.duplex="half"),this.#i(n),Object.assign(n,{headers:t,url:n.url instanceof URL?n.url:new URL(n.url)})}#i(e){if(e.timeout){let t=AbortSignal.timeout(e.timeout);e.signal&&!e.signal.aborted?e.signal=AbortSignal.any([e.signal,t]):e.signal=t}}validateStatus(e){return e>=200&&e<300}async getResponseDataFromContentType(e){let t=e.headers.get("Content-Type");if(null===t)return e.text();if((t=t.toLowerCase()).includes("application/json")){let t=await e.text();try{t=JSON.parse(t)}catch{}return t}return t.match(/^text\//)?e.text():e.blob()}async *getMultipartRequest(e,t){let n=`--${t}--`;for(let n of e){let e=n.headers.get("Content-Type")||"application/octet-stream",r=`--${t}\r
Content-Type: ${e}\r
\r
`;yield r,"string"==typeof n.content?yield n.content:yield*n.content,yield"\r\n"}yield n}static #a;static #l;static async #s(){return this.#a||=(await n.e(453).then(n.t.bind(n,5453,23))).HttpsProxyAgent,this.#a}static async #r(){let e="undefined"!=typeof window&&!!window;return this.#l||=e?window.fetch:(await n.e(550).then(n.bind(n,550))).default,this.#l}static mergeHeaders(e,...t){for(let n of(e=e instanceof Headers?e:new Headers(e),t))(n instanceof Headers?n:new Headers(n)).forEach((t,n)=>{"set-cookie"===n?e.append(n,t):e.set(n,t)});return e}}t.Gaxios=h,r=h},5678:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.instance=t.Gaxios=t.GaxiosError=void 0,t.request=a;let o=n(1957);Object.defineProperty(t,"Gaxios",{enumerable:!0,get:function(){return o.Gaxios}});var s=n(1328);async function a(e){return t.instance.request(e)}Object.defineProperty(t,"GaxiosError",{enumerable:!0,get:function(){return s.GaxiosError}}),i(n(7845),t),t.instance=new o.Gaxios},7845:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GaxiosInterceptorManager=void 0;class n extends Set{}t.GaxiosInterceptorManager=n},3017:(e,t)=>{"use strict";async function n(e){var t;let n=i(e);if(!e||!e.config||!n&&!e.config.retry)return{shouldRetry:!1};(n=n||{}).currentRetryAttempt=n.currentRetryAttempt||0,n.retry=void 0===n.retry||null===n.retry?3:n.retry,n.httpMethodsToRetry=n.httpMethodsToRetry||["GET","HEAD","PUT","OPTIONS","DELETE"],n.noResponseRetries=void 0===n.noResponseRetries||null===n.noResponseRetries?2:n.noResponseRetries,n.retryDelayMultiplier=n.retryDelayMultiplier?n.retryDelayMultiplier:2,n.timeOfFirstRequest=n.timeOfFirstRequest?n.timeOfFirstRequest:Date.now(),n.totalTimeout=n.totalTimeout?n.totalTimeout:Number.MAX_SAFE_INTEGER,n.maxRetryDelay=n.maxRetryDelay?n.maxRetryDelay:Number.MAX_SAFE_INTEGER,n.statusCodesToRetry=n.statusCodesToRetry||[[100,199],[408,408],[429,429],[500,599]],e.config.retryConfig=n;let o=n.shouldRetry||r;if(!await o(e))return{shouldRetry:!1,config:e.config};let s=Math.min(((t=n).currentRetryAttempt?0:t.retryDelay??100)+(Math.pow(t.retryDelayMultiplier,t.currentRetryAttempt)-1)/2*1e3,t.totalTimeout-(Date.now()-t.timeOfFirstRequest),t.maxRetryDelay);e.config.retryConfig.currentRetryAttempt+=1;let a=n.retryBackoff?n.retryBackoff(e,s):new Promise(e=>{setTimeout(e,s)});return n.onRetryAttempt&&await n.onRetryAttempt(e),await a,{shouldRetry:!0,config:e.config}}function r(e){let t=i(e);if(e.config.signal?.aborted&&"TimeoutError"!==e.code||"AbortError"===e.code||!t||0===t.retry||!e.response&&(t.currentRetryAttempt||0)>=t.noResponseRetries||!t.httpMethodsToRetry||!t.httpMethodsToRetry.includes(e.config.method?.toUpperCase()||"GET"))return!1;if(e.response&&e.response.status){let n=!1;for(let[r,i]of t.statusCodesToRetry){let t=e.response.status;if(t>=r&&t<=i){n=!0;break}}if(!n)return!1}return t.currentRetryAttempt=t.currentRetryAttempt||0,!(t.currentRetryAttempt>=t.retry)}function i(e){if(e&&e.config&&e.config.retryConfig)return e.config.retryConfig}Object.defineProperty(t,"__esModule",{value:!0}),t.getRetryConfig=n},4987:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AuthClient=t.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=t.DEFAULT_UNIVERSE=void 0;let r=n(7702),i=n(5678),o=n(1118),s=n(3340),a=n(9662);t.DEFAULT_UNIVERSE="googleapis.com",t.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS=3e5;class l extends r.EventEmitter{apiKey;projectId;quotaProjectId;transporter;credentials={};eagerRefreshThresholdMillis=t.DEFAULT_EAGER_REFRESH_THRESHOLD_MILLIS;forceRefreshOnFailure=!1;universeDomain=t.DEFAULT_UNIVERSE;static RequestMethodNameSymbol=Symbol("request method name");static RequestLogIdSymbol=Symbol("request log id");constructor(e={}){super();let n=(0,o.originalOrCamelOptions)(e);this.apiKey=e.apiKey,this.projectId=n.get("project_id")??null,this.quotaProjectId=n.get("quota_project_id"),this.credentials=n.get("credentials")??{},this.universeDomain=n.get("universe_domain")??t.DEFAULT_UNIVERSE,this.transporter=e.transporter??new i.Gaxios(e.transporterOptions),!1!==n.get("useAuthRequestParameters")&&(this.transporter.interceptors.request.add(l.DEFAULT_REQUEST_INTERCEPTOR),this.transporter.interceptors.response.add(l.DEFAULT_RESPONSE_INTERCEPTOR)),e.eagerRefreshThresholdMillis&&(this.eagerRefreshThresholdMillis=e.eagerRefreshThresholdMillis),this.forceRefreshOnFailure=e.forceRefreshOnFailure??!1}fetch(...e){let t;let n=e[0],r=e[1],o=new Headers;return("string"==typeof n?t=new URL(n):n instanceof URL?t=n:n&&n.url&&(t=new URL(n.url)),n&&"object"==typeof n&&"headers"in n&&i.Gaxios.mergeHeaders(o,n.headers),r&&i.Gaxios.mergeHeaders(o,new Headers(r.headers)),"object"!=typeof n||n instanceof URL)?this.request({...r,headers:o,url:t}):this.request({...r,...n,headers:o,url:t})}setCredentials(e){this.credentials=e}addSharedMetadataHeaders(e){return!e.has("x-goog-user-project")&&this.quotaProjectId&&e.set("x-goog-user-project",this.quotaProjectId),e}addUserProjectAndAuthHeaders(e,t){let n=t.get("x-goog-user-project"),r=t.get("authorization");return n&&e.set("x-goog-user-project",n),r&&e.set("authorization",r),e}static log=(0,s.log)("auth");static DEFAULT_REQUEST_INTERCEPTOR={resolved:async e=>{if(!e.headers.has("x-goog-api-client")){let t=process.version.replace(/^v/,"");e.headers.set("x-goog-api-client",`gl-node/${t}`)}let t=e.headers.get("User-Agent");t?t.includes(`${a.PRODUCT_NAME}/`)||e.headers.set("User-Agent",`${t} ${a.USER_AGENT}`):e.headers.set("User-Agent",a.USER_AGENT);try{let t=e[l.RequestMethodNameSymbol],n=`${Math.floor(1e3*Math.random())}`;e[l.RequestLogIdSymbol]=n;let r={url:e.url,headers:e.headers};t?l.log.info("%s [%s] request %j",t,n,r):l.log.info("[%s] request %j",n,r)}catch(e){}return e}};static DEFAULT_RESPONSE_INTERCEPTOR={resolved:async e=>{try{let t=e.config,n=t[l.RequestMethodNameSymbol],r=t[l.RequestLogIdSymbol];n?l.log.info("%s [%s] response %j",n,r,e.data):l.log.info("[%s] response %j",r,e.data)}catch(e){}return e},rejected:async e=>{try{let t=e.config,n=t[l.RequestMethodNameSymbol],r=t[l.RequestLogIdSymbol];n?l.log.info("%s [%s] error %j",n,r,e.response?.data):l.log.error("[%s] error %j",r,e.response?.data)}catch(e){}throw e}};static setMethodName(e,t){try{e[l.RequestMethodNameSymbol]=t}catch(e){}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}}t.AuthClient=l},659:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AwsClient=void 0;let r=n(203),i=n(7116),o=n(8454),s=n(1118),a=n(5678);class l extends i.BaseExternalAccountClient{environmentId;awsSecurityCredentialsSupplier;regionalCredVerificationUrl;awsRequestSigner;region;static #u="https://sts.{region}.amazonaws.com?Action=GetCallerIdentity&Version=2011-06-15";static AWS_EC2_METADATA_IPV4_ADDRESS="169.254.169.254";static AWS_EC2_METADATA_IPV6_ADDRESS="fd00:ec2::254";constructor(e){super(e);let t=(0,s.originalOrCamelOptions)(e),n=t.get("credential_source"),r=t.get("aws_security_credentials_supplier");if(!n&&!r)throw Error("A credential source or AWS security credentials supplier must be specified.");if(n&&r)throw Error("Only one of credential source or AWS security credentials supplier can be specified.");if(r)this.awsSecurityCredentialsSupplier=r,this.regionalCredVerificationUrl=l.#u,this.credentialSourceType="programmatic";else{let e=(0,s.originalOrCamelOptions)(n);this.environmentId=e.get("environment_id");let t=e.get("region_url"),r=e.get("url"),i=e.get("imdsv2_session_token_url");this.awsSecurityCredentialsSupplier=new o.DefaultAwsSecurityCredentialsSupplier({regionUrl:t,securityCredentialsUrl:r,imdsV2SessionTokenUrl:i}),this.regionalCredVerificationUrl=e.get("regional_cred_verification_url"),this.credentialSourceType="aws",this.validateEnvironmentId()}this.awsRequestSigner=null,this.region=""}validateEnvironmentId(){let e=this.environmentId?.match(/^(aws)(\d+)$/);if(e&&this.regionalCredVerificationUrl){if(1!==parseInt(e[2],10))throw Error(`aws version "${e[2]}" is not supported in the current build.`)}else throw Error('No valid AWS "credential_source" provided')}async retrieveSubjectToken(){this.awsRequestSigner||(this.region=await this.awsSecurityCredentialsSupplier.getAwsRegion(this.supplierContext),this.awsRequestSigner=new r.AwsRequestSigner(async()=>this.awsSecurityCredentialsSupplier.getAwsSecurityCredentials(this.supplierContext),this.region));let e=await this.awsRequestSigner.getRequestOptions({...l.RETRY_CONFIG,url:this.regionalCredVerificationUrl.replace("{region}",this.region),method:"POST"}),t=[];return a.Gaxios.mergeHeaders({"x-goog-cloud-target-resource":this.audience},e.headers).forEach((e,n)=>t.push({key:n,value:e})),encodeURIComponent(JSON.stringify({url:e.url,method:e.method,headers:t}))}}t.AwsClient=l},203:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AwsRequestSigner=void 0;let r=n(5678),i=n(6108),o="AWS4-HMAC-SHA256";class s{getCredentials;region;crypto;constructor(e,t){this.getCredentials=e,this.region=t,this.crypto=(0,i.createCrypto)()}async getRequestOptions(e){if(!e.url)throw RangeError('"url" is required in "amzOptions"');let t="object"==typeof e.data?JSON.stringify(e.data):e.data,n=e.url,i=e.method||"GET",o=e.body||t,s=e.headers,a=await this.getCredentials(),l=new URL(n);if("string"!=typeof o&&void 0!==o)throw TypeError(`'requestPayload' is expected to be a string if provided. Got: ${o}`);let c=await u({crypto:this.crypto,host:l.host,canonicalUri:l.pathname,canonicalQuerystring:l.search.slice(1),method:i,region:this.region,securityCredentials:a,requestPayload:o,additionalAmzHeaders:s}),d=r.Gaxios.mergeHeaders(c.amzDate?{"x-amz-date":c.amzDate}:{},{authorization:c.authorizationHeader,host:l.host},s||{});a.token&&r.Gaxios.mergeHeaders(d,{"x-amz-security-token":a.token});let h={url:n,method:i,headers:d};return void 0!==o&&(h.body=o),h}}async function a(e,t,n){return await e.signWithHmacSha256(t,n)}async function l(e,t,n,r,i){let o=await a(e,`AWS4${t}`,n),s=await a(e,o,r),l=await a(e,s,i);return await a(e,l,"aws4_request")}async function u(e){let t=r.Gaxios.mergeHeaders(e.additionalAmzHeaders),n=e.requestPayload||"",s=e.host.split(".")[0],u=new Date,c=u.toISOString().replace(/[-:]/g,"").replace(/\.[0-9]+/,""),d=u.toISOString().replace(/[-]/g,"").replace(/T.*/,"");e.securityCredentials.token&&t.set("x-amz-security-token",e.securityCredentials.token);let h=r.Gaxios.mergeHeaders({host:e.host},t.has("date")?{}:{"x-amz-date":c},t),p="",f=[...h.keys()].sort();f.forEach(e=>{p+=`${e}:${h.get(e)}
`});let m=f.join(";"),g=await e.crypto.sha256DigestHex(n),y=`${e.method.toUpperCase()}
${e.canonicalUri}
${e.canonicalQuerystring}
${p}
${m}
${g}`,v=`${d}/${e.region}/${s}/aws4_request`,_=`${o}
${c}
${v}
`+await e.crypto.sha256DigestHex(y),b=await l(e.crypto,e.securityCredentials.secretAccessKey,d,e.region,s),E=await a(e.crypto,b,_),T=`${o} Credential=${e.securityCredentials.accessKeyId}/${v}, SignedHeaders=${m}, Signature=${(0,i.fromArrayBufferToHex)(E)}`;return{amzDate:t.has("date")?void 0:c,authorizationHeader:T,canonicalQuerystring:e.canonicalQuerystring}}t.AwsRequestSigner=s},7116:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseExternalAccountClient=t.CLOUD_RESOURCE_MANAGER=t.EXTERNAL_ACCOUNT_TYPE=t.EXPIRATION_TIME_OFFSET=void 0;let r=n(5678),i=n(6162),o=n(4987),s=n(5161),a=n(1118),l=n(9662),u="https://www.googleapis.com/auth/cloud-platform";t.EXPIRATION_TIME_OFFSET=3e5,t.EXTERNAL_ACCOUNT_TYPE="external_account",t.CLOUD_RESOURCE_MANAGER="https://cloudresourcemanager.googleapis.com/v1/projects/";class c extends o.AuthClient{scopes;projectNumber;audience;subjectTokenType;stsCredential;clientAuth;credentialSourceType;cachedAccessToken;serviceAccountImpersonationUrl;serviceAccountImpersonationLifetime;workforcePoolUserProject;configLifetimeRequested;tokenUrl;cloudResourceManagerURL;supplierContext;#c=null;constructor(e){super(e);let n=(0,a.originalOrCamelOptions)(e),r=n.get("type");if(r&&r!==t.EXTERNAL_ACCOUNT_TYPE)throw Error(`Expected "${t.EXTERNAL_ACCOUNT_TYPE}" type but received "${e.type}"`);let i=n.get("client_id"),o=n.get("client_secret");this.tokenUrl=n.get("token_url")??"https://sts.{universeDomain}/v1/token".replace("{universeDomain}",this.universeDomain);let l=n.get("subject_token_type"),c=n.get("workforce_pool_user_project"),d=n.get("service_account_impersonation_url"),h=n.get("service_account_impersonation"),p=(0,a.originalOrCamelOptions)(h).get("token_lifetime_seconds");this.cloudResourceManagerURL=new URL(n.get("cloud_resource_manager_url")||`https://cloudresourcemanager.${this.universeDomain}/v1/projects/`),i&&(this.clientAuth={confidentialClientType:"basic",clientId:i,clientSecret:o}),this.stsCredential=new s.StsCredentials({tokenExchangeEndpoint:this.tokenUrl,clientAuthentication:this.clientAuth}),this.scopes=n.get("scopes")||[u],this.cachedAccessToken=null,this.audience=n.get("audience"),this.subjectTokenType=l,this.workforcePoolUserProject=c;let f=RegExp("//iam\\.googleapis\\.com/locations/[^/]+/workforcePools/[^/]+/providers/.+");if(this.workforcePoolUserProject&&!this.audience.match(f))throw Error("workforcePoolUserProject should not be set for non-workforce pool credentials.");this.serviceAccountImpersonationUrl=d,this.serviceAccountImpersonationLifetime=p,this.serviceAccountImpersonationLifetime?this.configLifetimeRequested=!0:(this.configLifetimeRequested=!1,this.serviceAccountImpersonationLifetime=3600),this.projectNumber=this.getProjectNumber(this.audience),this.supplierContext={audience:this.audience,subjectTokenType:this.subjectTokenType,transporter:this.transporter}}getServiceAccountEmail(){if(this.serviceAccountImpersonationUrl){if(this.serviceAccountImpersonationUrl.length>256)throw RangeError(`URL is too long: ${this.serviceAccountImpersonationUrl}`);let e=/serviceAccounts\/(?<email>[^:]+):generateAccessToken$/.exec(this.serviceAccountImpersonationUrl);return e?.groups?.email||null}return null}setCredentials(e){super.setCredentials(e),this.cachedAccessToken=e}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),t=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(t)}request(e,t){if(!t)return this.requestAsync(e);this.requestAsync(e).then(e=>t(null,e),e=>t(e,e.response))}async getProjectId(){let e=this.projectNumber||this.workforcePoolUserProject;if(this.projectId)return this.projectId;if(e){let t=await this.getRequestHeaders(),n={...c.RETRY_CONFIG,headers:t,url:`${this.cloudResourceManagerURL.toString()}${e}`};o.AuthClient.setMethodName(n,"getProjectId");let r=await this.transporter.request(n);return this.projectId=r.data.projectId,this.projectId}return null}async requestAsync(e,t=!1){let n;try{let t=await this.getRequestHeaders();e.headers=r.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,t),n=await this.transporter.request(e)}catch(r){let n=r.response;if(n){let r=n.status,o=n.config.data instanceof i.Readable;if(!t&&(401===r||403===r)&&!o&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw r}return n}async refreshAccessTokenAsync(){this.#c=this.#c||this.#d();try{return await this.#c}finally{this.#c=null}}async #d(){let e=await this.retrieveSubjectToken(),t={grantType:"urn:ietf:params:oauth:grant-type:token-exchange",audience:this.audience,requestedTokenType:"urn:ietf:params:oauth:token-type:access_token",subjectToken:e,subjectTokenType:this.subjectTokenType,scope:this.serviceAccountImpersonationUrl?[u]:this.getScopesArray()},n=!this.clientAuth&&this.workforcePoolUserProject?{userProject:this.workforcePoolUserProject}:void 0,r=new Headers({"x-goog-api-client":this.getMetricsHeaderValue()}),i=await this.stsCredential.exchangeToken(t,r,n);return this.serviceAccountImpersonationUrl?this.cachedAccessToken=await this.getImpersonatedAccessToken(i.access_token):i.expires_in?this.cachedAccessToken={access_token:i.access_token,expiry_date:new Date().getTime()+1e3*i.expires_in,res:i.res}:this.cachedAccessToken={access_token:i.access_token,res:i.res},this.credentials={},Object.assign(this.credentials,this.cachedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedAccessToken.expiry_date,access_token:this.cachedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedAccessToken}getProjectNumber(e){let t=e.match(/\/projects\/([^/]+)/);return t?t[1]:null}async getImpersonatedAccessToken(e){let t={...c.RETRY_CONFIG,url:this.serviceAccountImpersonationUrl,method:"POST",headers:{"content-type":"application/json",authorization:`Bearer ${e}`},data:{scope:this.getScopesArray(),lifetime:this.serviceAccountImpersonationLifetime+"s"}};o.AuthClient.setMethodName(t,"getImpersonatedAccessToken");let n=await this.transporter.request(t),r=n.data;return{access_token:r.accessToken,expiry_date:new Date(r.expireTime).getTime(),res:n}}isExpired(e){let t=new Date().getTime();return!!e.expiry_date&&t>=e.expiry_date-this.eagerRefreshThresholdMillis}getScopesArray(){return"string"==typeof this.scopes?[this.scopes]:this.scopes||[u]}getMetricsHeaderValue(){let e=process.version.replace(/^v/,""),t=void 0!==this.serviceAccountImpersonationUrl,n=this.credentialSourceType?this.credentialSourceType:"unknown";return`gl-node/${e} auth/${l.pkg.version} google-byoid-sdk source/${n} sa-impersonation/${t} config-lifetime/${this.configLifetimeRequested}`}getTokenUrl(){return this.tokenUrl}}t.BaseExternalAccountClient=c},5911:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CertificateSubjectTokenSupplier=t.InvalidConfigurationError=t.CertificateSourceUnavailableError=t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE=void 0;let r=n(1118),i=n(2048),o=n(4770),s=n(8791);t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE="GOOGLE_API_CERTIFICATE_CONFIG";class a extends Error{constructor(e){super(e),this.name="CertificateSourceUnavailableError"}}t.CertificateSourceUnavailableError=a;class l extends Error{constructor(e){super(e),this.name="InvalidConfigurationError"}}t.InvalidConfigurationError=l;class u{certificateConfigPath;trustChainPath;cert;key;constructor(e){if(!e.useDefaultCertificateConfig&&!e.certificateConfigLocation)throw new l("Either `useDefaultCertificateConfig` must be true or a `certificateConfigLocation` must be provided.");if(e.useDefaultCertificateConfig&&e.certificateConfigLocation)throw new l("Both `useDefaultCertificateConfig` and `certificateConfigLocation` cannot be provided.");this.trustChainPath=e.trustChainPath,this.certificateConfigPath=e.certificateConfigLocation??""}async createMtlsHttpsAgent(){if(!this.key||!this.cert)throw new l("Cannot create mTLS Agent with missing certificate or key");return new s.Agent({key:this.key,cert:this.cert})}async getSubjectToken(){this.certificateConfigPath=await this.#h();let{certPath:e,keyPath:t}=await this.#p();return{cert:this.cert,key:this.key}=await this.#f(e,t),await this.#m(this.cert)}async #h(){let e=this.certificateConfigPath;if(e){if(await (0,r.isValidFile)(e))return e;throw new a(`Provided certificate config path is invalid: ${e}`)}let n=process.env[t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE];if(n){if(await (0,r.isValidFile)(n))return n;throw new a(`Path from environment variable "${t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" is invalid: ${n}`)}let i=(0,r.getWellKnownCertificateConfigFileLocation)();if(await (0,r.isValidFile)(i))return i;throw new a(`Could not find certificate configuration file. Searched override path, the "${t.CERTIFICATE_CONFIGURATION_ENV_VARIABLE}" env var, and the gcloud path (${i}).`)}async #p(){let e;let t=this.certificateConfigPath;try{e=await i.promises.readFile(t,"utf8")}catch(e){throw new a(`Failed to read certificate config file at: ${t}`)}try{let n=JSON.parse(e),r=n?.cert_configs?.workload?.cert_path,i=n?.cert_configs?.workload?.key_path;if(!r||!i)throw new l(`Certificate config file (${t}) is missing required "cert_path" or "key_path" in the workload config.`);return{certPath:r,keyPath:i}}catch(e){if(e instanceof l)throw e;throw new l(`Failed to parse certificate config from ${t}: ${e.message}`)}}async #f(e,t){let n,r;try{n=await i.promises.readFile(e),new o.X509Certificate(n)}catch(n){let t=n instanceof Error?n.message:String(n);throw new a(`Failed to read certificate file at ${e}: ${t}`)}try{r=await i.promises.readFile(t),(0,o.createPrivateKey)(r)}catch(n){let e=n instanceof Error?n.message:String(n);throw new a(`Failed to read private key file at ${t}: ${e}`)}return{cert:n,key:r}}async #m(e){let t=new o.X509Certificate(e);if(!this.trustChainPath)return JSON.stringify([t.raw.toString("base64")]);try{let e;let n=((await i.promises.readFile(this.trustChainPath,"utf8")).match(/-----BEGIN CERTIFICATE-----[^-]+-----END CERTIFICATE-----/g)??[]).map((e,t)=>{try{return new o.X509Certificate(e)}catch(n){let e=n instanceof Error?n.message:String(n);throw new l(`Failed to parse certificate at index ${t} in trust chain file ${this.trustChainPath}: ${e}`)}}),r=n.findIndex(e=>t.raw.equals(e.raw));if(-1===r)e=[t,...n];else if(0===r)e=n;else throw new l(`Leaf certificate exists in the trust chain but is not the first entry (found at index ${r}).`);return JSON.stringify(e.map(e=>e.raw.toString("base64")))}catch(t){if(t instanceof l)throw t;let e=t instanceof Error?t.message:String(t);throw new a(`Failed to process certificate chain from ${this.trustChainPath}: ${e}`)}}}t.CertificateSubjectTokenSupplier=u},1473:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Compute=void 0;let r=n(5678),i=n(9972),o=n(851);class s extends o.OAuth2Client{serviceAccountEmail;scopes;constructor(e={}){super(e),this.credentials={expiry_date:1,refresh_token:"compute-placeholder"},this.serviceAccountEmail=e.serviceAccountEmail||"default",this.scopes=Array.isArray(e.scopes)?e.scopes:e.scopes?[e.scopes]:[]}async refreshTokenNoCache(){let e;let t=`service-accounts/${this.serviceAccountEmail}/token`;try{let n={property:t};this.scopes.length>0&&(n.params={scopes:this.scopes.join(",")}),e=await i.instance(n)}catch(e){throw e instanceof r.GaxiosError&&(e.message=`Could not refresh access token: ${e.message}`,this.wrapError(e)),e}let n=e;return e&&e.expires_in&&(n.expiry_date=new Date().getTime()+1e3*e.expires_in,delete n.expires_in),this.emit("tokens",n),{tokens:n,res:null}}async fetchIdToken(e){let t;let n=`service-accounts/${this.serviceAccountEmail}/identity?format=full&audience=${e}`;try{t=await i.instance({property:n})}catch(e){throw e instanceof Error&&(e.message=`Could not fetch ID token: ${e.message}`),e}return t}wrapError(e){let t=e.response;t&&t.status&&(e.status=t.status,403===t.status?e.message="A Forbidden error was returned while attempting to retrieve an access token for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have the correct permission scopes specified: "+e.message:404===t.status&&(e.message="A Not Found error was returned while attempting to retrieve an accesstoken for the Compute Engine built-in service account. This may be because the Compute Engine instance does not have any permission scopes specified: "+e.message))}}t.Compute=s},8454:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DefaultAwsSecurityCredentialsSupplier=void 0;let r=n(4987);class i{regionUrl;securityCredentialsUrl;imdsV2SessionTokenUrl;additionalGaxiosOptions;constructor(e){this.regionUrl=e.regionUrl,this.securityCredentialsUrl=e.securityCredentialsUrl,this.imdsV2SessionTokenUrl=e.imdsV2SessionTokenUrl,this.additionalGaxiosOptions=e.additionalGaxiosOptions}async getAwsRegion(e){if(this.#g)return this.#g;let t=new Headers;if(!this.#g&&this.imdsV2SessionTokenUrl&&t.set("x-aws-ec2-metadata-token",await this.#y(e.transporter)),!this.regionUrl)throw RangeError('Unable to determine AWS region due to missing "options.credential_source.region_url"');let n={...this.additionalGaxiosOptions,url:this.regionUrl,method:"GET",headers:t};r.AuthClient.setMethodName(n,"getAwsRegion");let i=await e.transporter.request(n);return i.data.substr(0,i.data.length-1)}async getAwsSecurityCredentials(e){if(this.#v)return this.#v;let t=new Headers;this.imdsV2SessionTokenUrl&&t.set("x-aws-ec2-metadata-token",await this.#y(e.transporter));let n=await this.#_(t,e.transporter),r=await this.#b(n,t,e.transporter);return{accessKeyId:r.AccessKeyId,secretAccessKey:r.SecretAccessKey,token:r.Token}}async #y(e){let t={...this.additionalGaxiosOptions,url:this.imdsV2SessionTokenUrl,method:"PUT",headers:{"x-aws-ec2-metadata-token-ttl-seconds":"300"}};return r.AuthClient.setMethodName(t,"#getImdsV2SessionToken"),(await e.request(t)).data}async #_(e,t){if(!this.securityCredentialsUrl)throw Error('Unable to determine AWS role name due to missing "options.credential_source.url"');let n={...this.additionalGaxiosOptions,url:this.securityCredentialsUrl,method:"GET",headers:e};return r.AuthClient.setMethodName(n,"#getAwsRoleName"),(await t.request(n)).data}async #b(e,t,n){let i={...this.additionalGaxiosOptions,url:`${this.securityCredentialsUrl}/${e}`,headers:t};return r.AuthClient.setMethodName(i,"#retrieveAwsSecurityCredentials"),(await n.request(i)).data}get #g(){return process.env.AWS_REGION||process.env.AWS_DEFAULT_REGION||null}get #v(){return process.env.AWS_ACCESS_KEY_ID&&process.env.AWS_SECRET_ACCESS_KEY?{accessKeyId:process.env.AWS_ACCESS_KEY_ID,secretAccessKey:process.env.AWS_SECRET_ACCESS_KEY,token:process.env.AWS_SESSION_TOKEN}:null}}t.DefaultAwsSecurityCredentialsSupplier=i},76:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DownscopedClient=t.EXPIRATION_TIME_OFFSET=t.MAX_ACCESS_BOUNDARY_RULES_COUNT=void 0;let r=n(5678),i=n(6162),o=n(4987),s=n(5161);t.MAX_ACCESS_BOUNDARY_RULES_COUNT=10,t.EXPIRATION_TIME_OFFSET=3e5;class a extends o.AuthClient{authClient;credentialAccessBoundary;cachedDownscopedAccessToken;stsCredential;constructor(e,n={accessBoundary:{accessBoundaryRules:[]}}){if(super(e instanceof o.AuthClient?{}:e),e instanceof o.AuthClient?(this.authClient=e,this.credentialAccessBoundary=n):(this.authClient=e.authClient,this.credentialAccessBoundary=e.credentialAccessBoundary),0===this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length)throw Error("At least one access boundary rule needs to be defined.");if(this.credentialAccessBoundary.accessBoundary.accessBoundaryRules.length>t.MAX_ACCESS_BOUNDARY_RULES_COUNT)throw Error(`The provided access boundary has more than ${t.MAX_ACCESS_BOUNDARY_RULES_COUNT} access boundary rules.`);for(let e of this.credentialAccessBoundary.accessBoundary.accessBoundaryRules)if(0===e.availablePermissions.length)throw Error("At least one permission should be defined in access boundary rules.");this.stsCredential=new s.StsCredentials({tokenExchangeEndpoint:`https://sts.${this.universeDomain}/v1/token`}),this.cachedDownscopedAccessToken=null}setCredentials(e){if(!e.expiry_date)throw Error("The access token expiry_date field is missing in the provided credentials.");super.setCredentials(e),this.cachedDownscopedAccessToken=e}async getAccessToken(){return(!this.cachedDownscopedAccessToken||this.isExpired(this.cachedDownscopedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedDownscopedAccessToken.access_token,expirationTime:this.cachedDownscopedAccessToken.expiry_date,res:this.cachedDownscopedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),t=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(t)}request(e,t){if(!t)return this.requestAsync(e);this.requestAsync(e).then(e=>t(null,e),e=>t(e,e.response))}async requestAsync(e,t=!1){let n;try{let t=await this.getRequestHeaders();e.headers=r.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,t),n=await this.transporter.request(e)}catch(r){let n=r.response;if(n){let r=n.status,o=n.config.data instanceof i.Readable;if(!t&&(401===r||403===r)&&!o&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw r}return n}async refreshAccessTokenAsync(){let e=(await this.authClient.getAccessToken()).token,t=await this.stsCredential.exchangeToken({grantType:"urn:ietf:params:oauth:grant-type:token-exchange",requestedTokenType:"urn:ietf:params:oauth:token-type:access_token",subjectToken:e,subjectTokenType:"urn:ietf:params:oauth:token-type:access_token"},void 0,this.credentialAccessBoundary),n=this.authClient.credentials?.expiry_date||null,r=t.expires_in?new Date().getTime()+1e3*t.expires_in:n;return this.cachedDownscopedAccessToken={access_token:t.access_token,expiry_date:r,res:t.res},this.credentials={},Object.assign(this.credentials,this.cachedDownscopedAccessToken),delete this.credentials.res,this.emit("tokens",{refresh_token:null,expiry_date:this.cachedDownscopedAccessToken.expiry_date,access_token:this.cachedDownscopedAccessToken.access_token,token_type:"Bearer",id_token:null}),this.cachedDownscopedAccessToken}isExpired(e){let t=new Date().getTime();return!!e.expiry_date&&t>=e.expiry_date-this.eagerRefreshThresholdMillis}}t.DownscopedClient=a},3530:(e,t,n)=>{"use strict";var r;let i;Object.defineProperty(t,"__esModule",{value:!0}),t.GCPEnv=void 0,t.clear=function(){i=void 0},t.getEnv=s;let o=n(9972);async function s(){return i||(i=a())}async function a(){return r.NONE,process.env.GAE_SERVICE||process.env.GAE_MODULE_NAME?r.APP_ENGINE:process.env.FUNCTION_NAME||process.env.FUNCTION_TARGET?r.CLOUD_FUNCTIONS:await u()?await l()?r.KUBERNETES_ENGINE:process.env.K_CONFIGURATION?r.CLOUD_RUN:process.env.CLOUD_RUN_JOB?r.CLOUD_RUN_JOBS:r.COMPUTE_ENGINE:r.NONE}async function l(){try{return await o.instance("attributes/cluster-name"),!0}catch(e){return!1}}async function u(){return o.isAvailable()}!function(e){e.APP_ENGINE="APP_ENGINE",e.KUBERNETES_ENGINE="KUBERNETES_ENGINE",e.CLOUD_FUNCTIONS="CLOUD_FUNCTIONS",e.COMPUTE_ENGINE="COMPUTE_ENGINE",e.CLOUD_RUN="CLOUD_RUN",e.CLOUD_RUN_JOBS="CLOUD_RUN_JOBS",e.NONE="NONE"}(r||(t.GCPEnv=r={}))},8358:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.InvalidSubjectTokenError=t.InvalidMessageFieldError=t.InvalidCodeFieldError=t.InvalidTokenTypeFieldError=t.InvalidExpirationTimeFieldError=t.InvalidSuccessFieldError=t.InvalidVersionFieldError=t.ExecutableResponseError=t.ExecutableResponse=void 0;let n="urn:ietf:params:oauth:token-type:saml2",r="urn:ietf:params:oauth:token-type:id_token",i="urn:ietf:params:oauth:token-type:jwt";class o{version;success;expirationTime;tokenType;errorCode;errorMessage;subjectToken;constructor(e){if(!e.version)throw new a("Executable response must contain a 'version' field.");if(void 0===e.success)throw new l("Executable response must contain a 'success' field.");if(this.version=e.version,this.success=e.success,this.success){if(this.expirationTime=e.expiration_time,this.tokenType=e.token_type,this.tokenType!==n&&this.tokenType!==r&&this.tokenType!==i)throw new c(`Executable response must contain a 'token_type' field when successful and it must be one of ${r}, ${i}, or ${n}.`);if(this.tokenType===n){if(!e.saml_response)throw new p(`Executable response must contain a 'saml_response' field when token_type=${n}.`);this.subjectToken=e.saml_response}else{if(!e.id_token)throw new p(`Executable response must contain a 'id_token' field when token_type=${r} or ${i}.`);this.subjectToken=e.id_token}}else{if(!e.code)throw new d("Executable response must contain a 'code' field when unsuccessful.");if(!e.message)throw new h("Executable response must contain a 'message' field when unsuccessful.");this.errorCode=e.code,this.errorMessage=e.message}}isValid(){return!this.isExpired()&&this.success}isExpired(){return void 0!==this.expirationTime&&this.expirationTime<Math.round(Date.now()/1e3)}}t.ExecutableResponse=o;class s extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}}t.ExecutableResponseError=s;class a extends s{}t.InvalidVersionFieldError=a;class l extends s{}t.InvalidSuccessFieldError=l;class u extends s{}t.InvalidExpirationTimeFieldError=u;class c extends s{}t.InvalidTokenTypeFieldError=c;class d extends s{}t.InvalidCodeFieldError=d;class h extends s{}t.InvalidMessageFieldError=h;class p extends s{}t.InvalidSubjectTokenError=p},4875:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExternalAccountAuthorizedUserClient=t.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE=void 0;let r=n(4987),i=n(9061),o=n(5678),s=n(6162),a=n(7116);t.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE="external_account_authorized_user";class l extends i.OAuthClientAuthHandler{#E;constructor(e){super(e),this.#E=e.tokenRefreshEndpoint}async refreshToken(e,t){let n={...l.RETRY_CONFIG,url:this.#E,method:"POST",headers:t,data:new URLSearchParams({grant_type:"refresh_token",refresh_token:e})};r.AuthClient.setMethodName(n,"refreshToken"),this.applyClientAuthenticationOptions(n);try{let e=await this.transporter.request(n),t=e.data;return t.res=e,t}catch(e){if(e instanceof o.GaxiosError&&e.response)throw(0,i.getErrorFromOAuthErrorResponse)(e.response.data,e);throw e}}}class u extends r.AuthClient{cachedAccessToken;externalAccountAuthorizedUserHandler;refreshToken;constructor(e){super(e),e.universe_domain&&(this.universeDomain=e.universe_domain),this.refreshToken=e.refresh_token;let t={confidentialClientType:"basic",clientId:e.client_id,clientSecret:e.client_secret};this.externalAccountAuthorizedUserHandler=new l({tokenRefreshEndpoint:e.token_url??"https://sts.{universeDomain}/v1/oauthtoken".replace("{universeDomain}",this.universeDomain),transporter:this.transporter,clientAuthentication:t}),this.cachedAccessToken=null,this.quotaProjectId=e.quota_project_id,"number"!=typeof e?.eagerRefreshThresholdMillis?this.eagerRefreshThresholdMillis=a.EXPIRATION_TIME_OFFSET:this.eagerRefreshThresholdMillis=e.eagerRefreshThresholdMillis,this.forceRefreshOnFailure=!!e?.forceRefreshOnFailure}async getAccessToken(){return(!this.cachedAccessToken||this.isExpired(this.cachedAccessToken))&&await this.refreshAccessTokenAsync(),{token:this.cachedAccessToken.access_token,res:this.cachedAccessToken.res}}async getRequestHeaders(){let e=await this.getAccessToken(),t=new Headers({authorization:`Bearer ${e.token}`});return this.addSharedMetadataHeaders(t)}request(e,t){if(!t)return this.requestAsync(e);this.requestAsync(e).then(e=>t(null,e),e=>t(e,e.response))}async requestAsync(e,t=!1){let n;try{let t=await this.getRequestHeaders();e.headers=o.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,t),n=await this.transporter.request(e)}catch(r){let n=r.response;if(n){let r=n.status,i=n.config.data instanceof s.Readable;if(!t&&(401===r||403===r)&&!i&&this.forceRefreshOnFailure)return await this.refreshAccessTokenAsync(),await this.requestAsync(e,!0)}throw r}return n}async refreshAccessTokenAsync(){let e=await this.externalAccountAuthorizedUserHandler.refreshToken(this.refreshToken);return this.cachedAccessToken={access_token:e.access_token,expiry_date:new Date().getTime()+1e3*e.expires_in,res:e.res},void 0!==e.refresh_token&&(this.refreshToken=e.refresh_token),this.cachedAccessToken}isExpired(e){let t=new Date().getTime();return!!e.expiry_date&&t>=e.expiry_date-this.eagerRefreshThresholdMillis}}t.ExternalAccountAuthorizedUserClient=u},1962:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ExternalAccountClient=void 0;let r=n(7116),i=n(4057),o=n(659),s=n(1202);class a{constructor(){throw Error("ExternalAccountClients should be initialized via: ExternalAccountClient.fromJSON(), directly via explicit constructors, eg. new AwsClient(options), new IdentityPoolClient(options), newPluggableAuthClientOptions, or via new GoogleAuth(options).getClient()")}static fromJSON(e){return e&&e.type===r.EXTERNAL_ACCOUNT_TYPE?e.credential_source?.environment_id?new o.AwsClient(e):e.credential_source?.executable?new s.PluggableAuthClient(e):new i.IdentityPoolClient(e):null}}t.ExternalAccountClient=a},9086:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FileSubjectTokenSupplier=void 0;let r=n(1764),i=n(2048),o=(0,r.promisify)(i.readFile??(()=>{})),s=(0,r.promisify)(i.realpath??(()=>{})),a=(0,r.promisify)(i.lstat??(()=>{}));class l{filePath;formatType;subjectTokenFieldName;constructor(e){this.filePath=e.filePath,this.formatType=e.formatType,this.subjectTokenFieldName=e.subjectTokenFieldName}async getSubjectToken(){let e,t=this.filePath;try{if(t=await s(t),!(await a(t)).isFile())throw Error()}catch(e){throw e instanceof Error&&(e.message=`The file at ${t} does not exist, or it is not a file. ${e.message}`),e}let n=await o(t,{encoding:"utf8"});if("text"===this.formatType?e=n:"json"===this.formatType&&this.subjectTokenFieldName&&(e=JSON.parse(n)[this.subjectTokenFieldName]),!e)throw Error("Unable to parse the subject_token from the credential_source file");return e}}t.FileSubjectTokenSupplier=l},2501:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GoogleAuth=t.GoogleAuthExceptionMessages=void 0;let r=n(1282),i=n(2048),o=n(5678),s=n(9972),a=n(9801),l=n(5315),u=n(6108),c=n(1473),d=n(6405),h=n(3530),p=n(8444),f=n(5243),m=n(8362),g=n(1962),y=n(7116),v=n(4987),_=n(4875),b=n(1118);t.GoogleAuthExceptionMessages={API_KEY_WITH_CREDENTIALS:"API Keys and Credentials are mutually exclusive authentication methods and cannot be used together.",NO_PROJECT_ID_FOUND:"Unable to detect a Project Id in the current environment. \nTo learn more about authentication and Google APIs, visit: \nhttps://cloud.google.com/docs/authentication/getting-started",NO_CREDENTIALS_FOUND:"Unable to find credentials in current environment. \nTo learn more about authentication and Google APIs, visit: \nhttps://cloud.google.com/docs/authentication/getting-started",NO_ADC_FOUND:"Could not load the default credentials. Browse to https://cloud.google.com/docs/authentication/getting-started for more information.",NO_UNIVERSE_DOMAIN_FOUND:"Unable to detect a Universe Domain in the current environment.\nTo learn more about Universe Domain retrieval, visit: \nhttps://cloud.google.com/compute/docs/metadata/predefined-metadata-keys"};class E{checkIsGCE=void 0;useJWTAccessWithScope;defaultServicePath;get isGCE(){return this.checkIsGCE}_findProjectIdPromise;_cachedProjectId;jsonContent=null;apiKey;cachedCredential=null;#T=null;defaultScopes;keyFilename;scopes;clientOptions={};constructor(e={}){if(this._cachedProjectId=e.projectId||null,this.cachedCredential=e.authClient||null,this.keyFilename=e.keyFilename||e.keyFile,this.scopes=e.scopes,this.clientOptions=e.clientOptions||{},this.jsonContent=e.credentials||null,this.apiKey=e.apiKey||this.clientOptions.apiKey||null,this.apiKey&&(this.jsonContent||this.clientOptions.credentials))throw RangeError(t.GoogleAuthExceptionMessages.API_KEY_WITH_CREDENTIALS);e.universeDomain&&(this.clientOptions.universeDomain=e.universeDomain)}setGapicJWTValues(e){e.defaultServicePath=this.defaultServicePath,e.useJWTAccessWithScope=this.useJWTAccessWithScope,e.defaultScopes=this.defaultScopes}getProjectId(e){if(!e)return this.getProjectIdAsync();this.getProjectIdAsync().then(t=>e(null,t),e)}async getProjectIdOptional(){try{return await this.getProjectId()}catch(e){if(e instanceof Error&&e.message===t.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)return null;throw e}}async findAndCacheProjectId(){let e=null;if(e||=await this.getProductionProjectId(),e||=await this.getFileProjectId(),e||=await this.getDefaultServiceProjectId(),e||=await this.getGCEProjectId(),e||=await this.getExternalAccountClientProjectId())return this._cachedProjectId=e,e;throw Error(t.GoogleAuthExceptionMessages.NO_PROJECT_ID_FOUND)}async getProjectIdAsync(){return this._cachedProjectId?this._cachedProjectId:(this._findProjectIdPromise||(this._findProjectIdPromise=this.findAndCacheProjectId()),this._findProjectIdPromise)}async getUniverseDomainFromMetadataServer(){let e;try{e=await s.universe("universe-domain"),e||=v.DEFAULT_UNIVERSE}catch(t){if(t&&t?.response?.status===404)e=v.DEFAULT_UNIVERSE;else throw t}return e}async getUniverseDomain(){let e=(0,b.originalOrCamelOptions)(this.clientOptions).get("universe_domain");try{e??=(await this.getClient()).universeDomain}catch{e??=v.DEFAULT_UNIVERSE}return e}getAnyScopes(){return this.scopes||this.defaultScopes}getApplicationDefault(e={},t){let n;if("function"==typeof e?t=e:n=e,!t)return this.getApplicationDefaultAsync(n);this.getApplicationDefaultAsync(n).then(e=>t(null,e.credential,e.projectId),t)}async getApplicationDefaultAsync(e={}){let n;if(this.cachedCredential)return await this.#w(this.cachedCredential,null);if((n=await this._tryGetApplicationCredentialsFromEnvironmentVariable(e))||(n=await this._tryGetApplicationCredentialsFromWellKnownFile(e)))return n instanceof p.JWT?n.scopes=this.scopes:n instanceof y.BaseExternalAccountClient&&(n.scopes=this.getAnyScopes()),await this.#w(n);if(await this._checkIsGCE())return e.scopes=this.getAnyScopes(),await this.#w(new c.Compute(e));throw Error(t.GoogleAuthExceptionMessages.NO_ADC_FOUND)}async #w(e,t=process.env.GOOGLE_CLOUD_QUOTA_PROJECT||null){let n=await this.getProjectIdOptional();return t&&(e.quotaProjectId=t),this.cachedCredential=e,{credential:e,projectId:n}}async _checkIsGCE(){return void 0===this.checkIsGCE&&(this.checkIsGCE=s.getGCPResidency()||await s.isAvailable()),this.checkIsGCE}async _tryGetApplicationCredentialsFromEnvironmentVariable(e){let t=process.env.GOOGLE_APPLICATION_CREDENTIALS||process.env.google_application_credentials;if(!t||0===t.length)return null;try{return this._getApplicationCredentialsFromFilePath(t,e)}catch(e){throw e instanceof Error&&(e.message=`Unable to read the credential file specified by the GOOGLE_APPLICATION_CREDENTIALS environment variable: ${e.message}`),e}}async _tryGetApplicationCredentialsFromWellKnownFile(e){let t=null;if(this._isWindows())t=process.env.APPDATA;else{let e=process.env.HOME;e&&(t=l.join(e,".config"))}return(t&&(t=l.join(t,"gcloud","application_default_credentials.json"),i.existsSync(t)||(t=null)),t)?await this._getApplicationCredentialsFromFilePath(t,e):null}async _getApplicationCredentialsFromFilePath(e,t={}){if(!e||0===e.length)throw Error("The file path is invalid.");try{if(e=i.realpathSync(e),!i.lstatSync(e).isFile())throw Error()}catch(t){throw t instanceof Error&&(t.message=`The file at ${e} does not exist, or it is not a file. ${t.message}`),t}let n=i.createReadStream(e);return this.fromStream(n,t)}fromImpersonatedJSON(e){if(!e)throw Error("Must pass in a JSON object containing an  impersonated refresh token");if(e.type!==m.IMPERSONATED_ACCOUNT_TYPE)throw Error(`The incoming JSON object does not have the "${m.IMPERSONATED_ACCOUNT_TYPE}" type`);if(!e.source_credentials)throw Error("The incoming JSON object does not contain a source_credentials field");if(!e.service_account_impersonation_url)throw Error("The incoming JSON object does not contain a service_account_impersonation_url field");let t=this.fromJSON(e.source_credentials);if(e.service_account_impersonation_url?.length>256)throw RangeError(`Target principal is too long: ${e.service_account_impersonation_url}`);let n=/(?<target>[^/]+):(generateAccessToken|generateIdToken)$/.exec(e.service_account_impersonation_url)?.groups?.target;if(!n)throw RangeError(`Cannot extract target principal from ${e.service_account_impersonation_url}`);let r=(this.scopes||e.scopes||this.defaultScopes)??[];return new m.Impersonated({...e,sourceClient:t,targetPrincipal:n,targetScopes:Array.isArray(r)?r:[r]})}fromJSON(e,t={}){let n;let r=(0,b.originalOrCamelOptions)(t).get("universe_domain");return e.type===f.USER_REFRESH_ACCOUNT_TYPE?(n=new f.UserRefreshClient(t)).fromJSON(e):e.type===m.IMPERSONATED_ACCOUNT_TYPE?n=this.fromImpersonatedJSON(e):e.type===y.EXTERNAL_ACCOUNT_TYPE?(n=g.ExternalAccountClient.fromJSON({...e,...t})).scopes=this.getAnyScopes():e.type===_.EXTERNAL_ACCOUNT_AUTHORIZED_USER_TYPE?n=new _.ExternalAccountAuthorizedUserClient({...e,...t}):(t.scopes=this.scopes,n=new p.JWT(t),this.setGapicJWTValues(n),n.fromJSON(e)),r&&(n.universeDomain=r),n}_cacheClientFromJSON(e,t){let n=this.fromJSON(e,t);return this.jsonContent=e,this.cachedCredential=n,n}fromStream(e,t={},n){let r={};if("function"==typeof t?n=t:r=t,!n)return this.fromStreamAsync(e,r);this.fromStreamAsync(e,r).then(e=>n(null,e),n)}fromStreamAsync(e,t){return new Promise((n,r)=>{if(!e)throw Error("Must pass in a stream containing the Google auth settings.");let i=[];e.setEncoding("utf8").on("error",r).on("data",e=>i.push(e)).on("end",()=>{try{try{let e=JSON.parse(i.join("")),r=this._cacheClientFromJSON(e,t);return n(r)}catch(t){if(!this.keyFilename)throw t;let e=new p.JWT({...this.clientOptions,keyFile:this.keyFilename});return this.cachedCredential=e,this.setGapicJWTValues(e),n(e)}}catch(e){return r(e)}})})}fromAPIKey(e,t={}){return new p.JWT({...t,apiKey:e})}_isWindows(){let e=a.platform();return!!e&&e.length>=3&&"win"===e.substring(0,3).toLowerCase()}async getDefaultServiceProjectId(){return new Promise(e=>{(0,r.exec)("gcloud config config-helper --format json",(t,n)=>{if(!t&&n)try{let t=JSON.parse(n).configuration.properties.core.project;e(t);return}catch(e){}e(null)})})}getProductionProjectId(){return process.env.GCLOUD_PROJECT||process.env.GOOGLE_CLOUD_PROJECT||process.env.gcloud_project||process.env.google_cloud_project}async getFileProjectId(){if(this.cachedCredential)return this.cachedCredential.projectId;if(this.keyFilename){let e=await this.getClient();if(e&&e.projectId)return e.projectId}let e=await this._tryGetApplicationCredentialsFromEnvironmentVariable();return e?e.projectId:null}async getExternalAccountClientProjectId(){if(!this.jsonContent||this.jsonContent.type!==y.EXTERNAL_ACCOUNT_TYPE)return null;let e=await this.getClient();return await e.getProjectId()}async getGCEProjectId(){try{return await s.project("project-id")}catch(e){return null}}getCredentials(e){if(!e)return this.getCredentialsAsync();this.getCredentialsAsync().then(t=>e(null,t),e)}async getCredentialsAsync(){let e=await this.getClient();if(e instanceof m.Impersonated)return{client_email:e.getTargetPrincipal()};if(e instanceof y.BaseExternalAccountClient){let t=e.getServiceAccountEmail();if(t)return{client_email:t,universe_domain:e.universeDomain}}if(this.jsonContent)return{client_email:this.jsonContent.client_email,private_key:this.jsonContent.private_key,universe_domain:this.jsonContent.universe_domain};if(await this._checkIsGCE()){let[e,t]=await Promise.all([s.instance("service-accounts/default/email"),this.getUniverseDomain()]);return{client_email:e,universe_domain:t}}throw Error(t.GoogleAuthExceptionMessages.NO_CREDENTIALS_FOUND)}async getClient(){if(this.cachedCredential)return this.cachedCredential;this.#T=this.#T||this.#S();try{return await this.#T}finally{this.#T=null}}async #S(){if(this.jsonContent)return this._cacheClientFromJSON(this.jsonContent,this.clientOptions);if(this.keyFilename){let e=l.resolve(this.keyFilename),t=i.createReadStream(e);return await this.fromStreamAsync(t,this.clientOptions)}if(this.apiKey){let e=await this.fromAPIKey(this.apiKey,this.clientOptions);e.scopes=this.scopes;let{credential:t}=await this.#w(e);return t}{let{credential:e}=await this.getApplicationDefaultAsync(this.clientOptions);return e}}async getIdTokenClient(e){let t=await this.getClient();if(!("fetchIdToken"in t))throw Error("Cannot fetch ID token in this environment, use GCE or set the GOOGLE_APPLICATION_CREDENTIALS environment variable to a service account credentials JSON file.");return new d.IdTokenClient({targetAudience:e,idTokenProvider:t})}async getAccessToken(){let e=await this.getClient();return(await e.getAccessToken()).token}async getRequestHeaders(e){return(await this.getClient()).getRequestHeaders(e)}async authorizeRequest(e={}){let t=e.url,n=await this.getClient(),r=await n.getRequestHeaders(t);return e.headers=o.Gaxios.mergeHeaders(e.headers,r),e}async fetch(...e){return(await this.getClient()).fetch(...e)}async request(e){return(await this.getClient()).request(e)}getEnv(){return(0,h.getEnv)()}async sign(e,t){let n=await this.getClient(),r=await this.getUniverseDomain();if(t=t||`https://iamcredentials.${r}/v1/projects/-/serviceAccounts/`,n instanceof m.Impersonated)return(await n.sign(e)).signedBlob;let i=(0,u.createCrypto)();if(n instanceof p.JWT&&n.key)return await i.sign(n.key,e);let o=await this.getCredentials();if(!o.client_email)throw Error("Cannot sign data without `client_email`.");return this.signBlob(i,o.client_email,e,t)}async signBlob(e,t,n,r){let i=new URL(r+`${t}:signBlob`);return(await this.request({method:"POST",url:i.href,data:{payload:e.encodeBase64StringUtf8(n)},retry:!0,retryConfig:{httpMethodsToRetry:["POST"]}})).data.signedBlob}}t.GoogleAuth=E},1805:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IAMAuth=void 0;class n{selector;token;constructor(e,t){this.selector=e,this.token=t,this.selector=e,this.token=t}getRequestHeaders(){return{"x-goog-iam-authority-selector":this.selector,"x-goog-iam-authorization-token":this.token}}}t.IAMAuth=n},4057:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IdentityPoolClient=void 0;let r=n(7116),i=n(1118),o=n(9086),s=n(8934),a=n(5911),l=n(5161),u=n(5678);class c extends r.BaseExternalAccountClient{subjectTokenSupplier;constructor(e){super(e);let t=(0,i.originalOrCamelOptions)(e),n=t.get("credential_source"),r=t.get("subject_token_supplier");if(!n&&!r)throw Error("A credential source or subject token supplier must be specified.");if(n&&r)throw Error("Only one of credential source or subject token supplier can be specified.");if(r)this.subjectTokenSupplier=r,this.credentialSourceType="programmatic";else{let e=(0,i.originalOrCamelOptions)(n),t=(0,i.originalOrCamelOptions)(e.get("format")),r=t.get("type")||"text",l=t.get("subject_token_field_name");if("json"!==r&&"text"!==r)throw Error(`Invalid credential_source format "${r}"`);if("json"===r&&!l)throw Error("Missing subject_token_field_name for JSON credential_source format");let u=e.get("file"),d=e.get("url"),h=e.get("certificate"),p=e.get("headers");if(u&&d||d&&h||u&&h)throw Error('No valid Identity Pool "credential_source" provided, must be either file, url, or certificate.');if(u)this.credentialSourceType="file",this.subjectTokenSupplier=new o.FileSubjectTokenSupplier({filePath:u,formatType:r,subjectTokenFieldName:l});else if(d)this.credentialSourceType="url",this.subjectTokenSupplier=new s.UrlSubjectTokenSupplier({url:d,formatType:r,subjectTokenFieldName:l,headers:p,additionalGaxiosOptions:c.RETRY_CONFIG});else if(h){this.credentialSourceType="certificate";let e=new a.CertificateSubjectTokenSupplier({useDefaultCertificateConfig:h.use_default_certificate_config,certificateConfigLocation:h.certificate_config_location,trustChainPath:h.trust_chain_path});this.subjectTokenSupplier=e}else throw Error('No valid Identity Pool "credential_source" provided, must be either file, url, or certificate.')}}async retrieveSubjectToken(){let e=await this.subjectTokenSupplier.getSubjectToken(this.supplierContext);if(this.subjectTokenSupplier instanceof a.CertificateSubjectTokenSupplier){let e=await this.subjectTokenSupplier.createMtlsHttpsAgent();this.stsCredential=new l.StsCredentials({tokenExchangeEndpoint:this.getTokenUrl(),clientAuthentication:this.clientAuth,transporter:new u.Gaxios({agent:e})}),this.transporter=new u.Gaxios({...this.transporter.defaults||{},agent:e})}return e}}t.IdentityPoolClient=c},6405:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IdTokenClient=void 0;let r=n(851);class i extends r.OAuth2Client{targetAudience;idTokenProvider;constructor(e){super(e),this.targetAudience=e.targetAudience,this.idTokenProvider=e.idTokenProvider}async getRequestMetadataAsync(){if(!this.credentials.id_token||!this.credentials.expiry_date||this.isTokenExpiring()){let e=await this.idTokenProvider.fetchIdToken(this.targetAudience);this.credentials={id_token:e,expiry_date:this.getIdTokenExpiryDate(e)}}return{headers:new Headers({authorization:"Bearer "+this.credentials.id_token})}}getIdTokenExpiryDate(e){let t=e.split(".")[1];if(t)return 1e3*JSON.parse(Buffer.from(t,"base64").toString("ascii")).exp}}t.IdTokenClient=i},8362:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Impersonated=t.IMPERSONATED_ACCOUNT_TYPE=void 0;let r=n(851),i=n(5678),o=n(1118);t.IMPERSONATED_ACCOUNT_TYPE="impersonated_service_account";class s extends r.OAuth2Client{sourceClient;targetPrincipal;targetScopes;delegates;lifetime;endpoint;constructor(e={}){if(super(e),this.credentials={expiry_date:1,refresh_token:"impersonated-placeholder"},this.sourceClient=e.sourceClient??new r.OAuth2Client,this.targetPrincipal=e.targetPrincipal??"",this.delegates=e.delegates??[],this.targetScopes=e.targetScopes??[],this.lifetime=e.lifetime??3600,(0,o.originalOrCamelOptions)(e).get("universe_domain")){if(this.sourceClient.universeDomain!==this.universeDomain)throw RangeError(`Universe domain ${this.sourceClient.universeDomain} in source credentials does not match ${this.universeDomain} universe domain set for impersonated credentials.`)}else this.universeDomain=this.sourceClient.universeDomain;this.endpoint=e.endpoint??`https://iamcredentials.${this.universeDomain}`}async sign(e){await this.sourceClient.getAccessToken();let t=`projects/-/serviceAccounts/${this.targetPrincipal}`,n=`${this.endpoint}/v1/${t}:signBlob`,r={delegates:this.delegates,payload:Buffer.from(e).toString("base64")};return(await this.sourceClient.request({...s.RETRY_CONFIG,url:n,data:r,method:"POST"})).data}getTargetPrincipal(){return this.targetPrincipal}async refreshToken(){try{await this.sourceClient.getAccessToken();let e="projects/-/serviceAccounts/"+this.targetPrincipal,t=`${this.endpoint}/v1/${e}:generateAccessToken`,n={delegates:this.delegates,scope:this.targetScopes,lifetime:this.lifetime+"s"},r=await this.sourceClient.request({...s.RETRY_CONFIG,url:t,data:n,method:"POST"}),i=r.data;return this.credentials.access_token=i.accessToken,this.credentials.expiry_date=Date.parse(i.expireTime),{tokens:this.credentials,res:r}}catch(n){if(!(n instanceof Error))throw n;let e=0,t="";if(n instanceof i.GaxiosError&&(e=n?.response?.data?.error?.status,t=n?.response?.data?.error?.message),e&&t)throw n.message=`${e}: unable to impersonate: ${t}`,n;throw n.message=`unable to impersonate: ${n}`,n}}async fetchIdToken(e,t){await this.sourceClient.getAccessToken();let n=`projects/-/serviceAccounts/${this.targetPrincipal}`,r=`${this.endpoint}/v1/${n}:generateIdToken`,i={delegates:this.delegates,audience:e,includeEmail:t?.includeEmail??!0,useEmailAzp:t?.includeEmail??!0};return(await this.sourceClient.request({...s.RETRY_CONFIG,url:r,data:i,method:"POST"})).data.token}}t.Impersonated=s},7712:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JWTAccess=void 0;let r=n(843),i=n(1118),o={alg:"RS256",typ:"JWT"};class s{email;key;keyId;projectId;eagerRefreshThresholdMillis;cache=new i.LRUCache({capacity:500,maxAge:36e5});constructor(e,t,n,r){this.email=e,this.key=t,this.keyId=n,this.eagerRefreshThresholdMillis=r??3e5}getCachedKey(e,t){let n=e;if(t&&Array.isArray(t)&&t.length?n=e?`${e}_${t.join("_")}`:`${t.join("_")}`:"string"==typeof t&&(n=e?`${e}_${t}`:t),!n)throw Error("Scopes or url must be provided");return n}getRequestHeaders(e,t,n){let i;let a=this.getCachedKey(e,n),l=this.cache.get(a),u=Date.now();if(l&&l.expiration-u>this.eagerRefreshThresholdMillis)return new Headers(l.headers);let c=Math.floor(Date.now()/1e3),d=s.getExpirationTime(c);if(Array.isArray(n)&&(n=n.join(" ")),i=n?{iss:this.email,sub:this.email,scope:n,exp:d,iat:c}:{iss:this.email,sub:this.email,aud:e,exp:d,iat:c},t){for(let e in i)if(t[e])throw Error(`The '${e}' property is not allowed when passing additionalClaims. This claim is included in the JWT by default.`)}let h=this.keyId?{...o,kid:this.keyId}:o,p=Object.assign(i,t),f=r.sign({header:h,payload:p,secret:this.key}),m=new Headers({authorization:`Bearer ${f}`});return this.cache.set(a,{expiration:1e3*d,headers:m}),m}static getExpirationTime(e){return e+3600}fromJSON(e){if(!e)throw Error("Must pass in a JSON object containing the service account auth settings.");if(!e.client_email)throw Error("The incoming JSON object does not contain a client_email field");if(!e.private_key)throw Error("The incoming JSON object does not contain a private_key field");this.email=e.client_email,this.key=e.private_key,this.keyId=e.private_key_id,this.projectId=e.project_id}fromStream(e,t){if(!t)return this.fromStreamAsync(e);this.fromStreamAsync(e).then(()=>t(),t)}fromStreamAsync(e){return new Promise((t,n)=>{e||n(Error("Must pass in a stream containing the service account auth settings."));let r="";e.setEncoding("utf8").on("data",e=>r+=e).on("error",n).on("end",()=>{try{let e=JSON.parse(r);this.fromJSON(e),t()}catch(e){n(e)}})})}}t.JWTAccess=s},8444:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JWT=void 0;let r=n(1053),i=n(7712),o=n(851),s=n(4987);class a extends o.OAuth2Client{email;keyFile;key;keyId;defaultScopes;scopes;scope;subject;gtoken;additionalClaims;useJWTAccessWithScope;defaultServicePath;access;constructor(e={}){super(e),this.email=e.email,this.keyFile=e.keyFile,this.key=e.key,this.keyId=e.keyId,this.scopes=e.scopes,this.subject=e.subject,this.additionalClaims=e.additionalClaims,this.credentials={refresh_token:"jwt-placeholder",expiry_date:1}}createScoped(e){let t=new a(this);return t.scopes=e,t}async getRequestMetadataAsync(e){e=this.defaultServicePath?`https://${this.defaultServicePath}/`:e;let t=!this.hasUserScopes()&&e||this.useJWTAccessWithScope&&this.hasAnyScopes()||this.universeDomain!==s.DEFAULT_UNIVERSE;if(this.subject&&this.universeDomain!==s.DEFAULT_UNIVERSE)throw RangeError(`Service Account user is configured for the credential. Domain-wide delegation is not supported in universes other than ${s.DEFAULT_UNIVERSE}`);if(!this.apiKey&&t){if(this.additionalClaims&&this.additionalClaims.target_audience){let{tokens:e}=await this.refreshToken();return{headers:this.addSharedMetadataHeaders(new Headers({authorization:`Bearer ${e.id_token}`}))}}{let t;this.access||(this.access=new i.JWTAccess(this.email,this.key,this.keyId,this.eagerRefreshThresholdMillis)),this.hasUserScopes()?t=this.scopes:e||(t=this.defaultScopes);let n=this.useJWTAccessWithScope||this.universeDomain!==s.DEFAULT_UNIVERSE,r=await this.access.getRequestHeaders(e??void 0,this.additionalClaims,n?t:void 0);return{headers:this.addSharedMetadataHeaders(r)}}}return this.hasAnyScopes()||this.apiKey?super.getRequestMetadataAsync(e):{headers:new Headers}}async fetchIdToken(e){let t=new r.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:{target_audience:e},transporter:this.transporter});if(await t.getToken({forceRefresh:!0}),!t.idToken)throw Error("Unknown error: Failed to fetch ID token");return t.idToken}hasUserScopes(){return!!this.scopes&&this.scopes.length>0}hasAnyScopes(){return!!this.scopes&&this.scopes.length>0||!!this.defaultScopes&&this.defaultScopes.length>0}authorize(e){if(!e)return this.authorizeAsync();this.authorizeAsync().then(t=>e(null,t),e)}async authorizeAsync(){let e=await this.refreshToken();if(!e)throw Error("No result returned");return this.credentials=e.tokens,this.credentials.refresh_token="jwt-placeholder",this.key=this.gtoken.key,this.email=this.gtoken.iss,e.tokens}async refreshTokenNoCache(){let e=this.createGToken(),t={access_token:(await e.getToken({forceRefresh:this.isTokenExpiring()})).access_token,token_type:"Bearer",expiry_date:e.expiresAt,id_token:e.idToken};return this.emit("tokens",t),{res:null,tokens:t}}createGToken(){return this.gtoken||(this.gtoken=new r.GoogleToken({iss:this.email,sub:this.subject,scope:this.scopes||this.defaultScopes,keyFile:this.keyFile,key:this.key,additionalClaims:this.additionalClaims,transporter:this.transporter})),this.gtoken}fromJSON(e){if(!e)throw Error("Must pass in a JSON object containing the service account auth settings.");if(!e.client_email)throw Error("The incoming JSON object does not contain a client_email field");if(!e.private_key)throw Error("The incoming JSON object does not contain a private_key field");this.email=e.client_email,this.key=e.private_key,this.keyId=e.private_key_id,this.projectId=e.project_id,this.quotaProjectId=e.quota_project_id,this.universeDomain=e.universe_domain||this.universeDomain}fromStream(e,t){if(!t)return this.fromStreamAsync(e);this.fromStreamAsync(e).then(()=>t(),t)}fromStreamAsync(e){return new Promise((t,n)=>{if(!e)throw Error("Must pass in a stream containing the service account auth settings.");let r="";e.setEncoding("utf8").on("error",n).on("data",e=>r+=e).on("end",()=>{try{let e=JSON.parse(r);this.fromJSON(e),t()}catch(e){n(e)}})})}fromAPIKey(e){if("string"!=typeof e)throw Error("Must provide an API Key string.");this.apiKey=e}async getCredentials(){if(this.key)return{private_key:this.key,client_email:this.email};if(this.keyFile){let e=this.createGToken(),t=await e.getCredentials(this.keyFile);return{private_key:t.privateKey,client_email:t.clientEmail}}throw Error("A key or a keyFile must be provided to getCredentials.")}}t.JWT=a},4847:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoginTicket=void 0;class n{envelope;payload;constructor(e,t){this.envelope=e,this.payload=t}getEnvelope(){return this.envelope}getPayload(){return this.payload}getUserId(){let e=this.getPayload();return e&&e.sub?e.sub:null}getAttributes(){return{envelope:this.getEnvelope(),payload:this.getPayload()}}}t.LoginTicket=n},851:(e,t,n)=>{"use strict";var r,i,o;Object.defineProperty(t,"__esModule",{value:!0}),t.OAuth2Client=t.ClientAuthentication=t.CertificateFormat=t.CodeChallengeMethod=void 0;let s=n(5678),a=n(6624),l=n(6162),u=n(7145),c=n(1118),d=n(6108),h=n(4987),p=n(4847);(function(e){e.Plain="plain",e.S256="S256"})(r||(t.CodeChallengeMethod=r={})),function(e){e.PEM="PEM",e.JWK="JWK"}(i||(t.CertificateFormat=i={})),function(e){e.ClientSecretPost="ClientSecretPost",e.ClientSecretBasic="ClientSecretBasic",e.None="None"}(o||(t.ClientAuthentication=o={}));class f extends h.AuthClient{redirectUri;certificateCache={};certificateExpiry=null;certificateCacheFormat=i.PEM;refreshTokenPromises=new Map;endpoints;issuers;clientAuthentication;_clientId;_clientSecret;refreshHandler;constructor(e={},t,n){super("object"==typeof e?e:{}),"object"!=typeof e&&(e={clientId:e,clientSecret:t,redirectUri:n}),this._clientId=e.clientId||e.client_id,this._clientSecret=e.clientSecret||e.client_secret,this.redirectUri=e.redirectUri||e.redirect_uris?.[0],this.endpoints={tokenInfoUrl:"https://oauth2.googleapis.com/tokeninfo",oauth2AuthBaseUrl:"https://accounts.google.com/o/oauth2/v2/auth",oauth2TokenUrl:"https://oauth2.googleapis.com/token",oauth2RevokeUrl:"https://oauth2.googleapis.com/revoke",oauth2FederatedSignonPemCertsUrl:"https://www.googleapis.com/oauth2/v1/certs",oauth2FederatedSignonJwkCertsUrl:"https://www.googleapis.com/oauth2/v3/certs",oauth2IapPublicKeyUrl:"https://www.gstatic.com/iap/verify/public_key",...e.endpoints},this.clientAuthentication=e.clientAuthentication||o.ClientSecretPost,this.issuers=e.issuers||["accounts.google.com","https://accounts.google.com",this.universeDomain]}static GOOGLE_TOKEN_INFO_URL="https://oauth2.googleapis.com/tokeninfo";static CLOCK_SKEW_SECS_=300;static DEFAULT_MAX_TOKEN_LIFETIME_SECS_=86400;generateAuthUrl(e={}){if(e.code_challenge_method&&!e.code_challenge)throw Error("If a code_challenge_method is provided, code_challenge must be included.");return e.response_type=e.response_type||"code",e.client_id=e.client_id||this._clientId,e.redirect_uri=e.redirect_uri||this.redirectUri,Array.isArray(e.scope)&&(e.scope=e.scope.join(" ")),this.endpoints.oauth2AuthBaseUrl.toString()+"?"+a.stringify(e)}generateCodeVerifier(){throw Error("generateCodeVerifier is removed, please use generateCodeVerifierAsync instead.")}async generateCodeVerifierAsync(){let e=(0,d.createCrypto)(),t=e.randomBytesBase64(96).replace(/\+/g,"~").replace(/=/g,"_").replace(/\//g,"-"),n=(await e.sha256DigestBase64(t)).split("=")[0].replace(/\+/g,"-").replace(/\//g,"_");return{codeVerifier:t,codeChallenge:n}}getToken(e,t){let n="string"==typeof e?{code:e}:e;if(!t)return this.getTokenAsync(n);this.getTokenAsync(n).then(e=>t(null,e.tokens,e.res),e=>t(e,null,e.response))}async getTokenAsync(e){let t=this.endpoints.oauth2TokenUrl.toString(),n=new Headers,r={client_id:e.client_id||this._clientId,code_verifier:e.codeVerifier,code:e.code,grant_type:"authorization_code",redirect_uri:e.redirect_uri||this.redirectUri};if(this.clientAuthentication===o.ClientSecretBasic){let e=Buffer.from(`${this._clientId}:${this._clientSecret}`);n.set("authorization",`Basic ${e.toString("base64")}`)}this.clientAuthentication===o.ClientSecretPost&&(r.client_secret=this._clientSecret);let i={...f.RETRY_CONFIG,method:"POST",url:t,data:new URLSearchParams((0,c.removeUndefinedValuesInObject)(r)),headers:n};h.AuthClient.setMethodName(i,"getTokenAsync");let s=await this.transporter.request(i),a=s.data;return s.data&&s.data.expires_in&&(a.expiry_date=new Date().getTime()+1e3*s.data.expires_in,delete a.expires_in),this.emit("tokens",a),{tokens:a,res:s}}async refreshToken(e){if(!e)return this.refreshTokenNoCache(e);if(this.refreshTokenPromises.has(e))return this.refreshTokenPromises.get(e);let t=this.refreshTokenNoCache(e).then(t=>(this.refreshTokenPromises.delete(e),t),t=>{throw this.refreshTokenPromises.delete(e),t});return this.refreshTokenPromises.set(e,t),t}async refreshTokenNoCache(e){let t;if(!e)throw Error("No refresh token is set.");let n=this.endpoints.oauth2TokenUrl.toString(),r={refresh_token:e,client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token"};try{let e={...f.RETRY_CONFIG,method:"POST",url:n,data:new URLSearchParams((0,c.removeUndefinedValuesInObject)(r))};h.AuthClient.setMethodName(e,"refreshTokenNoCache"),t=await this.transporter.request(e)}catch(e){throw e instanceof s.GaxiosError&&"invalid_grant"===e.message&&e.response?.data&&/ReAuth/i.test(e.response.data.error_description)&&(e.message=JSON.stringify(e.response.data)),e}let i=t.data;return t.data&&t.data.expires_in&&(i.expiry_date=new Date().getTime()+1e3*t.data.expires_in,delete i.expires_in),this.emit("tokens",i),{tokens:i,res:t}}refreshAccessToken(e){if(!e)return this.refreshAccessTokenAsync();this.refreshAccessTokenAsync().then(t=>e(null,t.credentials,t.res),e)}async refreshAccessTokenAsync(){let e=await this.refreshToken(this.credentials.refresh_token),t=e.tokens;return t.refresh_token=this.credentials.refresh_token,this.credentials=t,{credentials:this.credentials,res:e.res}}getAccessToken(e){if(!e)return this.getAccessTokenAsync();this.getAccessTokenAsync().then(t=>e(null,t.token,t.res),e)}async getAccessTokenAsync(){if(!(!this.credentials.access_token||this.isTokenExpiring()))return{token:this.credentials.access_token};{if(!this.credentials.refresh_token){if(this.refreshHandler){let e=await this.processAndValidateRefreshHandler();if(e?.access_token)return this.setCredentials(e),{token:this.credentials.access_token}}else throw Error("No refresh token or refresh handler callback is set.")}let e=await this.refreshAccessTokenAsync();if(!e.credentials||e.credentials&&!e.credentials.access_token)throw Error("Could not refresh access token.");return{token:e.credentials.access_token,res:e.res}}}async getRequestHeaders(e){return(await this.getRequestMetadataAsync(e)).headers}async getRequestMetadataAsync(e){let t=this.credentials;if(!t.access_token&&!t.refresh_token&&!this.apiKey&&!this.refreshHandler)throw Error("No access, refresh token, API key or refresh handler callback is set.");if(t.access_token&&!this.isTokenExpiring()){t.token_type=t.token_type||"Bearer";let e=new Headers({authorization:t.token_type+" "+t.access_token});return{headers:this.addSharedMetadataHeaders(e)}}if(this.refreshHandler){let e=await this.processAndValidateRefreshHandler();if(e?.access_token){this.setCredentials(e);let t=new Headers({authorization:"Bearer "+this.credentials.access_token});return{headers:this.addSharedMetadataHeaders(t)}}}if(this.apiKey)return{headers:new Headers({"X-Goog-Api-Key":this.apiKey})};let n=null,r=null;try{r=(n=await this.refreshToken(t.refresh_token)).tokens}catch(e){throw e.response&&(403===e.response.status||404===e.response.status)&&(e.message=`Could not refresh access token: ${e.message}`),e}let i=this.credentials;i.token_type=i.token_type||"Bearer",r.refresh_token=i.refresh_token,this.credentials=r;let o=new Headers({authorization:i.token_type+" "+r.access_token});return{headers:this.addSharedMetadataHeaders(o),res:n.res}}static getRevokeTokenUrl(e){return new f().getRevokeTokenURL(e).toString()}getRevokeTokenURL(e){let t=new URL(this.endpoints.oauth2RevokeUrl);return t.searchParams.append("token",e),t}revokeToken(e,t){let n={...f.RETRY_CONFIG,url:this.getRevokeTokenURL(e).toString(),method:"POST"};if(h.AuthClient.setMethodName(n,"revokeToken"),!t)return this.transporter.request(n);this.transporter.request(n).then(e=>t(null,e),t)}revokeCredentials(e){if(!e)return this.revokeCredentialsAsync();this.revokeCredentialsAsync().then(t=>e(null,t),e)}async revokeCredentialsAsync(){let e=this.credentials.access_token;if(this.credentials={},e)return this.revokeToken(e);throw Error("No access token to revoke.")}request(e,t){if(!t)return this.requestAsync(e);this.requestAsync(e).then(e=>t(null,e),e=>t(e,e.response))}async requestAsync(e,t=!1){try{let t=await this.getRequestMetadataAsync();return e.headers=s.Gaxios.mergeHeaders(e.headers),this.addUserProjectAndAuthHeaders(e.headers,t.headers),this.apiKey&&e.headers.set("X-Goog-Api-Key",this.apiKey),await this.transporter.request(e)}catch(r){let n=r.response;if(n){let r=n.status,i=this.credentials&&this.credentials.access_token&&this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure),o=this.credentials&&this.credentials.access_token&&!this.credentials.refresh_token&&(!this.credentials.expiry_date||this.forceRefreshOnFailure)&&this.refreshHandler,s=n.config.data instanceof l.Readable,a=401===r||403===r;if(!t&&a&&!s&&i)return await this.refreshAccessTokenAsync(),this.requestAsync(e,!0);if(!t&&a&&!s&&o){let t=await this.processAndValidateRefreshHandler();return t?.access_token&&this.setCredentials(t),this.requestAsync(e,!0)}}throw r}}verifyIdToken(e,t){if(t&&"function"!=typeof t)throw Error("This method accepts an options object as the first parameter, which includes the idToken, audience, and maxExpiry.");if(!t)return this.verifyIdTokenAsync(e);this.verifyIdTokenAsync(e).then(e=>t(null,e),t)}async verifyIdTokenAsync(e){if(!e.idToken)throw Error("The verifyIdToken method requires an ID Token");let t=await this.getFederatedSignonCertsAsync();return await this.verifySignedJwtWithCertsAsync(e.idToken,t.certs,e.audience,this.issuers,e.maxExpiry)}async getTokenInfo(e){let{data:t}=await this.transporter.request({...f.RETRY_CONFIG,method:"POST",headers:{"content-type":"application/x-www-form-urlencoded;charset=UTF-8",authorization:`Bearer ${e}`},url:this.endpoints.tokenInfoUrl.toString()}),n=Object.assign({expiry_date:new Date().getTime()+1e3*t.expires_in,scopes:t.scope.split(" ")},t);return delete n.expires_in,delete n.scope,n}getFederatedSignonCerts(e){if(!e)return this.getFederatedSignonCertsAsync();this.getFederatedSignonCertsAsync().then(t=>e(null,t.certs,t.res),e)}async getFederatedSignonCertsAsync(){let e,t;let n=new Date().getTime(),r=(0,d.hasBrowserCrypto)()?i.JWK:i.PEM;if(this.certificateExpiry&&n<this.certificateExpiry.getTime()&&this.certificateCacheFormat===r)return{certs:this.certificateCache,format:r};switch(r){case i.PEM:t=this.endpoints.oauth2FederatedSignonPemCertsUrl.toString();break;case i.JWK:t=this.endpoints.oauth2FederatedSignonJwkCertsUrl.toString();break;default:throw Error(`Unsupported certificate format ${r}`)}try{let n={...f.RETRY_CONFIG,url:t};h.AuthClient.setMethodName(n,"getFederatedSignonCertsAsync"),e=await this.transporter.request(n)}catch(e){throw e instanceof Error&&(e.message=`Failed to retrieve verification certificates: ${e.message}`),e}let o=e?.headers.get("cache-control"),s=-1;if(o){let e=/max-age=(?<maxAge>[0-9]+)/.exec(o)?.groups?.maxAge;e&&(s=1e3*Number(e))}let a={};switch(r){case i.PEM:a=e.data;break;case i.JWK:for(let t of e.data.keys)a[t.kid]=t;break;default:throw Error(`Unsupported certificate format ${r}`)}let l=new Date;return this.certificateExpiry=-1===s?null:new Date(l.getTime()+s),this.certificateCache=a,this.certificateCacheFormat=r,{certs:a,format:r,res:e}}getIapPublicKeys(e){if(!e)return this.getIapPublicKeysAsync();this.getIapPublicKeysAsync().then(t=>e(null,t.pubkeys,t.res),e)}async getIapPublicKeysAsync(){let e;let t=this.endpoints.oauth2IapPublicKeyUrl.toString();try{let n={...f.RETRY_CONFIG,url:t};h.AuthClient.setMethodName(n,"getIapPublicKeysAsync"),e=await this.transporter.request(n)}catch(e){throw e instanceof Error&&(e.message=`Failed to retrieve verification certificates: ${e.message}`),e}return{pubkeys:e.data,res:e}}verifySignedJwtWithCerts(){throw Error("verifySignedJwtWithCerts is removed, please use verifySignedJwtWithCertsAsync instead.")}async verifySignedJwtWithCertsAsync(e,t,n,r,i){let o,s;let a=(0,d.createCrypto)();i||(i=f.DEFAULT_MAX_TOKEN_LIFETIME_SECS_);let l=e.split(".");if(3!==l.length)throw Error("Wrong number of segments in token: "+e);let c=l[0]+"."+l[1],h=l[2];try{o=JSON.parse(a.decodeBase64StringUtf8(l[0]))}catch(e){throw e instanceof Error&&(e.message=`Can't parse token envelope: ${l[0]}': ${e.message}`),e}if(!o)throw Error("Can't parse token envelope: "+l[0]);try{s=JSON.parse(a.decodeBase64StringUtf8(l[1]))}catch(e){throw e instanceof Error&&(e.message=`Can't parse token payload '${l[0]}`),e}if(!s)throw Error("Can't parse token payload: "+l[1]);if(!Object.prototype.hasOwnProperty.call(t,o.kid))throw Error("No pem found for envelope: "+JSON.stringify(o));let m=t[o.kid];if("ES256"===o.alg&&(h=u.joseToDer(h,"ES256").toString("base64")),!await a.verify(m,c,h))throw Error("Invalid token signature: "+e);if(!s.iat)throw Error("No issue time in token: "+JSON.stringify(s));if(!s.exp)throw Error("No expiration time in token: "+JSON.stringify(s));let g=Number(s.iat);if(isNaN(g))throw Error("iat field using invalid format");let y=Number(s.exp);if(isNaN(y))throw Error("exp field using invalid format");let v=new Date().getTime()/1e3;if(y>=v+i)throw Error("Expiration time too far in future: "+JSON.stringify(s));let _=g-f.CLOCK_SKEW_SECS_,b=y+f.CLOCK_SKEW_SECS_;if(v<_)throw Error("Token used too early, "+v+" < "+_+": "+JSON.stringify(s));if(v>b)throw Error("Token used too late, "+v+" > "+b+": "+JSON.stringify(s));if(r&&0>r.indexOf(s.iss))throw Error("Invalid issuer, expected one of ["+r+"], but got "+s.iss);if(null!=n){let e=s.aud;if(!(n.constructor===Array?n.indexOf(e)>-1:e===n))throw Error("Wrong recipient, payload audience != requiredAudience")}return new p.LoginTicket(o,s)}async processAndValidateRefreshHandler(){if(this.refreshHandler){let e=await this.refreshHandler();if(!e.access_token)throw Error("No access token is returned by the refreshHandler callback.");return e}}isTokenExpiring(){let e=this.credentials.expiry_date;return!!e&&e<=new Date().getTime()+this.eagerRefreshThresholdMillis}}t.OAuth2Client=f},9061:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.OAuthClientAuthHandler=void 0,t.getErrorFromOAuthErrorResponse=function(e,t){let n=e.error,r=e.error_description,i=e.error_uri,o=`Error code ${n}`;void 0!==r&&(o+=`: ${r}`),void 0!==i&&(o+=` - ${i}`);let s=Error(o);if(t){let e=Object.keys(t);t.stack&&e.push("stack"),e.forEach(e=>{"message"!==e&&Object.defineProperty(s,e,{value:t[e],writable:!1,enumerable:!0})})}return s};let r=n(5678),i=n(6108),o=["PUT","POST","PATCH"];class s{#A=(0,i.createCrypto)();#C;transporter;constructor(e){e&&"clientId"in e?(this.#C=e,this.transporter=new r.Gaxios):(this.#C=e?.clientAuthentication,this.transporter=e?.transporter||new r.Gaxios)}applyClientAuthenticationOptions(e,t){e.headers=r.Gaxios.mergeHeaders(e.headers),this.injectAuthenticatedHeaders(e,t),t||this.injectAuthenticatedRequestBody(e)}injectAuthenticatedHeaders(e,t){if(t)e.headers=r.Gaxios.mergeHeaders(e.headers,{authorization:`Bearer ${t}`});else if(this.#C?.confidentialClientType==="basic"){e.headers=r.Gaxios.mergeHeaders(e.headers);let t=this.#C.clientId,n=this.#C.clientSecret||"",i=this.#A.encodeBase64StringUtf8(`${t}:${n}`);r.Gaxios.mergeHeaders(e.headers,{authorization:`Basic ${i}`})}}injectAuthenticatedRequestBody(e){if(this.#C?.confidentialClientType==="request-body"){let t=(e.method||"GET").toUpperCase();if(!o.includes(t))throw Error(`${t} HTTP method does not support ${this.#C.confidentialClientType} client authentication`);let n=new Headers(e.headers).get("content-type");if(n?.startsWith("application/x-www-form-urlencoded")||e.data instanceof URLSearchParams){let t=new URLSearchParams(e.data??"");t.append("client_id",this.#C.clientId),t.append("client_secret",this.#C.clientSecret||""),e.data=t}else if(n?.startsWith("application/json"))e.data=e.data||{},Object.assign(e.data,{client_id:this.#C.clientId,client_secret:this.#C.clientSecret||""});else throw Error(`${n} content-types are not supported with ${this.#C.confidentialClientType} client authentication`)}}static get RETRY_CONFIG(){return{retry:!0,retryConfig:{httpMethodsToRetry:["GET","PUT","POST","HEAD","OPTIONS","DELETE"]}}}}t.OAuthClientAuthHandler=s},8378:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PassThroughClient=void 0;let r=n(4987);class i extends r.AuthClient{async request(e){return this.transporter.request(e)}async getAccessToken(){return{}}async getRequestHeaders(){return new Headers}}t.PassThroughClient=i},1202:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PluggableAuthClient=t.ExecutableError=void 0;let r=n(7116),i=n(8358),o=n(7216);var s=n(7216);Object.defineProperty(t,"ExecutableError",{enumerable:!0,get:function(){return s.ExecutableError}});class a extends r.BaseExternalAccountClient{command;timeoutMillis;outputFile;handler;constructor(e){if(super(e),!e.credential_source.executable||(this.command=e.credential_source.executable.command,!this.command))throw Error('No valid Pluggable Auth "credential_source" provided.');if(void 0===e.credential_source.executable.timeout_millis)this.timeoutMillis=3e4;else if(this.timeoutMillis=e.credential_source.executable.timeout_millis,this.timeoutMillis<5e3||this.timeoutMillis>12e4)throw Error("Timeout must be between 5000120000 milliseconds.");this.outputFile=e.credential_source.executable.output_file,this.handler=new o.PluggableAuthHandler({command:this.command,timeoutMillis:this.timeoutMillis,outputFile:this.outputFile}),this.credentialSourceType="executable"}async retrieveSubjectToken(){let e;if("1"!==process.env.GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES)throw Error("Pluggable Auth executables need to be explicitly allowed to run by setting the GOOGLE_EXTERNAL_ACCOUNT_ALLOW_EXECUTABLES environment Variable to 1.");if(this.outputFile&&(e=await this.handler.retrieveCachedResponse()),!e){let t=new Map;t.set("GOOGLE_EXTERNAL_ACCOUNT_AUDIENCE",this.audience),t.set("GOOGLE_EXTERNAL_ACCOUNT_TOKEN_TYPE",this.subjectTokenType),t.set("GOOGLE_EXTERNAL_ACCOUNT_INTERACTIVE","0"),this.outputFile&&t.set("GOOGLE_EXTERNAL_ACCOUNT_OUTPUT_FILE",this.outputFile);let n=this.getServiceAccountEmail();n&&t.set("GOOGLE_EXTERNAL_ACCOUNT_IMPERSONATED_EMAIL",n),e=await this.handler.retrieveResponseFromExecutable(t)}if(e.version>1)throw Error("Version of executable is not currently supported, maximum supported version is 1.");if(!e.success)throw new o.ExecutableError(e.errorMessage,e.errorCode);if(this.outputFile&&!e.expirationTime)throw new i.InvalidExpirationTimeFieldError("The executable response must contain the `expiration_time` field for successful responses when an output_file has been specified in the configuration.");if(e.isExpired())throw Error("Executable response is expired.");return e.subjectToken}}t.PluggableAuthClient=a},7216:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PluggableAuthHandler=t.ExecutableError=void 0;let r=n(8358),i=n(1282),o=n(2048);class s extends Error{code;constructor(e,t){super(`The executable failed with exit code: ${t} and error message: ${e}.`),this.code=t,Object.setPrototypeOf(this,new.target.prototype)}}t.ExecutableError=s;class a{commandComponents;timeoutMillis;outputFile;constructor(e){if(!e.command)throw Error("No command provided.");if(this.commandComponents=a.parseCommand(e.command),this.timeoutMillis=e.timeoutMillis,!this.timeoutMillis)throw Error("No timeoutMillis provided.");this.outputFile=e.outputFile}retrieveResponseFromExecutable(e){return new Promise((t,n)=>{let o=i.spawn(this.commandComponents[0],this.commandComponents.slice(1),{env:{...process.env,...Object.fromEntries(e)}}),a="";o.stdout.on("data",e=>{a+=e}),o.stderr.on("data",e=>{a+=e});let l=setTimeout(()=>(o.removeAllListeners(),o.kill(),n(Error("The executable failed to finish within the timeout specified."))),this.timeoutMillis);o.on("close",e=>{if(clearTimeout(l),0!==e)return n(new s(a,e.toString()));try{let e=JSON.parse(a),n=new r.ExecutableResponse(e);return t(n)}catch(e){if(e instanceof r.ExecutableResponseError)return n(e);return n(new r.ExecutableResponseError(`The executable returned an invalid response: ${a}`))}})})}async retrieveCachedResponse(){let e;if(!this.outputFile||0===this.outputFile.length)return;try{e=await o.promises.realpath(this.outputFile)}catch{return}if(!(await o.promises.lstat(e)).isFile())return;let t=await o.promises.readFile(e,{encoding:"utf8"});if(""!==t)try{let e=JSON.parse(t);if(new r.ExecutableResponse(e).isValid())return new r.ExecutableResponse(e);return}catch(e){if(e instanceof r.ExecutableResponseError)throw e;throw new r.ExecutableResponseError(`The output file contained an invalid response: ${t}`)}}static parseCommand(e){let t=e.match(/(?:[^\s"]+|"[^"]*")+/g);if(!t)throw Error(`Provided command: "${e}" could not be parsed.`);for(let e=0;e<t.length;e++)'"'===t[e][0]&&'"'===t[e].slice(-1)&&(t[e]=t[e].slice(1,-1));return t}}t.PluggableAuthHandler=a},5243:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserRefreshClient=t.USER_REFRESH_ACCOUNT_TYPE=void 0;let r=n(851),i=n(4987);t.USER_REFRESH_ACCOUNT_TYPE="authorized_user";class o extends r.OAuth2Client{_refreshToken;constructor(e,t,n,r,i){let o=e&&"object"==typeof e?e:{clientId:e,clientSecret:t,refreshToken:n,eagerRefreshThresholdMillis:r,forceRefreshOnFailure:i};super(o),this._refreshToken=o.refreshToken,this.credentials.refresh_token=o.refreshToken}async refreshTokenNoCache(){return super.refreshTokenNoCache(this._refreshToken)}async fetchIdToken(e){let t={...o.RETRY_CONFIG,url:this.endpoints.oauth2TokenUrl,method:"POST",data:new URLSearchParams({client_id:this._clientId,client_secret:this._clientSecret,grant_type:"refresh_token",refresh_token:this._refreshToken,target_audience:e})};return i.AuthClient.setMethodName(t,"fetchIdToken"),(await this.transporter.request(t)).data.id_token}fromJSON(e){if(!e)throw Error("Must pass in a JSON object containing the user refresh token");if("authorized_user"!==e.type)throw Error('The incoming JSON object does not have the "authorized_user" type');if(!e.client_id)throw Error("The incoming JSON object does not contain a client_id field");if(!e.client_secret)throw Error("The incoming JSON object does not contain a client_secret field");if(!e.refresh_token)throw Error("The incoming JSON object does not contain a refresh_token field");this._clientId=e.client_id,this._clientSecret=e.client_secret,this._refreshToken=e.refresh_token,this.credentials.refresh_token=e.refresh_token,this.quotaProjectId=e.quota_project_id,this.universeDomain=e.universe_domain||this.universeDomain}fromStream(e,t){if(!t)return this.fromStreamAsync(e);this.fromStreamAsync(e).then(()=>t(),t)}async fromStreamAsync(e){return new Promise((t,n)=>{if(!e)return n(Error("Must pass in a stream containing the user refresh token."));let r="";e.setEncoding("utf8").on("error",n).on("data",e=>r+=e).on("end",()=>{try{let e=JSON.parse(r);return this.fromJSON(e),t()}catch(e){return n(e)}})})}static fromJSON(e){let t=new o;return t.fromJSON(e),t}}t.UserRefreshClient=o},5161:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StsCredentials=void 0;let r=n(5678),i=n(4987),o=n(9061),s=n(1118);class a extends o.OAuthClientAuthHandler{#O;constructor(e={tokenExchangeEndpoint:""},t){("object"!=typeof e||e instanceof URL)&&(e={tokenExchangeEndpoint:e,clientAuthentication:t}),super(e),this.#O=e.tokenExchangeEndpoint}async exchangeToken(e,t,n){let l={grant_type:e.grantType,resource:e.resource,audience:e.audience,scope:e.scope?.join(" "),requested_token_type:e.requestedTokenType,subject_token:e.subjectToken,subject_token_type:e.subjectTokenType,actor_token:e.actingParty?.actorToken,actor_token_type:e.actingParty?.actorTokenType,options:n&&JSON.stringify(n)},u={...a.RETRY_CONFIG,url:this.#O.toString(),method:"POST",headers:t,data:new URLSearchParams((0,s.removeUndefinedValuesInObject)(l))};i.AuthClient.setMethodName(u,"exchangeToken"),this.applyClientAuthenticationOptions(u);try{let e=await this.transporter.request(u),t=e.data;return t.res=e,t}catch(e){if(e instanceof r.GaxiosError&&e.response)throw(0,o.getErrorFromOAuthErrorResponse)(e.response.data,e);throw e}}}t.StsCredentials=a},8934:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UrlSubjectTokenSupplier=void 0;let r=n(4987);class i{url;headers;formatType;subjectTokenFieldName;additionalGaxiosOptions;constructor(e){this.url=e.url,this.formatType=e.formatType,this.subjectTokenFieldName=e.subjectTokenFieldName,this.headers=e.headers,this.additionalGaxiosOptions=e.additionalGaxiosOptions}async getSubjectToken(e){let t;let n={...this.additionalGaxiosOptions,url:this.url,method:"GET",headers:this.headers};if(r.AuthClient.setMethodName(n,"getSubjectToken"),"text"===this.formatType?t=(await e.transporter.request(n)).data:"json"===this.formatType&&this.subjectTokenFieldName&&(t=(await e.transporter.request(n)).data[this.subjectTokenFieldName]),!t)throw Error("Unable to parse the subject_token from the credential_source URL");return t}}t.UrlSubjectTokenSupplier=i},320:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BrowserCrypto=void 0;let r=n(5017),i=n(9499);class o{constructor(){if("undefined"==typeof window||void 0===window.crypto||void 0===window.crypto.subtle)throw Error("SubtleCrypto not found. Make sure it's an https:// website.")}async sha256DigestBase64(e){let t=new TextEncoder().encode(e),n=await window.crypto.subtle.digest("SHA-256",t);return r.fromByteArray(new Uint8Array(n))}randomBytesBase64(e){let t=new Uint8Array(e);return window.crypto.getRandomValues(t),r.fromByteArray(t)}static padBase64(e){for(;e.length%4!=0;)e+="=";return e}async verify(e,t,n){let i={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},s=new TextEncoder().encode(t),a=r.toByteArray(o.padBase64(n)),l=await window.crypto.subtle.importKey("jwk",e,i,!0,["verify"]);return await window.crypto.subtle.verify(i,l,a,s)}async sign(e,t){let n={name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},i=new TextEncoder().encode(t),o=await window.crypto.subtle.importKey("jwk",e,n,!0,["sign"]),s=await window.crypto.subtle.sign(n,o,i);return r.fromByteArray(new Uint8Array(s))}decodeBase64StringUtf8(e){let t=r.toByteArray(o.padBase64(e));return new TextDecoder().decode(t)}encodeBase64StringUtf8(e){let t=new TextEncoder().encode(e);return r.fromByteArray(t)}async sha256DigestHex(e){let t=new TextEncoder().encode(e),n=await window.crypto.subtle.digest("SHA-256",t);return(0,i.fromArrayBufferToHex)(n)}async signWithHmacSha256(e,t){let n="string"==typeof e?e:String.fromCharCode(...new Uint16Array(e)),r=new TextEncoder,i=await window.crypto.subtle.importKey("raw",r.encode(n),{name:"HMAC",hash:{name:"SHA-256"}},!1,["sign"]);return window.crypto.subtle.sign("HMAC",i,r.encode(t))}}t.BrowserCrypto=o},6108:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.createCrypto=function(){return a()?new o.BrowserCrypto:new s.NodeCrypto},t.hasBrowserCrypto=a;let o=n(320),s=n(6606);function a(){return"undefined"!=typeof window&&void 0!==window.crypto&&void 0!==window.crypto.subtle}i(n(9499),t)},6606:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.NodeCrypto=void 0;let r=n(4770);class i{async sha256DigestBase64(e){return r.createHash("sha256").update(e).digest("base64")}randomBytesBase64(e){return r.randomBytes(e).toString("base64")}async verify(e,t,n){let i=r.createVerify("RSA-SHA256");return i.update(t),i.end(),i.verify(e,n,"base64")}async sign(e,t){let n=r.createSign("RSA-SHA256");return n.update(t),n.end(),n.sign(e,"base64")}decodeBase64StringUtf8(e){return Buffer.from(e,"base64").toString("utf-8")}encodeBase64StringUtf8(e){return Buffer.from(e,"utf-8").toString("base64")}async sha256DigestHex(e){return r.createHash("sha256").update(e).digest("hex")}async signWithHmacSha256(e,t){var n;let i="string"==typeof e?e:Buffer.from(e);return(n=r.createHmac("sha256",i).update(t).digest()).buffer.slice(n.byteOffset,n.byteOffset+n.byteLength)}}t.NodeCrypto=i},9499:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.fromArrayBufferToHex=function(e){return Array.from(new Uint8Array(e)).map(e=>e.toString(16).padStart(2,"0")).join("")}},3064:(e,t,n)=>{"use strict";t.eE=void 0;let r=n(2501);Object.defineProperty(t,"eE",{enumerable:!0,get:function(){return r.GoogleAuth}}),n(9972),n(5678),n(4987),n(1473),n(3530),n(1805),n(6405),n(7712),n(8444),n(8362),n(851),n(4847),n(5243),n(659),n(203),n(4057),n(1962),n(7116),n(76),n(1202),n(4875),n(8378),new r.GoogleAuth},1118:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LRUCache=void 0,t.snakeToCamel=a,t.originalOrCamelOptions=function(e){return{get:function(t){let n=e||{};return n[t]??n[a(t)]}}},t.removeUndefinedValuesInObject=function(e){return Object.entries(e).forEach(([t,n])=>{(void 0===n||"undefined"===n)&&delete e[t]}),e},t.isValidFile=u,t.getWellKnownCertificateConfigFileLocation=function(){let e=process.env.CLOUDSDK_CONFIG||(i.platform().startsWith("win")?o.join(process.env.APPDATA||"",s):o.join(process.env.HOME||"",".config",s));return o.join(e,"certificate_config.json")};let r=n(2048),i=n(9801),o=n(5315),s="gcloud";function a(e){return e.replace(/([_][^_])/g,e=>e.slice(1).toUpperCase())}class l{capacity;#I=new Map;maxAge;constructor(e){this.capacity=e.capacity,this.maxAge=e.maxAge}#k(e,t){this.#I.delete(e),this.#I.set(e,{value:t,lastAccessed:Date.now()})}set(e,t){this.#k(e,t),this.#R()}get(e){let t=this.#I.get(e);if(t)return this.#k(e,t.value),this.#R(),t.value}#R(){let e=this.maxAge?Date.now()-this.maxAge:0,t=this.#I.entries().next();for(;!t.done&&(this.#I.size>this.capacity||t.value[1].lastAccessed<e);)this.#I.delete(t.value[0]),t=this.#I.entries().next()}}async function u(e){try{return(await r.promises.lstat(e)).isFile()}catch(e){return!1}}t.LRUCache=l},4137:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Colours=void 0;class n{static isEnabled(e){return e&&e.isTTY&&("function"!=typeof e.getColorDepth||e.getColorDepth()>2)}static refresh(){n.enabled=n.isEnabled(null==process?void 0:process.stderr),this.enabled?(n.reset="\x1b[0m",n.bright="\x1b[1m",n.dim="\x1b[2m",n.red="\x1b[31m",n.green="\x1b[32m",n.yellow="\x1b[33m",n.blue="\x1b[34m",n.magenta="\x1b[35m",n.cyan="\x1b[36m",n.white="\x1b[37m",n.grey="\x1b[90m"):(n.reset="",n.bright="",n.dim="",n.red="",n.green="",n.yellow="",n.blue="",n.magenta="",n.cyan="",n.white="",n.grey="")}}t.Colours=n,n.enabled=!1,n.reset="",n.bright="",n.dim="",n.red="",n.green="",n.yellow="",n.blue="",n.magenta="",n.cyan="",n.white="",n.grey="",n.refresh()},3340:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(4488),t)},4488:function(e,t,n){"use strict";let r;var i,o,s,a=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),l=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),u=this&&this.__importStar||(i=function(e){return(i=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t})(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=i(e),r=0;r<n.length;r++)"default"!==n[r]&&a(t,e,n[r]);return l(t,e),t});Object.defineProperty(t,"__esModule",{value:!0}),t.env=t.DebugLogBackendBase=t.placeholder=t.AdhocDebugLogger=t.LogSeverity=void 0,t.getNodeBackend=y,t.getDebugBackend=function(e){return new v(e)},t.getStructuredBackend=function(e){return new _(e)},t.setBackend=function(e){r=e,b.clear()},t.log=E;let c=n(7702),d=u(n(5816)),h=u(n(1764)),p=n(4137);(o=s||(t.LogSeverity=s={})).DEFAULT="DEFAULT",o.DEBUG="DEBUG",o.INFO="INFO",o.WARNING="WARNING",o.ERROR="ERROR";class f extends c.EventEmitter{constructor(e,t){super(),this.namespace=e,this.upstream=t,this.func=Object.assign(this.invoke.bind(this),{instance:this,on:(e,t)=>this.on(e,t)}),this.func.debug=(...e)=>this.invokeSeverity(s.DEBUG,...e),this.func.info=(...e)=>this.invokeSeverity(s.INFO,...e),this.func.warn=(...e)=>this.invokeSeverity(s.WARNING,...e),this.func.error=(...e)=>this.invokeSeverity(s.ERROR,...e),this.func.sublog=e=>E(e,this.func)}invoke(e,...t){if(this.upstream)try{this.upstream(e,...t)}catch(e){}try{this.emit("log",e,t)}catch(e){}}invokeSeverity(e,...t){this.invoke({severity:e},...t)}}t.AdhocDebugLogger=f,t.placeholder=new f("",()=>{}).func;class m{constructor(){var e;this.cached=new Map,this.filters=[],this.filtersSet=!1;let n=null!==(e=d.env[t.env.nodeEnables])&&void 0!==e?e:"*";"all"===n&&(n="*"),this.filters=n.split(",")}log(e,t,...n){try{this.filtersSet||(this.setFilters(),this.filtersSet=!0);let r=this.cached.get(e);r||(r=this.makeLogger(e),this.cached.set(e,r)),r(t,...n)}catch(e){console.error(e)}}}t.DebugLogBackendBase=m;class g extends m{constructor(){super(...arguments),this.enabledRegexp=/.*/g}isEnabled(e){return this.enabledRegexp.test(e)}makeLogger(e){return this.enabledRegexp.test(e)?(t,...n)=>{var r;let i;let o=`${p.Colours.green}${e}${p.Colours.reset}`,a=`${p.Colours.yellow}${d.pid}${p.Colours.reset}`;switch(t.severity){case s.ERROR:i=`${p.Colours.red}${t.severity}${p.Colours.reset}`;break;case s.INFO:i=`${p.Colours.magenta}${t.severity}${p.Colours.reset}`;break;case s.WARNING:i=`${p.Colours.yellow}${t.severity}${p.Colours.reset}`;break;default:i=null!==(r=t.severity)&&void 0!==r?r:s.DEFAULT}let l=h.formatWithOptions({colors:p.Colours.enabled},...n),u=Object.assign({},t);delete u.severity;let c=Object.getOwnPropertyNames(u).length?JSON.stringify(u):"",f=c?`${p.Colours.grey}${c}${p.Colours.reset}`:"";console.error("%s [%s|%s] %s%s",a,o,i,l,c?` ${f}`:"")}:()=>{}}setFilters(){let e=this.filters.join(",").replace(/[|\\{}()[\]^$+?.]/g,"\\$&").replace(/\*/g,".*").replace(/,/g,"$|^");this.enabledRegexp=RegExp(`^${e}$`,"i")}}function y(){return new g}class v extends m{constructor(e){super(),this.debugPkg=e}makeLogger(e){let t=this.debugPkg(e);return(e,...n)=>{t(n[0],...n.slice(1))}}setFilters(){var e;let t=null!==(e=d.env.NODE_DEBUG)&&void 0!==e?e:"";d.env.NODE_DEBUG=`${t}${t?",":""}${this.filters.join(",")}`}}class _ extends m{constructor(e){super(),this.upstream=null!=e?e:void 0}makeLogger(e){var t;let n=null===(t=this.upstream)||void 0===t?void 0:t.makeLogger(e);return(e,...t)=>{var r;let i=JSON.stringify(Object.assign({severity:null!==(r=e.severity)&&void 0!==r?r:s.INFO,message:h.format(...t)},e));n?n(e,i):console.log("%s",i)}}setFilters(){var e;null===(e=this.upstream)||void 0===e||e.setFilters()}}t.env={nodeEnables:"GOOGLE_SDK_NODE_LOGGING"};let b=new Map;function E(e,n){let i;if(!r&&!d.env[t.env.nodeEnables]||!e)return t.placeholder;n&&(e=`${n.instance.namespace}:${e}`);let o=b.get(e);if(o)return o.func;if(null===r)return t.placeholder;void 0===r&&(r=y());let s=new f(e,(t,...n)=>{if(i!==r){if(null===r)return;void 0===r&&(r=y()),i=r}null==r||r.log(e,t,...n)});return b.set(e,s),s.func}},9180:(e,t,n)=>{var r=n(7777).stringify,i=n(664);e.exports=function(e){return{parse:i(e),stringify:r}},e.exports.parse=i(),e.exports.stringify=r},664:(e,t,n)=>{var r=null;let i=/(?:_|\\u005[Ff])(?:_|\\u005[Ff])(?:p|\\u0070)(?:r|\\u0072)(?:o|\\u006[Ff])(?:t|\\u0074)(?:o|\\u006[Ff])(?:_|\\u005[Ff])(?:_|\\u005[Ff])/,o=/(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)/;e.exports=function(e){"use strict";var t={strict:!1,storeAsString:!1,alwaysParseAsBig:!1,useNativeBigInt:!1,protoAction:"error",constructorAction:"error"};if(null!=e){if(!0===e.strict&&(t.strict=!0),!0===e.storeAsString&&(t.storeAsString=!0),t.alwaysParseAsBig=!0===e.alwaysParseAsBig&&e.alwaysParseAsBig,t.useNativeBigInt=!0===e.useNativeBigInt&&e.useNativeBigInt,void 0!==e.constructorAction){if("error"===e.constructorAction||"ignore"===e.constructorAction||"preserve"===e.constructorAction)t.constructorAction=e.constructorAction;else throw Error(`Incorrect value for constructorAction option, must be "error", "ignore" or undefined but passed ${e.constructorAction}`)}if(void 0!==e.protoAction){if("error"===e.protoAction||"ignore"===e.protoAction||"preserve"===e.protoAction)t.protoAction=e.protoAction;else throw Error(`Incorrect value for protoAction option, must be "error", "ignore" or undefined but passed ${e.protoAction}`)}}var s,a,l,u,c={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"	"},d=function(e){throw{name:"SyntaxError",message:e,at:s,text:l}},h=function(e){return e&&e!==a&&d("Expected '"+e+"' instead of '"+a+"'"),a=l.charAt(s),s+=1,a},p=function(){var e,i="";for("-"===a&&(i="-",h("-"));a>="0"&&a<="9";)i+=a,h();if("."===a)for(i+=".";h()&&a>="0"&&a<="9";)i+=a;if("e"===a||"E"===a)for(i+=a,h(),("-"===a||"+"===a)&&(i+=a,h());a>="0"&&a<="9";)i+=a,h();if(isFinite(e=+i))return(null==r&&(r=n(8112)),i.length>15)?t.storeAsString?i:t.useNativeBigInt?BigInt(i):new r(i):t.alwaysParseAsBig?t.useNativeBigInt?BigInt(e):new r(e):e;d("Bad number")},f=function(){var e,t,n,r="";if('"'===a)for(var i=s;h();){if('"'===a)return s-1>i&&(r+=l.substring(i,s-1)),h(),r;if("\\"===a){if(s-1>i&&(r+=l.substring(i,s-1)),h(),"u"===a){for(t=0,n=0;t<4&&isFinite(e=parseInt(h(),16));t+=1)n=16*n+e;r+=String.fromCharCode(n)}else if("string"==typeof c[a])r+=c[a];else break;i=s}}d("Bad string")},m=function(){for(;a&&a<=" ";)h()},g=function(){switch(a){case"t":return h("t"),h("r"),h("u"),h("e"),!0;case"f":return h("f"),h("a"),h("l"),h("s"),h("e"),!1;case"n":return h("n"),h("u"),h("l"),h("l"),null}d("Unexpected '"+a+"'")},y=function(){var e=[];if("["===a){if(h("["),m(),"]"===a)return h("]"),e;for(;a;){if(e.push(u()),m(),"]"===a)return h("]"),e;h(","),m()}}d("Bad array")},v=function(){var e,n=Object.create(null);if("{"===a){if(h("{"),m(),"}"===a)return h("}"),n;for(;a;){if(e=f(),m(),h(":"),!0===t.strict&&Object.hasOwnProperty.call(n,e)&&d('Duplicate key "'+e+'"'),!0===i.test(e)?"error"===t.protoAction?d("Object contains forbidden prototype property"):"ignore"===t.protoAction?u():n[e]=u():!0===o.test(e)?"error"===t.constructorAction?d("Object contains forbidden constructor property"):"ignore"===t.constructorAction?u():n[e]=u():n[e]=u(),m(),"}"===a)return h("}"),n;h(","),m()}}d("Bad object")};return u=function(){switch(m(),a){case"{":return v();case"[":return y();case'"':return f();case"-":return p();default:return a>="0"&&a<="9"?p():g()}},function(e,t){var n;return l=e+"",s=0,a=" ",n=u(),m(),a&&d("Syntax error"),"function"==typeof t?function e(n,r){var i,o=n[r];return o&&"object"==typeof o&&Object.keys(o).forEach(function(t){void 0!==(i=e(o,t))?o[t]=i:delete o[t]}),t.call(n,r,o)}({"":n},""):n}}},7777:(e,t,n)=>{var r=n(8112),i=e.exports;!function(){"use strict";var e,t,n,o=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,s={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};function a(e){return o.lastIndex=0,o.test(e)?'"'+e.replace(o,function(e){var t=s[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}"function"!=typeof i.stringify&&(i.stringify=function(i,o,s){var l;if(e="",t="","number"==typeof s)for(l=0;l<s;l+=1)t+=" ";else"string"==typeof s&&(t=s);if(n=o,o&&"function"!=typeof o&&("object"!=typeof o||"number"!=typeof o.length))throw Error("JSON.stringify");return function i(o,s){var l,u,c,d,h,p=e,f=s[o],m=null!=f&&(f instanceof r||r.isBigNumber(f));switch(f&&"object"==typeof f&&"function"==typeof f.toJSON&&(f=f.toJSON(o)),"function"==typeof n&&(f=n.call(s,o,f)),typeof f){case"string":if(m)return f;return a(f);case"number":return isFinite(f)?String(f):"null";case"boolean":case"null":case"bigint":return String(f);case"object":if(!f)return"null";if(e+=t,h=[],"[object Array]"===Object.prototype.toString.apply(f)){for(l=0,d=f.length;l<d;l+=1)h[l]=i(l,f)||"null";return c=0===h.length?"[]":e?"[\n"+e+h.join(",\n"+e)+"\n"+p+"]":"["+h.join(",")+"]",e=p,c}if(n&&"object"==typeof n)for(l=0,d=n.length;l<d;l+=1)"string"==typeof n[l]&&(c=i(u=n[l],f))&&h.push(a(u)+(e?": ":":")+c);else Object.keys(f).forEach(function(t){var n=i(t,f);n&&h.push(a(t)+(e?": ":":")+n)});return c=0===h.length?"{}":e?"{\n"+e+h.join(",\n"+e)+"\n"+p+"}":"{"+h.join(",")+"}",e=p,c}}("",{"":i})})}()},7917:(e,t,n)=>{var r,i=n(8243).Buffer,o=n(4770),s=n(7145),a=n(1764),l="secret must be a string or buffer",u="key must be a string or a buffer",c="function"==typeof o.createPublicKey;function d(e){if(!i.isBuffer(e)&&"string"!=typeof e&&(!c||"object"!=typeof e||"string"!=typeof e.type||"string"!=typeof e.asymmetricKeyType||"function"!=typeof e.export))throw m(u)}function h(e){if(!i.isBuffer(e)&&"string"!=typeof e&&"object"!=typeof e)throw m("key must be a string, a buffer or an object")}function p(e){return e.replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function f(e){var t=4-(e=e.toString()).length%4;if(4!==t)for(var n=0;n<t;++n)e+="=";return e.replace(/\-/g,"+").replace(/_/g,"/")}function m(e){var t=[].slice.call(arguments,1);return TypeError(a.format.bind(a,e).apply(null,t))}function g(e){var t;return t=e,i.isBuffer(t)||"string"==typeof t||(e=JSON.stringify(e)),e}function y(e){return function(t,n){(function(e){if(!i.isBuffer(e)&&"string"!=typeof e&&(!c||"object"!=typeof e||"secret"!==e.type||"function"!=typeof e.export))throw m(l)})(n),t=g(t);var r=o.createHmac("sha"+e,n);return p((r.update(t),r.digest("base64")))}}c&&(u+=" or a KeyObject",l+="or a KeyObject");var v="timingSafeEqual"in o?function(e,t){return e.byteLength===t.byteLength&&o.timingSafeEqual(e,t)}:function(e,t){return r||(r=n(9121)),r(e,t)};function _(e){return function(t,n,r){var o=y(e)(t,r);return v(i.from(n),i.from(o))}}function b(e){return function(t,n){h(n),t=g(t);var r=o.createSign("RSA-SHA"+e);return p((r.update(t),r.sign(n,"base64")))}}function E(e){return function(t,n,r){d(r),t=g(t),n=f(n);var i=o.createVerify("RSA-SHA"+e);return i.update(t),i.verify(r,n,"base64")}}function T(e){return function(t,n){h(n),t=g(t);var r=o.createSign("RSA-SHA"+e);return p((r.update(t),r.sign({key:n,padding:o.constants.RSA_PKCS1_PSS_PADDING,saltLength:o.constants.RSA_PSS_SALTLEN_DIGEST},"base64")))}}function w(e){return function(t,n,r){d(r),t=g(t),n=f(n);var i=o.createVerify("RSA-SHA"+e);return i.update(t),i.verify({key:r,padding:o.constants.RSA_PKCS1_PSS_PADDING,saltLength:o.constants.RSA_PSS_SALTLEN_DIGEST},n,"base64")}}function S(e){var t=b(e);return function(){var n=t.apply(null,arguments);return s.derToJose(n,"ES"+e)}}function A(e){var t=E(e);return function(n,r,i){return t(n,r=s.joseToDer(r,"ES"+e).toString("base64"),i)}}function C(){return function(){return""}}function O(){return function(e,t){return""===t}}e.exports=function(e){var t=e.match(/^(RS|PS|ES|HS)(256|384|512)$|^(none)$/);if(!t)throw m('"%s" is not a valid algorithm.\n  Supported algorithms are:\n  "HS256", "HS384", "HS512", "RS256", "RS384", "RS512", "PS256", "PS384", "PS512", "ES256", "ES384", "ES512" and "none".',e);var n=(t[1]||t[3]).toLowerCase(),r=t[2];return{sign:({hs:y,rs:b,ps:T,es:S,none:C})[n](r),verify:({hs:_,rs:E,ps:w,es:A,none:O})[n](r)}}},843:(e,t,n)=>{var r=n(1287),i=n(5640);t.ALGORITHMS=["HS256","HS384","HS512","RS256","RS384","RS512","PS256","PS384","PS512","ES256","ES384","ES512"],t.sign=r.sign,t.verify=i.verify,t.decode=i.decode,t.isValid=i.isValid,t.createSign=function(e){return new r(e)},t.createVerify=function(e){return new i(e)}},3348:(e,t,n)=>{var r=n(8243).Buffer,i=n(6162);function o(e){if(this.buffer=null,this.writable=!0,this.readable=!0,!e)return this.buffer=r.alloc(0),this;if("function"==typeof e.pipe)return this.buffer=r.alloc(0),e.pipe(this),this;if(e.length||"object"==typeof e)return this.buffer=e,this.writable=!1,process.nextTick((function(){this.emit("end",e),this.readable=!1,this.emit("close")}).bind(this)),this;throw TypeError("Unexpected data type ("+typeof e+")")}n(1764).inherits(o,i),o.prototype.write=function(e){this.buffer=r.concat([this.buffer,r.from(e)]),this.emit("data",e)},o.prototype.end=function(e){e&&this.write(e),this.emit("end",e),this.emit("close"),this.writable=!1,this.readable=!1},e.exports=o},1287:(e,t,n)=>{var r=n(8243).Buffer,i=n(3348),o=n(7917),s=n(6162),a=n(6107),l=n(1764);function u(e,t){return r.from(e,t).toString("base64").replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}function c(e){var t,n,r,i=e.header,s=e.payload,c=e.secret||e.privateKey,d=e.encoding,h=o(i.alg),p=(t=(t=d)||"utf8",n=u(a(i),"binary"),r=u(a(s),t),l.format("%s.%s",n,r)),f=h.sign(p,c);return l.format("%s.%s",p,f)}function d(e){var t=new i(e.secret||e.privateKey||e.key);this.readable=!0,this.header=e.header,this.encoding=e.encoding,this.secret=this.privateKey=this.key=t,this.payload=new i(e.payload),this.secret.once("close",(function(){!this.payload.writable&&this.readable&&this.sign()}).bind(this)),this.payload.once("close",(function(){!this.secret.writable&&this.readable&&this.sign()}).bind(this))}l.inherits(d,s),d.prototype.sign=function(){try{var e=c({header:this.header,payload:this.payload.buffer,secret:this.secret.buffer,encoding:this.encoding});return this.emit("done",e),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(e){this.readable=!1,this.emit("error",e),this.emit("close")}},d.sign=c,e.exports=d},6107:(e,t,n)=>{var r=n(8893).Buffer;e.exports=function(e){return"string"==typeof e?e:"number"==typeof e||r.isBuffer(e)?e.toString():JSON.stringify(e)}},5640:(e,t,n)=>{var r=n(8243).Buffer,i=n(3348),o=n(7917),s=n(6162),a=n(6107),l=n(1764),u=/^[a-zA-Z0-9\-_]+?\.[a-zA-Z0-9\-_]+?\.([a-zA-Z0-9\-_]+)?$/;function c(e){var t=e.split(".",1)[0];return function(e){if("[object Object]"===Object.prototype.toString.call(e))return e;try{return JSON.parse(e)}catch(e){return}}(r.from(t,"base64").toString("binary"))}function d(e){return e.split(".")[2]}function h(e){return u.test(e)&&!!c(e)}function p(e,t,n){if(!t){var r=Error("Missing algorithm parameter for jws.verify");throw r.code="MISSING_ALGORITHM",r}var i=d(e=a(e)),s=e.split(".",2).join(".");return o(t).verify(s,i,n)}function f(e,t){if(t=t||{},!h(e=a(e)))return null;var n,i,o=c(e);if(!o)return null;var s=(n=n||"utf8",i=e.split(".")[1],r.from(i,"base64").toString(n));return("JWT"===o.typ||t.json)&&(s=JSON.parse(s,t.encoding)),{header:o,payload:s,signature:d(e)}}function m(e){var t=new i((e=e||{}).secret||e.publicKey||e.key);this.readable=!0,this.algorithm=e.algorithm,this.encoding=e.encoding,this.secret=this.publicKey=this.key=t,this.signature=new i(e.signature),this.secret.once("close",(function(){!this.signature.writable&&this.readable&&this.verify()}).bind(this)),this.signature.once("close",(function(){!this.secret.writable&&this.readable&&this.verify()}).bind(this))}l.inherits(m,s),m.prototype.verify=function(){try{var e=p(this.signature.buffer,this.algorithm,this.key.buffer),t=f(this.signature.buffer,this.encoding);return this.emit("done",e,t),this.emit("data",e),this.emit("end"),this.readable=!1,e}catch(e){this.readable=!1,this.emit("error",e),this.emit("close")}},m.decode=f,m.isValid=h,m.verify=p,e.exports=m},9925:e=>{"use strict";var t=Object.defineProperty,n=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,i=Object.prototype.hasOwnProperty,o={};function s(e){var t;let n=["path"in e&&e.path&&`Path=${e.path}`,"expires"in e&&(e.expires||0===e.expires)&&`Expires=${("number"==typeof e.expires?new Date(e.expires):e.expires).toUTCString()}`,"maxAge"in e&&"number"==typeof e.maxAge&&`Max-Age=${e.maxAge}`,"domain"in e&&e.domain&&`Domain=${e.domain}`,"secure"in e&&e.secure&&"Secure","httpOnly"in e&&e.httpOnly&&"HttpOnly","sameSite"in e&&e.sameSite&&`SameSite=${e.sameSite}`,"partitioned"in e&&e.partitioned&&"Partitioned","priority"in e&&e.priority&&`Priority=${e.priority}`].filter(Boolean),r=`${e.name}=${encodeURIComponent(null!=(t=e.value)?t:"")}`;return 0===n.length?r:`${r}; ${n.join("; ")}`}function a(e){let t=new Map;for(let n of e.split(/; */)){if(!n)continue;let e=n.indexOf("=");if(-1===e){t.set(n,"true");continue}let[r,i]=[n.slice(0,e),n.slice(e+1)];try{t.set(r,decodeURIComponent(null!=i?i:"true"))}catch{}}return t}function l(e){var t,n;if(!e)return;let[[r,i],...o]=a(e),{domain:s,expires:l,httponly:d,maxage:h,path:p,samesite:f,secure:m,partitioned:g,priority:y}=Object.fromEntries(o.map(([e,t])=>[e.toLowerCase(),t]));return function(e){let t={};for(let n in e)e[n]&&(t[n]=e[n]);return t}({name:r,value:decodeURIComponent(i),domain:s,...l&&{expires:new Date(l)},...d&&{httpOnly:!0},..."string"==typeof h&&{maxAge:Number(h)},path:p,...f&&{sameSite:u.includes(t=(t=f).toLowerCase())?t:void 0},...m&&{secure:!0},...y&&{priority:c.includes(n=(n=y).toLowerCase())?n:void 0},...g&&{partitioned:!0}})}((e,n)=>{for(var r in n)t(e,r,{get:n[r],enumerable:!0})})(o,{RequestCookies:()=>d,ResponseCookies:()=>h,parseCookie:()=>a,parseSetCookie:()=>l,stringifyCookie:()=>s}),e.exports=((e,o,s,a)=>{if(o&&"object"==typeof o||"function"==typeof o)for(let l of r(o))i.call(e,l)||l===s||t(e,l,{get:()=>o[l],enumerable:!(a=n(o,l))||a.enumerable});return e})(t({},"__esModule",{value:!0}),o);var u=["strict","lax","none"],c=["low","medium","high"],d=class{constructor(e){this._parsed=new Map,this._headers=e;let t=e.get("cookie");if(t)for(let[e,n]of a(t))this._parsed.set(e,{name:e,value:n})}[Symbol.iterator](){return this._parsed[Symbol.iterator]()}get size(){return this._parsed.size}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let n=Array.from(this._parsed);if(!e.length)return n.map(([e,t])=>t);let r="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return n.filter(([e])=>e===r).map(([e,t])=>t)}has(e){return this._parsed.has(e)}set(...e){let[t,n]=1===e.length?[e[0].name,e[0].value]:e,r=this._parsed;return r.set(t,{name:t,value:n}),this._headers.set("cookie",Array.from(r).map(([e,t])=>s(t)).join("; ")),this}delete(e){let t=this._parsed,n=Array.isArray(e)?e.map(e=>t.delete(e)):t.delete(e);return this._headers.set("cookie",Array.from(t).map(([e,t])=>s(t)).join("; ")),n}clear(){return this.delete(Array.from(this._parsed.keys())),this}[Symbol.for("edge-runtime.inspect.custom")](){return`RequestCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(e=>`${e.name}=${encodeURIComponent(e.value)}`).join("; ")}},h=class{constructor(e){var t,n,r;this._parsed=new Map,this._headers=e;let i=null!=(r=null!=(n=null==(t=e.getSetCookie)?void 0:t.call(e))?n:e.get("set-cookie"))?r:[];for(let e of Array.isArray(i)?i:function(e){if(!e)return[];var t,n,r,i,o,s=[],a=0;function l(){for(;a<e.length&&/\s/.test(e.charAt(a));)a+=1;return a<e.length}for(;a<e.length;){for(t=a,o=!1;l();)if(","===(n=e.charAt(a))){for(r=a,a+=1,l(),i=a;a<e.length&&"="!==(n=e.charAt(a))&&";"!==n&&","!==n;)a+=1;a<e.length&&"="===e.charAt(a)?(o=!0,a=i,s.push(e.substring(t,r)),t=a):a=r+1}else a+=1;(!o||a>=e.length)&&s.push(e.substring(t,e.length))}return s}(i)){let t=l(e);t&&this._parsed.set(t.name,t)}}get(...e){let t="string"==typeof e[0]?e[0]:e[0].name;return this._parsed.get(t)}getAll(...e){var t;let n=Array.from(this._parsed.values());if(!e.length)return n;let r="string"==typeof e[0]?e[0]:null==(t=e[0])?void 0:t.name;return n.filter(e=>e.name===r)}has(e){return this._parsed.has(e)}set(...e){let[t,n,r]=1===e.length?[e[0].name,e[0].value,e[0]]:e,i=this._parsed;return i.set(t,function(e={name:"",value:""}){return"number"==typeof e.expires&&(e.expires=new Date(e.expires)),e.maxAge&&(e.expires=new Date(Date.now()+1e3*e.maxAge)),(null===e.path||void 0===e.path)&&(e.path="/"),e}({name:t,value:n,...r})),function(e,t){for(let[,n]of(t.delete("set-cookie"),e)){let e=s(n);t.append("set-cookie",e)}}(i,this._headers),this}delete(...e){let[t,n,r]="string"==typeof e[0]?[e[0]]:[e[0].name,e[0].path,e[0].domain];return this.set({name:t,path:n,domain:r,value:"",expires:new Date(0)})}[Symbol.for("edge-runtime.inspect.custom")](){return`ResponseCookies ${JSON.stringify(Object.fromEntries(this._parsed))}`}toString(){return[...this._parsed.values()].map(s).join("; ")}}},8346:(e,t,n)=>{var r;(()=>{var i={226:function(i,o){!function(s,a){"use strict";var l="function",u="undefined",c="object",d="string",h="major",p="model",f="name",m="type",g="vendor",y="version",v="architecture",_="console",b="mobile",E="tablet",T="smarttv",w="wearable",S="embedded",A="Amazon",C="Apple",O="ASUS",I="BlackBerry",k="Browser",R="Chrome",N="Firefox",P="Google",x="Huawei",U="Microsoft",D="Motorola",M="Opera",j="Samsung",L="Sharp",G="Sony",q="Xiaomi",F="Zebra",H="Facebook",B="Chromium OS",V="Mac OS",$=function(e,t){var n={};for(var r in e)t[r]&&t[r].length%2==0?n[r]=t[r].concat(e[r]):n[r]=e[r];return n},W=function(e){for(var t={},n=0;n<e.length;n++)t[e[n].toUpperCase()]=e[n];return t},J=function(e,t){return typeof e===d&&-1!==K(t).indexOf(K(e))},K=function(e){return e.toLowerCase()},Y=function(e,t){if(typeof e===d)return e=e.replace(/^\s\s*/,""),typeof t===u?e:e.substring(0,350)},z=function(e,t){for(var n,r,i,o,s,u,d=0;d<t.length&&!s;){var h=t[d],p=t[d+1];for(n=r=0;n<h.length&&!s&&h[n];)if(s=h[n++].exec(e))for(i=0;i<p.length;i++)u=s[++r],typeof(o=p[i])===c&&o.length>0?2===o.length?typeof o[1]==l?this[o[0]]=o[1].call(this,u):this[o[0]]=o[1]:3===o.length?typeof o[1]!==l||o[1].exec&&o[1].test?this[o[0]]=u?u.replace(o[1],o[2]):void 0:this[o[0]]=u?o[1].call(this,u,o[2]):void 0:4===o.length&&(this[o[0]]=u?o[3].call(this,u.replace(o[1],o[2])):void 0):this[o]=u||a;d+=2}},X=function(e,t){for(var n in t)if(typeof t[n]===c&&t[n].length>0){for(var r=0;r<t[n].length;r++)if(J(t[n][r],e))return"?"===n?a:n}else if(J(t[n],e))return"?"===n?a:n;return e},Q={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},Z={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[y,[f,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[y,[f,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[f,y],[/opios[\/ ]+([\w\.]+)/i],[y,[f,M+" Mini"]],[/\bopr\/([\w\.]+)/i],[y,[f,M]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(heytap|ovi)browser\/([\d\.]+)/i,/(weibo)__([\d\.]+)/i],[f,y],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[y,[f,"UC"+k]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[y,[f,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[y,[f,"WeChat"]],[/konqueror\/([\w\.]+)/i],[y,[f,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[y,[f,"IE"]],[/ya(?:search)?browser\/([\w\.]+)/i],[y,[f,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[f,/(.+)/,"$1 Secure "+k],y],[/\bfocus\/([\w\.]+)/i],[y,[f,N+" Focus"]],[/\bopt\/([\w\.]+)/i],[y,[f,M+" Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[y,[f,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[y,[f,"Dolphin"]],[/coast\/([\w\.]+)/i],[y,[f,M+" Coast"]],[/miuibrowser\/([\w\.]+)/i],[y,[f,"MIUI "+k]],[/fxios\/([-\w\.]+)/i],[y,[f,N]],[/\bqihu|(qi?ho?o?|360)browser/i],[[f,"360 "+k]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[f,/(.+)/,"$1 "+k],y],[/(comodo_dragon)\/([\w\.]+)/i],[[f,/_/g," "],y],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[f,y],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[f],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[f,H],y],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[f,y],[/\bgsa\/([\w\.]+) .*safari\//i],[y,[f,"GSA"]],[/musical_ly(?:.+app_?version\/|_)([\w\.]+)/i],[y,[f,"TikTok"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[y,[f,R+" Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[f,R+" WebView"],y],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[y,[f,"Android "+k]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[f,y],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[y,[f,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[y,f],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[f,[y,X,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[f,y],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[f,"Netscape"],y],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[y,[f,N+" Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[f,y],[/(cobalt)\/([\w\.]+)/i],[f,[y,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[v,"amd64"]],[/(ia32(?=;))/i],[[v,K]],[/((?:i[346]|x)86)[;\)]/i],[[v,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[v,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[v,"armhf"]],[/windows (ce|mobile); ppc;/i],[[v,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[v,/ower/,"",K]],[/(sun4\w)[;\)]/i],[[v,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[v,K]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[p,[g,j],[m,E]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[p,[g,j],[m,b]],[/(?:\/|\()(ip(?:hone|od)[\w, ]*)(?:\/|;)/i],[p,[g,C],[m,b]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[p,[g,C],[m,E]],[/(macintosh);/i],[p,[g,C]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[p,[g,L],[m,b]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[p,[g,x],[m,E]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[p,[g,x],[m,b]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[p,/_/g," "],[g,q],[m,b]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[p,/_/g," "],[g,q],[m,E]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[p,[g,"OPPO"],[m,b]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[p,[g,"Vivo"],[m,b]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[p,[g,"Realme"],[m,b]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[p,[g,D],[m,b]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[p,[g,D],[m,E]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[p,[g,"LG"],[m,E]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[p,[g,"LG"],[m,b]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[p,[g,"Lenovo"],[m,E]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[p,/_/g," "],[g,"Nokia"],[m,b]],[/(pixel c)\b/i],[p,[g,P],[m,E]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[p,[g,P],[m,b]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[p,[g,G],[m,b]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[p,"Xperia Tablet"],[g,G],[m,E]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[p,[g,"OnePlus"],[m,b]],[/(alexa)webm/i,/(kf[a-z]{2}wi|aeo[c-r]{2})( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[p,[g,A],[m,E]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[p,/(.+)/g,"Fire Phone $1"],[g,A],[m,b]],[/(playbook);[-\w\),; ]+(rim)/i],[p,g,[m,E]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[p,[g,I],[m,b]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[p,[g,O],[m,E]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[p,[g,O],[m,b]],[/(nexus 9)/i],[p,[g,"HTC"],[m,E]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[g,[p,/_/g," "],[m,b]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[p,[g,"Acer"],[m,E]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[p,[g,"Meizu"],[m,b]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[g,p,[m,b]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[g,p,[m,E]],[/(surface duo)/i],[p,[g,U],[m,E]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[p,[g,"Fairphone"],[m,b]],[/(u304aa)/i],[p,[g,"AT&T"],[m,b]],[/\bsie-(\w*)/i],[p,[g,"Siemens"],[m,b]],[/\b(rct\w+) b/i],[p,[g,"RCA"],[m,E]],[/\b(venue[\d ]{2,7}) b/i],[p,[g,"Dell"],[m,E]],[/\b(q(?:mv|ta)\w+) b/i],[p,[g,"Verizon"],[m,E]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[p,[g,"Barnes & Noble"],[m,E]],[/\b(tm\d{3}\w+) b/i],[p,[g,"NuVision"],[m,E]],[/\b(k88) b/i],[p,[g,"ZTE"],[m,E]],[/\b(nx\d{3}j) b/i],[p,[g,"ZTE"],[m,b]],[/\b(gen\d{3}) b.+49h/i],[p,[g,"Swiss"],[m,b]],[/\b(zur\d{3}) b/i],[p,[g,"Swiss"],[m,E]],[/\b((zeki)?tb.*\b) b/i],[p,[g,"Zeki"],[m,E]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[g,"Dragon Touch"],p,[m,E]],[/\b(ns-?\w{0,9}) b/i],[p,[g,"Insignia"],[m,E]],[/\b((nxa|next)-?\w{0,9}) b/i],[p,[g,"NextBook"],[m,E]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[g,"Voice"],p,[m,b]],[/\b(lvtel\-)?(v1[12]) b/i],[[g,"LvTel"],p,[m,b]],[/\b(ph-1) /i],[p,[g,"Essential"],[m,b]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[p,[g,"Envizen"],[m,E]],[/\b(trio[-\w\. ]+) b/i],[p,[g,"MachSpeed"],[m,E]],[/\btu_(1491) b/i],[p,[g,"Rotor"],[m,E]],[/(shield[\w ]+) b/i],[p,[g,"Nvidia"],[m,E]],[/(sprint) (\w+)/i],[g,p,[m,b]],[/(kin\.[onetw]{3})/i],[[p,/\./g," "],[g,U],[m,b]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[p,[g,F],[m,E]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[p,[g,F],[m,b]],[/smart-tv.+(samsung)/i],[g,[m,T]],[/hbbtv.+maple;(\d+)/i],[[p,/^/,"SmartTV"],[g,j],[m,T]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[g,"LG"],[m,T]],[/(apple) ?tv/i],[g,[p,C+" TV"],[m,T]],[/crkey/i],[[p,R+"cast"],[g,P],[m,T]],[/droid.+aft(\w)( bui|\))/i],[p,[g,A],[m,T]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[p,[g,L],[m,T]],[/(bravia[\w ]+)( bui|\))/i],[p,[g,G],[m,T]],[/(mitv-\w{5}) bui/i],[p,[g,q],[m,T]],[/Hbbtv.*(technisat) (.*);/i],[g,p,[m,T]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[g,Y],[p,Y],[m,T]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[m,T]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[g,p,[m,_]],[/droid.+; (shield) bui/i],[p,[g,"Nvidia"],[m,_]],[/(playstation [345portablevi]+)/i],[p,[g,G],[m,_]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[p,[g,U],[m,_]],[/((pebble))app/i],[g,p,[m,w]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[p,[g,C],[m,w]],[/droid.+; (glass) \d/i],[p,[g,P],[m,w]],[/droid.+; (wt63?0{2,3})\)/i],[p,[g,F],[m,w]],[/(quest( 2| pro)?)/i],[p,[g,H],[m,w]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[g,[m,S]],[/(aeobc)\b/i],[p,[g,A],[m,S]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[p,[m,b]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[p,[m,E]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[m,E]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[m,b]],[/(android[-\w\. ]{0,9});.+buil/i],[p,[g,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[y,[f,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[y,[f,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i,/\b(libweb)/i],[f,y],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[y,f]],os:[[/microsoft (windows) (vista|xp)/i],[f,y],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[f,[y,X,Q]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[f,"Windows"],[y,X,Q]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/ios;fbsv\/([\d\.]+)/i,/cfnetwork\/.+darwin/i],[[y,/_/g,"."],[f,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[f,V],[y,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[y,f],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[f,y],[/\(bb(10);/i],[y,[f,I]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[y,[f,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[y,[f,N+" OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[y,[f,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[y,[f,"watchOS"]],[/crkey\/([\d\.]+)/i],[y,[f,R+"cast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[f,B],y],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[f,y],[/(sunos) ?([\w\.\d]*)/i],[[f,"Solaris"],y],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux|serenityos)/i,/(unix) ?([\w\.]*)/i],[f,y]]},ee=function(e,t){if(typeof e===c&&(t=e,e=a),!(this instanceof ee))return new ee(e,t).getResult();var n=typeof s!==u&&s.navigator?s.navigator:a,r=e||(n&&n.userAgent?n.userAgent:""),i=n&&n.userAgentData?n.userAgentData:a,o=t?$(Z,t):Z,_=n&&n.userAgent==r;return this.getBrowser=function(){var e,t={};return t[f]=a,t[y]=a,z.call(t,r,o.browser),t[h]=typeof(e=t[y])===d?e.replace(/[^\d\.]/g,"").split(".")[0]:a,_&&n&&n.brave&&typeof n.brave.isBrave==l&&(t[f]="Brave"),t},this.getCPU=function(){var e={};return e[v]=a,z.call(e,r,o.cpu),e},this.getDevice=function(){var e={};return e[g]=a,e[p]=a,e[m]=a,z.call(e,r,o.device),_&&!e[m]&&i&&i.mobile&&(e[m]=b),_&&"Macintosh"==e[p]&&n&&typeof n.standalone!==u&&n.maxTouchPoints&&n.maxTouchPoints>2&&(e[p]="iPad",e[m]=E),e},this.getEngine=function(){var e={};return e[f]=a,e[y]=a,z.call(e,r,o.engine),e},this.getOS=function(){var e={};return e[f]=a,e[y]=a,z.call(e,r,o.os),_&&!e[f]&&i&&"Unknown"!=i.platform&&(e[f]=i.platform.replace(/chrome os/i,B).replace(/macos/i,V)),e},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return r},this.setUA=function(e){return r=typeof e===d&&e.length>350?Y(e,350):e,this},this.setUA(r),this};ee.VERSION="1.0.35",ee.BROWSER=W([f,y,h]),ee.CPU=W([v]),ee.DEVICE=W([p,g,m,_,b,T,E,w,S]),ee.ENGINE=ee.OS=W([f,y]),typeof o!==u?(i.exports&&(o=i.exports=ee),o.UAParser=ee):n.amdO?void 0!==(r=(function(){return ee}).call(t,n,t,e))&&(e.exports=r):typeof s!==u&&(s.UAParser=ee);var et=typeof s!==u&&(s.jQuery||s.Zepto);if(et&&!et.ua){var en=new ee;et.ua=en.getResult(),et.ua.get=function(){return en.getUA()},et.ua.set=function(e){en.setUA(e);var t=en.getResult();for(var n in t)et.ua[n]=t[n]}}}("object"==typeof window?window:this)}},o={};function s(e){var t=o[e];if(void 0!==t)return t.exports;var n=o[e]={exports:{}},r=!0;try{i[e].call(n.exports,n,n.exports,s),r=!1}finally{r&&delete o[e]}return n.exports}s.ab=__dirname+"/";var a=s(226);e.exports=a})()},9303:(e,t,n)=>{"use strict";e.exports=n(517)},44:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{PageSignatureError:function(){return n},RemovedPageError:function(){return r},RemovedUAError:function(){return i}});class n extends Error{constructor({page:e}){super(`The middleware "${e}" accepts an async API directly with the form:
  
  export function middleware(request, event) {
    return NextResponse.redirect('/new-location')
  }
  
  Read more: https://nextjs.org/docs/messages/middleware-new-signature
  `)}}class r extends Error{constructor(){super(`The request.page has been deprecated in favour of \`URLPattern\`.
  Read more: https://nextjs.org/docs/messages/middleware-request-page
  `)}}class i extends Error{constructor(){super(`The request.ua has been removed in favour of \`userAgent\` function.
  Read more: https://nextjs.org/docs/messages/middleware-parse-user-agent
  `)}}},8277:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{ImageResponse:function(){return r.ImageResponse},NextRequest:function(){return i.NextRequest},NextResponse:function(){return o.NextResponse},URLPattern:function(){return a.URLPattern},userAgent:function(){return s.userAgent},userAgentFromString:function(){return s.userAgentFromString}});let r=n(6),i=n(9745),o=n(9211),s=n(8471),a=n(2433)},9247:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"NextURL",{enumerable:!0,get:function(){return c}});let r=n(3777),i=n(3817),o=n(1675),s=n(6111),a=/(?!^https?:\/\/)(127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}|\[::1\]|localhost)/;function l(e,t){return new URL(String(e).replace(a,"localhost"),t&&String(t).replace(a,"localhost"))}let u=Symbol("NextURLInternal");class c{constructor(e,t,n){let r,i;"object"==typeof t&&"pathname"in t||"string"==typeof t?(r=t,i=n||{}):i=n||t||{},this[u]={url:l(e,r??i.base),options:i,basePath:""},this.analyze()}analyze(){var e,t,n,i,a;let l=(0,s.getNextPathnameInfo)(this[u].url.pathname,{nextConfig:this[u].options.nextConfig,parseData:!0,i18nProvider:this[u].options.i18nProvider}),c=(0,o.getHostname)(this[u].url,this[u].options.headers);this[u].domainLocale=this[u].options.i18nProvider?this[u].options.i18nProvider.detectDomainLocale(c):(0,r.detectDomainLocale)(null==(t=this[u].options.nextConfig)?void 0:null==(e=t.i18n)?void 0:e.domains,c);let d=(null==(n=this[u].domainLocale)?void 0:n.defaultLocale)||(null==(a=this[u].options.nextConfig)?void 0:null==(i=a.i18n)?void 0:i.defaultLocale);this[u].url.pathname=l.pathname,this[u].defaultLocale=d,this[u].basePath=l.basePath??"",this[u].buildId=l.buildId,this[u].locale=l.locale??d,this[u].trailingSlash=l.trailingSlash}formatPathname(){return(0,i.formatNextPathnameInfo)({basePath:this[u].basePath,buildId:this[u].buildId,defaultLocale:this[u].options.forceLocale?void 0:this[u].defaultLocale,locale:this[u].locale,pathname:this[u].url.pathname,trailingSlash:this[u].trailingSlash})}formatSearch(){return this[u].url.search}get buildId(){return this[u].buildId}set buildId(e){this[u].buildId=e}get locale(){return this[u].locale??""}set locale(e){var t,n;if(!this[u].locale||!(null==(n=this[u].options.nextConfig)?void 0:null==(t=n.i18n)?void 0:t.locales.includes(e)))throw TypeError(`The NextURL configuration includes no locale "${e}"`);this[u].locale=e}get defaultLocale(){return this[u].defaultLocale}get domainLocale(){return this[u].domainLocale}get searchParams(){return this[u].url.searchParams}get host(){return this[u].url.host}set host(e){this[u].url.host=e}get hostname(){return this[u].url.hostname}set hostname(e){this[u].url.hostname=e}get port(){return this[u].url.port}set port(e){this[u].url.port=e}get protocol(){return this[u].url.protocol}set protocol(e){this[u].url.protocol=e}get href(){let e=this.formatPathname(),t=this.formatSearch();return`${this.protocol}//${this.host}${e}${t}${this.hash}`}set href(e){this[u].url=l(e),this.analyze()}get origin(){return this[u].url.origin}get pathname(){return this[u].url.pathname}set pathname(e){this[u].url.pathname=e}get hash(){return this[u].url.hash}set hash(e){this[u].url.hash=e}get search(){return this[u].url.search}set search(e){this[u].url.search=e}get password(){return this[u].url.password}set password(e){this[u].url.password=e}get username(){return this[u].url.username}set username(e){this[u].url.username=e}get basePath(){return this[u].basePath}set basePath(e){this[u].basePath=e.startsWith("/")?e:`/${e}`}toString(){return this.href}toJSON(){return this.href}[Symbol.for("edge-runtime.inspect.custom")](){return{href:this.href,origin:this.origin,protocol:this.protocol,username:this.username,password:this.password,host:this.host,hostname:this.hostname,port:this.port,pathname:this.pathname,search:this.search,searchParams:this.searchParams,hash:this.hash}}clone(){return new c(String(this),this[u].options)}}},8238:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ReflectAdapter",{enumerable:!0,get:function(){return n}});class n{static get(e,t,n){let r=Reflect.get(e,t,n);return"function"==typeof r?r.bind(e):r}static set(e,t,n,r){return Reflect.set(e,t,n,r)}static has(e,t){return Reflect.has(e,t)}static deleteProperty(e,t){return Reflect.deleteProperty(e,t)}}},2044:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{RequestCookies:function(){return r.RequestCookies},ResponseCookies:function(){return r.ResponseCookies},stringifyCookie:function(){return r.stringifyCookie}});let r=n(9925)},6:(e,t)=>{"use strict";function n(){throw Error('ImageResponse moved from "next/server" to "next/og" since Next.js 14, please import from "next/og" instead')}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"ImageResponse",{enumerable:!0,get:function(){return n}})},9745:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{INTERNALS:function(){return a},NextRequest:function(){return l}});let r=n(9247),i=n(7636),o=n(44),s=n(2044),a=Symbol("internal request");class l extends Request{constructor(e,t={}){let n="string"!=typeof e&&"url"in e?e.url:String(e);(0,i.validateURL)(n),e instanceof Request?super(e,t):super(n,t);let o=new r.NextURL(n,{headers:(0,i.toNodeOutgoingHttpHeaders)(this.headers),nextConfig:t.nextConfig});this[a]={cookies:new s.RequestCookies(this.headers),geo:t.geo||{},ip:t.ip,nextUrl:o,url:o.toString()}}[Symbol.for("edge-runtime.inspect.custom")](){return{cookies:this.cookies,geo:this.geo,ip:this.ip,nextUrl:this.nextUrl,url:this.url,bodyUsed:this.bodyUsed,cache:this.cache,credentials:this.credentials,destination:this.destination,headers:Object.fromEntries(this.headers),integrity:this.integrity,keepalive:this.keepalive,method:this.method,mode:this.mode,redirect:this.redirect,referrer:this.referrer,referrerPolicy:this.referrerPolicy,signal:this.signal}}get cookies(){return this[a].cookies}get geo(){return this[a].geo}get ip(){return this[a].ip}get nextUrl(){return this[a].nextUrl}get page(){throw new o.RemovedPageError}get ua(){throw new o.RemovedUAError}get url(){return this[a].url}}},9211:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"NextResponse",{enumerable:!0,get:function(){return d}});let r=n(2044),i=n(9247),o=n(7636),s=n(8238),a=n(2044),l=Symbol("internal response"),u=new Set([301,302,303,307,308]);function c(e,t){var n;if(null==e?void 0:null==(n=e.request)?void 0:n.headers){if(!(e.request.headers instanceof Headers))throw Error("request.headers must be an instance of Headers");let n=[];for(let[r,i]of e.request.headers)t.set("x-middleware-request-"+r,i),n.push(r);t.set("x-middleware-override-headers",n.join(","))}}class d extends Response{constructor(e,t={}){super(e,t);let n=this.headers,u=new Proxy(new a.ResponseCookies(n),{get(e,i,o){switch(i){case"delete":case"set":return(...o)=>{let s=Reflect.apply(e[i],e,o),l=new Headers(n);return s instanceof a.ResponseCookies&&n.set("x-middleware-set-cookie",s.getAll().map(e=>(0,r.stringifyCookie)(e)).join(",")),c(t,l),s};default:return s.ReflectAdapter.get(e,i,o)}}});this[l]={cookies:u,url:t.url?new i.NextURL(t.url,{headers:(0,o.toNodeOutgoingHttpHeaders)(n),nextConfig:t.nextConfig}):void 0}}[Symbol.for("edge-runtime.inspect.custom")](){return{cookies:this.cookies,url:this.url,body:this.body,bodyUsed:this.bodyUsed,headers:Object.fromEntries(this.headers),ok:this.ok,redirected:this.redirected,status:this.status,statusText:this.statusText,type:this.type}}get cookies(){return this[l].cookies}static json(e,t){let n=Response.json(e,t);return new d(n.body,n)}static redirect(e,t){let n="number"==typeof t?t:(null==t?void 0:t.status)??307;if(!u.has(n))throw RangeError('Failed to execute "redirect" on "response": Invalid status code');let r="object"==typeof t?t:{},i=new Headers(null==r?void 0:r.headers);return i.set("Location",(0,o.validateURL)(e)),new d(null,{...r,headers:i,status:n})}static rewrite(e,t){let n=new Headers(null==t?void 0:t.headers);return n.set("x-middleware-rewrite",(0,o.validateURL)(e)),c(t,n),new d(null,{...t,headers:n})}static next(e){let t=new Headers(null==e?void 0:e.headers);return t.set("x-middleware-next","1"),c(e,t),new d(null,{...e,headers:t})}}},2433:(e,t)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"URLPattern",{enumerable:!0,get:function(){return n}});let n="undefined"==typeof URLPattern?void 0:URLPattern},8471:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{isBot:function(){return i},userAgent:function(){return s},userAgentFromString:function(){return o}});let r=function(e){return e&&e.__esModule?e:{default:e}}(n(8346));function i(e){return/Googlebot|Mediapartners-Google|AdsBot-Google|googleweblight|Storebot-Google|Google-PageRenderer|Google-InspectionTool|Bingbot|BingPreview|Slurp|DuckDuckBot|baiduspider|yandex|sogou|LinkedInBot|bitlybot|tumblr|vkShare|quora link preview|facebookexternalhit|facebookcatalog|Twitterbot|applebot|redditbot|Slackbot|Discordbot|WhatsApp|SkypeUriPreview|ia_archiver/i.test(e)}function o(e){return{...(0,r.default)(e),isBot:void 0!==e&&i(e)}}function s({headers:e}){return o(e.get("user-agent")||void 0)}},7636:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),function(e,t){for(var n in t)Object.defineProperty(e,n,{enumerable:!0,get:t[n]})}(t,{fromNodeOutgoingHttpHeaders:function(){return i},normalizeNextQueryParam:function(){return l},splitCookiesString:function(){return o},toNodeOutgoingHttpHeaders:function(){return s},validateURL:function(){return a}});let r=n(1943);function i(e){let t=new Headers;for(let[n,r]of Object.entries(e))for(let e of Array.isArray(r)?r:[r])void 0!==e&&("number"==typeof e&&(e=e.toString()),t.append(n,e));return t}function o(e){var t,n,r,i,o,s=[],a=0;function l(){for(;a<e.length&&/\s/.test(e.charAt(a));)a+=1;return a<e.length}for(;a<e.length;){for(t=a,o=!1;l();)if(","===(n=e.charAt(a))){for(r=a,a+=1,l(),i=a;a<e.length&&"="!==(n=e.charAt(a))&&";"!==n&&","!==n;)a+=1;a<e.length&&"="===e.charAt(a)?(o=!0,a=i,s.push(e.substring(t,r)),t=a):a=r+1}else a+=1;(!o||a>=e.length)&&s.push(e.substring(t,e.length))}return s}function s(e){let t={},n=[];if(e)for(let[r,i]of e.entries())"set-cookie"===r.toLowerCase()?(n.push(...o(i)),t[r]=1===n.length?n[0]:n):t[r]=i;return t}function a(e){try{return String(new URL(String(e)))}catch(t){throw Error(`URL is malformed "${String(e)}". Please use only absolute URLs - https://nextjs.org/docs/messages/middleware-relative-urls`,{cause:t})}}function l(e,t){for(let n of[r.NEXT_QUERY_PARAM_PREFIX,r.NEXT_INTERCEPTION_MARKER_PREFIX])e!==n&&e.startsWith(n)&&t(e.substring(n.length))}},1675:(e,t)=>{"use strict";function n(e,t){let n;if((null==t?void 0:t.host)&&!Array.isArray(t.host))n=t.host.toString().split(":",1)[0];else{if(!e.hostname)return;n=e.hostname}return n.toLowerCase()}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"getHostname",{enumerable:!0,get:function(){return n}})},3777:(e,t)=>{"use strict";function n(e,t,n){if(e)for(let o of(n&&(n=n.toLowerCase()),e)){var r,i;if(t===(null==(r=o.domain)?void 0:r.split(":",1)[0].toLowerCase())||n===o.defaultLocale.toLowerCase()||(null==(i=o.locales)?void 0:i.some(e=>e.toLowerCase()===n)))return o}}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"detectDomainLocale",{enumerable:!0,get:function(){return n}})},5014:(e,t)=>{"use strict";function n(e,t){let n;let r=e.split("/");return(t||[]).some(t=>!!r[1]&&r[1].toLowerCase()===t.toLowerCase()&&(n=t,r.splice(1,1),e=r.join("/")||"/",!0)),{pathname:e,detectedLocale:n}}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"normalizeLocalePath",{enumerable:!0,get:function(){return n}})},225:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"addLocale",{enumerable:!0,get:function(){return o}});let r=n(1041),i=n(4329);function o(e,t,n,o){if(!t||t===n)return e;let s=e.toLowerCase();return!o&&((0,i.pathHasPrefix)(s,"/api")||(0,i.pathHasPrefix)(s,"/"+t.toLowerCase()))?e:(0,r.addPathPrefix)(e,"/"+t)}},1041:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"addPathPrefix",{enumerable:!0,get:function(){return i}});let r=n(1693);function i(e,t){if(!e.startsWith("/")||!t)return e;let{pathname:n,query:i,hash:o}=(0,r.parsePath)(e);return""+t+n+i+o}},8166:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"addPathSuffix",{enumerable:!0,get:function(){return i}});let r=n(1693);function i(e,t){if(!e.startsWith("/")||!t)return e;let{pathname:n,query:i,hash:o}=(0,r.parsePath)(e);return""+n+t+i+o}},3817:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"formatNextPathnameInfo",{enumerable:!0,get:function(){return a}});let r=n(7847),i=n(1041),o=n(8166),s=n(225);function a(e){let t=(0,s.addLocale)(e.pathname,e.locale,e.buildId?void 0:e.defaultLocale,e.ignorePrefix);return(e.buildId||!e.trailingSlash)&&(t=(0,r.removeTrailingSlash)(t)),e.buildId&&(t=(0,o.addPathSuffix)((0,i.addPathPrefix)(t,"/_next/data/"+e.buildId),"/"===e.pathname?"index.json":".json")),t=(0,i.addPathPrefix)(t,e.basePath),!e.buildId&&e.trailingSlash?t.endsWith("/")?t:(0,o.addPathSuffix)(t,"/"):(0,r.removeTrailingSlash)(t)}},6111:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"getNextPathnameInfo",{enumerable:!0,get:function(){return s}});let r=n(5014),i=n(9529),o=n(4329);function s(e,t){var n,s;let{basePath:a,i18n:l,trailingSlash:u}=null!=(n=t.nextConfig)?n:{},c={pathname:e,trailingSlash:"/"!==e?e.endsWith("/"):u};a&&(0,o.pathHasPrefix)(c.pathname,a)&&(c.pathname=(0,i.removePathPrefix)(c.pathname,a),c.basePath=a);let d=c.pathname;if(c.pathname.startsWith("/_next/data/")&&c.pathname.endsWith(".json")){let e=c.pathname.replace(/^\/_next\/data\//,"").replace(/\.json$/,"").split("/"),n=e[0];c.buildId=n,d="index"!==e[1]?"/"+e.slice(1).join("/"):"/",!0===t.parseData&&(c.pathname=d)}if(l){let e=t.i18nProvider?t.i18nProvider.analyze(c.pathname):(0,r.normalizeLocalePath)(c.pathname,l.locales);c.locale=e.detectedLocale,c.pathname=null!=(s=e.pathname)?s:c.pathname,!e.detectedLocale&&c.buildId&&(e=t.i18nProvider?t.i18nProvider.analyze(d):(0,r.normalizeLocalePath)(d,l.locales)).detectedLocale&&(c.locale=e.detectedLocale)}return c}},1693:(e,t)=>{"use strict";function n(e){let t=e.indexOf("#"),n=e.indexOf("?"),r=n>-1&&(t<0||n<t);return r||t>-1?{pathname:e.substring(0,r?n:t),query:r?e.substring(n,t>-1?t:void 0):"",hash:t>-1?e.slice(t):""}:{pathname:e,query:"",hash:""}}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"parsePath",{enumerable:!0,get:function(){return n}})},4329:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"pathHasPrefix",{enumerable:!0,get:function(){return i}});let r=n(1693);function i(e,t){if("string"!=typeof e)return!1;let{pathname:n}=(0,r.parsePath)(e);return n===t||n.startsWith(t+"/")}},9529:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"removePathPrefix",{enumerable:!0,get:function(){return i}});let r=n(4329);function i(e,t){if(!(0,r.pathHasPrefix)(e,t))return e;let n=e.slice(t.length);return n.startsWith("/")?n:"/"+n}},7847:(e,t)=>{"use strict";function n(e){return e.replace(/\/$/,"")||"/"}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"removeTrailingSlash",{enumerable:!0,get:function(){return n}})},8243:(e,t,n)=>{var r=n(8893),i=r.Buffer;function o(e,t){for(var n in e)t[n]=e[n]}function s(e,t,n){return i(e,t,n)}i.from&&i.alloc&&i.allocUnsafe&&i.allocUnsafeSlow?e.exports=r:(o(r,t),t.Buffer=s),s.prototype=Object.create(i.prototype),o(i,s),s.from=function(e,t,n){if("number"==typeof e)throw TypeError("Argument must not be a number");return i(e,t,n)},s.alloc=function(e,t,n){if("number"!=typeof e)throw TypeError("Argument must be a number");var r=i(e);return void 0!==t?"string"==typeof n?r.fill(t,n):r.fill(t):r.fill(0),r},s.allocUnsafe=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return i(e)},s.allocUnsafeSlow=function(e){if("number"!=typeof e)throw TypeError("Argument must be a number");return r.SlowBuffer(e)}},8098:(e,t,n)=>{"use strict";let{EMPTY_BUFFER:r}=n(9030),i=Buffer[Symbol.species];function o(e,t,n,r,i){for(let o=0;o<i;o++)n[r+o]=e[o]^t[3&o]}function s(e,t){for(let n=0;n<e.length;n++)e[n]^=t[3&n]}if(e.exports={concat:function(e,t){if(0===e.length)return r;if(1===e.length)return e[0];let n=Buffer.allocUnsafe(t),o=0;for(let t=0;t<e.length;t++){let r=e[t];n.set(r,o),o+=r.length}return o<t?new i(n.buffer,n.byteOffset,o):n},mask:o,toArrayBuffer:function(e){return e.length===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteOffset+e.length)},toBuffer:function e(t){let n;return(e.readOnly=!0,Buffer.isBuffer(t))?t:(t instanceof ArrayBuffer?n=new i(t):ArrayBuffer.isView(t)?n=new i(t.buffer,t.byteOffset,t.byteLength):(n=Buffer.from(t),e.readOnly=!1),n)},unmask:s},!process.env.WS_NO_BUFFER_UTIL)try{let t=n(8359);e.exports.mask=function(e,n,r,i,s){s<48?o(e,n,r,i,s):t.mask(e,n,r,i,s)},e.exports.unmask=function(e,n){e.length<32?s(e,n):t.unmask(e,n)}}catch(e){}},9030:e=>{"use strict";let t=["nodebuffer","arraybuffer","fragments"],n="undefined"!=typeof Blob;n&&t.push("blob"),e.exports={BINARY_TYPES:t,EMPTY_BUFFER:Buffer.alloc(0),GUID:"258EAFA5-E914-47DA-95CA-C5AB0DC85B11",hasBlob:n,kForOnEventAttribute:Symbol("kIsForOnEventAttribute"),kListener:Symbol("kListener"),kStatusCode:Symbol("status-code"),kWebSocket:Symbol("websocket"),NOOP:()=>{}}},5767:(e,t,n)=>{"use strict";let{kForOnEventAttribute:r,kListener:i}=n(9030),o=Symbol("kCode"),s=Symbol("kData"),a=Symbol("kError"),l=Symbol("kMessage"),u=Symbol("kReason"),c=Symbol("kTarget"),d=Symbol("kType"),h=Symbol("kWasClean");class p{constructor(e){this[c]=null,this[d]=e}get target(){return this[c]}get type(){return this[d]}}Object.defineProperty(p.prototype,"target",{enumerable:!0}),Object.defineProperty(p.prototype,"type",{enumerable:!0});class f extends p{constructor(e,t={}){super(e),this[o]=void 0===t.code?0:t.code,this[u]=void 0===t.reason?"":t.reason,this[h]=void 0!==t.wasClean&&t.wasClean}get code(){return this[o]}get reason(){return this[u]}get wasClean(){return this[h]}}Object.defineProperty(f.prototype,"code",{enumerable:!0}),Object.defineProperty(f.prototype,"reason",{enumerable:!0}),Object.defineProperty(f.prototype,"wasClean",{enumerable:!0});class m extends p{constructor(e,t={}){super(e),this[a]=void 0===t.error?null:t.error,this[l]=void 0===t.message?"":t.message}get error(){return this[a]}get message(){return this[l]}}Object.defineProperty(m.prototype,"error",{enumerable:!0}),Object.defineProperty(m.prototype,"message",{enumerable:!0});class g extends p{constructor(e,t={}){super(e),this[s]=void 0===t.data?null:t.data}get data(){return this[s]}}function y(e,t,n){"object"==typeof e&&e.handleEvent?e.handleEvent.call(e,n):e.call(t,n)}Object.defineProperty(g.prototype,"data",{enumerable:!0}),e.exports={CloseEvent:f,ErrorEvent:m,Event:p,EventTarget:{addEventListener(e,t,n={}){let o;for(let o of this.listeners(e))if(!n[r]&&o[i]===t&&!o[r])return;if("message"===e)o=function(e,n){let r=new g("message",{data:n?e:e.toString()});r[c]=this,y(t,this,r)};else if("close"===e)o=function(e,n){let r=new f("close",{code:e,reason:n.toString(),wasClean:this._closeFrameReceived&&this._closeFrameSent});r[c]=this,y(t,this,r)};else if("error"===e)o=function(e){let n=new m("error",{error:e,message:e.message});n[c]=this,y(t,this,n)};else{if("open"!==e)return;o=function(){let e=new p("open");e[c]=this,y(t,this,e)}}o[r]=!!n[r],o[i]=t,n.once?this.once(e,o):this.on(e,o)},removeEventListener(e,t){for(let n of this.listeners(e))if(n[i]===t&&!n[r]){this.removeListener(e,n);break}}},MessageEvent:g}},8718:(e,t,n)=>{"use strict";let{tokenChars:r}=n(1187);function i(e,t,n){void 0===e[t]?e[t]=[n]:e[t].push(n)}e.exports={format:function(e){return Object.keys(e).map(t=>{let n=e[t];return Array.isArray(n)||(n=[n]),n.map(e=>[t].concat(Object.keys(e).map(t=>{let n=e[t];return Array.isArray(n)||(n=[n]),n.map(e=>!0===e?t:`${t}=${e}`).join("; ")})).join("; ")).join(", ")}).join(", ")},parse:function(e){let t,n;let o=Object.create(null),s=Object.create(null),a=!1,l=!1,u=!1,c=-1,d=-1,h=-1,p=0;for(;p<e.length;p++)if(d=e.charCodeAt(p),void 0===t){if(-1===h&&1===r[d])-1===c&&(c=p);else if(0!==p&&(32===d||9===d))-1===h&&-1!==c&&(h=p);else if(59===d||44===d){if(-1===c)throw SyntaxError(`Unexpected character at index ${p}`);-1===h&&(h=p);let n=e.slice(c,h);44===d?(i(o,n,s),s=Object.create(null)):t=n,c=h=-1}else throw SyntaxError(`Unexpected character at index ${p}`)}else if(void 0===n){if(-1===h&&1===r[d])-1===c&&(c=p);else if(32===d||9===d)-1===h&&-1!==c&&(h=p);else if(59===d||44===d){if(-1===c)throw SyntaxError(`Unexpected character at index ${p}`);-1===h&&(h=p),i(s,e.slice(c,h),!0),44===d&&(i(o,t,s),s=Object.create(null),t=void 0),c=h=-1}else if(61===d&&-1!==c&&-1===h)n=e.slice(c,p),c=h=-1;else throw SyntaxError(`Unexpected character at index ${p}`)}else if(l){if(1!==r[d])throw SyntaxError(`Unexpected character at index ${p}`);-1===c?c=p:a||(a=!0),l=!1}else if(u){if(1===r[d])-1===c&&(c=p);else if(34===d&&-1!==c)u=!1,h=p;else if(92===d)l=!0;else throw SyntaxError(`Unexpected character at index ${p}`)}else if(34===d&&61===e.charCodeAt(p-1))u=!0;else if(-1===h&&1===r[d])-1===c&&(c=p);else if(-1!==c&&(32===d||9===d))-1===h&&(h=p);else if(59===d||44===d){if(-1===c)throw SyntaxError(`Unexpected character at index ${p}`);-1===h&&(h=p);let r=e.slice(c,h);a&&(r=r.replace(/\\/g,""),a=!1),i(s,n,r),44===d&&(i(o,t,s),s=Object.create(null),t=void 0),n=void 0,c=h=-1}else throw SyntaxError(`Unexpected character at index ${p}`);if(-1===c||u||32===d||9===d)throw SyntaxError("Unexpected end of input");-1===h&&(h=p);let f=e.slice(c,h);return void 0===t?i(o,f,s):(void 0===n?i(s,f,!0):a?i(s,n,f.replace(/\\/g,"")):i(s,n,f),i(o,t,s)),o}}},189:e=>{"use strict";let t=Symbol("kDone"),n=Symbol("kRun");class r{constructor(e){this[t]=()=>{this.pending--,this[n]()},this.concurrency=e||1/0,this.jobs=[],this.pending=0}add(e){this.jobs.push(e),this[n]()}[n](){if(this.pending!==this.concurrency&&this.jobs.length){let e=this.jobs.shift();this.pending++,e(this[t])}}}e.exports=r},8384:(e,t,n)=>{"use strict";let r;let i=n(1568),o=n(8098),s=n(189),{kStatusCode:a}=n(9030),l=Buffer[Symbol.species],u=Buffer.from([0,0,255,255]),c=Symbol("permessage-deflate"),d=Symbol("total-length"),h=Symbol("callback"),p=Symbol("buffers"),f=Symbol("error");class m{constructor(e,t,n){this._maxPayload=0|n,this._options=e||{},this._threshold=void 0!==this._options.threshold?this._options.threshold:1024,this._isServer=!!t,this._deflate=null,this._inflate=null,this.params=null,r||(r=new s(void 0!==this._options.concurrencyLimit?this._options.concurrencyLimit:10))}static get extensionName(){return"permessage-deflate"}offer(){let e={};return this._options.serverNoContextTakeover&&(e.server_no_context_takeover=!0),this._options.clientNoContextTakeover&&(e.client_no_context_takeover=!0),this._options.serverMaxWindowBits&&(e.server_max_window_bits=this._options.serverMaxWindowBits),this._options.clientMaxWindowBits?e.client_max_window_bits=this._options.clientMaxWindowBits:null==this._options.clientMaxWindowBits&&(e.client_max_window_bits=!0),e}accept(e){return e=this.normalizeParams(e),this.params=this._isServer?this.acceptAsServer(e):this.acceptAsClient(e),this.params}cleanup(){if(this._inflate&&(this._inflate.close(),this._inflate=null),this._deflate){let e=this._deflate[h];this._deflate.close(),this._deflate=null,e&&e(Error("The deflate stream was closed while data was being processed"))}}acceptAsServer(e){let t=this._options,n=e.find(e=>(!1!==t.serverNoContextTakeover||!e.server_no_context_takeover)&&(!e.server_max_window_bits||!1!==t.serverMaxWindowBits&&("number"!=typeof t.serverMaxWindowBits||!(t.serverMaxWindowBits>e.server_max_window_bits)))&&("number"!=typeof t.clientMaxWindowBits||!!e.client_max_window_bits));if(!n)throw Error("None of the extension offers can be accepted");return t.serverNoContextTakeover&&(n.server_no_context_takeover=!0),t.clientNoContextTakeover&&(n.client_no_context_takeover=!0),"number"==typeof t.serverMaxWindowBits&&(n.server_max_window_bits=t.serverMaxWindowBits),"number"==typeof t.clientMaxWindowBits?n.client_max_window_bits=t.clientMaxWindowBits:(!0===n.client_max_window_bits||!1===t.clientMaxWindowBits)&&delete n.client_max_window_bits,n}acceptAsClient(e){let t=e[0];if(!1===this._options.clientNoContextTakeover&&t.client_no_context_takeover)throw Error('Unexpected parameter "client_no_context_takeover"');if(t.client_max_window_bits){if(!1===this._options.clientMaxWindowBits||"number"==typeof this._options.clientMaxWindowBits&&t.client_max_window_bits>this._options.clientMaxWindowBits)throw Error('Unexpected or invalid parameter "client_max_window_bits"')}else"number"==typeof this._options.clientMaxWindowBits&&(t.client_max_window_bits=this._options.clientMaxWindowBits);return t}normalizeParams(e){return e.forEach(e=>{Object.keys(e).forEach(t=>{let n=e[t];if(n.length>1)throw Error(`Parameter "${t}" must have only a single value`);if(n=n[0],"client_max_window_bits"===t){if(!0!==n){let e=+n;if(!Number.isInteger(e)||e<8||e>15)throw TypeError(`Invalid value for parameter "${t}": ${n}`);n=e}else if(!this._isServer)throw TypeError(`Invalid value for parameter "${t}": ${n}`)}else if("server_max_window_bits"===t){let e=+n;if(!Number.isInteger(e)||e<8||e>15)throw TypeError(`Invalid value for parameter "${t}": ${n}`);n=e}else if("client_no_context_takeover"===t||"server_no_context_takeover"===t){if(!0!==n)throw TypeError(`Invalid value for parameter "${t}": ${n}`)}else throw Error(`Unknown parameter "${t}"`);e[t]=n})}),e}decompress(e,t,n){r.add(r=>{this._decompress(e,t,(e,t)=>{r(),n(e,t)})})}compress(e,t,n){r.add(r=>{this._compress(e,t,(e,t)=>{r(),n(e,t)})})}_decompress(e,t,n){let r=this._isServer?"client":"server";if(!this._inflate){let e=`${r}_max_window_bits`,t="number"!=typeof this.params[e]?i.Z_DEFAULT_WINDOWBITS:this.params[e];this._inflate=i.createInflateRaw({...this._options.zlibInflateOptions,windowBits:t}),this._inflate[c]=this,this._inflate[d]=0,this._inflate[p]=[],this._inflate.on("error",v),this._inflate.on("data",y)}this._inflate[h]=n,this._inflate.write(e),t&&this._inflate.write(u),this._inflate.flush(()=>{let e=this._inflate[f];if(e){this._inflate.close(),this._inflate=null,n(e);return}let i=o.concat(this._inflate[p],this._inflate[d]);this._inflate._readableState.endEmitted?(this._inflate.close(),this._inflate=null):(this._inflate[d]=0,this._inflate[p]=[],t&&this.params[`${r}_no_context_takeover`]&&this._inflate.reset()),n(null,i)})}_compress(e,t,n){let r=this._isServer?"server":"client";if(!this._deflate){let e=`${r}_max_window_bits`,t="number"!=typeof this.params[e]?i.Z_DEFAULT_WINDOWBITS:this.params[e];this._deflate=i.createDeflateRaw({...this._options.zlibDeflateOptions,windowBits:t}),this._deflate[d]=0,this._deflate[p]=[],this._deflate.on("data",g)}this._deflate[h]=n,this._deflate.write(e),this._deflate.flush(i.Z_SYNC_FLUSH,()=>{if(!this._deflate)return;let e=o.concat(this._deflate[p],this._deflate[d]);t&&(e=new l(e.buffer,e.byteOffset,e.length-4)),this._deflate[h]=null,this._deflate[d]=0,this._deflate[p]=[],t&&this.params[`${r}_no_context_takeover`]&&this._deflate.reset(),n(null,e)})}}function g(e){this[p].push(e),this[d]+=e.length}function y(e){if(this[d]+=e.length,this[c]._maxPayload<1||this[d]<=this[c]._maxPayload){this[p].push(e);return}this[f]=RangeError("Max payload size exceeded"),this[f].code="WS_ERR_UNSUPPORTED_MESSAGE_LENGTH",this[f][a]=1009,this.removeListener("data",y),this.reset()}function v(e){if(this[c]._inflate=null,this[f]){this[h](this[f]);return}e[a]=1007,this[h](e)}e.exports=m},263:(e,t,n)=>{"use strict";let{Writable:r}=n(6162),i=n(8384),{BINARY_TYPES:o,EMPTY_BUFFER:s,kStatusCode:a,kWebSocket:l}=n(9030),{concat:u,toArrayBuffer:c,unmask:d}=n(8098),{isValidStatusCode:h,isValidUTF8:p}=n(1187),f=Buffer[Symbol.species];class m extends r{constructor(e={}){super(),this._allowSynchronousEvents=void 0===e.allowSynchronousEvents||e.allowSynchronousEvents,this._binaryType=e.binaryType||o[0],this._extensions=e.extensions||{},this._isServer=!!e.isServer,this._maxPayload=0|e.maxPayload,this._skipUTF8Validation=!!e.skipUTF8Validation,this[l]=void 0,this._bufferedBytes=0,this._buffers=[],this._compressed=!1,this._payloadLength=0,this._mask=void 0,this._fragmented=0,this._masked=!1,this._fin=!1,this._opcode=0,this._totalPayloadLength=0,this._messageLength=0,this._fragments=[],this._errored=!1,this._loop=!1,this._state=0}_write(e,t,n){if(8===this._opcode&&0==this._state)return n();this._bufferedBytes+=e.length,this._buffers.push(e),this.startLoop(n)}consume(e){if(this._bufferedBytes-=e,e===this._buffers[0].length)return this._buffers.shift();if(e<this._buffers[0].length){let t=this._buffers[0];return this._buffers[0]=new f(t.buffer,t.byteOffset+e,t.length-e),new f(t.buffer,t.byteOffset,e)}let t=Buffer.allocUnsafe(e);do{let n=this._buffers[0],r=t.length-e;e>=n.length?t.set(this._buffers.shift(),r):(t.set(new Uint8Array(n.buffer,n.byteOffset,e),r),this._buffers[0]=new f(n.buffer,n.byteOffset+e,n.length-e)),e-=n.length}while(e>0);return t}startLoop(e){this._loop=!0;do switch(this._state){case 0:this.getInfo(e);break;case 1:this.getPayloadLength16(e);break;case 2:this.getPayloadLength64(e);break;case 3:this.getMask();break;case 4:this.getData(e);break;case 5:case 6:this._loop=!1;return}while(this._loop);this._errored||e()}getInfo(e){if(this._bufferedBytes<2){this._loop=!1;return}let t=this.consume(2);if((48&t[0])!=0){e(this.createError(RangeError,"RSV2 and RSV3 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_2_3"));return}let n=(64&t[0])==64;if(n&&!this._extensions[i.extensionName]){e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));return}if(this._fin=(128&t[0])==128,this._opcode=15&t[0],this._payloadLength=127&t[1],0===this._opcode){if(n){e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));return}if(!this._fragmented){e(this.createError(RangeError,"invalid opcode 0",!0,1002,"WS_ERR_INVALID_OPCODE"));return}this._opcode=this._fragmented}else if(1===this._opcode||2===this._opcode){if(this._fragmented){e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));return}this._compressed=n}else if(this._opcode>7&&this._opcode<11){if(!this._fin){e(this.createError(RangeError,"FIN must be set",!0,1002,"WS_ERR_EXPECTED_FIN"));return}if(n){e(this.createError(RangeError,"RSV1 must be clear",!0,1002,"WS_ERR_UNEXPECTED_RSV_1"));return}if(this._payloadLength>125||8===this._opcode&&1===this._payloadLength){e(this.createError(RangeError,`invalid payload length ${this._payloadLength}`,!0,1002,"WS_ERR_INVALID_CONTROL_PAYLOAD_LENGTH"));return}}else{e(this.createError(RangeError,`invalid opcode ${this._opcode}`,!0,1002,"WS_ERR_INVALID_OPCODE"));return}if(this._fin||this._fragmented||(this._fragmented=this._opcode),this._masked=(128&t[1])==128,this._isServer){if(!this._masked){e(this.createError(RangeError,"MASK must be set",!0,1002,"WS_ERR_EXPECTED_MASK"));return}}else if(this._masked){e(this.createError(RangeError,"MASK must be clear",!0,1002,"WS_ERR_UNEXPECTED_MASK"));return}126===this._payloadLength?this._state=1:127===this._payloadLength?this._state=2:this.haveLength(e)}getPayloadLength16(e){if(this._bufferedBytes<2){this._loop=!1;return}this._payloadLength=this.consume(2).readUInt16BE(0),this.haveLength(e)}getPayloadLength64(e){if(this._bufferedBytes<8){this._loop=!1;return}let t=this.consume(8),n=t.readUInt32BE(0);if(n>2097151){e(this.createError(RangeError,"Unsupported WebSocket frame: payload length > 2^53 - 1",!1,1009,"WS_ERR_UNSUPPORTED_DATA_PAYLOAD_LENGTH"));return}this._payloadLength=4294967296*n+t.readUInt32BE(4),this.haveLength(e)}haveLength(e){if(this._payloadLength&&this._opcode<8&&(this._totalPayloadLength+=this._payloadLength,this._totalPayloadLength>this._maxPayload&&this._maxPayload>0)){e(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));return}this._masked?this._state=3:this._state=4}getMask(){if(this._bufferedBytes<4){this._loop=!1;return}this._mask=this.consume(4),this._state=4}getData(e){let t=s;if(this._payloadLength){if(this._bufferedBytes<this._payloadLength){this._loop=!1;return}t=this.consume(this._payloadLength),this._masked&&(this._mask[0]|this._mask[1]|this._mask[2]|this._mask[3])!=0&&d(t,this._mask)}if(this._opcode>7){this.controlMessage(t,e);return}if(this._compressed){this._state=5,this.decompress(t,e);return}t.length&&(this._messageLength=this._totalPayloadLength,this._fragments.push(t)),this.dataMessage(e)}decompress(e,t){this._extensions[i.extensionName].decompress(e,this._fin,(e,n)=>{if(e)return t(e);if(n.length){if(this._messageLength+=n.length,this._messageLength>this._maxPayload&&this._maxPayload>0){t(this.createError(RangeError,"Max payload size exceeded",!1,1009,"WS_ERR_UNSUPPORTED_MESSAGE_LENGTH"));return}this._fragments.push(n)}this.dataMessage(t),0===this._state&&this.startLoop(t)})}dataMessage(e){if(!this._fin){this._state=0;return}let t=this._messageLength,n=this._fragments;if(this._totalPayloadLength=0,this._messageLength=0,this._fragmented=0,this._fragments=[],2===this._opcode){let r;r="nodebuffer"===this._binaryType?u(n,t):"arraybuffer"===this._binaryType?c(u(n,t)):"blob"===this._binaryType?new Blob(n):n,this._allowSynchronousEvents?(this.emit("message",r,!0),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",r,!0),this._state=0,this.startLoop(e)}))}else{let r=u(n,t);if(!this._skipUTF8Validation&&!p(r)){e(this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8"));return}5===this._state||this._allowSynchronousEvents?(this.emit("message",r,!1),this._state=0):(this._state=6,setImmediate(()=>{this.emit("message",r,!1),this._state=0,this.startLoop(e)}))}}controlMessage(e,t){if(8===this._opcode){if(0===e.length)this._loop=!1,this.emit("conclude",1005,s),this.end();else{let n=e.readUInt16BE(0);if(!h(n)){t(this.createError(RangeError,`invalid status code ${n}`,!0,1002,"WS_ERR_INVALID_CLOSE_CODE"));return}let r=new f(e.buffer,e.byteOffset+2,e.length-2);if(!this._skipUTF8Validation&&!p(r)){t(this.createError(Error,"invalid UTF-8 sequence",!0,1007,"WS_ERR_INVALID_UTF8"));return}this._loop=!1,this.emit("conclude",n,r),this.end()}this._state=0;return}this._allowSynchronousEvents?(this.emit(9===this._opcode?"ping":"pong",e),this._state=0):(this._state=6,setImmediate(()=>{this.emit(9===this._opcode?"ping":"pong",e),this._state=0,this.startLoop(t)}))}createError(e,t,n,r,i){this._loop=!1,this._errored=!0;let o=new e(n?`Invalid WebSocket frame: ${t}`:t);return Error.captureStackTrace(o,this.createError),o.code=i,o[a]=r,o}}e.exports=m},2404:(e,t,n)=>{"use strict";let r;let{Duplex:i}=n(6162),{randomFillSync:o}=n(4770),s=n(8384),{EMPTY_BUFFER:a,kWebSocket:l,NOOP:u}=n(9030),{isBlob:c,isValidStatusCode:d}=n(1187),{mask:h,toBuffer:p}=n(8098),f=Symbol("kByteLength"),m=Buffer.alloc(4),g=8192;class y{constructor(e,t,n){this._extensions=t||{},n&&(this._generateMask=n,this._maskBuffer=Buffer.alloc(4)),this._socket=e,this._firstFragment=!0,this._compress=!1,this._bufferedBytes=0,this._queue=[],this._state=0,this.onerror=u,this[l]=void 0}static frame(e,t){let n,i;let s=!1,a=2,l=!1;t.mask&&(n=t.maskBuffer||m,t.generateMask?t.generateMask(n):(8192===g&&(void 0===r&&(r=Buffer.alloc(8192)),o(r,0,8192),g=0),n[0]=r[g++],n[1]=r[g++],n[2]=r[g++],n[3]=r[g++]),l=(n[0]|n[1]|n[2]|n[3])==0,a=6),"string"==typeof e?i=(!t.mask||l)&&void 0!==t[f]?t[f]:(e=Buffer.from(e)).length:(i=e.length,s=t.mask&&t.readOnly&&!l);let u=i;i>=65536?(a+=8,u=127):i>125&&(a+=2,u=126);let c=Buffer.allocUnsafe(s?i+a:a);return(c[0]=t.fin?128|t.opcode:t.opcode,t.rsv1&&(c[0]|=64),c[1]=u,126===u?c.writeUInt16BE(i,2):127===u&&(c[2]=c[3]=0,c.writeUIntBE(i,4,6)),t.mask)?(c[1]|=128,c[a-4]=n[0],c[a-3]=n[1],c[a-2]=n[2],c[a-1]=n[3],l)?[c,e]:s?(h(e,n,c,a,i),[c]):(h(e,n,e,0,i),[c,e]):[c,e]}close(e,t,n,r){let i;if(void 0===e)i=a;else if("number"==typeof e&&d(e)){if(void 0!==t&&t.length){let n=Buffer.byteLength(t);if(n>123)throw RangeError("The message must not be greater than 123 bytes");(i=Buffer.allocUnsafe(2+n)).writeUInt16BE(e,0),"string"==typeof t?i.write(t,2):i.set(t,2)}else(i=Buffer.allocUnsafe(2)).writeUInt16BE(e,0)}else throw TypeError("First argument must be a valid error code number");let o={[f]:i.length,fin:!0,generateMask:this._generateMask,mask:n,maskBuffer:this._maskBuffer,opcode:8,readOnly:!1,rsv1:!1};0!==this._state?this.enqueue([this.dispatch,i,!1,o,r]):this.sendFrame(y.frame(i,o),r)}ping(e,t,n){let r,i;if("string"==typeof e?(r=Buffer.byteLength(e),i=!1):c(e)?(r=e.size,i=!1):(r=(e=p(e)).length,i=p.readOnly),r>125)throw RangeError("The data size must not be greater than 125 bytes");let o={[f]:r,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:9,readOnly:i,rsv1:!1};c(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,o,n]):this.getBlobData(e,!1,o,n):0!==this._state?this.enqueue([this.dispatch,e,!1,o,n]):this.sendFrame(y.frame(e,o),n)}pong(e,t,n){let r,i;if("string"==typeof e?(r=Buffer.byteLength(e),i=!1):c(e)?(r=e.size,i=!1):(r=(e=p(e)).length,i=p.readOnly),r>125)throw RangeError("The data size must not be greater than 125 bytes");let o={[f]:r,fin:!0,generateMask:this._generateMask,mask:t,maskBuffer:this._maskBuffer,opcode:10,readOnly:i,rsv1:!1};c(e)?0!==this._state?this.enqueue([this.getBlobData,e,!1,o,n]):this.getBlobData(e,!1,o,n):0!==this._state?this.enqueue([this.dispatch,e,!1,o,n]):this.sendFrame(y.frame(e,o),n)}send(e,t,n){let r,i;let o=this._extensions[s.extensionName],a=t.binary?2:1,l=t.compress;"string"==typeof e?(r=Buffer.byteLength(e),i=!1):c(e)?(r=e.size,i=!1):(r=(e=p(e)).length,i=p.readOnly),this._firstFragment?(this._firstFragment=!1,l&&o&&o.params[o._isServer?"server_no_context_takeover":"client_no_context_takeover"]&&(l=r>=o._threshold),this._compress=l):(l=!1,a=0),t.fin&&(this._firstFragment=!0);let u={[f]:r,fin:t.fin,generateMask:this._generateMask,mask:t.mask,maskBuffer:this._maskBuffer,opcode:a,readOnly:i,rsv1:l};c(e)?0!==this._state?this.enqueue([this.getBlobData,e,this._compress,u,n]):this.getBlobData(e,this._compress,u,n):0!==this._state?this.enqueue([this.dispatch,e,this._compress,u,n]):this.dispatch(e,this._compress,u,n)}getBlobData(e,t,n,r){this._bufferedBytes+=n[f],this._state=2,e.arrayBuffer().then(e=>{if(this._socket.destroyed){let e=Error("The socket was closed while the blob was being read");process.nextTick(v,this,e,r);return}this._bufferedBytes-=n[f];let i=p(e);t?this.dispatch(i,t,n,r):(this._state=0,this.sendFrame(y.frame(i,n),r),this.dequeue())}).catch(e=>{process.nextTick(_,this,e,r)})}dispatch(e,t,n,r){if(!t){this.sendFrame(y.frame(e,n),r);return}let i=this._extensions[s.extensionName];this._bufferedBytes+=n[f],this._state=1,i.compress(e,n.fin,(e,t)=>{if(this._socket.destroyed){v(this,Error("The socket was closed while data was being compressed"),r);return}this._bufferedBytes-=n[f],this._state=0,n.readOnly=!1,this.sendFrame(y.frame(t,n),r),this.dequeue()})}dequeue(){for(;0===this._state&&this._queue.length;){let e=this._queue.shift();this._bufferedBytes-=e[3][f],Reflect.apply(e[0],this,e.slice(1))}}enqueue(e){this._bufferedBytes+=e[3][f],this._queue.push(e)}sendFrame(e,t){2===e.length?(this._socket.cork(),this._socket.write(e[0]),this._socket.write(e[1],t),this._socket.uncork()):this._socket.write(e[0],t)}}function v(e,t,n){"function"==typeof n&&n(t);for(let n=0;n<e._queue.length;n++){let r=e._queue[n],i=r[r.length-1];"function"==typeof i&&i(t)}}function _(e,t,n){v(e,t,n),e.onerror(t)}e.exports=y},8826:(e,t,n)=>{"use strict";n(9936);let{Duplex:r}=n(6162);function i(e){e.emit("close")}function o(){!this.destroyed&&this._writableState.finished&&this.destroy()}function s(e){this.removeListener("error",s),this.destroy(),0===this.listenerCount("error")&&this.emit("error",e)}e.exports=function(e,t){let n=!0,a=new r({...t,autoDestroy:!1,emitClose:!1,objectMode:!1,writableObjectMode:!1});return e.on("message",function(t,n){let r=!n&&a._readableState.objectMode?t.toString():t;a.push(r)||e.pause()}),e.once("error",function(e){a.destroyed||(n=!1,a.destroy(e))}),e.once("close",function(){a.destroyed||a.push(null)}),a._destroy=function(t,r){if(e.readyState===e.CLOSED){r(t),process.nextTick(i,a);return}let o=!1;e.once("error",function(e){o=!0,r(e)}),e.once("close",function(){o||r(t),process.nextTick(i,a)}),n&&e.terminate()},a._final=function(t){if(e.readyState===e.CONNECTING){e.once("open",function(){a._final(t)});return}null!==e._socket&&(e._socket._writableState.finished?(t(),a._readableState.endEmitted&&a.destroy()):(e._socket.once("finish",function(){t()}),e.close()))},a._read=function(){e.isPaused&&e.resume()},a._write=function(t,n,r){if(e.readyState===e.CONNECTING){e.once("open",function(){a._write(t,n,r)});return}e.send(t,r)},a.on("end",o),a.on("error",s),a}},5931:(e,t,n)=>{"use strict";let{tokenChars:r}=n(1187);e.exports={parse:function(e){let t=new Set,n=-1,i=-1,o=0;for(;o<e.length;o++){let s=e.charCodeAt(o);if(-1===i&&1===r[s])-1===n&&(n=o);else if(0!==o&&(32===s||9===s))-1===i&&-1!==n&&(i=o);else if(44===s){if(-1===n)throw SyntaxError(`Unexpected character at index ${o}`);-1===i&&(i=o);let r=e.slice(n,i);if(t.has(r))throw SyntaxError(`The "${r}" subprotocol is duplicated`);t.add(r),n=i=-1}else throw SyntaxError(`Unexpected character at index ${o}`)}if(-1===n||-1!==i)throw SyntaxError("Unexpected end of input");let s=e.slice(n,o);if(t.has(s))throw SyntaxError(`The "${s}" subprotocol is duplicated`);return t.add(s),t}}},1187:(e,t,n)=>{"use strict";let{isUtf8:r}=n(8893),{hasBlob:i}=n(9030);function o(e){let t=e.length,n=0;for(;n<t;)if((128&e[n])==0)n++;else if((224&e[n])==192){if(n+1===t||(192&e[n+1])!=128||(254&e[n])==192)return!1;n+=2}else if((240&e[n])==224){if(n+2>=t||(192&e[n+1])!=128||(192&e[n+2])!=128||224===e[n]&&(224&e[n+1])==128||237===e[n]&&(224&e[n+1])==160)return!1;n+=3}else{if((248&e[n])!=240||n+3>=t||(192&e[n+1])!=128||(192&e[n+2])!=128||(192&e[n+3])!=128||240===e[n]&&(240&e[n+1])==128||244===e[n]&&e[n+1]>143||e[n]>244)return!1;n+=4}return!0}if(e.exports={isBlob:function(e){return i&&"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&("Blob"===e[Symbol.toStringTag]||"File"===e[Symbol.toStringTag])},isValidStatusCode:function(e){return e>=1e3&&e<=1014&&1004!==e&&1005!==e&&1006!==e||e>=3e3&&e<=4999},isValidUTF8:o,tokenChars:[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,1,1,1,1,1,0,0,1,1,0,1,1,0,1,1,1,1,1,1,1,1,1,1,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,0,0,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,0,1,0,1,0]},r)e.exports.isValidUTF8=function(e){return e.length<24?o(e):r(e)};else if(!process.env.WS_NO_UTF_8_VALIDATE)try{let t=n(3739);e.exports.isValidUTF8=function(e){return e.length<32?o(e):t(e)}}catch(e){}},183:(e,t,n)=>{"use strict";let r=n(7702),i=n(2615),{Duplex:o}=n(6162),{createHash:s}=n(4770),a=n(8718),l=n(8384),u=n(5931),c=n(9936),{GUID:d,kWebSocket:h}=n(9030),p=/^[+/0-9A-Za-z]{22}==$/;class f extends r{constructor(e,t){if(super(),null==(e={allowSynchronousEvents:!0,autoPong:!0,maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!1,handleProtocols:null,clientTracking:!0,verifyClient:null,noServer:!1,backlog:null,server:null,host:null,path:null,port:null,WebSocket:c,...e}).port&&!e.server&&!e.noServer||null!=e.port&&(e.server||e.noServer)||e.server&&e.noServer)throw TypeError('One and only one of the "port", "server", or "noServer" options must be specified');if(null!=e.port?(this._server=i.createServer((e,t)=>{let n=i.STATUS_CODES[426];t.writeHead(426,{"Content-Length":n.length,"Content-Type":"text/plain"}),t.end(n)}),this._server.listen(e.port,e.host,e.backlog,t)):e.server&&(this._server=e.server),this._server){let e=this.emit.bind(this,"connection");this._removeListeners=function(e,t){for(let n of Object.keys(t))e.on(n,t[n]);return function(){for(let n of Object.keys(t))e.removeListener(n,t[n])}}(this._server,{listening:this.emit.bind(this,"listening"),error:this.emit.bind(this,"error"),upgrade:(t,n,r)=>{this.handleUpgrade(t,n,r,e)}})}!0===e.perMessageDeflate&&(e.perMessageDeflate={}),e.clientTracking&&(this.clients=new Set,this._shouldEmitClose=!1),this.options=e,this._state=0}address(){if(this.options.noServer)throw Error('The server is operating in "noServer" mode');return this._server?this._server.address():null}close(e){if(2===this._state){e&&this.once("close",()=>{e(Error("The server is not running"))}),process.nextTick(m,this);return}if(e&&this.once("close",e),1!==this._state){if(this._state=1,this.options.noServer||this.options.server)this._server&&(this._removeListeners(),this._removeListeners=this._server=null),this.clients&&this.clients.size?this._shouldEmitClose=!0:process.nextTick(m,this);else{let e=this._server;this._removeListeners(),this._removeListeners=this._server=null,e.close(()=>{m(this)})}}}shouldHandle(e){if(this.options.path){let t=e.url.indexOf("?");if((-1!==t?e.url.slice(0,t):e.url)!==this.options.path)return!1}return!0}handleUpgrade(e,t,n,r){t.on("error",g);let i=e.headers["sec-websocket-key"],o=e.headers.upgrade,s=+e.headers["sec-websocket-version"];if("GET"!==e.method){v(this,e,t,405,"Invalid HTTP method");return}if(void 0===o||"websocket"!==o.toLowerCase()){v(this,e,t,400,"Invalid Upgrade header");return}if(void 0===i||!p.test(i)){v(this,e,t,400,"Missing or invalid Sec-WebSocket-Key header");return}if(13!==s&&8!==s){v(this,e,t,400,"Missing or invalid Sec-WebSocket-Version header",{"Sec-WebSocket-Version":"13, 8"});return}if(!this.shouldHandle(e)){y(t,400);return}let c=e.headers["sec-websocket-protocol"],d=new Set;if(void 0!==c)try{d=u.parse(c)}catch(n){v(this,e,t,400,"Invalid Sec-WebSocket-Protocol header");return}let h=e.headers["sec-websocket-extensions"],f={};if(this.options.perMessageDeflate&&void 0!==h){let n=new l(this.options.perMessageDeflate,!0,this.options.maxPayload);try{let e=a.parse(h);e[l.extensionName]&&(n.accept(e[l.extensionName]),f[l.extensionName]=n)}catch(n){v(this,e,t,400,"Invalid or unacceptable Sec-WebSocket-Extensions header");return}}if(this.options.verifyClient){let o={origin:e.headers[`${8===s?"sec-websocket-origin":"origin"}`],secure:!!(e.socket.authorized||e.socket.encrypted),req:e};if(2===this.options.verifyClient.length){this.options.verifyClient(o,(o,s,a,l)=>{if(!o)return y(t,s||401,a,l);this.completeUpgrade(f,i,d,e,t,n,r)});return}if(!this.options.verifyClient(o))return y(t,401)}this.completeUpgrade(f,i,d,e,t,n,r)}completeUpgrade(e,t,n,r,i,o,u){if(!i.readable||!i.writable)return i.destroy();if(i[h])throw Error("server.handleUpgrade() was called more than once with the same socket, possibly due to a misconfiguration");if(this._state>0)return y(i,503);let c=s("sha1").update(t+d).digest("base64"),p=["HTTP/1.1 101 Switching Protocols","Upgrade: websocket","Connection: Upgrade",`Sec-WebSocket-Accept: ${c}`],f=new this.options.WebSocket(null,void 0,this.options);if(n.size){let e=this.options.handleProtocols?this.options.handleProtocols(n,r):n.values().next().value;e&&(p.push(`Sec-WebSocket-Protocol: ${e}`),f._protocol=e)}if(e[l.extensionName]){let t=e[l.extensionName].params,n=a.format({[l.extensionName]:[t]});p.push(`Sec-WebSocket-Extensions: ${n}`),f._extensions=e}this.emit("headers",p,r),i.write(p.concat("\r\n").join("\r\n")),i.removeListener("error",g),f.setSocket(i,o,{allowSynchronousEvents:this.options.allowSynchronousEvents,maxPayload:this.options.maxPayload,skipUTF8Validation:this.options.skipUTF8Validation}),this.clients&&(this.clients.add(f),f.on("close",()=>{this.clients.delete(f),this._shouldEmitClose&&!this.clients.size&&process.nextTick(m,this)})),u(f,r)}}function m(e){e._state=2,e.emit("close")}function g(){this.destroy()}function y(e,t,n,r){n=n||i.STATUS_CODES[t],r={Connection:"close","Content-Type":"text/html","Content-Length":Buffer.byteLength(n),...r},e.once("finish",e.destroy),e.end(`HTTP/1.1 ${t} ${i.STATUS_CODES[t]}\r
`+Object.keys(r).map(e=>`${e}: ${r[e]}`).join("\r\n")+"\r\n\r\n"+n)}function v(e,t,n,r,i,o){if(e.listenerCount("wsClientError")){let r=Error(i);Error.captureStackTrace(r,v),e.emit("wsClientError",r,n,t)}else y(n,r,i,o)}e.exports=f},9936:(e,t,n)=>{"use strict";let r=n(7702),i=n(8791),o=n(2615),s=n(8216),a=n(2452),{randomBytes:l,createHash:u}=n(4770),{Duplex:c,Readable:d}=n(6162),{URL:h}=n(7360),p=n(8384),f=n(263),m=n(2404),{isBlob:g}=n(1187),{BINARY_TYPES:y,EMPTY_BUFFER:v,GUID:_,kForOnEventAttribute:b,kListener:E,kStatusCode:T,kWebSocket:w,NOOP:S}=n(9030),{EventTarget:{addEventListener:A,removeEventListener:C}}=n(5767),{format:O,parse:I}=n(8718),{toBuffer:k}=n(8098),R=Symbol("kAborted"),N=[8,13],P=["CONNECTING","OPEN","CLOSING","CLOSED"],x=/^[!#$%&'*+\-.0-9A-Z^_`|a-z~]+$/;class U extends r{constructor(e,t,n){super(),this._binaryType=y[0],this._closeCode=1006,this._closeFrameReceived=!1,this._closeFrameSent=!1,this._closeMessage=v,this._closeTimer=null,this._errorEmitted=!1,this._extensions={},this._paused=!1,this._protocol="",this._readyState=U.CONNECTING,this._receiver=null,this._sender=null,this._socket=null,null!==e?(this._bufferedAmount=0,this._isServer=!1,this._redirects=0,void 0===t?t=[]:Array.isArray(t)||("object"==typeof t&&null!==t?(n=t,t=[]):t=[t]),function e(t,n,r,s){let a,c,d,f;let m={allowSynchronousEvents:!0,autoPong:!0,protocolVersion:N[1],maxPayload:104857600,skipUTF8Validation:!1,perMessageDeflate:!0,followRedirects:!1,maxRedirects:10,...s,socketPath:void 0,hostname:void 0,protocol:void 0,timeout:void 0,method:"GET",host:void 0,path:void 0,port:void 0};if(t._autoPong=m.autoPong,!N.includes(m.protocolVersion))throw RangeError(`Unsupported protocol version: ${m.protocolVersion} (supported versions: ${N.join(", ")})`);if(n instanceof h)a=n;else try{a=new h(n)}catch(e){throw SyntaxError(`Invalid URL: ${n}`)}"http:"===a.protocol?a.protocol="ws:":"https:"===a.protocol&&(a.protocol="wss:"),t._url=a.href;let g="wss:"===a.protocol,y="ws+unix:"===a.protocol;if("ws:"===a.protocol||g||y?y&&!a.pathname?c="The URL's pathname is empty":a.hash&&(c="The URL contains a fragment identifier"):c='The URL\'s protocol must be one of "ws:", "wss:", "http:", "https:", or "ws+unix:"',c){let e=SyntaxError(c);if(0===t._redirects)throw e;D(t,e);return}let v=g?443:80,b=l(16).toString("base64"),E=g?i.request:o.request,T=new Set;if(m.createConnection=m.createConnection||(g?j:M),m.defaultPort=m.defaultPort||v,m.port=a.port||v,m.host=a.hostname.startsWith("[")?a.hostname.slice(1,-1):a.hostname,m.headers={...m.headers,"Sec-WebSocket-Version":m.protocolVersion,"Sec-WebSocket-Key":b,Connection:"Upgrade",Upgrade:"websocket"},m.path=a.pathname+a.search,m.timeout=m.handshakeTimeout,m.perMessageDeflate&&(d=new p(!0!==m.perMessageDeflate?m.perMessageDeflate:{},!1,m.maxPayload),m.headers["Sec-WebSocket-Extensions"]=O({[p.extensionName]:d.offer()})),r.length){for(let e of r){if("string"!=typeof e||!x.test(e)||T.has(e))throw SyntaxError("An invalid or duplicated subprotocol was specified");T.add(e)}m.headers["Sec-WebSocket-Protocol"]=r.join(",")}if(m.origin&&(m.protocolVersion<13?m.headers["Sec-WebSocket-Origin"]=m.origin:m.headers.Origin=m.origin),(a.username||a.password)&&(m.auth=`${a.username}:${a.password}`),y){let e=m.path.split(":");m.socketPath=e[0],m.path=e[1]}if(m.followRedirects){if(0===t._redirects){t._originalIpc=y,t._originalSecure=g,t._originalHostOrSocketPath=y?m.socketPath:a.host;let e=s&&s.headers;if(s={...s,headers:{}},e)for(let[t,n]of Object.entries(e))s.headers[t.toLowerCase()]=n}else if(0===t.listenerCount("redirect")){let e=y?!!t._originalIpc&&m.socketPath===t._originalHostOrSocketPath:!t._originalIpc&&a.host===t._originalHostOrSocketPath;e&&(!t._originalSecure||g)||(delete m.headers.authorization,delete m.headers.cookie,e||delete m.headers.host,m.auth=void 0)}m.auth&&!s.headers.authorization&&(s.headers.authorization="Basic "+Buffer.from(m.auth).toString("base64")),f=t._req=E(m),t._redirects&&t.emit("redirect",t.url,f)}else f=t._req=E(m);m.timeout&&f.on("timeout",()=>{L(t,f,"Opening handshake has timed out")}),f.on("error",e=>{null===f||f[R]||(f=t._req=null,D(t,e))}),f.on("response",i=>{let o=i.headers.location,a=i.statusCode;if(o&&m.followRedirects&&a>=300&&a<400){let i;if(++t._redirects>m.maxRedirects){L(t,f,"Maximum redirects exceeded");return}f.abort();try{i=new h(o,n)}catch(e){D(t,SyntaxError(`Invalid URL: ${o}`));return}e(t,i,r,s)}else t.emit("unexpected-response",f,i)||L(t,f,`Unexpected server response: ${i.statusCode}`)}),f.on("upgrade",(e,n,r)=>{let i;if(t.emit("upgrade",e),t.readyState!==U.CONNECTING)return;f=t._req=null;let o=e.headers.upgrade;if(void 0===o||"websocket"!==o.toLowerCase()){L(t,n,"Invalid Upgrade header");return}let s=u("sha1").update(b+_).digest("base64");if(e.headers["sec-websocket-accept"]!==s){L(t,n,"Invalid Sec-WebSocket-Accept header");return}let a=e.headers["sec-websocket-protocol"];if(void 0!==a?T.size?T.has(a)||(i="Server sent an invalid subprotocol"):i="Server sent a subprotocol but none was requested":T.size&&(i="Server sent no subprotocol"),i){L(t,n,i);return}a&&(t._protocol=a);let l=e.headers["sec-websocket-extensions"];if(void 0!==l){let e;if(!d){L(t,n,"Server sent a Sec-WebSocket-Extensions header but no extension was requested");return}try{e=I(l)}catch(e){L(t,n,"Invalid Sec-WebSocket-Extensions header");return}let r=Object.keys(e);if(1!==r.length||r[0]!==p.extensionName){L(t,n,"Server indicated an extension that was not requested");return}try{d.accept(e[p.extensionName])}catch(e){L(t,n,"Invalid Sec-WebSocket-Extensions header");return}t._extensions[p.extensionName]=d}t.setSocket(n,r,{allowSynchronousEvents:m.allowSynchronousEvents,generateMask:m.generateMask,maxPayload:m.maxPayload,skipUTF8Validation:m.skipUTF8Validation})}),m.finishRequest?m.finishRequest(f,t):f.end()}(this,e,t,n)):(this._autoPong=n.autoPong,this._isServer=!0)}get binaryType(){return this._binaryType}set binaryType(e){y.includes(e)&&(this._binaryType=e,this._receiver&&(this._receiver._binaryType=e))}get bufferedAmount(){return this._socket?this._socket._writableState.length+this._sender._bufferedBytes:this._bufferedAmount}get extensions(){return Object.keys(this._extensions).join()}get isPaused(){return this._paused}get onclose(){return null}get onerror(){return null}get onopen(){return null}get onmessage(){return null}get protocol(){return this._protocol}get readyState(){return this._readyState}get url(){return this._url}setSocket(e,t,n){let r=new f({allowSynchronousEvents:n.allowSynchronousEvents,binaryType:this.binaryType,extensions:this._extensions,isServer:this._isServer,maxPayload:n.maxPayload,skipUTF8Validation:n.skipUTF8Validation}),i=new m(e,this._extensions,n.generateMask);this._receiver=r,this._sender=i,this._socket=e,r[w]=this,i[w]=this,e[w]=this,r.on("conclude",q),r.on("drain",F),r.on("error",H),r.on("message",V),r.on("ping",$),r.on("pong",W),i.onerror=K,e.setTimeout&&e.setTimeout(0),e.setNoDelay&&e.setNoDelay(),t.length>0&&e.unshift(t),e.on("close",z),e.on("data",X),e.on("end",Q),e.on("error",Z),this._readyState=U.OPEN,this.emit("open")}emitClose(){if(!this._socket){this._readyState=U.CLOSED,this.emit("close",this._closeCode,this._closeMessage);return}this._extensions[p.extensionName]&&this._extensions[p.extensionName].cleanup(),this._receiver.removeAllListeners(),this._readyState=U.CLOSED,this.emit("close",this._closeCode,this._closeMessage)}close(e,t){if(this.readyState!==U.CLOSED){if(this.readyState===U.CONNECTING){L(this,this._req,"WebSocket was closed before the connection was established");return}if(this.readyState===U.CLOSING){this._closeFrameSent&&(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end();return}this._readyState=U.CLOSING,this._sender.close(e,t,!this._isServer,e=>{!e&&(this._closeFrameSent=!0,(this._closeFrameReceived||this._receiver._writableState.errorEmitted)&&this._socket.end())}),Y(this)}}pause(){this.readyState!==U.CONNECTING&&this.readyState!==U.CLOSED&&(this._paused=!0,this._socket.pause())}ping(e,t,n){if(this.readyState===U.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof e?(n=e,e=t=void 0):"function"==typeof t&&(n=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState!==U.OPEN){G(this,e,n);return}void 0===t&&(t=!this._isServer),this._sender.ping(e||v,t,n)}pong(e,t,n){if(this.readyState===U.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof e?(n=e,e=t=void 0):"function"==typeof t&&(n=t,t=void 0),"number"==typeof e&&(e=e.toString()),this.readyState!==U.OPEN){G(this,e,n);return}void 0===t&&(t=!this._isServer),this._sender.pong(e||v,t,n)}resume(){this.readyState!==U.CONNECTING&&this.readyState!==U.CLOSED&&(this._paused=!1,this._receiver._writableState.needDrain||this._socket.resume())}send(e,t,n){if(this.readyState===U.CONNECTING)throw Error("WebSocket is not open: readyState 0 (CONNECTING)");if("function"==typeof t&&(n=t,t={}),"number"==typeof e&&(e=e.toString()),this.readyState!==U.OPEN){G(this,e,n);return}let r={binary:"string"!=typeof e,mask:!this._isServer,compress:!0,fin:!0,...t};this._extensions[p.extensionName]||(r.compress=!1),this._sender.send(e||v,r,n)}terminate(){if(this.readyState!==U.CLOSED){if(this.readyState===U.CONNECTING){L(this,this._req,"WebSocket was closed before the connection was established");return}this._socket&&(this._readyState=U.CLOSING,this._socket.destroy())}}}function D(e,t){e._readyState=U.CLOSING,e._errorEmitted=!0,e.emit("error",t),e.emitClose()}function M(e){return e.path=e.socketPath,s.connect(e)}function j(e){return e.path=void 0,e.servername||""===e.servername||(e.servername=s.isIP(e.host)?"":e.host),a.connect(e)}function L(e,t,n){e._readyState=U.CLOSING;let r=Error(n);Error.captureStackTrace(r,L),t.setHeader?(t[R]=!0,t.abort(),t.socket&&!t.socket.destroyed&&t.socket.destroy(),process.nextTick(D,e,r)):(t.destroy(r),t.once("error",e.emit.bind(e,"error")),t.once("close",e.emitClose.bind(e)))}function G(e,t,n){if(t){let n=g(t)?t.size:k(t).length;e._socket?e._sender._bufferedBytes+=n:e._bufferedAmount+=n}if(n){let t=Error(`WebSocket is not open: readyState ${e.readyState} (${P[e.readyState]})`);process.nextTick(n,t)}}function q(e,t){let n=this[w];n._closeFrameReceived=!0,n._closeMessage=t,n._closeCode=e,void 0!==n._socket[w]&&(n._socket.removeListener("data",X),process.nextTick(J,n._socket),1005===e?n.close():n.close(e,t))}function F(){let e=this[w];e.isPaused||e._socket.resume()}function H(e){let t=this[w];void 0!==t._socket[w]&&(t._socket.removeListener("data",X),process.nextTick(J,t._socket),t.close(e[T])),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e))}function B(){this[w].emitClose()}function V(e,t){this[w].emit("message",e,t)}function $(e){let t=this[w];t._autoPong&&t.pong(e,!this._isServer,S),t.emit("ping",e)}function W(e){this[w].emit("pong",e)}function J(e){e.resume()}function K(e){let t=this[w];t.readyState===U.CLOSED||(t.readyState===U.OPEN&&(t._readyState=U.CLOSING,Y(t)),this._socket.end(),t._errorEmitted||(t._errorEmitted=!0,t.emit("error",e)))}function Y(e){e._closeTimer=setTimeout(e._socket.destroy.bind(e._socket),3e4)}function z(){let e;let t=this[w];this.removeListener("close",z),this.removeListener("data",X),this.removeListener("end",Q),t._readyState=U.CLOSING,this._readableState.endEmitted||t._closeFrameReceived||t._receiver._writableState.errorEmitted||null===(e=t._socket.read())||t._receiver.write(e),t._receiver.end(),this[w]=void 0,clearTimeout(t._closeTimer),t._receiver._writableState.finished||t._receiver._writableState.errorEmitted?t.emitClose():(t._receiver.on("error",B),t._receiver.on("finish",B))}function X(e){this[w]._receiver.write(e)||this.pause()}function Q(){let e=this[w];e._readyState=U.CLOSING,e._receiver.end(),this.end()}function Z(){let e=this[w];this.removeListener("error",Z),this.on("error",S),e&&(e._readyState=U.CLOSING,this.destroy())}Object.defineProperty(U,"CONNECTING",{enumerable:!0,value:P.indexOf("CONNECTING")}),Object.defineProperty(U.prototype,"CONNECTING",{enumerable:!0,value:P.indexOf("CONNECTING")}),Object.defineProperty(U,"OPEN",{enumerable:!0,value:P.indexOf("OPEN")}),Object.defineProperty(U.prototype,"OPEN",{enumerable:!0,value:P.indexOf("OPEN")}),Object.defineProperty(U,"CLOSING",{enumerable:!0,value:P.indexOf("CLOSING")}),Object.defineProperty(U.prototype,"CLOSING",{enumerable:!0,value:P.indexOf("CLOSING")}),Object.defineProperty(U,"CLOSED",{enumerable:!0,value:P.indexOf("CLOSED")}),Object.defineProperty(U.prototype,"CLOSED",{enumerable:!0,value:P.indexOf("CLOSED")}),["binaryType","bufferedAmount","extensions","isPaused","protocol","readyState","url"].forEach(e=>{Object.defineProperty(U.prototype,e,{enumerable:!0})}),["open","error","close","message"].forEach(e=>{Object.defineProperty(U.prototype,`on${e}`,{enumerable:!0,get(){for(let t of this.listeners(e))if(t[b])return t[E];return null},set(t){for(let t of this.listeners(e))if(t[b]){this.removeListener(e,t);break}"function"==typeof t&&this.addEventListener(e,t,{[b]:!0})}})}),U.prototype.addEventListener=A,U.prototype.removeEventListener=C,e.exports=U},622:(e,t,n)=>{"use strict";let r=n(7408);e.exports={pkg:r}},7598:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GCE_LINUX_BIOS_PATHS=void 0,t.isGoogleCloudServerless=s,t.isGoogleComputeEngineLinux=a,t.isGoogleComputeEngineMACAddress=l,t.isGoogleComputeEngine=u,t.detectGCPResidency=function(){return s()||u()};let r=n(2048),i=n(9801);t.GCE_LINUX_BIOS_PATHS={BIOS_DATE:"/sys/class/dmi/id/bios_date",BIOS_VENDOR:"/sys/class/dmi/id/bios_vendor"};let o=/^42:01/;function s(){return!!(process.env.CLOUD_RUN_JOB||process.env.FUNCTION_NAME||process.env.K_SERVICE)}function a(){if("linux"!==(0,i.platform)())return!1;try{(0,r.statSync)(t.GCE_LINUX_BIOS_PATHS.BIOS_DATE);let e=(0,r.readFileSync)(t.GCE_LINUX_BIOS_PATHS.BIOS_VENDOR,"utf8");return/Google/.test(e)}catch{return!1}}function l(){for(let e of Object.values((0,i.networkInterfaces)()))if(e){for(let{mac:t}of e)if(o.test(t))return!0}return!1}function u(){return a()||l()}},9972:function(e,t,n){"use strict";let r;var i,o=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var i=Object.getOwnPropertyDescriptor(t,n);(!i||("get"in i?!t.__esModule:i.writable||i.configurable))&&(i={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,i)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),s=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__importStar||(i=function(e){return(i=Object.getOwnPropertyNames||function(e){var t=[];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[t.length]=n);return t})(e)},function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n=i(e),r=0;r<n.length;r++)"default"!==n[r]&&o(t,e,n[r]);return s(t,e),t}),l=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||o(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.gcpResidencyCache=t.METADATA_SERVER_DETECTION=t.HEADERS=t.HEADER_VALUE=t.HEADER_NAME=t.SECONDARY_HOST_ADDRESS=t.HOST_ADDRESS=t.BASE_PATH=void 0,t.instance=function(e){return m("instance",e)},t.project=function(e){return m("project",e)},t.universe=function(e){return m("universe",e)},t.bulk=y,t.isAvailable=v,t.resetIsAvailableCache=function(){r=void 0},t.getGCPResidency=_,t.setGCPResidency=b,t.requestTimeout=E;let u=n(5678),c=n(9180),d=n(7598),h=a(n(3340));t.BASE_PATH="/computeMetadata/v1",t.HOST_ADDRESS="http://169.254.169.254",t.SECONDARY_HOST_ADDRESS="http://metadata.google.internal.",t.HEADER_NAME="Metadata-Flavor",t.HEADER_VALUE="Google",t.HEADERS=Object.freeze({[t.HEADER_NAME]:t.HEADER_VALUE});let p=h.log("gcp-metadata");function f(e){return e||(e=process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST||t.HOST_ADDRESS),/^https?:\/\//.test(e)||(e=`http://${e}`),new URL(t.BASE_PATH,e).href}async function m(e,n={},r=3,i=!1){let o=new Headers(t.HEADERS),s="",a={};"object"==typeof e?(new Headers(e.headers).forEach((e,t)=>o.set(t,e)),s=e.metadataKey,a=e.params||a,r=e.noResponseRetries||r,i=e.fastFail||i):s=e,"string"==typeof n?s+=`/${n}`:(function(e){Object.keys(e).forEach(e=>{switch(e){case"params":case"property":case"headers":break;case"qs":throw Error("'qs' is not a valid configuration option. Please use 'params' instead.");default:throw Error(`'${e}' is not a valid configuration option.`)}})}(n),n.property&&(s+=`/${n.property}`),new Headers(n.headers).forEach((e,t)=>o.set(t,e)),a=n.params||a);let l=i?g:u.request,d={url:`${f()}/${s}`,headers:o,retryConfig:{noResponseRetries:r},params:a,responseType:"text",timeout:E()};p.info("instance request %j",d);let h=await l(d);p.info("instance metadata is %s",h.data);let m=h.headers.get(t.HEADER_NAME);if(m!==t.HEADER_VALUE)throw RangeError(`Invalid response from metadata service: incorrect ${t.HEADER_NAME} header. Expected '${t.HEADER_VALUE}', got ${m?`'${m}'`:"no header"}`);if("string"==typeof h.data)try{return c.parse(h.data)}catch{}return h.data}async function g(e){let n={...e,url:e.url?.toString().replace(f(),f(t.SECONDARY_HOST_ADDRESS))};return Promise.any([(0,u.request)(e),(0,u.request)(n)])}async function y(e){let t={};return await Promise.all(e.map(e=>(async()=>{let n=await m(e);t[e.metadataKey]=n})())),t}async function v(){if(process.env.METADATA_SERVER_DETECTION){let e=process.env.METADATA_SERVER_DETECTION.trim().toLocaleLowerCase();if(!(e in t.METADATA_SERVER_DETECTION))throw RangeError(`Unknown \`METADATA_SERVER_DETECTION\` env variable. Got \`${e}\`, but it should be \`${Object.keys(t.METADATA_SERVER_DETECTION).join("`, `")}\`, or unset`);switch(e){case"assume-present":return!0;case"none":return!1;case"bios-only":return _()}}try{return void 0===r&&(r=m("instance",void 0,process.env.DETECT_GCP_RETRIES?Number(process.env.DETECT_GCP_RETRIES):0,!(process.env.GCE_METADATA_IP||process.env.GCE_METADATA_HOST))),await r,!0}catch(e){if(process.env.DEBUG_AUTH&&console.info(e),"request-timeout"===e.type||e.response&&404===e.response.status)return!1;if(!(e.response&&404===e.response.status)&&(!e.code||!["EHOSTDOWN","EHOSTUNREACH","ENETUNREACH","ENOENT","ENOTFOUND","ECONNREFUSED"].includes(e.code.toString()))){let t="UNKNOWN";e.code&&(t=e.code.toString()),process.emitWarning(`received unexpected error = ${e.message} code = ${t}`,"MetadataLookupWarning")}return!1}}function _(){return null===t.gcpResidencyCache&&b(),t.gcpResidencyCache}function b(e=null){t.gcpResidencyCache=null!==e?e:(0,d.detectGCPResidency)()}function E(){return _()?0:3e3}t.METADATA_SERVER_DETECTION=Object.freeze({"assume-present":"don't try to ping the metadata server, but assume it's present",none:"don't try to ping the metadata server, but don't try to use it either","bios-only":"treat the result of a BIOS probe as canonical (don't fall back to pinging)","ping-only":"skip the BIOS probe, and go straight to pinging"}),t.gcpResidencyCache=null,l(n(7598),t)},9662:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.USER_AGENT=t.PRODUCT_NAME=t.pkg=void 0;let r=n(8688);t.pkg=r;let i="google-api-nodejs-client";t.PRODUCT_NAME=i;let o=`${i}/${r.version}`;t.USER_AGENT=o},1053:(e,t,n)=>{"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GoogleToken=void 0;var r=l(n(2048)),i=n(5678),o=l(n(843)),s=l(n(5315)),a=n(1764);function l(e,t){if("function"==typeof WeakMap)var n=new WeakMap,r=new WeakMap;return(l=function(e,t){if(!t&&e&&e.__esModule)return e;var i,o,s={__proto__:null,default:e};if(null===e||"object"!=u(e)&&"function"!=typeof e)return s;if(i=t?r:n){if(i.has(e))return i.get(e);i.set(e,s)}for(var a in e)"default"!==a&&({}).hasOwnProperty.call(e,a)&&((o=(i=Object.defineProperty)&&Object.getOwnPropertyDescriptor(e,a))&&(o.get||o.set)?i(s,a,o):s[a]=e[a]);return s})(e,t)}function u(e){return(u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function c(e,t){if(t.has(e))throw TypeError("Cannot initialize the same private elements twice on an object")}function d(e,t,n){return e.set(h(e,t),n),n}function h(e,t,n){if("function"==typeof e?e===t:e.has(t))return arguments.length<3?t:n;throw TypeError("Private element is not present on this object")}function p(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,E(r.key),r)}}function f(e,t,n){return t&&p(e.prototype,t),n&&p(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function m(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function g(e){var t="function"==typeof Map?new Map:void 0;return(g=function(e){if(null===e||!function(e){try{return -1!==Function.toString.call(e).indexOf("[native code]")}catch(t){return"function"==typeof e}}(e))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return function(e,t,n){if(y())return Reflect.construct.apply(null,arguments);var r=[null];r.push.apply(r,t);var i=new(e.bind.apply(e,r));return n&&v(i,n.prototype),i}(e,arguments,_(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),v(n,e)})(e)}function y(){try{var e=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch(e){}return(y=function(){return!!e})()}function v(e,t){return(v=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function _(e){return(_=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function b(e,t,n){return(t=E(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function E(e){var t=function(e,t){if("object"!=u(e)||!e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=u(r))return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==u(t)?t:t+""}function T(){var e,t,n="function"==typeof Symbol?Symbol:{},r=n.iterator||"@@iterator",i=n.toStringTag||"@@toStringTag";function o(n,r,i,o){var l=Object.create((r&&r.prototype instanceof a?r:a).prototype);return w(l,"_invoke",function(n,r,i){var o,a,l,u=0,c=i||[],d=!1,h={p:0,n:0,v:e,a:p,f:p.bind(e,4),d:function(t,n){return o=t,a=0,l=e,h.n=n,s}};function p(n,r){for(a=n,l=r,t=0;!d&&u&&!i&&t<c.length;t++){var i,o=c[t],p=h.p,f=o[2];n>3?(i=f===r)&&(l=o[(a=o[4])?5:(a=3,3)],o[4]=o[5]=e):o[0]<=p&&((i=n<2&&p<o[1])?(a=0,h.v=r,h.n=o[1]):p<f&&(i=n<3||o[0]>r||r>f)&&(o[4]=n,o[5]=r,h.n=f,a=0))}if(i||n>1)return s;throw d=!0,r}return function(i,c,f){if(u>1)throw TypeError("Generator is already running");for(d&&1===c&&p(c,f),a=c,l=f;(t=a<2?e:l)||!d;){o||(a?a<3?(a>1&&(h.n=-1),p(a,l)):h.n=l:h.v=l);try{if(u=2,o){if(a||(i="next"),t=o[i]){if(!(t=t.call(o,l)))throw TypeError("iterator result is not an object");if(!t.done)return t;l=t.value,a<2&&(a=0)}else 1===a&&(t=o.return)&&t.call(o),a<2&&(l=TypeError("The iterator does not provide a '"+i+"' method"),a=1);o=e}else if((t=(d=h.n<0)?l:n.call(r,h))!==s)break}catch(t){o=e,a=1,l=t}finally{u=1}}return{value:t,done:d}}}(n,i,o),!0),l}var s={};function a(){}function l(){}function u(){}t=Object.getPrototypeOf;var c=[][r]?t(t([][r]())):(w(t={},r,function(){return this}),t),d=u.prototype=a.prototype=Object.create(c);function h(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,u):(e.__proto__=u,w(e,i,"GeneratorFunction")),e.prototype=Object.create(d),e}return l.prototype=u,w(d,"constructor",u),w(u,"constructor",l),l.displayName="GeneratorFunction",w(u,i,"GeneratorFunction"),w(d),w(d,i,"Generator"),w(d,r,function(){return this}),w(d,"toString",function(){return"[object Generator]"}),(T=function(){return{w:o,m:h}})()}function w(e,t,n,r){var i=Object.defineProperty;try{i({},"",{})}catch(e){i=0}(w=function(e,t,n,r){if(t)i?i(e,t,{value:n,enumerable:!r,configurable:!r,writable:!r}):e[t]=n;else{var o=function(t,n){w(e,t,function(e){return this._invoke(t,n,e)})};o("next",0),o("throw",1),o("return",2)}})(e,t,n,r)}function S(e,t,n,r,i,o,s){try{var a=e[o](s),l=a.value}catch(e){return void n(e)}a.done?t(l):Promise.resolve(l).then(r,i)}function A(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var o=e.apply(t,n);function s(e){S(o,r,i,s,a,"next",e)}function a(e){S(o,r,i,s,a,"throw",e)}s(void 0)})}}var C=r.readFile?(0,a.promisify)(r.readFile):A(T().m(function e(){return T().w(function(e){for(;;)switch(e.n){case 0:throw new I("use key rather than keyFile.","MISSING_CREDENTIALS");case 1:return e.a(2)}},e)})),O="https://oauth2.googleapis.com/token",I=function(e){function t(e,n){var r,i,o;return m(this,t),i=t,o=[e],i=_(i),b(r=function(e,t){if(t&&("object"==u(t)||"function"==typeof t))return t;if(void 0!==t)throw TypeError("Derived constructors may only return object or undefined");return function(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}(e)}(this,y()?Reflect.construct(i,o||[],_(this).constructor):i.apply(this,o)),"code",void 0),r.code=n,r}return function(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&v(e,t)}(t,e),f(t)}(g(Error)),k=new WeakMap,R=new WeakSet;function N(e){return P.apply(this,arguments)}function P(){return(P=A(T().m(function e(t){return T().w(function(e){for(;;)switch(e.n){case 0:if(!k.get(h(k,this))||t.forceRefresh){e.n=1;break}return e.a(2,k.get(h(k,this)));case 1:return e.p=1,e.n=2,d(k,this,h(R,this,x).call(this,t));case 2:return e.a(2,e.v);case 3:return e.p=3,d(k,this,void 0),e.f(3);case 4:return e.a(2)}},e,this,[[1,,3,4]])}))).apply(this,arguments)}function x(e){return U.apply(this,arguments)}function U(){return(U=A(T().m(function e(t){var n;return T().w(function(e){for(;;)switch(e.n){case 0:if(!(!1===this.isTokenExpiring()&&!1===t.forceRefresh)){e.n=1;break}return e.a(2,Promise.resolve(this.rawToken));case 1:if(!(!this.key&&!this.keyFile)){e.n=2;break}throw Error("No key or keyFile set.");case 2:if(!(!this.key&&this.keyFile)){e.n=4;break}return e.n=3,this.getCredentials(this.keyFile);case 3:n=e.v,this.key=n.privateKey,this.iss=n.clientEmail||this.iss,n.clientEmail||h(R,this,D).call(this);case 4:return e.a(2,h(R,this,G).call(this))}},e,this)}))).apply(this,arguments)}function D(){if(!this.iss)throw new I("email is required.","MISSING_CREDENTIALS")}function M(){return j.apply(this,arguments)}function j(){return(j=A(T().m(function e(){var t;return T().w(function(e){for(;;)switch(e.n){case 0:if(this.accessToken){e.n=1;break}throw Error("No token to revoke.");case 1:return t="https://oauth2.googleapis.com/revoke?token="+this.accessToken,e.n=2,this.transporter.request({url:t,retry:!0});case 2:h(R,this,L).call(this,{email:this.iss,sub:this.sub,key:this.key,keyFile:this.keyFile,scope:this.scope,additionalClaims:this.additionalClaims});case 3:return e.a(2)}},e,this)}))).apply(this,arguments)}function L(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.keyFile=e.keyFile,this.key=e.key,this.rawToken=void 0,this.iss=e.email||e.iss,this.sub=e.sub,this.additionalClaims=e.additionalClaims,"object"===u(e.scope)?this.scope=e.scope.join(" "):this.scope=e.scope,this.eagerRefreshThresholdMillis=e.eagerRefreshThresholdMillis,e.transporter&&(this.transporter=e.transporter)}function G(){return q.apply(this,arguments)}function q(){return(q=A(T().m(function e(){var t,n,r,i,s,a,l,u,c,d;return T().w(function(e){for(;;)switch(e.n){case 0:return t=Math.floor(new Date().getTime()/1e3),n=this.additionalClaims||{},r=Object.assign({iss:this.iss,scope:this.scope,aud:O,exp:t+3600,iat:t,sub:this.sub},n),i=o.sign({header:{alg:"RS256"},payload:r,secret:this.key}),e.p=1,e.n=2,this.transporter.request({method:"POST",url:O,data:new URLSearchParams({grant_type:"urn:ietf:params:oauth:grant-type:jwt-bearer",assertion:i}),responseType:"json",retryConfig:{httpMethodsToRetry:["POST"]}});case 2:return s=e.v,this.rawToken=s.data,this.expiresAt=null===s.data.expires_in||void 0===s.data.expires_in?void 0:(t+s.data.expires_in)*1e3,e.a(2,this.rawToken);case 3:throw e.p=3,d=e.v,this.rawToken=void 0,this.tokenExpires=void 0,(u=d.response&&null!==(a=d.response)&&void 0!==a&&a.data?null===(l=d.response)||void 0===l?void 0:l.data:{}).error&&(c=u.error_description?": ".concat(u.error_description):"",d.message="".concat(u.error).concat(c)),d;case 4:return e.a(2)}},e,this,[[1,3]])}))).apply(this,arguments)}t.GoogleToken=function(){var e;return f(function e(t){var n;m(this,e),c(this,R),R.add(this),b(this,"expiresAt",void 0),b(this,"key",void 0),b(this,"keyFile",void 0),b(this,"iss",void 0),b(this,"sub",void 0),b(this,"scope",void 0),b(this,"rawToken",void 0),b(this,"tokenExpires",void 0),b(this,"email",void 0),b(this,"additionalClaims",void 0),b(this,"eagerRefreshThresholdMillis",void 0),b(this,"transporter",{request:function(e){return(0,i.request)(e)}}),n=void 0,c(this,k),k.set(this,n),h(R,this,L).call(this,t)},[{key:"accessToken",get:function(){return this.rawToken?this.rawToken.access_token:void 0}},{key:"idToken",get:function(){return this.rawToken?this.rawToken.id_token:void 0}},{key:"tokenType",get:function(){return this.rawToken?this.rawToken.token_type:void 0}},{key:"refreshToken",get:function(){return this.rawToken?this.rawToken.refresh_token:void 0}},{key:"hasExpired",value:function(){var e=new Date().getTime();return!this.rawToken||!this.expiresAt||e>=this.expiresAt}},{key:"isTokenExpiring",value:function(){var e,t=new Date().getTime(),n=null!==(e=this.eagerRefreshThresholdMillis)&&void 0!==e?e:0;return!this.rawToken||!this.expiresAt||this.expiresAt<=t+n}},{key:"getToken",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("object"===u(e)&&(t=e,e=void 0),t=Object.assign({forceRefresh:!1},t),e){var n=e;h(R,this,N).call(this,t).then(function(e){return n(null,e)},e);return}return h(R,this,N).call(this,t)}},{key:"getCredentials",value:(e=A(T().m(function e(t){var n,r,i,o,a;return T().w(function(e){for(;;)switch(e.n){case 0:a=s.extname(t),e.n=".json"===a?1:".der"===a?4:".crt"===a?4:".pem"===a?4:".p12"===a?6:".pfx"===a?6:7;break;case 1:return e.n=2,C(t,"utf8");case 2:if(r=(n=JSON.parse(e.v)).private_key,i=n.client_email,!(!r||!i)){e.n=3;break}throw new I("private_key and client_email are required.","MISSING_CREDENTIALS");case 3:return e.a(2,{privateKey:r,clientEmail:i});case 4:return e.n=5,C(t,"utf8");case 5:return o=e.v,e.a(2,{privateKey:o});case 6:throw new I("*.p12 certificates are not supported after v6.1.2. Consider utilizing *.json format or converting *.p12 to *.pem using the OpenSSL CLI.","UNKNOWN_CERTIFICATE_TYPE");case 7:throw new I("Unknown certificate type. Type is determined based on file extension. Current supported extensions are *.json, and *.pem.","UNKNOWN_CERTIFICATE_TYPE");case 8:return e.a(2)}},e)})),function(t){return e.apply(this,arguments)})},{key:"revokeToken",value:function(e){if(e){h(R,this,M).call(this).then(function(){return e()},e);return}return h(R,this,M).call(this)}}])}()},7408:e=>{"use strict";e.exports=JSON.parse('{"name":"gaxios","version":"7.1.3","description":"A simple common HTTP client specifically for Google APIs and services.","main":"build/cjs/src/index.js","types":"build/cjs/src/index.d.ts","files":["build/"],"exports":{".":{"import":{"types":"./build/esm/src/index.d.ts","default":"./build/esm/src/index.js"},"require":{"types":"./build/cjs/src/index.d.ts","default":"./build/cjs/src/index.js"}}},"scripts":{"lint":"gts check --no-inline-config","test":"c8 mocha build/esm/test","presystem-test":"npm run compile","system-test":"mocha build/esm/system-test --timeout 80000","compile":"tsc -b ./tsconfig.json ./tsconfig.cjs.json && node utils/enable-esm.mjs","fix":"gts fix","prepare":"npm run compile","pretest":"npm run compile","webpack":"webpack","prebrowser-test":"npm run compile","browser-test":"node build/browser-test/browser-test-runner.js","docs":"jsdoc -c .jsdoc.js","docs-test":"linkinator docs","predocs-test":"npm run docs","samples-test":"cd samples/ && npm link ../ && npm test && cd ../","prelint":"cd samples; npm link ../; npm install","clean":"gts clean"},"repository":{"type":"git","directory":"packages/gaxios","url":"https://github.com/googleapis/google-cloud-node-core.git"},"keywords":["google"],"engines":{"node":">=18"},"author":"Google, LLC","license":"Apache-2.0","devDependencies":{"@babel/plugin-proposal-private-methods":"^7.18.6","@types/cors":"^2.8.6","@types/express":"^5.0.0","@types/extend":"^3.0.1","@types/mocha":"^10.0.10","@types/multiparty":"4.2.1","@types/mv":"^2.1.0","@types/ncp":"^2.0.1","@types/node":"^22.0.0","@types/sinon":"^17.0.0","@types/tmp":"0.2.6","assert":"^2.0.0","browserify":"^17.0.0","c8":"^10.0.0","cors":"^2.8.5","express":"^5.0.0","gts":"^6.0.0","is-docker":"^3.0.0","jsdoc":"^4.0.0","jsdoc-fresh":"^5.0.0","jsdoc-region-tag":"^4.0.0","karma":"^6.0.0","karma-chrome-launcher":"^3.0.0","karma-coverage":"^2.0.0","karma-firefox-launcher":"^2.0.0","karma-mocha":"^2.0.0","karma-remap-coverage":"^0.1.5","karma-sourcemap-loader":"^0.4.0","karma-webpack":"^5.0.1","linkinator":"^6.1.2","mocha":"^11.1.0","multiparty":"^4.2.1","mv":"^2.1.1","ncp":"^2.0.0","nock":"^14.0.0-beta.13","null-loader":"^4.0.0","pack-n-play":"^4.0.0","puppeteer":"^24.0.0","sinon":"^21.0.0","stream-browserify":"^3.0.0","tmp":"0.2.5","ts-loader":"^9.5.2","typescript":"^5.8.3","webpack":"^5.35.0","webpack-cli":"^6.0.1"},"dependencies":{"extend":"^3.0.2","https-proxy-agent":"^7.0.1","node-fetch":"^3.3.2","rimraf":"^5.0.1"},"homepage":"https://github.com/googleapis/google-cloud-node-core/tree/main/packages/gaxios"}')},8688:e=>{"use strict";e.exports=JSON.parse('{"name":"google-auth-library","version":"10.5.0","author":"Google Inc.","description":"Google APIs Authentication Client Library for Node.js","engines":{"node":">=18"},"main":"./build/src/index.js","types":"./build/src/index.d.ts","repository":"googleapis/google-auth-library-nodejs.git","keywords":["google","api","google apis","client","client library"],"dependencies":{"base64-js":"^1.3.0","ecdsa-sig-formatter":"^1.0.11","gaxios":"^7.0.0","gcp-metadata":"^8.0.0","google-logging-utils":"^1.0.0","gtoken":"^8.0.0","jws":"^4.0.0"},"devDependencies":{"@types/base64-js":"^1.2.5","@types/jws":"^3.1.0","@types/mocha":"^10.0.10","@types/mv":"^2.1.0","@types/ncp":"^2.0.1","@types/node":"^22.0.0","@types/sinon":"^17.0.0","assert-rejects":"^1.0.0","c8":"^10.0.0","codecov":"^3.0.2","gts":"^6.0.0","is-docker":"^3.0.0","jsdoc":"^4.0.0","jsdoc-fresh":"^5.0.0","jsdoc-region-tag":"^4.0.0","karma":"^6.0.0","karma-chrome-launcher":"^3.0.0","karma-coverage":"^2.0.0","karma-firefox-launcher":"^2.0.0","karma-mocha":"^2.0.0","karma-sourcemap-loader":"^0.4.0","karma-webpack":"^5.0.1","keypair":"^1.0.4","mocha":"^11.1.0","mv":"^2.1.1","ncp":"^2.0.0","nock":"^14.0.5","null-loader":"^4.0.0","puppeteer":"^24.0.0","sinon":"^21.0.0","ts-loader":"^8.0.0","typescript":"5.8.2","webpack":"^5.21.2","webpack-cli":"^4.0.0"},"files":["build/src","!build/src/**/*.map"],"scripts":{"test":"c8 mocha build/test","clean":"gts clean","prepare":"npm run compile","lint":"gts check --no-inline-config","compile":"tsc -p .","fix":"gts fix","pretest":"npm run compile -- --sourceMap","docs":"jsdoc -c .jsdoc.js","samples-setup":"cd samples/ && npm link ../ && npm run setup && cd ../","samples-test":"cd samples/ && npm link ../ && npm test && cd ../","system-test":"mocha build/system-test --timeout 60000","presystem-test":"npm run compile -- --sourceMap","webpack":"webpack","browser-test":"karma start","docs-test":"echo \'disabled until linkinator is fixed\'","predocs-test":"npm run docs","prelint":"cd samples; npm link ../; npm install"},"license":"Apache-2.0"}')}};var t=require("../../../webpack-runtime.js");t.C(e);var n=e=>t(t.s=e),r=t.X(0,[948],()=>n(7509));module.exports=r})();